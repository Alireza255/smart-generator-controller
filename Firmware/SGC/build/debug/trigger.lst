ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"trigger.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "controller/engine_cycle/trigger.c"
  20              		.section	.text.set_filtering,"ax",%progbits
  21              		.align	1
  22              		.global	set_filtering
  23              		.syntax unified
  24              		.thumb
  25              		.thumb_func
  27              	set_filtering:
  28              	.LFB135:
   1:controller/engine_cycle/trigger.c **** #include "trigger.h"
   2:controller/engine_cycle/trigger.c **** 
   3:controller/engine_cycle/trigger.c **** 
   4:controller/engine_cycle/trigger.c **** trigger_status_s trigger_status = {0};
   5:controller/engine_cycle/trigger.c **** 
   6:controller/engine_cycle/trigger.c **** void set_filtering(void);
   7:controller/engine_cycle/trigger.c **** 
   8:controller/engine_cycle/trigger.c **** volatile controller_time_us_t trigger_filter_time_us = 0;
   9:controller/engine_cycle/trigger.c **** 
  10:controller/engine_cycle/trigger.c **** volatile controller_time_us_t tooth_time_us[3] = {0}; // the higher the index, the older the sample
  11:controller/engine_cycle/trigger.c **** volatile controller_time_us_t current_tooth_gap_us;
  12:controller/engine_cycle/trigger.c **** volatile controller_time_us_t target_tooth_gap_us;
  13:controller/engine_cycle/trigger.c **** volatile uint16_t counted_tooth = 0;
  14:controller/engine_cycle/trigger.c **** 
  15:controller/engine_cycle/trigger.c **** uint8_t trigger_actual_teeth = 0;
  16:controller/engine_cycle/trigger.c **** 
  17:controller/engine_cycle/trigger.c **** void trigger_set_filtering(trigger_filtering_e filtering_level)
  18:controller/engine_cycle/trigger.c **** {
  19:controller/engine_cycle/trigger.c ****   settings.trigger_filtering = filtering_level;
  20:controller/engine_cycle/trigger.c **** 
  21:controller/engine_cycle/trigger.c ****   set_filtering();
  22:controller/engine_cycle/trigger.c **** }
  23:controller/engine_cycle/trigger.c **** 
  24:controller/engine_cycle/trigger.c **** void set_filtering(void)
  25:controller/engine_cycle/trigger.c **** {
  29              		.loc 1 25 1 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 2


  26:controller/engine_cycle/trigger.c ****   switch (settings.trigger_filtering)
  34              		.loc 1 26 3 view .LVU1
  35              		.loc 1 26 19 is_stmt 0 view .LVU2
  36 0000 114B     		ldr	r3, .L9
  37 0002 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
  38              		.loc 1 26 3 view .LVU3
  39 0004 032B     		cmp	r3, #3
  40 0006 1AD8     		bhi	.L2
  41 0008 DFE803F0 		tbb	[pc, r3]
  42              	.L4:
  43 000c 02       		.byte	(.L7-.L4)/2
  44 000d 06       		.byte	(.L6-.L4)/2
  45 000e 0C       		.byte	(.L5-.L4)/2
  46 000f 11       		.byte	(.L3-.L4)/2
  47              		.p2align 1
  48              	.L7:
  27:controller/engine_cycle/trigger.c ****   {
  28:controller/engine_cycle/trigger.c ****     case TF_FILTERING_NONE:
  29:controller/engine_cycle/trigger.c ****         trigger_filter_time_us = 0;
  49              		.loc 1 29 9 is_stmt 1 view .LVU4
  50              		.loc 1 29 32 is_stmt 0 view .LVU5
  51 0010 0E4B     		ldr	r3, .L9+4
  52 0012 0022     		movs	r2, #0
  53 0014 1A60     		str	r2, [r3]
  30:controller/engine_cycle/trigger.c ****         break;
  54              		.loc 1 30 9 is_stmt 1 view .LVU6
  55 0016 7047     		bx	lr
  56              	.L6:
  31:controller/engine_cycle/trigger.c ****     case TF_FILTERING_LITE:
  32:controller/engine_cycle/trigger.c ****         trigger_filter_time_us = current_tooth_gap_us / 4U; 
  57              		.loc 1 32 9 view .LVU7
  58              		.loc 1 32 55 is_stmt 0 view .LVU8
  59 0018 0D4B     		ldr	r3, .L9+8
  60 001a 1B68     		ldr	r3, [r3]
  61 001c 9B08     		lsrs	r3, r3, #2
  62              		.loc 1 32 32 view .LVU9
  63 001e 0B4A     		ldr	r2, .L9+4
  64 0020 1360     		str	r3, [r2]
  33:controller/engine_cycle/trigger.c ****         break;
  65              		.loc 1 33 9 is_stmt 1 view .LVU10
  66 0022 7047     		bx	lr
  67              	.L5:
  34:controller/engine_cycle/trigger.c ****     case TF_FILTERING_MEDIUM:
  35:controller/engine_cycle/trigger.c ****         trigger_filter_time_us = current_tooth_gap_us / 1U;
  68              		.loc 1 35 9 view .LVU11
  69              		.loc 1 35 32 is_stmt 0 view .LVU12
  70 0024 0A4B     		ldr	r3, .L9+8
  71 0026 1A68     		ldr	r2, [r3]
  72 0028 084B     		ldr	r3, .L9+4
  73 002a 1A60     		str	r2, [r3]
  36:controller/engine_cycle/trigger.c ****         break;
  74              		.loc 1 36 9 is_stmt 1 view .LVU13
  75 002c 7047     		bx	lr
  76              	.L3:
  37:controller/engine_cycle/trigger.c ****     case TF_FILTERING_AGGRESSIVE:
  38:controller/engine_cycle/trigger.c ****         trigger_filter_time_us = current_tooth_gap_us * 3 / 4;
  77              		.loc 1 38 9 view .LVU14
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 3


  78              		.loc 1 38 55 is_stmt 0 view .LVU15
  79 002e 084B     		ldr	r3, .L9+8
  80 0030 1B68     		ldr	r3, [r3]
  81 0032 03EB4303 		add	r3, r3, r3, lsl #1
  82              		.loc 1 38 59 view .LVU16
  83 0036 9B08     		lsrs	r3, r3, #2
  84              		.loc 1 38 32 view .LVU17
  85 0038 044A     		ldr	r2, .L9+4
  86 003a 1360     		str	r3, [r2]
  39:controller/engine_cycle/trigger.c ****         break;
  87              		.loc 1 39 9 is_stmt 1 view .LVU18
  88 003c 7047     		bx	lr
  89              	.L2:
  40:controller/engine_cycle/trigger.c ****     default:
  41:controller/engine_cycle/trigger.c ****         // Handle invalid filtering level
  42:controller/engine_cycle/trigger.c ****         trigger_filter_time_us = 0;
  90              		.loc 1 42 9 view .LVU19
  91              		.loc 1 42 32 is_stmt 0 view .LVU20
  92 003e 034B     		ldr	r3, .L9+4
  93 0040 0022     		movs	r2, #0
  94 0042 1A60     		str	r2, [r3]
  43:controller/engine_cycle/trigger.c ****         break;
  95              		.loc 1 43 9 is_stmt 1 view .LVU21
  44:controller/engine_cycle/trigger.c ****   }
  45:controller/engine_cycle/trigger.c **** }
  96              		.loc 1 45 1 is_stmt 0 view .LVU22
  97 0044 7047     		bx	lr
  98              	.L10:
  99 0046 00BF     		.align	2
 100              	.L9:
 101 0048 00000000 		.word	settings
 102 004c 00000000 		.word	trigger_filter_time_us
 103 0050 00000000 		.word	current_tooth_gap_us
 104              		.cfi_endproc
 105              	.LFE135:
 107              		.section	.text.trigger_set_filtering,"ax",%progbits
 108              		.align	1
 109              		.global	trigger_set_filtering
 110              		.syntax unified
 111              		.thumb
 112              		.thumb_func
 114              	trigger_set_filtering:
 115              	.LVL0:
 116              	.LFB134:
  18:controller/engine_cycle/trigger.c ****   settings.trigger_filtering = filtering_level;
 117              		.loc 1 18 1 is_stmt 1 view -0
 118              		.cfi_startproc
 119              		@ args = 0, pretend = 0, frame = 0
 120              		@ frame_needed = 0, uses_anonymous_args = 0
  18:controller/engine_cycle/trigger.c ****   settings.trigger_filtering = filtering_level;
 121              		.loc 1 18 1 is_stmt 0 view .LVU24
 122 0000 08B5     		push	{r3, lr}
 123              		.cfi_def_cfa_offset 8
 124              		.cfi_offset 3, -8
 125              		.cfi_offset 14, -4
  19:controller/engine_cycle/trigger.c **** 
 126              		.loc 1 19 3 is_stmt 1 view .LVU25
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 4


  19:controller/engine_cycle/trigger.c **** 
 127              		.loc 1 19 30 is_stmt 0 view .LVU26
 128 0002 024B     		ldr	r3, .L13
 129 0004 1870     		strb	r0, [r3]
  21:controller/engine_cycle/trigger.c **** }
 130              		.loc 1 21 3 is_stmt 1 view .LVU27
 131 0006 FFF7FEFF 		bl	set_filtering
 132              	.LVL1:
  22:controller/engine_cycle/trigger.c **** 
 133              		.loc 1 22 1 is_stmt 0 view .LVU28
 134 000a 08BD     		pop	{r3, pc}
 135              	.L14:
 136              		.align	2
 137              	.L13:
 138 000c 00000000 		.word	settings
 139              		.cfi_endproc
 140              	.LFE134:
 142              		.section	.text.trigger_init,"ax",%progbits
 143              		.align	1
 144              		.global	trigger_init
 145              		.syntax unified
 146              		.thumb
 147              		.thumb_func
 149              	trigger_init:
 150              	.LFB136:
  46:controller/engine_cycle/trigger.c **** 
  47:controller/engine_cycle/trigger.c **** void trigger_init(void)
  48:controller/engine_cycle/trigger.c **** {   
 151              		.loc 1 48 1 is_stmt 1 view -0
 152              		.cfi_startproc
 153              		@ args = 0, pretend = 0, frame = 0
 154              		@ frame_needed = 0, uses_anonymous_args = 0
 155 0000 38B5     		push	{r3, r4, r5, lr}
 156              		.cfi_def_cfa_offset 16
 157              		.cfi_offset 3, -16
 158              		.cfi_offset 4, -12
 159              		.cfi_offset 5, -8
 160              		.cfi_offset 14, -4
  49:controller/engine_cycle/trigger.c ****     trigger_status.sync_status = TS_NOT_SYNCED;
 161              		.loc 1 49 5 view .LVU30
 162              		.loc 1 49 32 is_stmt 0 view .LVU31
 163 0002 074D     		ldr	r5, .L17
 164 0004 0023     		movs	r3, #0
 165 0006 6B70     		strb	r3, [r5, #1]
  50:controller/engine_cycle/trigger.c ****     trigger_set_filtering(settings.trigger_filtering);
 166              		.loc 1 50 5 is_stmt 1 view .LVU32
 167              		.loc 1 50 35 is_stmt 0 view .LVU33
 168 0008 064C     		ldr	r4, .L17+4
 169              		.loc 1 50 5 view .LVU34
 170 000a 2078     		ldrb	r0, [r4]	@ zero_extendqisi2
 171 000c FFF7FEFF 		bl	trigger_set_filtering
 172              	.LVL2:
  51:controller/engine_cycle/trigger.c ****     trigger_actual_teeth = settings.trigger_full_teeth - settings.trigger_missing_teeth;
 173              		.loc 1 51 5 is_stmt 1 view .LVU35
 174              		.loc 1 51 36 is_stmt 0 view .LVU36
 175 0010 A378     		ldrb	r3, [r4, #2]	@ zero_extendqisi2
 176              		.loc 1 51 66 view .LVU37
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 5


 177 0012 6278     		ldrb	r2, [r4, #1]	@ zero_extendqisi2
 178              		.loc 1 51 56 view .LVU38
 179 0014 9B1A     		subs	r3, r3, r2
 180              		.loc 1 51 26 view .LVU39
 181 0016 044A     		ldr	r2, .L17+8
 182 0018 1370     		strb	r3, [r2]
  52:controller/engine_cycle/trigger.c ****     
  53:controller/engine_cycle/trigger.c ****     
  54:controller/engine_cycle/trigger.c ****     trigger_status.initialized = true;
 183              		.loc 1 54 5 is_stmt 1 view .LVU40
 184              		.loc 1 54 32 is_stmt 0 view .LVU41
 185 001a 0123     		movs	r3, #1
 186 001c 2B70     		strb	r3, [r5]
  55:controller/engine_cycle/trigger.c ****     
  56:controller/engine_cycle/trigger.c **** }
 187              		.loc 1 56 1 view .LVU42
 188 001e 38BD     		pop	{r3, r4, r5, pc}
 189              	.L18:
 190              		.align	2
 191              	.L17:
 192 0020 00000000 		.word	trigger_status
 193 0024 00000000 		.word	settings
 194 0028 00000000 		.word	trigger_actual_teeth
 195              		.cfi_endproc
 196              	.LFE136:
 198              		.section	.text.trigger_tooth_handle,"ax",%progbits
 199              		.align	1
 200              		.global	trigger_tooth_handle
 201              		.syntax unified
 202              		.thumb
 203              		.thumb_func
 205              	trigger_tooth_handle:
 206              	.LFB137:
  57:controller/engine_cycle/trigger.c **** void trigger_tooth_handle(void)
  58:controller/engine_cycle/trigger.c **** {
 207              		.loc 1 58 1 is_stmt 1 view -0
 208              		.cfi_startproc
 209              		@ args = 0, pretend = 0, frame = 0
 210              		@ frame_needed = 0, uses_anonymous_args = 0
 211 0000 08B5     		push	{r3, lr}
 212              		.cfi_def_cfa_offset 8
 213              		.cfi_offset 3, -8
 214              		.cfi_offset 14, -4
  59:controller/engine_cycle/trigger.c **** 
  60:controller/engine_cycle/trigger.c ****   if (!trigger_status.initialized)
 215              		.loc 1 60 3 view .LVU44
 216              		.loc 1 60 22 is_stmt 0 view .LVU45
 217 0002 334B     		ldr	r3, .L32
 218 0004 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 219              		.loc 1 60 6 view .LVU46
 220 0006 03B9     		cbnz	r3, .L29
 221              	.L19:
  61:controller/engine_cycle/trigger.c ****   {
  62:controller/engine_cycle/trigger.c ****       /**
  63:controller/engine_cycle/trigger.c ****        * @todo add an error message
  64:controller/engine_cycle/trigger.c ****        */
  65:controller/engine_cycle/trigger.c ****       return;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 6


  66:controller/engine_cycle/trigger.c ****   }
  67:controller/engine_cycle/trigger.c **** 
  68:controller/engine_cycle/trigger.c ****   tooth_time_us[0] = get_time_us();
  69:controller/engine_cycle/trigger.c ****   current_tooth_gap_us = tooth_time_us[0] - tooth_time_us[1];
  70:controller/engine_cycle/trigger.c ****   
  71:controller/engine_cycle/trigger.c ****   if (current_tooth_gap_us < trigger_filter_time_us) // Pulses should never be less than trigger_fi
  72:controller/engine_cycle/trigger.c ****   {
  73:controller/engine_cycle/trigger.c ****     return;
  74:controller/engine_cycle/trigger.c ****   }
  75:controller/engine_cycle/trigger.c ****   
  76:controller/engine_cycle/trigger.c ****   counted_tooth++; //Increment the tooth counter
  77:controller/engine_cycle/trigger.c ****   
  78:controller/engine_cycle/trigger.c ****   bool is_missing_teeth = false;
  79:controller/engine_cycle/trigger.c ****   
  80:controller/engine_cycle/trigger.c ****   // if we had previous data calculate the tooth gap
  81:controller/engine_cycle/trigger.c ****   if (tooth_time_us[1] == 0 || tooth_time_us[2] == 0)
  82:controller/engine_cycle/trigger.c ****   {
  83:controller/engine_cycle/trigger.c ****     //return;
  84:controller/engine_cycle/trigger.c ****   }
  85:controller/engine_cycle/trigger.c ****   
  86:controller/engine_cycle/trigger.c ****   
  87:controller/engine_cycle/trigger.c ****   controller_time_us_t previous_tooth_gap = 0;
  88:controller/engine_cycle/trigger.c ****   controller_time_us_t shorter_tooth_gap = 0;
  89:controller/engine_cycle/trigger.c ****   previous_tooth_gap = tooth_time_us[1] - tooth_time_us[2];
  90:controller/engine_cycle/trigger.c **** 
  91:controller/engine_cycle/trigger.c ****   // this selects the shorter tooth gap since that is more approprate 
  92:controller/engine_cycle/trigger.c ****   if (previous_tooth_gap < current_tooth_gap_us) 
  93:controller/engine_cycle/trigger.c ****   {
  94:controller/engine_cycle/trigger.c ****     /**
  95:controller/engine_cycle/trigger.c ****      * We use the previous tooth gap since the current tooth gap might be long and indicate missing
  96:controller/engine_cycle/trigger.c ****      */
  97:controller/engine_cycle/trigger.c ****     shorter_tooth_gap = previous_tooth_gap;
  98:controller/engine_cycle/trigger.c ****   }
  99:controller/engine_cycle/trigger.c ****   else
 100:controller/engine_cycle/trigger.c ****   {
 101:controller/engine_cycle/trigger.c ****     shorter_tooth_gap = current_tooth_gap_us;
 102:controller/engine_cycle/trigger.c ****   }
 103:controller/engine_cycle/trigger.c ****     
 104:controller/engine_cycle/trigger.c ****     
 105:controller/engine_cycle/trigger.c ****     
 106:controller/engine_cycle/trigger.c ****   //If the time between the current tooth and the last is greater than 1.5x the time between the la
 107:controller/engine_cycle/trigger.c ****   if(settings.trigger_missing_teeth == 1)
 108:controller/engine_cycle/trigger.c ****   {
 109:controller/engine_cycle/trigger.c ****     target_tooth_gap_us = (3 * shorter_tooth_gap) >> 1; 
 110:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 111:controller/engine_cycle/trigger.c ****   else
 112:controller/engine_cycle/trigger.c ****   {
 113:controller/engine_cycle/trigger.c ****       target_tooth_gap_us = shorter_tooth_gap * settings.trigger_missing_teeth;
 114:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one    
 115:controller/engine_cycle/trigger.c ****   
 116:controller/engine_cycle/trigger.c ****   //if( (tooth_time_us[1] == 0) || (tooth_time_us[2] == 0) ) { current_tooth_gap_us = 0; } 
 117:controller/engine_cycle/trigger.c **** 
 118:controller/engine_cycle/trigger.c ****     
 119:controller/engine_cycle/trigger.c ****   if ((current_tooth_gap_us > target_tooth_gap_us) || (counted_tooth > trigger_actual_teeth))
 120:controller/engine_cycle/trigger.c ****   {
 121:controller/engine_cycle/trigger.c ****     //Missing tooth detected
 122:controller/engine_cycle/trigger.c ****     is_missing_teeth = true;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 7


 123:controller/engine_cycle/trigger.c ****     /**
 124:controller/engine_cycle/trigger.c ****      * this means that we  have missed a few teeth for some reason
 125:controller/engine_cycle/trigger.c ****      */
 126:controller/engine_cycle/trigger.c ****     if (counted_tooth < trigger_actual_teeth)
 127:controller/engine_cycle/trigger.c ****     {
 128:controller/engine_cycle/trigger.c ****       trigger_status.sync_status = TS_NOT_SYNCED;
 129:controller/engine_cycle/trigger.c ****       trigger_status.cync_loss_counter++;
 130:controller/engine_cycle/trigger.c ****       engine_parameters.total_revolutions = 0;
 131:controller/engine_cycle/trigger.c ****       counted_tooth = 0;
 132:controller/engine_cycle/trigger.c ****     }
 133:controller/engine_cycle/trigger.c ****     else
 134:controller/engine_cycle/trigger.c ****     {
 135:controller/engine_cycle/trigger.c ****       trigger_status.sync_status = TS_FULLY_SYNCED;
 136:controller/engine_cycle/trigger.c ****       engine_parameters.total_revolutions++;
 137:controller/engine_cycle/trigger.c ****       counted_tooth = 0;
 138:controller/engine_cycle/trigger.c ****      //here we can say we are at TDC!
 139:controller/engine_cycle/trigger.c ****     }
 140:controller/engine_cycle/trigger.c ****     
 141:controller/engine_cycle/trigger.c ****   }
 142:controller/engine_cycle/trigger.c ****     
 143:controller/engine_cycle/trigger.c ****   /**
 144:controller/engine_cycle/trigger.c ****    * @todo make sure the filter cannot get stuck in any condition
 145:controller/engine_cycle/trigger.c ****    */
 146:controller/engine_cycle/trigger.c ****   if(is_missing_teeth == false)
 147:controller/engine_cycle/trigger.c ****   {
 148:controller/engine_cycle/trigger.c ****     //Regular (non-missing) tooth
 149:controller/engine_cycle/trigger.c ****     set_filtering(); 
 150:controller/engine_cycle/trigger.c ****   }
 151:controller/engine_cycle/trigger.c ****   
 152:controller/engine_cycle/trigger.c ****   tooth_time_us[2] = tooth_time_us[1];
 153:controller/engine_cycle/trigger.c ****   tooth_time_us[1] = tooth_time_us[0];
 154:controller/engine_cycle/trigger.c **** 
 155:controller/engine_cycle/trigger.c **** }
 222              		.loc 1 155 1 view .LVU47
 223 0008 08BD     		pop	{r3, pc}
 224              	.L29:
  68:controller/engine_cycle/trigger.c ****   current_tooth_gap_us = tooth_time_us[0] - tooth_time_us[1];
 225              		.loc 1 68 3 is_stmt 1 view .LVU48
  68:controller/engine_cycle/trigger.c ****   current_tooth_gap_us = tooth_time_us[0] - tooth_time_us[1];
 226              		.loc 1 68 22 is_stmt 0 view .LVU49
 227 000a FFF7FEFF 		bl	get_time_us
 228              	.LVL3:
  68:controller/engine_cycle/trigger.c ****   current_tooth_gap_us = tooth_time_us[0] - tooth_time_us[1];
 229              		.loc 1 68 20 discriminator 1 view .LVU50
 230 000e 314A     		ldr	r2, .L32+4
 231 0010 1060     		str	r0, [r2]
  69:controller/engine_cycle/trigger.c ****   
 232              		.loc 1 69 3 is_stmt 1 view .LVU51
  69:controller/engine_cycle/trigger.c ****   
 233              		.loc 1 69 39 is_stmt 0 view .LVU52
 234 0012 1368     		ldr	r3, [r2]
  69:controller/engine_cycle/trigger.c ****   
 235              		.loc 1 69 58 view .LVU53
 236 0014 5268     		ldr	r2, [r2, #4]
  69:controller/engine_cycle/trigger.c ****   
 237              		.loc 1 69 43 view .LVU54
 238 0016 9B1A     		subs	r3, r3, r2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 8


  69:controller/engine_cycle/trigger.c ****   
 239              		.loc 1 69 24 view .LVU55
 240 0018 2F4A     		ldr	r2, .L32+8
 241 001a 1360     		str	r3, [r2]
  71:controller/engine_cycle/trigger.c ****   {
 242              		.loc 1 71 3 is_stmt 1 view .LVU56
  71:controller/engine_cycle/trigger.c ****   {
 243              		.loc 1 71 28 is_stmt 0 view .LVU57
 244 001c 1268     		ldr	r2, [r2]
 245 001e 2F4B     		ldr	r3, .L32+12
 246 0020 1B68     		ldr	r3, [r3]
  71:controller/engine_cycle/trigger.c ****   {
 247              		.loc 1 71 6 view .LVU58
 248 0022 9A42     		cmp	r2, r3
 249 0024 F0D3     		bcc	.L19
  76:controller/engine_cycle/trigger.c ****   
 250              		.loc 1 76 3 is_stmt 1 view .LVU59
  76:controller/engine_cycle/trigger.c ****   
 251              		.loc 1 76 16 is_stmt 0 view .LVU60
 252 0026 2E4A     		ldr	r2, .L32+16
 253 0028 1388     		ldrh	r3, [r2]
 254 002a 9BB2     		uxth	r3, r3
 255 002c 0133     		adds	r3, r3, #1
 256 002e 9BB2     		uxth	r3, r3
 257 0030 1380     		strh	r3, [r2]	@ movhi
  78:controller/engine_cycle/trigger.c ****   
 258              		.loc 1 78 3 is_stmt 1 view .LVU61
 259              	.LVL4:
  81:controller/engine_cycle/trigger.c ****   {
 260              		.loc 1 81 3 view .LVU62
  81:controller/engine_cycle/trigger.c ****   {
 261              		.loc 1 81 20 is_stmt 0 view .LVU63
 262 0032 284B     		ldr	r3, .L32+4
 263 0034 5B68     		ldr	r3, [r3, #4]
  81:controller/engine_cycle/trigger.c ****   {
 264              		.loc 1 81 6 view .LVU64
 265 0036 0BB1     		cbz	r3, .L21
  81:controller/engine_cycle/trigger.c ****   {
 266              		.loc 1 81 45 discriminator 1 view .LVU65
 267 0038 264B     		ldr	r3, .L32+4
 268 003a 9B68     		ldr	r3, [r3, #8]
 269              	.L21:
  84:controller/engine_cycle/trigger.c ****   
 270              		.loc 1 84 3 is_stmt 1 view .LVU66
  87:controller/engine_cycle/trigger.c ****   controller_time_us_t shorter_tooth_gap = 0;
 271              		.loc 1 87 3 view .LVU67
 272              	.LVL5:
  88:controller/engine_cycle/trigger.c ****   previous_tooth_gap = tooth_time_us[1] - tooth_time_us[2];
 273              		.loc 1 88 3 view .LVU68
  89:controller/engine_cycle/trigger.c **** 
 274              		.loc 1 89 3 view .LVU69
  89:controller/engine_cycle/trigger.c **** 
 275              		.loc 1 89 37 is_stmt 0 view .LVU70
 276 003c 254A     		ldr	r2, .L32+4
 277 003e 5368     		ldr	r3, [r2, #4]
  89:controller/engine_cycle/trigger.c **** 
 278              		.loc 1 89 56 view .LVU71
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 9


 279 0040 9268     		ldr	r2, [r2, #8]
  89:controller/engine_cycle/trigger.c **** 
 280              		.loc 1 89 22 view .LVU72
 281 0042 9B1A     		subs	r3, r3, r2
 282              	.LVL6:
  92:controller/engine_cycle/trigger.c ****   {
 283              		.loc 1 92 3 is_stmt 1 view .LVU73
  92:controller/engine_cycle/trigger.c ****   {
 284              		.loc 1 92 26 is_stmt 0 view .LVU74
 285 0044 244A     		ldr	r2, .L32+8
 286 0046 1268     		ldr	r2, [r2]
  92:controller/engine_cycle/trigger.c ****   {
 287              		.loc 1 92 6 view .LVU75
 288 0048 9A42     		cmp	r2, r3
 289 004a 01D8     		bhi	.L22
 101:controller/engine_cycle/trigger.c ****   }
 290              		.loc 1 101 5 is_stmt 1 view .LVU76
 101:controller/engine_cycle/trigger.c ****   }
 291              		.loc 1 101 23 is_stmt 0 view .LVU77
 292 004c 224B     		ldr	r3, .L32+8
 293              	.LVL7:
 101:controller/engine_cycle/trigger.c ****   }
 294              		.loc 1 101 23 view .LVU78
 295 004e 1B68     		ldr	r3, [r3]
 296              	.LVL8:
 297              	.L22:
 107:controller/engine_cycle/trigger.c ****   {
 298              		.loc 1 107 3 is_stmt 1 view .LVU79
 107:controller/engine_cycle/trigger.c ****   {
 299              		.loc 1 107 14 is_stmt 0 view .LVU80
 300 0050 244A     		ldr	r2, .L32+20
 301 0052 5278     		ldrb	r2, [r2, #1]	@ zero_extendqisi2
 107:controller/engine_cycle/trigger.c ****   {
 302              		.loc 1 107 5 view .LVU81
 303 0054 012A     		cmp	r2, #1
 304 0056 27D0     		beq	.L30
 113:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one    
 305              		.loc 1 113 7 is_stmt 1 view .LVU82
 113:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one    
 306              		.loc 1 113 47 is_stmt 0 view .LVU83
 307 0058 03FB02F2 		mul	r2, r3, r2
 113:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one    
 308              		.loc 1 113 27 view .LVU84
 309 005c 224B     		ldr	r3, .L32+24
 310              	.LVL9:
 113:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one    
 311              		.loc 1 113 27 view .LVU85
 312 005e 1A60     		str	r2, [r3]
 313              	.L24:
 119:controller/engine_cycle/trigger.c ****   {
 314              		.loc 1 119 3 is_stmt 1 view .LVU86
 119:controller/engine_cycle/trigger.c ****   {
 315              		.loc 1 119 29 is_stmt 0 view .LVU87
 316 0060 1D4B     		ldr	r3, .L32+8
 317 0062 1A68     		ldr	r2, [r3]
 318 0064 204B     		ldr	r3, .L32+24
 319 0066 1B68     		ldr	r3, [r3]
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 10


 119:controller/engine_cycle/trigger.c ****   {
 320              		.loc 1 119 6 view .LVU88
 321 0068 9A42     		cmp	r2, r3
 322 006a 06D8     		bhi	.L25
 119:controller/engine_cycle/trigger.c ****   {
 323              		.loc 1 119 70 discriminator 1 view .LVU89
 324 006c 1F4B     		ldr	r3, .L32+28
 325 006e 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 326 0070 1B4B     		ldr	r3, .L32+16
 327 0072 1B88     		ldrh	r3, [r3]
 328 0074 9BB2     		uxth	r3, r3
 119:controller/engine_cycle/trigger.c ****   {
 329              		.loc 1 119 52 discriminator 1 view .LVU90
 330 0076 9A42     		cmp	r2, r3
 331 0078 1CD2     		bcs	.L31
 332              	.L25:
 122:controller/engine_cycle/trigger.c ****     /**
 333              		.loc 1 122 5 is_stmt 1 view .LVU91
 334              	.LVL10:
 126:controller/engine_cycle/trigger.c ****     {
 335              		.loc 1 126 5 view .LVU92
 126:controller/engine_cycle/trigger.c ****     {
 336              		.loc 1 126 23 is_stmt 0 view .LVU93
 337 007a 1C4B     		ldr	r3, .L32+28
 338 007c 1A78     		ldrb	r2, [r3]	@ zero_extendqisi2
 339 007e 184B     		ldr	r3, .L32+16
 340 0080 1B88     		ldrh	r3, [r3]
 341 0082 9BB2     		uxth	r3, r3
 126:controller/engine_cycle/trigger.c ****     {
 342              		.loc 1 126 8 view .LVU94
 343 0084 9A42     		cmp	r2, r3
 344 0086 18D9     		bls	.L27
 128:controller/engine_cycle/trigger.c ****       trigger_status.cync_loss_counter++;
 345              		.loc 1 128 7 is_stmt 1 view .LVU95
 128:controller/engine_cycle/trigger.c ****       trigger_status.cync_loss_counter++;
 346              		.loc 1 128 34 is_stmt 0 view .LVU96
 347 0088 114A     		ldr	r2, .L32
 348 008a 0023     		movs	r3, #0
 349 008c 5370     		strb	r3, [r2, #1]
 129:controller/engine_cycle/trigger.c ****       engine_parameters.total_revolutions = 0;
 350              		.loc 1 129 7 is_stmt 1 view .LVU97
 129:controller/engine_cycle/trigger.c ****       engine_parameters.total_revolutions = 0;
 351              		.loc 1 129 21 is_stmt 0 view .LVU98
 352 008e 5188     		ldrh	r1, [r2, #2]
 129:controller/engine_cycle/trigger.c ****       engine_parameters.total_revolutions = 0;
 353              		.loc 1 129 39 view .LVU99
 354 0090 0131     		adds	r1, r1, #1
 355 0092 5180     		strh	r1, [r2, #2]	@ movhi
 130:controller/engine_cycle/trigger.c ****       counted_tooth = 0;
 356              		.loc 1 130 7 is_stmt 1 view .LVU100
 130:controller/engine_cycle/trigger.c ****       counted_tooth = 0;
 357              		.loc 1 130 43 is_stmt 0 view .LVU101
 358 0094 164A     		ldr	r2, .L32+32
 359 0096 1360     		str	r3, [r2]
 131:controller/engine_cycle/trigger.c ****     }
 360              		.loc 1 131 7 is_stmt 1 view .LVU102
 131:controller/engine_cycle/trigger.c ****     }
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 11


 361              		.loc 1 131 21 is_stmt 0 view .LVU103
 362 0098 114A     		ldr	r2, .L32+16
 363 009a 1380     		strh	r3, [r2]	@ movhi
 146:controller/engine_cycle/trigger.c ****   {
 364              		.loc 1 146 3 is_stmt 1 view .LVU104
 365              	.LVL11:
 366              	.L26:
 152:controller/engine_cycle/trigger.c ****   tooth_time_us[1] = tooth_time_us[0];
 367              		.loc 1 152 3 view .LVU105
 152:controller/engine_cycle/trigger.c ****   tooth_time_us[1] = tooth_time_us[0];
 368              		.loc 1 152 35 is_stmt 0 view .LVU106
 369 009c 0D4B     		ldr	r3, .L32+4
 370 009e 5A68     		ldr	r2, [r3, #4]
 152:controller/engine_cycle/trigger.c ****   tooth_time_us[1] = tooth_time_us[0];
 371              		.loc 1 152 20 view .LVU107
 372 00a0 9A60     		str	r2, [r3, #8]
 153:controller/engine_cycle/trigger.c **** 
 373              		.loc 1 153 3 is_stmt 1 view .LVU108
 153:controller/engine_cycle/trigger.c **** 
 374              		.loc 1 153 35 is_stmt 0 view .LVU109
 375 00a2 1A68     		ldr	r2, [r3]
 153:controller/engine_cycle/trigger.c **** 
 376              		.loc 1 153 20 view .LVU110
 377 00a4 5A60     		str	r2, [r3, #4]
 378 00a6 AFE7     		b	.L19
 379              	.LVL12:
 380              	.L30:
 109:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 381              		.loc 1 109 5 is_stmt 1 view .LVU111
 109:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 382              		.loc 1 109 30 is_stmt 0 view .LVU112
 383 00a8 03EB4303 		add	r3, r3, r3, lsl #1
 384              	.LVL13:
 109:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 385              		.loc 1 109 51 view .LVU113
 386 00ac 5B08     		lsrs	r3, r3, #1
 109:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 387              		.loc 1 109 25 view .LVU114
 388 00ae 0E4A     		ldr	r2, .L32+24
 389 00b0 1360     		str	r3, [r2]
 390 00b2 D5E7     		b	.L24
 391              	.L31:
 146:controller/engine_cycle/trigger.c ****   {
 392              		.loc 1 146 3 is_stmt 1 view .LVU115
 149:controller/engine_cycle/trigger.c ****   }
 393              		.loc 1 149 5 view .LVU116
 394 00b4 FFF7FEFF 		bl	set_filtering
 395              	.LVL14:
 396 00b8 F0E7     		b	.L26
 397              	.LVL15:
 398              	.L27:
 135:controller/engine_cycle/trigger.c ****       engine_parameters.total_revolutions++;
 399              		.loc 1 135 7 view .LVU117
 135:controller/engine_cycle/trigger.c ****       engine_parameters.total_revolutions++;
 400              		.loc 1 135 34 is_stmt 0 view .LVU118
 401 00ba 054B     		ldr	r3, .L32
 402 00bc 0122     		movs	r2, #1
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 12


 403 00be 5A70     		strb	r2, [r3, #1]
 136:controller/engine_cycle/trigger.c ****       counted_tooth = 0;
 404              		.loc 1 136 7 is_stmt 1 view .LVU119
 136:controller/engine_cycle/trigger.c ****       counted_tooth = 0;
 405              		.loc 1 136 24 is_stmt 0 view .LVU120
 406 00c0 0B4A     		ldr	r2, .L32+32
 407 00c2 1368     		ldr	r3, [r2]
 136:controller/engine_cycle/trigger.c ****       counted_tooth = 0;
 408              		.loc 1 136 42 view .LVU121
 409 00c4 0133     		adds	r3, r3, #1
 410 00c6 1360     		str	r3, [r2]
 137:controller/engine_cycle/trigger.c ****      //here we can say we are at TDC!
 411              		.loc 1 137 7 is_stmt 1 view .LVU122
 137:controller/engine_cycle/trigger.c ****      //here we can say we are at TDC!
 412              		.loc 1 137 21 is_stmt 0 view .LVU123
 413 00c8 054B     		ldr	r3, .L32+16
 414 00ca 0022     		movs	r2, #0
 415 00cc 1A80     		strh	r2, [r3]	@ movhi
 146:controller/engine_cycle/trigger.c ****   {
 416              		.loc 1 146 3 is_stmt 1 view .LVU124
 417 00ce E5E7     		b	.L26
 418              	.L33:
 419              		.align	2
 420              	.L32:
 421 00d0 00000000 		.word	trigger_status
 422 00d4 00000000 		.word	tooth_time_us
 423 00d8 00000000 		.word	current_tooth_gap_us
 424 00dc 00000000 		.word	trigger_filter_time_us
 425 00e0 00000000 		.word	counted_tooth
 426 00e4 00000000 		.word	settings
 427 00e8 00000000 		.word	target_tooth_gap_us
 428 00ec 00000000 		.word	trigger_actual_teeth
 429 00f0 00000000 		.word	engine_parameters
 430              		.cfi_endproc
 431              	.LFE137:
 433              		.global	trigger_actual_teeth
 434              		.section	.bss.trigger_actual_teeth,"aw",%nobits
 437              	trigger_actual_teeth:
 438 0000 00       		.space	1
 439              		.global	counted_tooth
 440              		.section	.bss.counted_tooth,"aw",%nobits
 441              		.align	1
 444              	counted_tooth:
 445 0000 0000     		.space	2
 446              		.global	target_tooth_gap_us
 447              		.section	.bss.target_tooth_gap_us,"aw",%nobits
 448              		.align	2
 451              	target_tooth_gap_us:
 452 0000 00000000 		.space	4
 453              		.global	current_tooth_gap_us
 454              		.section	.bss.current_tooth_gap_us,"aw",%nobits
 455              		.align	2
 458              	current_tooth_gap_us:
 459 0000 00000000 		.space	4
 460              		.global	tooth_time_us
 461              		.section	.bss.tooth_time_us,"aw",%nobits
 462              		.align	2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 13


 465              	tooth_time_us:
 466 0000 00000000 		.space	12
 466      00000000 
 466      00000000 
 467              		.global	trigger_filter_time_us
 468              		.section	.bss.trigger_filter_time_us,"aw",%nobits
 469              		.align	2
 472              	trigger_filter_time_us:
 473 0000 00000000 		.space	4
 474              		.global	trigger_status
 475              		.section	.bss.trigger_status,"aw",%nobits
 476              		.align	2
 479              	trigger_status:
 480 0000 00000000 		.space	4
 481              		.text
 482              	.Letext0:
 483              		.file 2 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 484              		.file 3 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 485              		.file 4 "controller/types.h"
 486              		.file 5 "controller/controller.h"
 487              		.file 6 "controller/settings.h"
 488              		.file 7 "controller/engine_cycle/trigger.h"
 489              		.file 8 "controller/controller_time.h"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s 			page 14


DEFINED SYMBOLS
                            *ABS*:00000000 trigger.c
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:21     .text.set_filtering:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:27     .text.set_filtering:00000000 set_filtering
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:43     .text.set_filtering:0000000c $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:47     .text.set_filtering:00000010 $t
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:101    .text.set_filtering:00000048 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:472    .bss.trigger_filter_time_us:00000000 trigger_filter_time_us
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:458    .bss.current_tooth_gap_us:00000000 current_tooth_gap_us
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:108    .text.trigger_set_filtering:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:114    .text.trigger_set_filtering:00000000 trigger_set_filtering
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:138    .text.trigger_set_filtering:0000000c $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:143    .text.trigger_init:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:149    .text.trigger_init:00000000 trigger_init
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:192    .text.trigger_init:00000020 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:479    .bss.trigger_status:00000000 trigger_status
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:437    .bss.trigger_actual_teeth:00000000 trigger_actual_teeth
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:199    .text.trigger_tooth_handle:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:205    .text.trigger_tooth_handle:00000000 trigger_tooth_handle
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:421    .text.trigger_tooth_handle:000000d0 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:465    .bss.tooth_time_us:00000000 tooth_time_us
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:444    .bss.counted_tooth:00000000 counted_tooth
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:451    .bss.target_tooth_gap_us:00000000 target_tooth_gap_us
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:438    .bss.trigger_actual_teeth:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:441    .bss.counted_tooth:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:448    .bss.target_tooth_gap_us:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:455    .bss.current_tooth_gap_us:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:462    .bss.tooth_time_us:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:469    .bss.trigger_filter_time_us:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccriKnR3.s:476    .bss.trigger_status:00000000 $d

UNDEFINED SYMBOLS
settings
get_time_us
engine_parameters
