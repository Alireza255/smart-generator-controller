ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"trigger.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "controller/engine_cycle/trigger.c"
  20              		.section	.text.set_filtering,"ax",%progbits
  21              		.align	1
  22              		.global	set_filtering
  23              		.syntax unified
  24              		.thumb
  25              		.thumb_func
  27              	set_filtering:
  28              	.LFB228:
   1:controller/engine_cycle/trigger.c **** #include "trigger.h"
   2:controller/engine_cycle/trigger.c **** #include "controller.h"
   3:controller/engine_cycle/trigger.c **** 
   4:controller/engine_cycle/trigger.c **** /* just a temporary fix */
   5:controller/engine_cycle/trigger.c **** trigger_t *trigger = NULL;
   6:controller/engine_cycle/trigger.c **** 
   7:controller/engine_cycle/trigger.c **** void set_filtering()
   8:controller/engine_cycle/trigger.c **** {
  29              		.loc 1 8 1 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		@ link register save eliminated.
   9:controller/engine_cycle/trigger.c ****   switch (trigger->settings->filtering)
  34              		.loc 1 9 3 view .LVU1
  35              		.loc 1 9 18 is_stmt 0 view .LVU2
  36 0000 0E4B     		ldr	r3, .L9
  37 0002 1B68     		ldr	r3, [r3]
  38 0004 5A6A     		ldr	r2, [r3, #36]
  39              		.loc 1 9 28 view .LVU3
  40 0006 1278     		ldrb	r2, [r2]	@ zero_extendqisi2
  41              		.loc 1 9 3 view .LVU4
  42 0008 032A     		cmp	r2, #3
  43 000a 13D8     		bhi	.L2
  44 000c DFE802F0 		tbb	[pc, r2]
  45              	.L4:
  46 0010 02       		.byte	(.L7-.L4)/2
  47 0011 05       		.byte	(.L6-.L4)/2
  48 0012 09       		.byte	(.L5-.L4)/2
  49 0013 0C       		.byte	(.L3-.L4)/2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 2


  50              		.p2align 1
  51              	.L7:
  10:controller/engine_cycle/trigger.c ****   {
  11:controller/engine_cycle/trigger.c ****     case TRIGGER_FILTERING_NONE:
  12:controller/engine_cycle/trigger.c ****       trigger->_trigger_filter_time_us = 0;
  52              		.loc 1 12 7 is_stmt 1 view .LVU5
  53              		.loc 1 12 40 is_stmt 0 view .LVU6
  54 0014 0022     		movs	r2, #0
  55 0016 5A60     		str	r2, [r3, #4]
  13:controller/engine_cycle/trigger.c ****         break;
  56              		.loc 1 13 9 is_stmt 1 view .LVU7
  57 0018 7047     		bx	lr
  58              	.L6:
  14:controller/engine_cycle/trigger.c ****     case TRIGGER_FILTERING_LITE:
  15:controller/engine_cycle/trigger.c ****       trigger->_trigger_filter_time_us = trigger->_current_tooth_gap_us / 4U;
  59              		.loc 1 15 7 view .LVU8
  60              		.loc 1 15 49 is_stmt 0 view .LVU9
  61 001a 5A69     		ldr	r2, [r3, #20]
  62              		.loc 1 15 73 view .LVU10
  63 001c 9208     		lsrs	r2, r2, #2
  64              		.loc 1 15 40 view .LVU11
  65 001e 5A60     		str	r2, [r3, #4]
  16:controller/engine_cycle/trigger.c ****         break;
  66              		.loc 1 16 9 is_stmt 1 view .LVU12
  67 0020 7047     		bx	lr
  68              	.L5:
  17:controller/engine_cycle/trigger.c ****     case TRIGGER_FILTERING_MEDIUM:
  18:controller/engine_cycle/trigger.c ****       trigger->_trigger_filter_time_us = trigger->_current_tooth_gap_us / 1U;
  69              		.loc 1 18 7 view .LVU13
  70              		.loc 1 18 49 is_stmt 0 view .LVU14
  71 0022 5A69     		ldr	r2, [r3, #20]
  72              		.loc 1 18 40 view .LVU15
  73 0024 5A60     		str	r2, [r3, #4]
  19:controller/engine_cycle/trigger.c ****         break;
  74              		.loc 1 19 9 is_stmt 1 view .LVU16
  75 0026 7047     		bx	lr
  76              	.L3:
  20:controller/engine_cycle/trigger.c ****     case TRIGGER_FILTERING_AGGRESSIVE:
  21:controller/engine_cycle/trigger.c ****       trigger->_trigger_filter_time_us = trigger->_current_tooth_gap_us * 3 / 4;
  77              		.loc 1 21 7 view .LVU17
  78              		.loc 1 21 49 is_stmt 0 view .LVU18
  79 0028 5A69     		ldr	r2, [r3, #20]
  80              		.loc 1 21 73 view .LVU19
  81 002a 02EB4202 		add	r2, r2, r2, lsl #1
  82              		.loc 1 21 77 view .LVU20
  83 002e 9208     		lsrs	r2, r2, #2
  84              		.loc 1 21 40 view .LVU21
  85 0030 5A60     		str	r2, [r3, #4]
  22:controller/engine_cycle/trigger.c ****         break;
  86              		.loc 1 22 9 is_stmt 1 view .LVU22
  87 0032 7047     		bx	lr
  88              	.L2:
  23:controller/engine_cycle/trigger.c ****     default:
  24:controller/engine_cycle/trigger.c ****         // Handle invalid filtering level
  25:controller/engine_cycle/trigger.c ****         trigger->_trigger_filter_time_us = 0;
  89              		.loc 1 25 9 view .LVU23
  90              		.loc 1 25 42 is_stmt 0 view .LVU24
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 3


  91 0034 0022     		movs	r2, #0
  92 0036 5A60     		str	r2, [r3, #4]
  26:controller/engine_cycle/trigger.c ****         break;
  93              		.loc 1 26 9 is_stmt 1 view .LVU25
  27:controller/engine_cycle/trigger.c ****   }
  28:controller/engine_cycle/trigger.c **** }
  94              		.loc 1 28 1 is_stmt 0 view .LVU26
  95 0038 7047     		bx	lr
  96              	.L10:
  97 003a 00BF     		.align	2
  98              	.L9:
  99 003c 00000000 		.word	trigger
 100              		.cfi_endproc
 101              	.LFE228:
 103              		.section	.rodata.trigger_init.str1.4,"aMS",%progbits,1
 104              		.align	2
 105              	.LC0:
 106 0000 54726967 		.ascii	"Trigger initialization failed. Trigger is NULL.\000"
 106      67657220 
 106      696E6974 
 106      69616C69 
 106      7A617469 
 107              		.align	2
 108              	.LC1:
 109 0030 54726967 		.ascii	"Trigger initialization failed. Settings are NULL.\000"
 109      67657220 
 109      696E6974 
 109      69616C69 
 109      7A617469 
 110 0062 0000     		.align	2
 111              	.LC2:
 112 0064 54726967 		.ascii	"Trigger initialization failed. Teeth misconfigured."
 112      67657220 
 112      696E6974 
 112      69616C69 
 112      7A617469 
 113 0097 00       		.ascii	"\000"
 114              		.section	.text.trigger_init,"ax",%progbits
 115              		.align	1
 116              		.global	trigger_init
 117              		.syntax unified
 118              		.thumb
 119              		.thumb_func
 121              	trigger_init:
 122              	.LVL0:
 123              	.LFB229:
  29:controller/engine_cycle/trigger.c **** 
  30:controller/engine_cycle/trigger.c **** void trigger_init(trigger_t *trigger_ptr, trigger_settings_t *settings)
  31:controller/engine_cycle/trigger.c **** {   
 124              		.loc 1 31 1 is_stmt 1 view -0
 125              		.cfi_startproc
 126              		@ args = 0, pretend = 0, frame = 0
 127              		@ frame_needed = 0, uses_anonymous_args = 0
 128              		.loc 1 31 1 is_stmt 0 view .LVU28
 129 0000 38B5     		push	{r3, r4, r5, lr}
 130              		.cfi_def_cfa_offset 16
 131              		.cfi_offset 3, -16
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 4


 132              		.cfi_offset 4, -12
 133              		.cfi_offset 5, -8
 134              		.cfi_offset 14, -4
  32:controller/engine_cycle/trigger.c ****   bool temp_status = true;
 135              		.loc 1 32 3 is_stmt 1 view .LVU29
 136              	.LVL1:
  33:controller/engine_cycle/trigger.c ****   if (trigger_ptr == NULL)
 137              		.loc 1 33 3 view .LVU30
 138              		.loc 1 33 6 is_stmt 0 view .LVU31
 139 0002 70B1     		cbz	r0, .L18
 140 0004 0C46     		mov	r4, r1
 141 0006 0346     		mov	r3, r0
  34:controller/engine_cycle/trigger.c ****   {
  35:controller/engine_cycle/trigger.c ****     log_error("Trigger initialization failed. Trigger is NULL.");
  36:controller/engine_cycle/trigger.c ****     return;
  37:controller/engine_cycle/trigger.c ****   }
  38:controller/engine_cycle/trigger.c ****   trigger = trigger_ptr;
 142              		.loc 1 38 3 is_stmt 1 view .LVU32
 143              		.loc 1 38 11 is_stmt 0 view .LVU33
 144 0008 124A     		ldr	r2, .L20
 145 000a 1060     		str	r0, [r2]
  39:controller/engine_cycle/trigger.c **** 
  40:controller/engine_cycle/trigger.c ****   if (settings == NULL)
 146              		.loc 1 40 3 is_stmt 1 view .LVU34
 147              		.loc 1 40 6 is_stmt 0 view .LVU35
 148 000c 69B1     		cbz	r1, .L19
  41:controller/engine_cycle/trigger.c ****   {
  42:controller/engine_cycle/trigger.c ****     log_error("Trigger initialization failed. Settings are NULL.");
  43:controller/engine_cycle/trigger.c ****     return;
  44:controller/engine_cycle/trigger.c ****   }
  45:controller/engine_cycle/trigger.c ****   
  46:controller/engine_cycle/trigger.c ****   if (settings->full_teeth == 0 || settings->missing_teeth == 0)
 149              		.loc 1 46 3 is_stmt 1 view .LVU36
 150              		.loc 1 46 15 is_stmt 0 view .LVU37
 151 000e 4A78     		ldrb	r2, [r1, #1]	@ zero_extendqisi2
 152              		.loc 1 46 6 view .LVU38
 153 0010 0AB1     		cbz	r2, .L15
 154              		.loc 1 46 44 discriminator 1 view .LVU39
 155 0012 8A78     		ldrb	r2, [r1, #2]	@ zero_extendqisi2
 156              		.loc 1 46 33 discriminator 1 view .LVU40
 157 0014 6AB9     		cbnz	r2, .L16
 158              	.L15:
  47:controller/engine_cycle/trigger.c ****   {
  48:controller/engine_cycle/trigger.c ****     temp_status = false;
 159              		.loc 1 48 5 is_stmt 1 view .LVU41
 160              	.LVL2:
  49:controller/engine_cycle/trigger.c ****     trigger->initialized = temp_status;
 161              		.loc 1 49 5 view .LVU42
 162              		.loc 1 49 26 is_stmt 0 view .LVU43
 163 0016 0022     		movs	r2, #0
 164 0018 1A70     		strb	r2, [r3]
  50:controller/engine_cycle/trigger.c ****     log_error("Trigger initialization failed. Teeth misconfigured.");
 165              		.loc 1 50 5 is_stmt 1 view .LVU44
 166 001a 0F48     		ldr	r0, .L20+4
 167              	.LVL3:
 168              		.loc 1 50 5 is_stmt 0 view .LVU45
 169 001c FFF7FEFF 		bl	log_error
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 5


 170              	.LVL4:
  51:controller/engine_cycle/trigger.c ****     return;
 171              		.loc 1 51 5 is_stmt 1 view .LVU46
 172              	.L11:
  52:controller/engine_cycle/trigger.c ****   }
  53:controller/engine_cycle/trigger.c ****   trigger->settings = settings;
  54:controller/engine_cycle/trigger.c ****   trigger->sync_status = TS_NOT_SYNCED;
  55:controller/engine_cycle/trigger.c ****   set_filtering(trigger);
  56:controller/engine_cycle/trigger.c ****   trigger->_trigger_actual_teeth = settings->full_teeth - settings->missing_teeth;
  57:controller/engine_cycle/trigger.c ****   trigger->initialized = true;
  58:controller/engine_cycle/trigger.c **** }
 173              		.loc 1 58 1 is_stmt 0 view .LVU47
 174 0020 38BD     		pop	{r3, r4, r5, pc}
 175              	.LVL5:
 176              	.L18:
  35:controller/engine_cycle/trigger.c ****     return;
 177              		.loc 1 35 5 is_stmt 1 view .LVU48
 178 0022 0E48     		ldr	r0, .L20+8
 179              	.LVL6:
  35:controller/engine_cycle/trigger.c ****     return;
 180              		.loc 1 35 5 is_stmt 0 view .LVU49
 181 0024 FFF7FEFF 		bl	log_error
 182              	.LVL7:
  36:controller/engine_cycle/trigger.c ****   }
 183              		.loc 1 36 5 is_stmt 1 view .LVU50
 184 0028 FAE7     		b	.L11
 185              	.LVL8:
 186              	.L19:
  42:controller/engine_cycle/trigger.c ****     return;
 187              		.loc 1 42 5 view .LVU51
 188 002a 0D48     		ldr	r0, .L20+12
 189              	.LVL9:
  42:controller/engine_cycle/trigger.c ****     return;
 190              		.loc 1 42 5 is_stmt 0 view .LVU52
 191 002c FFF7FEFF 		bl	log_error
 192              	.LVL10:
  43:controller/engine_cycle/trigger.c ****   }
 193              		.loc 1 43 5 is_stmt 1 view .LVU53
 194 0030 F6E7     		b	.L11
 195              	.LVL11:
 196              	.L16:
  53:controller/engine_cycle/trigger.c ****   trigger->sync_status = TS_NOT_SYNCED;
 197              		.loc 1 53 3 view .LVU54
  53:controller/engine_cycle/trigger.c ****   trigger->sync_status = TS_NOT_SYNCED;
 198              		.loc 1 53 21 is_stmt 0 view .LVU55
 199 0032 4162     		str	r1, [r0, #36]
  54:controller/engine_cycle/trigger.c ****   set_filtering(trigger);
 200              		.loc 1 54 3 is_stmt 1 view .LVU56
  54:controller/engine_cycle/trigger.c ****   set_filtering(trigger);
 201              		.loc 1 54 24 is_stmt 0 view .LVU57
 202 0034 0022     		movs	r2, #0
 203 0036 4270     		strb	r2, [r0, #1]
  55:controller/engine_cycle/trigger.c ****   trigger->_trigger_actual_teeth = settings->full_teeth - settings->missing_teeth;
 204              		.loc 1 55 3 is_stmt 1 view .LVU58
 205 0038 064D     		ldr	r5, .L20
 206 003a 2868     		ldr	r0, [r5]
 207              	.LVL12:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 6


  55:controller/engine_cycle/trigger.c ****   trigger->_trigger_actual_teeth = settings->full_teeth - settings->missing_teeth;
 208              		.loc 1 55 3 is_stmt 0 view .LVU59
 209 003c FFF7FEFF 		bl	set_filtering
 210              	.LVL13:
  56:controller/engine_cycle/trigger.c ****   trigger->initialized = true;
 211              		.loc 1 56 3 is_stmt 1 view .LVU60
  56:controller/engine_cycle/trigger.c ****   trigger->initialized = true;
 212              		.loc 1 56 44 is_stmt 0 view .LVU61
 213 0040 6378     		ldrb	r3, [r4, #1]	@ zero_extendqisi2
  56:controller/engine_cycle/trigger.c ****   trigger->initialized = true;
 214              		.loc 1 56 67 view .LVU62
 215 0042 A178     		ldrb	r1, [r4, #2]	@ zero_extendqisi2
  56:controller/engine_cycle/trigger.c ****   trigger->initialized = true;
 216              		.loc 1 56 10 view .LVU63
 217 0044 2A68     		ldr	r2, [r5]
  56:controller/engine_cycle/trigger.c ****   trigger->initialized = true;
 218              		.loc 1 56 57 view .LVU64
 219 0046 5B1A     		subs	r3, r3, r1
  56:controller/engine_cycle/trigger.c ****   trigger->initialized = true;
 220              		.loc 1 56 34 view .LVU65
 221 0048 82F82230 		strb	r3, [r2, #34]
  57:controller/engine_cycle/trigger.c **** }
 222              		.loc 1 57 3 is_stmt 1 view .LVU66
  57:controller/engine_cycle/trigger.c **** }
 223              		.loc 1 57 24 is_stmt 0 view .LVU67
 224 004c 0123     		movs	r3, #1
 225 004e 1370     		strb	r3, [r2]
 226 0050 E6E7     		b	.L11
 227              	.L21:
 228 0052 00BF     		.align	2
 229              	.L20:
 230 0054 00000000 		.word	trigger
 231 0058 64000000 		.word	.LC2
 232 005c 00000000 		.word	.LC0
 233 0060 30000000 		.word	.LC1
 234              		.cfi_endproc
 235              	.LFE229:
 237              		.section	.text.crankshaft_get_rpm,"ax",%progbits
 238              		.align	1
 239              		.global	crankshaft_get_rpm
 240              		.syntax unified
 241              		.thumb
 242              		.thumb_func
 244              	crankshaft_get_rpm:
 245              	.LFB231:
  59:controller/engine_cycle/trigger.c **** 
  60:controller/engine_cycle/trigger.c **** void trigger_tooth_handle()
  61:controller/engine_cycle/trigger.c **** {
  62:controller/engine_cycle/trigger.c **** 
  63:controller/engine_cycle/trigger.c ****   if (!trigger->initialized)
  64:controller/engine_cycle/trigger.c ****   {
  65:controller/engine_cycle/trigger.c ****     log_error("Trigger is not initialized.");
  66:controller/engine_cycle/trigger.c ****     return;
  67:controller/engine_cycle/trigger.c ****   }
  68:controller/engine_cycle/trigger.c **** 
  69:controller/engine_cycle/trigger.c ****   trigger->_tooth_time_us[0] = get_time_us();
  70:controller/engine_cycle/trigger.c ****   trigger->_current_tooth_gap_us = trigger->_tooth_time_us[0] - trigger->_tooth_time_us[1];
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 7


  71:controller/engine_cycle/trigger.c ****   
  72:controller/engine_cycle/trigger.c ****   if (trigger->_current_tooth_gap_us < trigger->_trigger_filter_time_us) // Pulses should never be 
  73:controller/engine_cycle/trigger.c ****   {
  74:controller/engine_cycle/trigger.c ****     // Reset the filter to avoid getting stuck
  75:controller/engine_cycle/trigger.c ****     //trigger->_trigger_filter_time_us = trigger->_current_tooth_gap_us / 2U;
  76:controller/engine_cycle/trigger.c ****     return;
  77:controller/engine_cycle/trigger.c ****   }
  78:controller/engine_cycle/trigger.c ****   
  79:controller/engine_cycle/trigger.c ****   trigger->_counted_tooth++; //Increment the tooth counter
  80:controller/engine_cycle/trigger.c ****   
  81:controller/engine_cycle/trigger.c ****   bool is_missing_teeth = false;
  82:controller/engine_cycle/trigger.c ****   
  83:controller/engine_cycle/trigger.c ****   // if we had previous data calculate the tooth gap
  84:controller/engine_cycle/trigger.c ****   if (trigger->_tooth_time_us[1] == 0 || trigger->_tooth_time_us[2] == 0)
  85:controller/engine_cycle/trigger.c ****   {
  86:controller/engine_cycle/trigger.c ****     //return;
  87:controller/engine_cycle/trigger.c ****   }
  88:controller/engine_cycle/trigger.c ****     
  89:controller/engine_cycle/trigger.c ****   time_us_t previous_tooth_gap = 0;
  90:controller/engine_cycle/trigger.c **** 
  91:controller/engine_cycle/trigger.c ****   previous_tooth_gap = trigger->_tooth_time_us[1] - trigger->_tooth_time_us[2];
  92:controller/engine_cycle/trigger.c **** 
  93:controller/engine_cycle/trigger.c ****   // this selects the shorter tooth gap since that is more appropriate 
  94:controller/engine_cycle/trigger.c ****   if (previous_tooth_gap < trigger->_current_tooth_gap_us) 
  95:controller/engine_cycle/trigger.c ****   {
  96:controller/engine_cycle/trigger.c ****     /**
  97:controller/engine_cycle/trigger.c ****      * We use the previous tooth gap since the current tooth gap might be long and indicate missing
  98:controller/engine_cycle/trigger.c ****      */
  99:controller/engine_cycle/trigger.c ****     trigger->_shorter_tooth_gap = previous_tooth_gap;
 100:controller/engine_cycle/trigger.c ****   }
 101:controller/engine_cycle/trigger.c ****   else
 102:controller/engine_cycle/trigger.c ****   {
 103:controller/engine_cycle/trigger.c ****     trigger->_shorter_tooth_gap = trigger->_current_tooth_gap_us;
 104:controller/engine_cycle/trigger.c ****   }
 105:controller/engine_cycle/trigger.c ****     
 106:controller/engine_cycle/trigger.c **** 
 107:controller/engine_cycle/trigger.c ****   //If the time between the current tooth and the last is greater than 1.5x the time between the la
 108:controller/engine_cycle/trigger.c ****   if(trigger->settings->missing_teeth == 1)
 109:controller/engine_cycle/trigger.c ****   {
 110:controller/engine_cycle/trigger.c ****     trigger->_target_tooth_gap_us = (3 * trigger->_shorter_tooth_gap) >> 1; 
 111:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 112:controller/engine_cycle/trigger.c ****   else
 113:controller/engine_cycle/trigger.c ****   {
 114:controller/engine_cycle/trigger.c ****     trigger->_target_tooth_gap_us = trigger->_shorter_tooth_gap * trigger->settings->missing_teeth;
 115:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one
 116:controller/engine_cycle/trigger.c **** 
 117:controller/engine_cycle/trigger.c ****   //if( (_tooth_time_us[1] == 0) || (_tooth_time_us[2] == 0) ) { _current_tooth_gap_us = 0; }
 118:controller/engine_cycle/trigger.c **** 
 119:controller/engine_cycle/trigger.c ****     
 120:controller/engine_cycle/trigger.c ****   if ((trigger->_current_tooth_gap_us > trigger->_target_tooth_gap_us) || (trigger->_counted_tooth 
 121:controller/engine_cycle/trigger.c ****   {
 122:controller/engine_cycle/trigger.c ****     //Missing tooth detected
 123:controller/engine_cycle/trigger.c ****     is_missing_teeth = true;
 124:controller/engine_cycle/trigger.c ****     /**
 125:controller/engine_cycle/trigger.c ****      * this means that we  have missed a few teeth for some reason
 126:controller/engine_cycle/trigger.c ****      */
 127:controller/engine_cycle/trigger.c ****     if (trigger->_counted_tooth < trigger->_trigger_actual_teeth)
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 8


 128:controller/engine_cycle/trigger.c ****     {
 129:controller/engine_cycle/trigger.c ****       trigger->sync_status = TS_NOT_SYNCED;
 130:controller/engine_cycle/trigger.c ****       trigger->sync_loss_counter++;
 131:controller/engine_cycle/trigger.c ****       engine.total_revolutions = 0;
 132:controller/engine_cycle/trigger.c ****       engine.rpm = 0;
 133:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 134:controller/engine_cycle/trigger.c ****     }
 135:controller/engine_cycle/trigger.c ****     else
 136:controller/engine_cycle/trigger.c ****     {
 137:controller/engine_cycle/trigger.c ****       trigger->sync_status = TS_FULLY_SYNCED;
 138:controller/engine_cycle/trigger.c ****       engine.total_revolutions++;
 139:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 140:controller/engine_cycle/trigger.c ****      //here we can say we are at TDC!
 141:controller/engine_cycle/trigger.c ****       osEventFlagsSet(engine.flags, ENGINE_FLAG_ROTATION_EVENT);
 142:controller/engine_cycle/trigger.c ****     }
 143:controller/engine_cycle/trigger.c ****   }
 144:controller/engine_cycle/trigger.c ****   
 145:controller/engine_cycle/trigger.c ****   engine.crankshaft_angle = 360.0f / (angle_t)configuration.trigger.full_teeth * (angle_t)trigger->
 146:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 147:controller/engine_cycle/trigger.c **** 
 148:controller/engine_cycle/trigger.c **** 
 149:controller/engine_cycle/trigger.c ****   if (trigger->sync_status == TS_FULLY_SYNCED && engine.rpm >= configuration.cranking_rpm_threshold
 150:controller/engine_cycle/trigger.c ****   {
 151:controller/engine_cycle/trigger.c ****     engine.spinning_state = SS_RUNNING;
 152:controller/engine_cycle/trigger.c ****   }
 153:controller/engine_cycle/trigger.c ****   else if (trigger->sync_status == TS_FULLY_SYNCED && engine.rpm < configuration.cranking_rpm_thres
 154:controller/engine_cycle/trigger.c ****   {
 155:controller/engine_cycle/trigger.c ****     engine.spinning_state = SS_CRANKING;
 156:controller/engine_cycle/trigger.c ****   }
 157:controller/engine_cycle/trigger.c ****   else if (trigger->sync_status == TS_NOT_SYNCED)
 158:controller/engine_cycle/trigger.c ****   {
 159:controller/engine_cycle/trigger.c ****     engine.spinning_state = SS_SPINNING_UP;
 160:controller/engine_cycle/trigger.c ****   }
 161:controller/engine_cycle/trigger.c ****   else
 162:controller/engine_cycle/trigger.c ****   {
 163:controller/engine_cycle/trigger.c ****     engine.spinning_state = SS_STOPPED;
 164:controller/engine_cycle/trigger.c ****   }
 165:controller/engine_cycle/trigger.c ****   
 166:controller/engine_cycle/trigger.c **** 
 167:controller/engine_cycle/trigger.c ****   /**
 168:controller/engine_cycle/trigger.c ****    * @todo make sure the filter cannot get stuck in any condition
 169:controller/engine_cycle/trigger.c ****    */
 170:controller/engine_cycle/trigger.c ****   if(is_missing_teeth == false)
 171:controller/engine_cycle/trigger.c ****   {
 172:controller/engine_cycle/trigger.c ****     //Regular (non-missing) tooth
 173:controller/engine_cycle/trigger.c ****     set_filtering(trigger); 
 174:controller/engine_cycle/trigger.c ****   }
 175:controller/engine_cycle/trigger.c ****   
 176:controller/engine_cycle/trigger.c ****   trigger->_tooth_time_us[2] = trigger->_tooth_time_us[1];
 177:controller/engine_cycle/trigger.c ****   trigger->_tooth_time_us[1] = trigger->_tooth_time_us[0];
 178:controller/engine_cycle/trigger.c **** 
 179:controller/engine_cycle/trigger.c ****   /* call trigger driven events such as ignition etc... */
 180:controller/engine_cycle/trigger.c ****   ignition_trigger_event_handle(crankshaft_get_angle(), crankshaft_get_rpm(), get_time_us());
 181:controller/engine_cycle/trigger.c ****   /* set the os flags for the engine */
 182:controller/engine_cycle/trigger.c ****   osEventFlagsSet(engine.flags, ENGINE_FLAG_TRIGGER_EVENT);
 183:controller/engine_cycle/trigger.c **** 
 184:controller/engine_cycle/trigger.c **** }
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 9


 185:controller/engine_cycle/trigger.c **** 
 186:controller/engine_cycle/trigger.c **** 
 187:controller/engine_cycle/trigger.c **** rpm_t crankshaft_get_rpm()
 188:controller/engine_cycle/trigger.c **** {
 246              		.loc 1 188 1 is_stmt 1 view -0
 247              		.cfi_startproc
 248              		@ args = 0, pretend = 0, frame = 0
 249              		@ frame_needed = 0, uses_anonymous_args = 0
 250              		@ link register save eliminated.
 189:controller/engine_cycle/trigger.c ****   return engine.rpm;
 251              		.loc 1 189 3 view .LVU69
 190:controller/engine_cycle/trigger.c **** }
 252              		.loc 1 190 1 is_stmt 0 view .LVU70
 253 0000 014B     		ldr	r3, .L23
 254 0002 93ED030A 		vldr.32	s0, [r3, #12]
 255 0006 7047     		bx	lr
 256              	.L24:
 257              		.align	2
 258              	.L23:
 259 0008 00000000 		.word	engine
 260              		.cfi_endproc
 261              	.LFE231:
 263              		.section	.text.crankshaft_get_angle,"ax",%progbits
 264              		.align	1
 265              		.global	crankshaft_get_angle
 266              		.syntax unified
 267              		.thumb
 268              		.thumb_func
 270              	crankshaft_get_angle:
 271              	.LFB232:
 191:controller/engine_cycle/trigger.c **** 
 192:controller/engine_cycle/trigger.c **** /**
 193:controller/engine_cycle/trigger.c ****  * @brief returns the instant angle of the crankshaft
 194:controller/engine_cycle/trigger.c ****  * @note angle is updated on every trigger event!
 195:controller/engine_cycle/trigger.c ****  */
 196:controller/engine_cycle/trigger.c **** angle_t crankshaft_get_angle()
 197:controller/engine_cycle/trigger.c **** {
 272              		.loc 1 197 1 is_stmt 1 view -0
 273              		.cfi_startproc
 274              		@ args = 0, pretend = 0, frame = 0
 275              		@ frame_needed = 0, uses_anonymous_args = 0
 276              		@ link register save eliminated.
 198:controller/engine_cycle/trigger.c ****   return engine.crankshaft_angle;
 277              		.loc 1 198 3 view .LVU72
 199:controller/engine_cycle/trigger.c **** }
 278              		.loc 1 199 1 is_stmt 0 view .LVU73
 279 0000 014B     		ldr	r3, .L26
 280 0002 93ED010A 		vldr.32	s0, [r3, #4]
 281 0006 7047     		bx	lr
 282              	.L27:
 283              		.align	2
 284              	.L26:
 285 0008 00000000 		.word	engine
 286              		.cfi_endproc
 287              	.LFE232:
 289              		.section	.rodata.trigger_tooth_handle.str1.4,"aMS",%progbits,1
 290              		.align	2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 10


 291              	.LC3:
 292 0000 54726967 		.ascii	"Trigger is not initialized.\000"
 292      67657220 
 292      6973206E 
 292      6F742069 
 292      6E697469 
 293              		.section	.text.trigger_tooth_handle,"ax",%progbits
 294              		.align	1
 295              		.global	trigger_tooth_handle
 296              		.syntax unified
 297              		.thumb
 298              		.thumb_func
 300              	trigger_tooth_handle:
 301              	.LFB230:
  61:controller/engine_cycle/trigger.c **** 
 302              		.loc 1 61 1 is_stmt 1 view -0
 303              		.cfi_startproc
 304              		@ args = 0, pretend = 0, frame = 0
 305              		@ frame_needed = 0, uses_anonymous_args = 0
 306 0000 38B5     		push	{r3, r4, r5, lr}
 307              		.cfi_def_cfa_offset 16
 308              		.cfi_offset 3, -16
 309              		.cfi_offset 4, -12
 310              		.cfi_offset 5, -8
 311              		.cfi_offset 14, -4
 312 0002 2DED028B 		vpush.64	{d8}
 313              		.cfi_def_cfa_offset 24
 314              		.cfi_offset 80, -24
 315              		.cfi_offset 81, -20
  63:controller/engine_cycle/trigger.c ****   {
 316              		.loc 1 63 3 view .LVU75
  63:controller/engine_cycle/trigger.c ****   {
 317              		.loc 1 63 15 is_stmt 0 view .LVU76
 318 0006 614B     		ldr	r3, .L54
 319 0008 1D68     		ldr	r5, [r3]
 320 000a 2C78     		ldrb	r4, [r5]	@ zero_extendqisi2
  63:controller/engine_cycle/trigger.c ****   {
 321              		.loc 1 63 6 view .LVU77
 322 000c 002C     		cmp	r4, #0
 323 000e 00F08180 		beq	.L49
  69:controller/engine_cycle/trigger.c ****   trigger->_current_tooth_gap_us = trigger->_tooth_time_us[0] - trigger->_tooth_time_us[1];
 324              		.loc 1 69 3 is_stmt 1 view .LVU78
  69:controller/engine_cycle/trigger.c ****   trigger->_current_tooth_gap_us = trigger->_tooth_time_us[0] - trigger->_tooth_time_us[1];
 325              		.loc 1 69 32 is_stmt 0 view .LVU79
 326 0012 FFF7FEFF 		bl	get_time_us
 327              	.LVL14:
  69:controller/engine_cycle/trigger.c ****   trigger->_current_tooth_gap_us = trigger->_tooth_time_us[0] - trigger->_tooth_time_us[1];
 328              		.loc 1 69 30 discriminator 1 view .LVU80
 329 0016 A860     		str	r0, [r5, #8]
  70:controller/engine_cycle/trigger.c ****   
 330              		.loc 1 70 3 is_stmt 1 view .LVU81
  70:controller/engine_cycle/trigger.c ****   
 331              		.loc 1 70 43 is_stmt 0 view .LVU82
 332 0018 5C4B     		ldr	r3, .L54
 333 001a 1B68     		ldr	r3, [r3]
  70:controller/engine_cycle/trigger.c ****   
 334              		.loc 1 70 59 view .LVU83
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 11


 335 001c 9A68     		ldr	r2, [r3, #8]
  70:controller/engine_cycle/trigger.c ****   
 336              		.loc 1 70 88 view .LVU84
 337 001e D868     		ldr	r0, [r3, #12]
  70:controller/engine_cycle/trigger.c ****   
 338              		.loc 1 70 63 view .LVU85
 339 0020 121A     		subs	r2, r2, r0
  70:controller/engine_cycle/trigger.c ****   
 340              		.loc 1 70 34 view .LVU86
 341 0022 5A61     		str	r2, [r3, #20]
  72:controller/engine_cycle/trigger.c ****   {
 342              		.loc 1 72 3 is_stmt 1 view .LVU87
  72:controller/engine_cycle/trigger.c ****   {
 343              		.loc 1 72 47 is_stmt 0 view .LVU88
 344 0024 5968     		ldr	r1, [r3, #4]
  72:controller/engine_cycle/trigger.c ****   {
 345              		.loc 1 72 6 view .LVU89
 346 0026 8A42     		cmp	r2, r1
 347 0028 71D3     		bcc	.L28
  79:controller/engine_cycle/trigger.c ****   
 348              		.loc 1 79 3 is_stmt 1 view .LVU90
  79:controller/engine_cycle/trigger.c ****   
 349              		.loc 1 79 10 is_stmt 0 view .LVU91
 350 002a 198C     		ldrh	r1, [r3, #32]
  79:controller/engine_cycle/trigger.c ****   
 351              		.loc 1 79 26 view .LVU92
 352 002c 0131     		adds	r1, r1, #1
 353 002e 89B2     		uxth	r1, r1
 354 0030 1984     		strh	r1, [r3, #32]	@ movhi
  81:controller/engine_cycle/trigger.c ****   
 355              		.loc 1 81 3 is_stmt 1 view .LVU93
 356              	.LVL15:
  84:controller/engine_cycle/trigger.c ****   {
 357              		.loc 1 84 3 view .LVU94
  87:controller/engine_cycle/trigger.c ****     
 358              		.loc 1 87 3 view .LVU95
  89:controller/engine_cycle/trigger.c **** 
 359              		.loc 1 89 3 view .LVU96
  91:controller/engine_cycle/trigger.c **** 
 360              		.loc 1 91 3 view .LVU97
  91:controller/engine_cycle/trigger.c **** 
 361              		.loc 1 91 76 is_stmt 0 view .LVU98
 362 0032 1D69     		ldr	r5, [r3, #16]
  91:controller/engine_cycle/trigger.c **** 
 363              		.loc 1 91 22 view .LVU99
 364 0034 401B     		subs	r0, r0, r5
 365              	.LVL16:
  94:controller/engine_cycle/trigger.c ****   {
 366              		.loc 1 94 3 is_stmt 1 view .LVU100
  94:controller/engine_cycle/trigger.c ****   {
 367              		.loc 1 94 6 is_stmt 0 view .LVU101
 368 0036 8242     		cmp	r2, r0
 369 0038 70D9     		bls	.L31
  99:controller/engine_cycle/trigger.c ****   }
 370              		.loc 1 99 5 is_stmt 1 view .LVU102
  99:controller/engine_cycle/trigger.c ****   }
 371              		.loc 1 99 33 is_stmt 0 view .LVU103
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 12


 372 003a 9861     		str	r0, [r3, #24]
 373              	.L32:
 108:controller/engine_cycle/trigger.c ****   {
 374              		.loc 1 108 3 is_stmt 1 view .LVU104
 108:controller/engine_cycle/trigger.c ****   {
 375              		.loc 1 108 13 is_stmt 0 view .LVU105
 376 003c 586A     		ldr	r0, [r3, #36]
 377              	.LVL17:
 108:controller/engine_cycle/trigger.c ****   {
 378              		.loc 1 108 23 view .LVU106
 379 003e 8078     		ldrb	r0, [r0, #2]	@ zero_extendqisi2
 108:controller/engine_cycle/trigger.c ****   {
 380              		.loc 1 108 5 view .LVU107
 381 0040 0128     		cmp	r0, #1
 382 0042 6DD0     		beq	.L50
 114:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one
 383              		.loc 1 114 5 is_stmt 1 view .LVU108
 114:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one
 384              		.loc 1 114 44 is_stmt 0 view .LVU109
 385 0044 9D69     		ldr	r5, [r3, #24]
 386              	.LVL18:
 114:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one
 387              		.loc 1 114 65 view .LVU110
 388 0046 00FB05F5 		mul	r5, r0, r5
 114:controller/engine_cycle/trigger.c ****   } //Multiply by 2 (Checks for a gap 2x greater than the last one
 389              		.loc 1 114 35 view .LVU111
 390 004a DD61     		str	r5, [r3, #28]
 391              	.L34:
 120:controller/engine_cycle/trigger.c ****   {
 392              		.loc 1 120 3 is_stmt 1 view .LVU112
 120:controller/engine_cycle/trigger.c ****   {
 393              		.loc 1 120 48 is_stmt 0 view .LVU113
 394 004c D869     		ldr	r0, [r3, #28]
 120:controller/engine_cycle/trigger.c ****   {
 395              		.loc 1 120 6 view .LVU114
 396 004e 8242     		cmp	r2, r0
 397 0050 03D8     		bhi	.L35
 120:controller/engine_cycle/trigger.c ****   {
 398              		.loc 1 120 109 discriminator 1 view .LVU115
 399 0052 93F82220 		ldrb	r2, [r3, #34]	@ zero_extendqisi2
 120:controller/engine_cycle/trigger.c ****   {
 400              		.loc 1 120 72 discriminator 1 view .LVU116
 401 0056 9142     		cmp	r1, r2
 402 0058 77D9     		bls	.L45
 403              	.L35:
 123:controller/engine_cycle/trigger.c ****     /**
 404              		.loc 1 123 5 is_stmt 1 view .LVU117
 405              	.LVL19:
 127:controller/engine_cycle/trigger.c ****     {
 406              		.loc 1 127 5 view .LVU118
 127:controller/engine_cycle/trigger.c ****     {
 407              		.loc 1 127 42 is_stmt 0 view .LVU119
 408 005a 93F82220 		ldrb	r2, [r3, #34]	@ zero_extendqisi2
 127:controller/engine_cycle/trigger.c ****     {
 409              		.loc 1 127 8 view .LVU120
 410 005e 9142     		cmp	r1, r2
 411 0060 64D2     		bcs	.L37
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 13


 129:controller/engine_cycle/trigger.c ****       trigger->sync_loss_counter++;
 412              		.loc 1 129 7 is_stmt 1 view .LVU121
 129:controller/engine_cycle/trigger.c ****       trigger->sync_loss_counter++;
 413              		.loc 1 129 28 is_stmt 0 view .LVU122
 414 0062 0022     		movs	r2, #0
 415 0064 5A70     		strb	r2, [r3, #1]
 130:controller/engine_cycle/trigger.c ****       engine.total_revolutions = 0;
 416              		.loc 1 130 7 is_stmt 1 view .LVU123
 130:controller/engine_cycle/trigger.c ****       engine.total_revolutions = 0;
 417              		.loc 1 130 14 is_stmt 0 view .LVU124
 418 0066 4949     		ldr	r1, .L54
 419 0068 0868     		ldr	r0, [r1]
 420 006a 4388     		ldrh	r3, [r0, #2]
 421              	.LVL20:
 130:controller/engine_cycle/trigger.c ****       engine.total_revolutions = 0;
 422              		.loc 1 130 33 view .LVU125
 423 006c 0133     		adds	r3, r3, #1
 424 006e 4380     		strh	r3, [r0, #2]	@ movhi
 131:controller/engine_cycle/trigger.c ****       engine.rpm = 0;
 425              		.loc 1 131 7 is_stmt 1 view .LVU126
 131:controller/engine_cycle/trigger.c ****       engine.rpm = 0;
 426              		.loc 1 131 32 is_stmt 0 view .LVU127
 427 0070 474B     		ldr	r3, .L54+4
 428 0072 1A60     		str	r2, [r3]
 132:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 429              		.loc 1 132 7 is_stmt 1 view .LVU128
 132:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 430              		.loc 1 132 18 is_stmt 0 view .LVU129
 431 0074 0020     		movs	r0, #0
 432 0076 D860     		str	r0, [r3, #12]	@ float
 133:controller/engine_cycle/trigger.c ****     }
 433              		.loc 1 133 7 is_stmt 1 view .LVU130
 133:controller/engine_cycle/trigger.c ****     }
 434              		.loc 1 133 14 is_stmt 0 view .LVU131
 435 0078 0B68     		ldr	r3, [r1]
 133:controller/engine_cycle/trigger.c ****     }
 436              		.loc 1 133 31 view .LVU132
 437 007a 1A84     		strh	r2, [r3, #32]	@ movhi
 438              	.LVL21:
 439              	.L36:
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 440              		.loc 1 145 3 is_stmt 1 view .LVU133
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 441              		.loc 1 145 68 is_stmt 0 view .LVU134
 442 007c 454B     		ldr	r3, .L54+8
 443 007e D979     		ldrb	r1, [r3, #7]	@ zero_extendqisi2
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 444              		.loc 1 145 38 view .LVU135
 445 0080 07EE901A 		vmov	s15, r1	@ int
 446 0084 B8EE677A 		vcvt.f32.u32	s14, s15
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 447              		.loc 1 145 36 view .LVU136
 448 0088 DFED436A 		vldr.32	s13, .L54+12
 449 008c C6EE877A 		vdiv.f32	s15, s13, s14
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 450              		.loc 1 145 98 view .LVU137
 451 0090 3E4B     		ldr	r3, .L54
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 14


 452 0092 1868     		ldr	r0, [r3]
 453 0094 038C     		ldrh	r3, [r0, #32]
 454 0096 07EE103A 		vmov	s14, r3	@ int
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 455              		.loc 1 145 82 view .LVU138
 456 009a B8EE477A 		vcvt.f32.u32	s14, s14
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 457              		.loc 1 145 80 view .LVU139
 458 009e 67EE877A 		vmul.f32	s15, s15, s14
 145:controller/engine_cycle/trigger.c ****   engine.rpm = (rpm_t)(CONVERSION_FACTOR_SECONDS_TO_MICROSECONDS * CONVERSION_FACTOR_MINUTES_TO_SEC
 459              		.loc 1 145 27 view .LVU140
 460 00a2 3B4A     		ldr	r2, .L54+4
 461 00a4 C2ED017A 		vstr.32	s15, [r2, #4]
 146:controller/engine_cycle/trigger.c **** 
 462              		.loc 1 146 3 is_stmt 1 view .LVU141
 146:controller/engine_cycle/trigger.c **** 
 463              		.loc 1 146 114 is_stmt 0 view .LVU142
 464 00a8 8569     		ldr	r5, [r0, #24]
 146:controller/engine_cycle/trigger.c **** 
 465              		.loc 1 146 105 view .LVU143
 466 00aa 3C4B     		ldr	r3, .L54+16
 467 00ac B3FBF5F3 		udiv	r3, r3, r5
 146:controller/engine_cycle/trigger.c **** 
 468              		.loc 1 146 135 view .LVU144
 469 00b0 B3FBF1F3 		udiv	r3, r3, r1
 146:controller/engine_cycle/trigger.c **** 
 470              		.loc 1 146 16 view .LVU145
 471 00b4 07EE903A 		vmov	s15, r3	@ int
 472 00b8 F8EE677A 		vcvt.f32.u32	s15, s15
 146:controller/engine_cycle/trigger.c **** 
 473              		.loc 1 146 14 view .LVU146
 474 00bc C2ED037A 		vstr.32	s15, [r2, #12]
 149:controller/engine_cycle/trigger.c ****   {
 475              		.loc 1 149 3 is_stmt 1 view .LVU147
 149:controller/engine_cycle/trigger.c ****   {
 476              		.loc 1 149 14 is_stmt 0 view .LVU148
 477 00c0 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
 149:controller/engine_cycle/trigger.c ****   {
 478              		.loc 1 149 6 view .LVU149
 479 00c2 012B     		cmp	r3, #1
 480 00c4 43D0     		beq	.L51
 481              	.L38:
 153:controller/engine_cycle/trigger.c ****   {
 482              		.loc 1 153 8 is_stmt 1 view .LVU150
 153:controller/engine_cycle/trigger.c ****   {
 483              		.loc 1 153 11 is_stmt 0 view .LVU151
 484 00c6 012B     		cmp	r3, #1
 485 00c8 4DD0     		beq	.L52
 486              	.L41:
 157:controller/engine_cycle/trigger.c ****   {
 487              		.loc 1 157 8 is_stmt 1 view .LVU152
 157:controller/engine_cycle/trigger.c ****   {
 488              		.loc 1 157 11 is_stmt 0 view .LVU153
 489 00ca 002B     		cmp	r3, #0
 490 00cc 57D1     		bne	.L43
 159:controller/engine_cycle/trigger.c ****   }
 491              		.loc 1 159 5 is_stmt 1 view .LVU154
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 15


 159:controller/engine_cycle/trigger.c ****   }
 492              		.loc 1 159 27 is_stmt 0 view .LVU155
 493 00ce 304B     		ldr	r3, .L54+4
 494 00d0 0122     		movs	r2, #1
 495 00d2 5A74     		strb	r2, [r3, #17]
 496              	.L40:
 170:controller/engine_cycle/trigger.c ****   {
 497              		.loc 1 170 3 is_stmt 1 view .LVU156
 170:controller/engine_cycle/trigger.c ****   {
 498              		.loc 1 170 5 is_stmt 0 view .LVU157
 499 00d4 002C     		cmp	r4, #0
 500 00d6 56D0     		beq	.L53
 501              	.L44:
 176:controller/engine_cycle/trigger.c ****   trigger->_tooth_time_us[1] = trigger->_tooth_time_us[0];
 502              		.loc 1 176 3 is_stmt 1 view .LVU158
 176:controller/engine_cycle/trigger.c ****   trigger->_tooth_time_us[1] = trigger->_tooth_time_us[0];
 503              		.loc 1 176 39 is_stmt 0 view .LVU159
 504 00d8 2C4B     		ldr	r3, .L54
 505 00da 1B68     		ldr	r3, [r3]
 176:controller/engine_cycle/trigger.c ****   trigger->_tooth_time_us[1] = trigger->_tooth_time_us[0];
 506              		.loc 1 176 55 view .LVU160
 507 00dc DA68     		ldr	r2, [r3, #12]
 176:controller/engine_cycle/trigger.c ****   trigger->_tooth_time_us[1] = trigger->_tooth_time_us[0];
 508              		.loc 1 176 30 view .LVU161
 509 00de 1A61     		str	r2, [r3, #16]
 177:controller/engine_cycle/trigger.c **** 
 510              		.loc 1 177 3 is_stmt 1 view .LVU162
 177:controller/engine_cycle/trigger.c **** 
 511              		.loc 1 177 55 is_stmt 0 view .LVU163
 512 00e0 9A68     		ldr	r2, [r3, #8]
 177:controller/engine_cycle/trigger.c **** 
 513              		.loc 1 177 30 view .LVU164
 514 00e2 DA60     		str	r2, [r3, #12]
 180:controller/engine_cycle/trigger.c ****   /* set the os flags for the engine */
 515              		.loc 1 180 3 is_stmt 1 view .LVU165
 516 00e4 FFF7FEFF 		bl	crankshaft_get_angle
 517              	.LVL22:
 518 00e8 B0EE408A 		vmov.f32	s16, s0
 180:controller/engine_cycle/trigger.c ****   /* set the os flags for the engine */
 519              		.loc 1 180 3 is_stmt 0 discriminator 1 view .LVU166
 520 00ec FFF7FEFF 		bl	crankshaft_get_rpm
 521              	.LVL23:
 522 00f0 F0EE408A 		vmov.f32	s17, s0
 180:controller/engine_cycle/trigger.c ****   /* set the os flags for the engine */
 523              		.loc 1 180 3 discriminator 2 view .LVU167
 524 00f4 FFF7FEFF 		bl	get_time_us
 525              	.LVL24:
 180:controller/engine_cycle/trigger.c ****   /* set the os flags for the engine */
 526              		.loc 1 180 3 discriminator 3 view .LVU168
 527 00f8 F0EE680A 		vmov.f32	s1, s17
 528 00fc B0EE480A 		vmov.f32	s0, s16
 529 0100 FFF7FEFF 		bl	ignition_trigger_event_handle
 530              	.LVL25:
 182:controller/engine_cycle/trigger.c **** 
 531              		.loc 1 182 3 is_stmt 1 view .LVU169
 532 0104 0121     		movs	r1, #1
 533 0106 224B     		ldr	r3, .L54+4
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 16


 534 0108 986C     		ldr	r0, [r3, #72]
 535 010a FFF7FEFF 		bl	osEventFlagsSet
 536              	.LVL26:
 537              	.L28:
 184:controller/engine_cycle/trigger.c **** 
 538              		.loc 1 184 1 is_stmt 0 view .LVU170
 539 010e BDEC028B 		vldm	sp!, {d8}
 540              		.cfi_remember_state
 541              		.cfi_restore 80
 542              		.cfi_restore 81
 543              		.cfi_def_cfa_offset 16
 544 0112 38BD     		pop	{r3, r4, r5, pc}
 545              	.L49:
 546              		.cfi_restore_state
  65:controller/engine_cycle/trigger.c ****     return;
 547              		.loc 1 65 5 is_stmt 1 view .LVU171
 548 0114 2248     		ldr	r0, .L54+20
 549 0116 FFF7FEFF 		bl	log_error
 550              	.LVL27:
  66:controller/engine_cycle/trigger.c ****   }
 551              		.loc 1 66 5 view .LVU172
 552 011a F8E7     		b	.L28
 553              	.LVL28:
 554              	.L31:
 103:controller/engine_cycle/trigger.c ****   }
 555              		.loc 1 103 5 view .LVU173
 103:controller/engine_cycle/trigger.c ****   }
 556              		.loc 1 103 33 is_stmt 0 view .LVU174
 557 011c 9A61     		str	r2, [r3, #24]
 558 011e 8DE7     		b	.L32
 559              	.LVL29:
 560              	.L50:
 110:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 561              		.loc 1 110 5 is_stmt 1 view .LVU175
 110:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 562              		.loc 1 110 49 is_stmt 0 view .LVU176
 563 0120 9869     		ldr	r0, [r3, #24]
 110:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 564              		.loc 1 110 40 view .LVU177
 565 0122 00EB4000 		add	r0, r0, r0, lsl #1
 110:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 566              		.loc 1 110 71 view .LVU178
 567 0126 4008     		lsrs	r0, r0, #1
 110:controller/engine_cycle/trigger.c ****   } //Multiply by 1.5 (Checks for a gap 1.5x greater than the last one) (Uses bitshift to multiply 
 568              		.loc 1 110 35 view .LVU179
 569 0128 D861     		str	r0, [r3, #28]
 570 012a 8FE7     		b	.L34
 571              	.LVL30:
 572              	.L37:
 137:controller/engine_cycle/trigger.c ****       engine.total_revolutions++;
 573              		.loc 1 137 7 is_stmt 1 view .LVU180
 137:controller/engine_cycle/trigger.c ****       engine.total_revolutions++;
 574              		.loc 1 137 28 is_stmt 0 view .LVU181
 575 012c 0122     		movs	r2, #1
 576 012e 5A70     		strb	r2, [r3, #1]
 138:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 577              		.loc 1 138 7 is_stmt 1 view .LVU182
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 17


 138:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 578              		.loc 1 138 13 is_stmt 0 view .LVU183
 579 0130 174B     		ldr	r3, .L54+4
 580              	.LVL31:
 138:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 581              		.loc 1 138 13 view .LVU184
 582 0132 1A68     		ldr	r2, [r3]
 138:controller/engine_cycle/trigger.c ****       trigger->_counted_tooth = 0;
 583              		.loc 1 138 31 view .LVU185
 584 0134 0132     		adds	r2, r2, #1
 585 0136 1A60     		str	r2, [r3]
 139:controller/engine_cycle/trigger.c ****      //here we can say we are at TDC!
 586              		.loc 1 139 7 is_stmt 1 view .LVU186
 139:controller/engine_cycle/trigger.c ****      //here we can say we are at TDC!
 587              		.loc 1 139 14 is_stmt 0 view .LVU187
 588 0138 144A     		ldr	r2, .L54
 589 013a 1268     		ldr	r2, [r2]
 139:controller/engine_cycle/trigger.c ****      //here we can say we are at TDC!
 590              		.loc 1 139 31 view .LVU188
 591 013c 0021     		movs	r1, #0
 592 013e 1184     		strh	r1, [r2, #32]	@ movhi
 141:controller/engine_cycle/trigger.c ****     }
 593              		.loc 1 141 7 is_stmt 1 view .LVU189
 594 0140 0221     		movs	r1, #2
 595 0142 986C     		ldr	r0, [r3, #72]
 596 0144 FFF7FEFF 		bl	osEventFlagsSet
 597              	.LVL32:
 598 0148 98E7     		b	.L36
 599              	.LVL33:
 600              	.L45:
  81:controller/engine_cycle/trigger.c ****   
 601              		.loc 1 81 8 is_stmt 0 view .LVU190
 602 014a 0024     		movs	r4, #0
 603 014c 96E7     		b	.L36
 604              	.LVL34:
 605              	.L51:
 149:controller/engine_cycle/trigger.c ****   {
 606              		.loc 1 149 77 discriminator 1 view .LVU191
 607 014e 114A     		ldr	r2, .L54+8
 608 0150 92ED037A 		vldr.32	s14, [r2, #12]
 149:controller/engine_cycle/trigger.c ****   {
 609              		.loc 1 149 47 discriminator 1 view .LVU192
 610 0154 F4EEC77A 		vcmpe.f32	s15, s14
 611 0158 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 612 015c B3DB     		blt	.L38
 151:controller/engine_cycle/trigger.c ****   }
 613              		.loc 1 151 5 is_stmt 1 view .LVU193
 151:controller/engine_cycle/trigger.c ****   }
 614              		.loc 1 151 27 is_stmt 0 view .LVU194
 615 015e 0C4B     		ldr	r3, .L54+4
 616 0160 0322     		movs	r2, #3
 617 0162 5A74     		strb	r2, [r3, #17]
 618 0164 B6E7     		b	.L40
 619              	.L52:
 153:controller/engine_cycle/trigger.c ****   {
 620              		.loc 1 153 81 discriminator 1 view .LVU195
 621 0166 0B4A     		ldr	r2, .L54+8
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 18


 622 0168 92ED037A 		vldr.32	s14, [r2, #12]
 153:controller/engine_cycle/trigger.c ****   {
 623              		.loc 1 153 52 discriminator 1 view .LVU196
 624 016c F4EEC77A 		vcmpe.f32	s15, s14
 625 0170 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 626 0174 A9D5     		bpl	.L41
 155:controller/engine_cycle/trigger.c ****   }
 627              		.loc 1 155 5 is_stmt 1 view .LVU197
 155:controller/engine_cycle/trigger.c ****   }
 628              		.loc 1 155 27 is_stmt 0 view .LVU198
 629 0176 064B     		ldr	r3, .L54+4
 630 0178 0222     		movs	r2, #2
 631 017a 5A74     		strb	r2, [r3, #17]
 632 017c AAE7     		b	.L40
 633              	.L43:
 163:controller/engine_cycle/trigger.c ****   }
 634              		.loc 1 163 5 is_stmt 1 view .LVU199
 163:controller/engine_cycle/trigger.c ****   }
 635              		.loc 1 163 27 is_stmt 0 view .LVU200
 636 017e 044B     		ldr	r3, .L54+4
 637 0180 0022     		movs	r2, #0
 638 0182 5A74     		strb	r2, [r3, #17]
 639 0184 A6E7     		b	.L40
 640              	.L53:
 173:controller/engine_cycle/trigger.c ****   }
 641              		.loc 1 173 5 is_stmt 1 view .LVU201
 642 0186 FFF7FEFF 		bl	set_filtering
 643              	.LVL35:
 644 018a A5E7     		b	.L44
 645              	.L55:
 646              		.align	2
 647              	.L54:
 648 018c 00000000 		.word	trigger
 649 0190 00000000 		.word	engine
 650 0194 00000000 		.word	configuration
 651 0198 0000B443 		.word	1135869952
 652 019c 00879303 		.word	60000000
 653 01a0 00000000 		.word	.LC3
 654              		.cfi_endproc
 655              	.LFE230:
 657              		.global	trigger
 658              		.section	.bss.trigger,"aw",%nobits
 659              		.align	2
 662              	trigger:
 663 0000 00000000 		.space	4
 664              		.text
 665              	.Letext0:
 666              		.file 2 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 667              		.file 3 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 668              		.file 4 "controller/types.h"
 669              		.file 5 "Middlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS_V2/cmsis_os2.h"
 670              		.file 6 "controller/engine_cycle/trigger.h"
 671              		.file 7 "controller/tables.h"
 672              		.file 8 "controller/IO/analog_inputs.h"
 673              		.file 9 "controller/IO/sensors.h"
 674              		.file 10 "controller/utils/pid.h"
 675              		.file 11 "controller/algorithm/governer.h"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 19


 676              		.file 12 "controller/utils/comms.h"
 677              		.file 13 "controller/controller.h"
 678              		.file 14 "controller/engine_cycle/ignition.h"
 679              		.file 15 "controller/utils/error_handling.h"
 680              		.file 16 "controller/utils/timing.h"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccyGftci.s 			page 20


DEFINED SYMBOLS
                            *ABS*:00000000 trigger.c
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:21     .text.set_filtering:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:27     .text.set_filtering:00000000 set_filtering
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:46     .text.set_filtering:00000010 $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:50     .text.set_filtering:00000014 $t
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:99     .text.set_filtering:0000003c $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:662    .bss.trigger:00000000 trigger
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:104    .rodata.trigger_init.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:115    .text.trigger_init:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:121    .text.trigger_init:00000000 trigger_init
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:230    .text.trigger_init:00000054 $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:238    .text.crankshaft_get_rpm:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:244    .text.crankshaft_get_rpm:00000000 crankshaft_get_rpm
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:259    .text.crankshaft_get_rpm:00000008 $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:264    .text.crankshaft_get_angle:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:270    .text.crankshaft_get_angle:00000000 crankshaft_get_angle
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:285    .text.crankshaft_get_angle:00000008 $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:290    .rodata.trigger_tooth_handle.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:294    .text.trigger_tooth_handle:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:300    .text.trigger_tooth_handle:00000000 trigger_tooth_handle
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:648    .text.trigger_tooth_handle:0000018c $d
C:\Users\alireza\AppData\Local\Temp\ccyGftci.s:659    .bss.trigger:00000000 $d

UNDEFINED SYMBOLS
log_error
engine
get_time_us
ignition_trigger_event_handle
osEventFlagsSet
configuration
