ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"tps.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "controller/IO/sensors/tps.c"
  20              		.section	.rodata.sensor_tps_get.str1.4,"aMS",%progbits,1
  21              		.align	2
  22              	.LC0:
  23 0000 74707320 		.ascii	"tps is null\000"
  23      6973206E 
  23      756C6C00 
  24              		.align	2
  25              	.LC1:
  26 000c 74707320 		.ascii	"tps wrong sensor calib\000"
  26      77726F6E 
  26      67207365 
  26      6E736F72 
  26      2063616C 
  27              		.section	.text.sensor_tps_get,"ax",%progbits
  28              		.align	1
  29              		.global	sensor_tps_get
  30              		.syntax unified
  31              		.thumb
  32              		.thumb_func
  34              	sensor_tps_get:
  35              	.LVL0:
  36              	.LFB228:
   1:controller/IO/sensors/tps.c **** #include "tps.h"
   2:controller/IO/sensors/tps.c **** #include "error_handling.h"
   3:controller/IO/sensors/tps.c **** #include <math.h>
   4:controller/IO/sensors/tps.c **** #include "utils.h"
   5:controller/IO/sensors/tps.c **** 
   6:controller/IO/sensors/tps.c **** percent_t sensor_tps_get(sensor_tps_s *sensor)
   7:controller/IO/sensors/tps.c **** {
  37              		.loc 1 7 1 view -0
  38              		.cfi_startproc
  39              		@ args = 0, pretend = 0, frame = 0
  40              		@ frame_needed = 0, uses_anonymous_args = 0
  41              		.loc 1 7 1 is_stmt 0 view .LVU1
  42 0000 10B5     		push	{r4, lr}
  43              		.cfi_def_cfa_offset 8
  44              		.cfi_offset 4, -8
  45              		.cfi_offset 14, -4
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 2


   8:controller/IO/sensors/tps.c ****     if (sensor == NULL)
  46              		.loc 1 8 5 is_stmt 1 view .LVU2
  47              		.loc 1 8 8 is_stmt 0 view .LVU3
  48 0002 A0B3     		cbz	r0, .L17
  49 0004 0446     		mov	r4, r0
   9:controller/IO/sensors/tps.c ****     {
  10:controller/IO/sensors/tps.c ****         log_error("tps is null");
  11:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
  12:controller/IO/sensors/tps.c ****     }
  13:controller/IO/sensors/tps.c ****      if (sensor->wide_open_throttle_adc_value == 0 && sensor->closed_throttle_adc_value == 0)
  50              		.loc 1 13 6 is_stmt 1 view .LVU4
  51              		.loc 1 13 16 is_stmt 0 view .LVU5
  52 0006 0388     		ldrh	r3, [r0]
  53              		.loc 1 13 9 view .LVU6
  54 0008 0BB9     		cbnz	r3, .L4
  55              		.loc 1 13 61 discriminator 1 view .LVU7
  56 000a 4388     		ldrh	r3, [r0, #2]
  57              		.loc 1 13 52 discriminator 1 view .LVU8
  58 000c ABB3     		cbz	r3, .L18
  59              	.L4:
  14:controller/IO/sensors/tps.c ****     {
  15:controller/IO/sensors/tps.c ****         log_error("tps wrong sensor calib");
  16:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
  17:controller/IO/sensors/tps.c ****     }
  18:controller/IO/sensors/tps.c ****     percent_t result = 0;
  60              		.loc 1 18 5 is_stmt 1 view .LVU9
  61              	.LVL1:
  19:controller/IO/sensors/tps.c ****     uint16_t raw_data = analog_inputs_get_data(sensor->analog_channel);
  62              		.loc 1 19 5 view .LVU10
  63              		.loc 1 19 25 is_stmt 0 view .LVU11
  64 000e 2079     		ldrb	r0, [r4, #4]	@ zero_extendqisi2
  65              	.LVL2:
  66              		.loc 1 19 25 view .LVU12
  67 0010 FFF7FEFF 		bl	analog_inputs_get_data
  68              	.LVL3:
  69 0014 07EE900A 		vmov	s15, r0	@ int
  70              	.LVL4:
  20:controller/IO/sensors/tps.c ****     if (sensor->is_inverted)
  71              		.loc 1 20 5 is_stmt 1 view .LVU13
  72              		.loc 1 20 15 is_stmt 0 view .LVU14
  73 0018 6379     		ldrb	r3, [r4, #5]	@ zero_extendqisi2
  74              		.loc 1 20 8 view .LVU15
  75 001a A3B3     		cbz	r3, .L5
  21:controller/IO/sensors/tps.c ****     {
  22:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->wide_open_throttle_adc_value, (float)sensor->
  76              		.loc 1 22 9 is_stmt 1 view .LVU16
  77              		.loc 1 22 18 is_stmt 0 view .LVU17
  78 001c F8EE677A 		vcvt.f32.u32	s15, s15
  79              	.LVL5:
  80              		.loc 1 22 53 view .LVU18
  81 0020 2288     		ldrh	r2, [r4]
  82              		.loc 1 22 18 view .LVU19
  83 0022 07EE102A 		vmov	s14, r2	@ int
  84 0026 F8EE476A 		vcvt.f32.u32	s13, s14
  85              		.loc 1 22 98 view .LVU20
  86 002a 6388     		ldrh	r3, [r4, #2]
  87              		.loc 1 22 18 view .LVU21
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 3


  88 002c 07EE103A 		vmov	s14, r3	@ int
  89 0030 B8EE477A 		vcvt.f32.u32	s14, s14
  90              	.LVL6:
  91              	.LBB6:
  92              	.LBI6:
  93              		.file 2 "controller/utils/utils.h"
   1:controller/utils/utils.h **** /**
   2:controller/utils/utils.h ****  * @file utils.h
   3:controller/utils/utils.h ****  * @brief Header file containing utility functions and definitions for the smart generator controll
   4:controller/utils/utils.h ****  * 
   5:controller/utils/utils.h ****  * This file provides declarations for utility functions and macros that are
   6:controller/utils/utils.h ****  * used throughout the firmware to support various functionalities.
   7:controller/utils/utils.h ****  * 
   8:controller/utils/utils.h ****  * @note Ensure that this file is included wherever utility functions are required.
   9:controller/utils/utils.h ****  */
  10:controller/utils/utils.h **** #ifndef UTILS_H
  11:controller/utils/utils.h **** #define UTILS_H
  12:controller/utils/utils.h **** 
  13:controller/utils/utils.h **** #include "types.h"
  14:controller/utils/utils.h **** #include "math.h"
  15:controller/utils/utils.h **** #define IS_IN_RANGE(value, min, max) ((value) >= (min) && (value) <= (max))
  16:controller/utils/utils.h **** #define ABS(value) ((value) < 0 ? -(value) : (value))
  17:controller/utils/utils.h **** #define CLAMP(value, min, max) ((value) < (min) ? (min) : ((value) > (max) ? (max) : (value)))
  18:controller/utils/utils.h **** 
  19:controller/utils/utils.h **** /**
  20:controller/utils/utils.h ****  * @brief Maps a value from one range to another.
  21:controller/utils/utils.h ****  * 
  22:controller/utils/utils.h ****  * @param x The value to map.
  23:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  24:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  25:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  26:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  27:controller/utils/utils.h ****  * @return The mapped value in the output range.
  28:controller/utils/utils.h ****  */
  29:controller/utils/utils.h **** #define MAP(x, in_min, in_max, out_min, out_max) \
  30:controller/utils/utils.h ****     (((x) - (in_min)) * ((out_max) - (out_min)) / ((in_max) - (in_min)) + (out_min))
  31:controller/utils/utils.h **** 
  32:controller/utils/utils.h **** 
  33:controller/utils/utils.h **** /**
  34:controller/utils/utils.h ****  * @brief Maps a uint16_t value from one range to another.
  35:controller/utils/utils.h ****  * 
  36:controller/utils/utils.h ****  * @param x The value to map.
  37:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  38:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  39:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  40:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  41:controller/utils/utils.h ****  * @return The mapped value in the output range.
  42:controller/utils/utils.h ****  */
  43:controller/utils/utils.h **** static inline uint16_t map_uint16(uint16_t x, uint16_t in_min, uint16_t in_max, uint16_t out_min, u
  44:controller/utils/utils.h **** {
  45:controller/utils/utils.h ****     if (in_max == in_min)
  46:controller/utils/utils.h ****     {
  47:controller/utils/utils.h ****         return 0; // Avoid division by zero
  48:controller/utils/utils.h ****     }
  49:controller/utils/utils.h ****     return (uint16_t)((x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min);
  50:controller/utils/utils.h **** }
  51:controller/utils/utils.h **** 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 4


  52:controller/utils/utils.h **** static inline float mapf(float x, float in_min, float in_max, float out_min, float out_max)
  94              		.loc 2 52 21 is_stmt 1 view .LVU22
  95              	.LBB7:
  53:controller/utils/utils.h **** {
  54:controller/utils/utils.h ****     if (in_max == in_min)
  96              		.loc 2 54 5 view .LVU23
  97              		.loc 2 54 8 is_stmt 0 view .LVU24
  98 0034 9A42     		cmp	r2, r3
  99 0036 43D0     		beq	.L10
  55:controller/utils/utils.h ****     {
  56:controller/utils/utils.h ****         return 0.0f; // Avoid division by zero
  57:controller/utils/utils.h ****     }
  58:controller/utils/utils.h ****     return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
 100              		.loc 2 58 5 is_stmt 1 view .LVU25
 101              		.loc 2 58 15 is_stmt 0 view .LVU26
 102 0038 77EEE67A 		vsub.f32	s15, s15, s13
 103              	.LVL7:
 104              		.loc 2 58 25 view .LVU27
 105 003c 9FED266A 		vldr.32	s12, .L21
 106 0040 67EE867A 		vmul.f32	s15, s15, s12
 107              		.loc 2 58 57 view .LVU28
 108 0044 37EE667A 		vsub.f32	s14, s14, s13
 109              	.LVL8:
 110              		.loc 2 58 47 view .LVU29
 111 0048 87EE870A 		vdiv.f32	s0, s15, s14
 112              		.loc 2 58 67 view .LVU30
 113 004c DFED237A 		vldr.32	s15, .L21+4
 114 0050 30EE270A 		vadd.f32	s0, s0, s15
 115              	.LVL9:
 116              	.L7:
 117              		.loc 2 58 67 view .LVU31
 118              	.LBE7:
 119              	.LBE6:
  23:controller/IO/sensors/tps.c ****     }
  24:controller/IO/sensors/tps.c ****     else
  25:controller/IO/sensors/tps.c ****     {
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
  27:controller/IO/sensors/tps.c ****     }
  28:controller/IO/sensors/tps.c ****     if (!IS_IN_RANGE(result, (percent_t)0, (percent_t)100))
 120              		.loc 1 28 5 is_stmt 1 view .LVU32
 121              		.loc 1 28 8 is_stmt 0 view .LVU33
 122 0054 B5EEC00A 		vcmpe.f32	s0, #0
 123 0058 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 124 005c 36DB     		blt	.L19
 125              	.LVL10:
 126              	.L6:
 127              		.loc 1 28 9 discriminator 1 view .LVU34
 128 005e DFED1E7A 		vldr.32	s15, .L21
 129 0062 B4EEE70A 		vcmpe.f32	s0, s15
 130 0066 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 131 006a 32D8     		bhi	.L20
 132              	.LVL11:
 133              	.L1:
  29:controller/IO/sensors/tps.c ****     {
  30:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
  31:controller/IO/sensors/tps.c ****         log_error("tps out of range!");
  32:controller/IO/sensors/tps.c ****     }
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 5


  33:controller/IO/sensors/tps.c ****     return result;
  34:controller/IO/sensors/tps.c **** }...
 134              		.loc 1 34 1 view .LVU35
 135 006c 10BD     		pop	{r4, pc}
 136              	.LVL12:
 137              	.L17:
  10:controller/IO/sensors/tps.c ****         log_error("tps is null");
 138              		.loc 1 10 9 is_stmt 1 view .LVU36
 139 006e 1C48     		ldr	r0, .L21+8
 140              	.LVL13:
  10:controller/IO/sensors/tps.c ****         log_error("tps is null");
 141              		.loc 1 10 9 is_stmt 0 view .LVU37
 142 0070 FFF7FEFF 		bl	log_error
 143              	.LVL14:
  11:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
 144              		.loc 1 11 9 is_stmt 1 view .LVU38
  11:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
 145              		.loc 1 11 16 is_stmt 0 view .LVU39
 146 0074 9FED1B0A 		vldr.32	s0, .L21+12
 147 0078 F8E7     		b	.L1
 148              	.LVL15:
 149              	.L18:
  15:controller/IO/sensors/tps.c ****         log_error("tps wrong sensor calib");
 150              		.loc 1 15 9 is_stmt 1 view .LVU40
 151 007a 1B48     		ldr	r0, .L21+16
 152              	.LVL16:
  15:controller/IO/sensors/tps.c ****         log_error("tps wrong sensor calib");
 153              		.loc 1 15 9 is_stmt 0 view .LVU41
 154 007c FFF7FEFF 		bl	log_error
 155              	.LVL17:
  16:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
 156              		.loc 1 16 9 is_stmt 1 view .LVU42
  16:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
 157              		.loc 1 16 16 is_stmt 0 view .LVU43
 158 0080 9FED180A 		vldr.32	s0, .L21+12
 159 0084 F2E7     		b	.L1
 160              	.LVL18:
 161              	.L5:
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
 162              		.loc 1 26 9 is_stmt 1 view .LVU44
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
 163              		.loc 1 26 18 is_stmt 0 view .LVU45
 164 0086 F8EE677A 		vcvt.f32.u32	s15, s15
 165              	.LVL19:
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
 166              		.loc 1 26 53 view .LVU46
 167 008a 6288     		ldrh	r2, [r4, #2]
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
 168              		.loc 1 26 18 view .LVU47
 169 008c 07EE102A 		vmov	s14, r2	@ int
 170 0090 F8EE476A 		vcvt.f32.u32	s13, s14
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
 171              		.loc 1 26 95 view .LVU48
 172 0094 2388     		ldrh	r3, [r4]
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
 173              		.loc 1 26 18 view .LVU49
 174 0096 07EE103A 		vmov	s14, r3	@ int
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 6


 175 009a B8EE477A 		vcvt.f32.u32	s14, s14
 176              	.LVL20:
 177              	.LBB8:
 178              	.LBI8:
  52:controller/utils/utils.h **** {
 179              		.loc 2 52 21 is_stmt 1 view .LVU50
 180              	.LBB9:
  54:controller/utils/utils.h ****     {
 181              		.loc 2 54 5 view .LVU51
  54:controller/utils/utils.h ****     {
 182              		.loc 2 54 8 is_stmt 0 view .LVU52
 183 009e 9A42     		cmp	r2, r3
 184 00a0 11D0     		beq	.L11
 185              		.loc 2 58 5 is_stmt 1 view .LVU53
 186              		.loc 2 58 15 is_stmt 0 view .LVU54
 187 00a2 77EEE67A 		vsub.f32	s15, s15, s13
 188              	.LVL21:
 189              		.loc 2 58 25 view .LVU55
 190 00a6 9FED0C6A 		vldr.32	s12, .L21
 191 00aa 67EE867A 		vmul.f32	s15, s15, s12
 192              		.loc 2 58 57 view .LVU56
 193 00ae 37EE667A 		vsub.f32	s14, s14, s13
 194              	.LVL22:
 195              		.loc 2 58 47 view .LVU57
 196 00b2 87EE870A 		vdiv.f32	s0, s15, s14
 197              		.loc 2 58 67 view .LVU58
 198 00b6 DFED097A 		vldr.32	s15, .L21+4
 199 00ba 30EE270A 		vadd.f32	s0, s0, s15
 200              	.LVL23:
 201              		.loc 2 58 67 view .LVU59
 202 00be C9E7     		b	.L7
 203              	.LVL24:
 204              	.L10:
 205              		.loc 2 58 67 view .LVU60
 206              	.LBE9:
 207              	.LBE8:
  22:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->wide_open_throttle_adc_value, (float)sensor->
 208              		.loc 1 22 18 view .LVU61
 209 00c0 9FED060A 		vldr.32	s0, .L21+4
 210 00c4 CBE7     		b	.L6
 211              	.LVL25:
 212              	.L11:
  26:controller/IO/sensors/tps.c ****         result = mapf((float)raw_data, (float)sensor->closed_throttle_adc_value, (float)sensor->wid
 213              		.loc 1 26 18 view .LVU62
 214 00c6 9FED050A 		vldr.32	s0, .L21+4
 215 00ca C8E7     		b	.L6
 216              	.LVL26:
 217              	.L19:
  30:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
 218              		.loc 1 30 16 view .LVU63
 219 00cc 9FED050A 		vldr.32	s0, .L21+12
 220              	.LVL27:
  30:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
 221              		.loc 1 30 16 view .LVU64
 222 00d0 CCE7     		b	.L1
 223              	.LVL28:
 224              	.L20:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 7


  30:controller/IO/sensors/tps.c ****         return SENSOR_TPS_FAIL_SAFE;
 225              		.loc 1 30 16 view .LVU65
 226 00d2 9FED040A 		vldr.32	s0, .L21+12
 227 00d6 C9E7     		b	.L1
 228              	.L22:
 229              		.align	2
 230              	.L21:
 231 00d8 0000C842 		.word	1120403456
 232 00dc 00000000 		.word	0
 233 00e0 00000000 		.word	.LC0
 234 00e4 0000C07F 		.word	2143289344
 235 00e8 0C000000 		.word	.LC1
 236              		.cfi_endproc
 237              	.LFE228:
 239              		.text
 240              	.Letext0:
 241              		.file 3 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 242              		.file 4 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 243              		.file 5 "controller/types.h"
 244              		.file 6 "controller/IO/analog_inputs.h"
 245              		.file 7 "controller/IO/sensors/tps.h"
 246              		.file 8 "controller/utils/error_handling.h"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s 			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 tps.c
C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s:21     .rodata.sensor_tps_get.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s:28     .text.sensor_tps_get:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s:34     .text.sensor_tps_get:00000000 sensor_tps_get
C:\Users\alireza\AppData\Local\Temp\cc8YXh0d.s:231    .text.sensor_tps_get:000000d8 $d

UNDEFINED SYMBOLS
analog_inputs_get_data
log_error
