ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"ignition.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "controller/engine_cycle/ignition.c"
  20              		.section	.rodata.ignition_coil_begin_charge.str1.4,"aMS",%progbits,1
  21              		.align	2
  22              	.LC0:
  23 0000 556E6B6F 		.ascii	"Unkown ignition output\000"
  23      776E2069 
  23      676E6974 
  23      696F6E20 
  23      6F757470 
  24              		.section	.text.ignition_coil_begin_charge,"ax",%progbits
  25              		.align	1
  26              		.global	ignition_coil_begin_charge
  27              		.syntax unified
  28              		.thumb
  29              		.thumb_func
  31              	ignition_coil_begin_charge:
  32              	.LVL0:
  33              	.LFB231:
   1:controller/engine_cycle/ignition.c **** #include "ignition.h"
   2:controller/engine_cycle/ignition.c **** 
   3:controller/engine_cycle/ignition.c **** ignition_output_pin_s ignition_outputs[IGNITION_MAX_OUTPUTS] = {0};
   4:controller/engine_cycle/ignition.c **** 
   5:controller/engine_cycle/ignition.c **** volatile ignition_coil_state_e ignition_coil_state[IGNITION_MAX_OUTPUTS] = {0};
   6:controller/engine_cycle/ignition.c **** 
   7:controller/engine_cycle/ignition.c **** uint8_t ignition_order[IGNITION_MAX_OUTPUTS] = {0};
   8:controller/engine_cycle/ignition.c **** 
   9:controller/engine_cycle/ignition.c **** static volatile bool spark_is_in_progress = false;
  10:controller/engine_cycle/ignition.c **** 
  11:controller/engine_cycle/ignition.c **** 
  12:controller/engine_cycle/ignition.c **** void ignition_init(ignition_output_conf_s *output_conf)
  13:controller/engine_cycle/ignition.c **** {
  14:controller/engine_cycle/ignition.c ****     if (output_conf == NULL)
  15:controller/engine_cycle/ignition.c ****     {
  16:controller/engine_cycle/ignition.c ****         log_error("ignition init failed. No output config");
  17:controller/engine_cycle/ignition.c ****         return;
  18:controller/engine_cycle/ignition.c ****     }
  19:controller/engine_cycle/ignition.c **** 
  20:controller/engine_cycle/ignition.c **** 
  21:controller/engine_cycle/ignition.c ****     switch (configuration.firing_order)
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 2


  22:controller/engine_cycle/ignition.c ****     {
  23:controller/engine_cycle/ignition.c ****         case FO_1342:
  24:controller/engine_cycle/ignition.c ****             engine.cylinder_count = 4;
  25:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
  26:controller/engine_cycle/ignition.c ****             ignition_order[1] = 3;
  27:controller/engine_cycle/ignition.c ****             ignition_order[2] = 4;
  28:controller/engine_cycle/ignition.c ****             ignition_order[3] = 2;
  29:controller/engine_cycle/ignition.c ****         break;
  30:controller/engine_cycle/ignition.c ****         
  31:controller/engine_cycle/ignition.c ****         default:
  32:controller/engine_cycle/ignition.c ****             log_error("ignition init failed. unkown firing order.");
  33:controller/engine_cycle/ignition.c ****             return;
  34:controller/engine_cycle/ignition.c ****         break;
  35:controller/engine_cycle/ignition.c ****     }
  36:controller/engine_cycle/ignition.c ****     
  37:controller/engine_cycle/ignition.c ****     engine.firing_interval = (angle_t)720 / engine.cylinder_count;
  38:controller/engine_cycle/ignition.c **** 
  39:controller/engine_cycle/ignition.c **** 
  40:controller/engine_cycle/ignition.c ****     for (size_t i = 0; i < IGNITION_MAX_OUTPUTS; i++)
  41:controller/engine_cycle/ignition.c ****     {
  42:controller/engine_cycle/ignition.c ****         ignition_outputs[i].gpio = output_conf->output[i].gpio;
  43:controller/engine_cycle/ignition.c ****         ignition_outputs[i].pin = output_conf->output[i].pin;
  44:controller/engine_cycle/ignition.c ****     }
  45:controller/engine_cycle/ignition.c ****     /* Read the pin states from real hardware */
  46:controller/engine_cycle/ignition.c ****     for (size_t i = 0; i < IGNITION_MAX_OUTPUTS; i++)
  47:controller/engine_cycle/ignition.c ****     {
  48:controller/engine_cycle/ignition.c ****         ignition_coil_state[i] = HAL_GPIO_ReadPin(ignition_outputs[i].gpio, ignition_outputs->pin);
  49:controller/engine_cycle/ignition.c ****     }
  50:controller/engine_cycle/ignition.c ****     /* Set all outputs to reset just in case */
  51:controller/engine_cycle/ignition.c ****     for (size_t i = 0; i < IGNITION_MAX_OUTPUTS; i++)
  52:controller/engine_cycle/ignition.c ****     {
  53:controller/engine_cycle/ignition.c ****         HAL_GPIO_WritePin(ignition_outputs[i].gpio, ignition_outputs->pin, GPIO_PIN_RESET);
  54:controller/engine_cycle/ignition.c ****     }
  55:controller/engine_cycle/ignition.c ****     
  56:controller/engine_cycle/ignition.c ****     if (configuration.ignition_is_multi_spark && !IS_IN_RANGE(configuration.ignition_multi_spark_nu
  57:controller/engine_cycle/ignition.c ****     {
  58:controller/engine_cycle/ignition.c ****         log_warning("Multi spark is enabled but number of sparks are 0.");
  59:controller/engine_cycle/ignition.c ****     }
  60:controller/engine_cycle/ignition.c **** }
  61:controller/engine_cycle/ignition.c **** 
  62:controller/engine_cycle/ignition.c **** /**
  63:controller/engine_cycle/ignition.c ****  * @brief Handles an ignition trigger event based on the crankshaft angle, RPM, and current time.
  64:controller/engine_cycle/ignition.c ****  * 
  65:controller/engine_cycle/ignition.c ****  * @param crankshaft_angle The current angle of the crankshaft.
  66:controller/engine_cycle/ignition.c ****  * @param rpm The current revolutions per minute of the engine.
  67:controller/engine_cycle/ignition.c ****  * @param current_time_us The current time in microseconds.
  68:controller/engine_cycle/ignition.c ****  */
  69:controller/engine_cycle/ignition.c **** void ignition_trigger_event_handle(angle_t crankshaft_angle, rpm_t rpm, time_us_t current_time_us)
  70:controller/engine_cycle/ignition.c **** {
  71:controller/engine_cycle/ignition.c ****     /**
  72:controller/engine_cycle/ignition.c ****      * @todo add the necessary checks and bounds
  73:controller/engine_cycle/ignition.c ****      */
  74:controller/engine_cycle/ignition.c **** 
  75:controller/engine_cycle/ignition.c ****     if (configuration.ignition_mode == IM_NO_IGNITION)
  76:controller/engine_cycle/ignition.c ****     {
  77:controller/engine_cycle/ignition.c ****         // obviously, there is no need to do any furthure processing
  78:controller/engine_cycle/ignition.c ****         return;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 3


  79:controller/engine_cycle/ignition.c ****     }
  80:controller/engine_cycle/ignition.c ****     
  81:controller/engine_cycle/ignition.c ****     if (!IS_IN_RANGE(configuration.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_MAX_DWELL_T
  82:controller/engine_cycle/ignition.c ****     {
  83:controller/engine_cycle/ignition.c ****         /**
  84:controller/engine_cycle/ignition.c ****          * @todo throw an error
  85:controller/engine_cycle/ignition.c ****          */
  86:controller/engine_cycle/ignition.c ****         log_error("ignition dwell out of bounds.");
  87:controller/engine_cycle/ignition.c ****         return;
  88:controller/engine_cycle/ignition.c ****     }
  89:controller/engine_cycle/ignition.c **** 
  90:controller/engine_cycle/ignition.c ****     angle_t spark_advance = 0;
  91:controller/engine_cycle/ignition.c ****     #ifdef TEST_MODE
  92:controller/engine_cycle/ignition.c ****     spark_advance = (angle_t)30;
  93:controller/engine_cycle/ignition.c ****     #else
  94:controller/engine_cycle/ignition.c ****     spark_advance = spark_logic_get_advance();
  95:controller/engine_cycle/ignition.c ****     #endif
  96:controller/engine_cycle/ignition.c **** 
  97:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
  98:controller/engine_cycle/ignition.c ****     
  99:controller/engine_cycle/ignition.c ****     uint8_t multi_spark_count = 0;
 100:controller/engine_cycle/ignition.c ****     if (configuration.ignition_is_multi_spark && rpm < configuration.ignition_multi_spark_rpm_thres
 101:controller/engine_cycle/ignition.c ****     {
 102:controller/engine_cycle/ignition.c ****         multi_spark_count = configuration.ignition_multi_spark_number_of_sparks;
 103:controller/engine_cycle/ignition.c ****     }
 104:controller/engine_cycle/ignition.c ****     
 105:controller/engine_cycle/ignition.c **** 
 106:controller/engine_cycle/ignition.c ****     /* First we have to detect the engine phase */
 107:controller/engine_cycle/ignition.c ****     uint8_t phase = (uint8_t)(crankshaft_angle / engine.firing_interval);
 108:controller/engine_cycle/ignition.c ****     
 109:controller/engine_cycle/ignition.c ****     volatile angle_t next_spark_angle = phase * engine.firing_interval - spark_advance + engine.fir
 110:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)configuration.ignition_dwell * (f
 111:controller/engine_cycle/ignition.c ****     
 112:controller/engine_cycle/ignition.c ****     /* phase index now shows which stage of crankshaft rotation we are in. */
 113:controller/engine_cycle/ignition.c ****     static uint8_t next_firing_cylinder_index = 0;
 114:controller/engine_cycle/ignition.c ****     next_firing_cylinder_index = ignition_order[phase] - 1;
 115:controller/engine_cycle/ignition.c ****  
 116:controller/engine_cycle/ignition.c ****     if ((next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_dwell_angle - 
 117:controller/engine_cycle/ignition.c ****     {
 118:controller/engine_cycle/ignition.c ****         /* Now we are close enough to the dwell angle that we can schedule the coil charge start */
 119:controller/engine_cycle/ignition.c ****         spark_is_in_progress = true;
 120:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 121:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 122:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void*)&
 123:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (void*)&ne
 124:controller/engine_cycle/ignition.c **** 
 125:controller/engine_cycle/ignition.c ****     }
 126:controller/engine_cycle/ignition.c ****     
 127:controller/engine_cycle/ignition.c **** }
 128:controller/engine_cycle/ignition.c **** 
 129:controller/engine_cycle/ignition.c **** 
 130:controller/engine_cycle/ignition.c **** /**
 131:controller/engine_cycle/ignition.c ****  * @brief Gets the number of sparks per coil based on the ignition mode.
 132:controller/engine_cycle/ignition.c ****  * 
 133:controller/engine_cycle/ignition.c ****  * @param ignition_mode The mode of ignition, specified as an enumeration of type ignition_mode_e.
 134:controller/engine_cycle/ignition.c ****  * @return The number of sparks per coil.
 135:controller/engine_cycle/ignition.c ****  */
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 4


 136:controller/engine_cycle/ignition.c **** uint8_t ignition_get_number_of_sparks_per_coil(ignition_mode_e ignition_mode)
 137:controller/engine_cycle/ignition.c **** {
 138:controller/engine_cycle/ignition.c ****     switch (ignition_mode)
 139:controller/engine_cycle/ignition.c ****     {
 140:controller/engine_cycle/ignition.c ****     case IM_ONE_COIL:
 141:controller/engine_cycle/ignition.c ****         return engine.cylinder_count;
 142:controller/engine_cycle/ignition.c ****     case IM_INDIVIDUAL_COILS:
 143:controller/engine_cycle/ignition.c ****         return 1;
 144:controller/engine_cycle/ignition.c ****     case IM_WASTED_SPARK:
 145:controller/engine_cycle/ignition.c ****         return 2;
 146:controller/engine_cycle/ignition.c ****     default:
 147:controller/engine_cycle/ignition.c ****         log_error("Unkown ignition mode");
 148:controller/engine_cycle/ignition.c ****         return 1;
 149:controller/engine_cycle/ignition.c ****     }
 150:controller/engine_cycle/ignition.c **** }
 151:controller/engine_cycle/ignition.c **** 
 152:controller/engine_cycle/ignition.c **** /**
 153:controller/engine_cycle/ignition.c ****  * @brief Charges the ignition coil at the specified index.
 154:controller/engine_cycle/ignition.c ****  * 
 155:controller/engine_cycle/ignition.c ****  * @param coil_index The index of the coil to be charged.
 156:controller/engine_cycle/ignition.c ****  */
 157:controller/engine_cycle/ignition.c **** void ignition_coil_begin_charge(void *arg)
 158:controller/engine_cycle/ignition.c **** {
  34              		.loc 1 158 1 view -0
  35              		.cfi_startproc
  36              		@ args = 0, pretend = 0, frame = 0
  37              		@ frame_needed = 0, uses_anonymous_args = 0
 159:controller/engine_cycle/ignition.c ****     if (arg == NULL)
  38              		.loc 1 159 5 view .LVU1
  39              		.loc 1 159 8 is_stmt 0 view .LVU2
  40 0000 98B1     		cbz	r0, .L5
 158:controller/engine_cycle/ignition.c ****     if (arg == NULL)
  41              		.loc 1 158 1 view .LVU3
  42 0002 08B5     		push	{r3, lr}
  43              		.cfi_def_cfa_offset 8
  44              		.cfi_offset 3, -8
  45              		.cfi_offset 14, -4
 160:controller/engine_cycle/ignition.c ****     {
 161:controller/engine_cycle/ignition.c ****         return;
 162:controller/engine_cycle/ignition.c ****     }
 163:controller/engine_cycle/ignition.c ****     uint8_t coil_index = *(uint8_t*)arg;
  46              		.loc 1 163 5 is_stmt 1 view .LVU4
  47              		.loc 1 163 13 is_stmt 0 view .LVU5
  48 0004 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
  49              	.LVL1:
 164:controller/engine_cycle/ignition.c **** 
 165:controller/engine_cycle/ignition.c ****     if (coil_index > IGNITION_MAX_OUTPUTS - 1)
  50              		.loc 1 165 5 is_stmt 1 view .LVU6
  51              		.loc 1 165 8 is_stmt 0 view .LVU7
  52 0006 032B     		cmp	r3, #3
  53 0008 0BD8     		bhi	.L8
 166:controller/engine_cycle/ignition.c ****     {
 167:controller/engine_cycle/ignition.c ****         log_error("Unkown ignition output");
 168:controller/engine_cycle/ignition.c ****         return;
 169:controller/engine_cycle/ignition.c ****     }
 170:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index] = IGNITION_COIL_STATE_CHARGING;
  54              		.loc 1 170 5 is_stmt 1 view .LVU8
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 5


  55              		.loc 1 170 37 is_stmt 0 view .LVU9
  56 000a 0122     		movs	r2, #1
  57 000c 0749     		ldr	r1, .L9
  58 000e CA54     		strb	r2, [r1, r3]
 171:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index].gpio, ignition_outputs[coil_index].pin, GPIO_PIN
  59              		.loc 1 171 5 is_stmt 1 view .LVU10
  60              		.loc 1 171 86 is_stmt 0 view .LVU11
  61 0010 0748     		ldr	r0, .L9+4
  62              	.LVL2:
  63              		.loc 1 171 86 view .LVU12
  64 0012 00EBC301 		add	r1, r0, r3, lsl #3
  65              		.loc 1 171 5 view .LVU13
  66 0016 8988     		ldrh	r1, [r1, #4]
  67 0018 50F83300 		ldr	r0, [r0, r3, lsl #3]
  68 001c FFF7FEFF 		bl	HAL_GPIO_WritePin
  69              	.LVL3:
  70              	.L1:
 172:controller/engine_cycle/ignition.c **** }
  71              		.loc 1 172 1 view .LVU14
  72 0020 08BD     		pop	{r3, pc}
  73              	.LVL4:
  74              	.L8:
 167:controller/engine_cycle/ignition.c ****         return;
  75              		.loc 1 167 9 is_stmt 1 view .LVU15
  76 0022 0448     		ldr	r0, .L9+8
  77              	.LVL5:
 167:controller/engine_cycle/ignition.c ****         return;
  78              		.loc 1 167 9 is_stmt 0 view .LVU16
  79 0024 FFF7FEFF 		bl	log_error
  80              	.LVL6:
 168:controller/engine_cycle/ignition.c ****     }
  81              		.loc 1 168 9 is_stmt 1 view .LVU17
  82 0028 FAE7     		b	.L1
  83              	.LVL7:
  84              	.L5:
  85              		.cfi_def_cfa_offset 0
  86              		.cfi_restore 3
  87              		.cfi_restore 14
 168:controller/engine_cycle/ignition.c ****     }
  88              		.loc 1 168 9 is_stmt 0 view .LVU18
  89 002a 7047     		bx	lr
  90              	.L10:
  91              		.align	2
  92              	.L9:
  93 002c 00000000 		.word	ignition_coil_state
  94 0030 00000000 		.word	ignition_outputs
  95 0034 00000000 		.word	.LC0
  96              		.cfi_endproc
  97              	.LFE231:
  99              		.section	.text.ignition_coil_fire_spark,"ax",%progbits
 100              		.align	1
 101              		.global	ignition_coil_fire_spark
 102              		.syntax unified
 103              		.thumb
 104              		.thumb_func
 106              	ignition_coil_fire_spark:
 107              	.LVL8:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 6


 108              	.LFB232:
 173:controller/engine_cycle/ignition.c **** 
 174:controller/engine_cycle/ignition.c **** /**
 175:controller/engine_cycle/ignition.c ****  * @brief Fires a spark from the ignition coil at the specified index.
 176:controller/engine_cycle/ignition.c ****  * 
 177:controller/engine_cycle/ignition.c ****  * @param coil_index The index of the coil to fire the spark from.
 178:controller/engine_cycle/ignition.c ****  */
 179:controller/engine_cycle/ignition.c **** void ignition_coil_fire_spark(void *arg)
 180:controller/engine_cycle/ignition.c **** {
 109              		.loc 1 180 1 is_stmt 1 view -0
 110              		.cfi_startproc
 111              		@ args = 0, pretend = 0, frame = 0
 112              		@ frame_needed = 0, uses_anonymous_args = 0
 181:controller/engine_cycle/ignition.c ****     if (arg == NULL)
 113              		.loc 1 181 5 view .LVU20
 114              		.loc 1 181 8 is_stmt 0 view .LVU21
 115 0000 B0B1     		cbz	r0, .L15
 180:controller/engine_cycle/ignition.c ****     if (arg == NULL)
 116              		.loc 1 180 1 view .LVU22
 117 0002 10B5     		push	{r4, lr}
 118              		.cfi_def_cfa_offset 8
 119              		.cfi_offset 4, -8
 120              		.cfi_offset 14, -4
 182:controller/engine_cycle/ignition.c ****     {
 183:controller/engine_cycle/ignition.c ****         return;
 184:controller/engine_cycle/ignition.c ****     }
 185:controller/engine_cycle/ignition.c ****     
 186:controller/engine_cycle/ignition.c ****     uint8_t coil_index = *(uint8_t*)arg;
 121              		.loc 1 186 5 is_stmt 1 view .LVU23
 122              		.loc 1 186 13 is_stmt 0 view .LVU24
 123 0004 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
 124              	.LVL9:
 187:controller/engine_cycle/ignition.c ****     if (coil_index > IGNITION_MAX_OUTPUTS - 1)
 125              		.loc 1 187 5 is_stmt 1 view .LVU25
 126              		.loc 1 187 8 is_stmt 0 view .LVU26
 127 0006 032B     		cmp	r3, #3
 128 0008 0ED8     		bhi	.L18
 188:controller/engine_cycle/ignition.c ****     {
 189:controller/engine_cycle/ignition.c ****         log_error("Unkown ignition output");
 190:controller/engine_cycle/ignition.c ****         return;
 191:controller/engine_cycle/ignition.c ****     }
 192:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index] = IGNITION_COIL_STATE_NOT_CHARGING;
 129              		.loc 1 192 5 is_stmt 1 view .LVU27
 130              		.loc 1 192 37 is_stmt 0 view .LVU28
 131 000a 0024     		movs	r4, #0
 132 000c 094A     		ldr	r2, .L19
 133 000e D454     		strb	r4, [r2, r3]
 193:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index].gpio, ignition_outputs[coil_index].pin, GPIO_PIN
 134              		.loc 1 193 5 is_stmt 1 view .LVU29
 135              		.loc 1 193 86 is_stmt 0 view .LVU30
 136 0010 0948     		ldr	r0, .L19+4
 137              	.LVL10:
 138              		.loc 1 193 86 view .LVU31
 139 0012 00EBC301 		add	r1, r0, r3, lsl #3
 140              		.loc 1 193 5 view .LVU32
 141 0016 2246     		mov	r2, r4
 142 0018 8988     		ldrh	r1, [r1, #4]
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 7


 143 001a 50F83300 		ldr	r0, [r0, r3, lsl #3]
 144 001e FFF7FEFF 		bl	HAL_GPIO_WritePin
 145              	.LVL11:
 194:controller/engine_cycle/ignition.c ****     spark_is_in_progress = false;
 146              		.loc 1 194 5 is_stmt 1 view .LVU33
 147              		.loc 1 194 26 is_stmt 0 view .LVU34
 148 0022 064B     		ldr	r3, .L19+8
 149 0024 1C70     		strb	r4, [r3]
 150              	.L11:
 195:controller/engine_cycle/ignition.c **** }
 151              		.loc 1 195 1 view .LVU35
 152 0026 10BD     		pop	{r4, pc}
 153              	.LVL12:
 154              	.L18:
 189:controller/engine_cycle/ignition.c ****         return;
 155              		.loc 1 189 9 is_stmt 1 view .LVU36
 156 0028 0548     		ldr	r0, .L19+12
 157              	.LVL13:
 189:controller/engine_cycle/ignition.c ****         return;
 158              		.loc 1 189 9 is_stmt 0 view .LVU37
 159 002a FFF7FEFF 		bl	log_error
 160              	.LVL14:
 190:controller/engine_cycle/ignition.c ****     }
 161              		.loc 1 190 9 is_stmt 1 view .LVU38
 162 002e FAE7     		b	.L11
 163              	.LVL15:
 164              	.L15:
 165              		.cfi_def_cfa_offset 0
 166              		.cfi_restore 4
 167              		.cfi_restore 14
 190:controller/engine_cycle/ignition.c ****     }
 168              		.loc 1 190 9 is_stmt 0 view .LVU39
 169 0030 7047     		bx	lr
 170              	.L20:
 171 0032 00BF     		.align	2
 172              	.L19:
 173 0034 00000000 		.word	ignition_coil_state
 174 0038 00000000 		.word	ignition_outputs
 175 003c 00000000 		.word	spark_is_in_progress
 176 0040 00000000 		.word	.LC0
 177              		.cfi_endproc
 178              	.LFE232:
 180              		.section	.rodata.ignition_init.str1.4,"aMS",%progbits,1
 181              		.align	2
 182              	.LC1:
 183 0000 69676E69 		.ascii	"ignition init failed. No output config\000"
 183      74696F6E 
 183      20696E69 
 183      74206661 
 183      696C6564 
 184 0027 00       		.align	2
 185              	.LC2:
 186 0028 69676E69 		.ascii	"ignition init failed. unkown firing order.\000"
 186      74696F6E 
 186      20696E69 
 186      74206661 
 186      696C6564 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 8


 187 0053 00       		.align	2
 188              	.LC3:
 189 0054 4D756C74 		.ascii	"Multi spark is enabled but number of sparks are 0.\000"
 189      69207370 
 189      61726B20 
 189      69732065 
 189      6E61626C 
 190              		.section	.text.ignition_init,"ax",%progbits
 191              		.align	1
 192              		.global	ignition_init
 193              		.syntax unified
 194              		.thumb
 195              		.thumb_func
 197              	ignition_init:
 198              	.LVL16:
 199              	.LFB228:
  13:controller/engine_cycle/ignition.c ****     if (output_conf == NULL)
 200              		.loc 1 13 1 is_stmt 1 view -0
 201              		.cfi_startproc
 202              		@ args = 0, pretend = 0, frame = 0
 203              		@ frame_needed = 0, uses_anonymous_args = 0
  13:controller/engine_cycle/ignition.c ****     if (output_conf == NULL)
 204              		.loc 1 13 1 is_stmt 0 view .LVU41
 205 0000 10B5     		push	{r4, lr}
 206              		.cfi_def_cfa_offset 8
 207              		.cfi_offset 4, -8
 208              		.cfi_offset 14, -4
  14:controller/engine_cycle/ignition.c ****     {
 209              		.loc 1 14 5 is_stmt 1 view .LVU42
  14:controller/engine_cycle/ignition.c ****     {
 210              		.loc 1 14 8 is_stmt 0 view .LVU43
 211 0002 90B1     		cbz	r0, .L32
 212 0004 0146     		mov	r1, r0
  21:controller/engine_cycle/ignition.c ****     {
 213              		.loc 1 21 5 is_stmt 1 view .LVU44
  21:controller/engine_cycle/ignition.c ****     {
 214              		.loc 1 21 26 is_stmt 0 view .LVU45
 215 0006 264B     		ldr	r3, .L33
 216 0008 1B7D     		ldrb	r3, [r3, #20]	@ zero_extendqisi2
  21:controller/engine_cycle/ignition.c ****     {
 217              		.loc 1 21 5 view .LVU46
 218 000a 93B9     		cbnz	r3, .L24
  24:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
 219              		.loc 1 24 13 is_stmt 1 view .LVU47
  24:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
 220              		.loc 1 24 35 is_stmt 0 view .LVU48
 221 000c 254A     		ldr	r2, .L33+4
 222 000e 0420     		movs	r0, #4
 223              	.LVL17:
  24:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
 224              		.loc 1 24 35 view .LVU49
 225 0010 1074     		strb	r0, [r2, #16]
  25:controller/engine_cycle/ignition.c ****             ignition_order[1] = 3;
 226              		.loc 1 25 13 is_stmt 1 view .LVU50
  25:controller/engine_cycle/ignition.c ****             ignition_order[1] = 3;
 227              		.loc 1 25 31 is_stmt 0 view .LVU51
 228 0012 254B     		ldr	r3, .L33+8
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 9


 229 0014 0124     		movs	r4, #1
 230 0016 1C70     		strb	r4, [r3]
  26:controller/engine_cycle/ignition.c ****             ignition_order[2] = 4;
 231              		.loc 1 26 13 is_stmt 1 view .LVU52
  26:controller/engine_cycle/ignition.c ****             ignition_order[2] = 4;
 232              		.loc 1 26 31 is_stmt 0 view .LVU53
 233 0018 0324     		movs	r4, #3
 234 001a 5C70     		strb	r4, [r3, #1]
  27:controller/engine_cycle/ignition.c ****             ignition_order[3] = 2;
 235              		.loc 1 27 13 is_stmt 1 view .LVU54
  27:controller/engine_cycle/ignition.c ****             ignition_order[3] = 2;
 236              		.loc 1 27 31 is_stmt 0 view .LVU55
 237 001c 9870     		strb	r0, [r3, #2]
  28:controller/engine_cycle/ignition.c ****         break;
 238              		.loc 1 28 13 is_stmt 1 view .LVU56
  28:controller/engine_cycle/ignition.c ****         break;
 239              		.loc 1 28 31 is_stmt 0 view .LVU57
 240 001e 0220     		movs	r0, #2
 241 0020 D870     		strb	r0, [r3, #3]
  29:controller/engine_cycle/ignition.c ****         
 242              		.loc 1 29 9 is_stmt 1 view .LVU58
  34:controller/engine_cycle/ignition.c ****     }
 243              		.loc 1 34 9 view .LVU59
  37:controller/engine_cycle/ignition.c **** 
 244              		.loc 1 37 5 view .LVU60
  37:controller/engine_cycle/ignition.c **** 
 245              		.loc 1 37 28 is_stmt 0 view .LVU61
 246 0022 224B     		ldr	r3, .L33+12
 247 0024 5361     		str	r3, [r2, #20]	@ float
  40:controller/engine_cycle/ignition.c ****     {
 248              		.loc 1 40 5 is_stmt 1 view .LVU62
 249              	.LBB9:
  40:controller/engine_cycle/ignition.c ****     {
 250              		.loc 1 40 10 view .LVU63
 251              	.LVL18:
  40:controller/engine_cycle/ignition.c ****     {
 252              		.loc 1 40 17 is_stmt 0 view .LVU64
 253 0026 0023     		movs	r3, #0
  40:controller/engine_cycle/ignition.c ****     {
 254              		.loc 1 40 5 view .LVU65
 255 0028 13E0     		b	.L25
 256              	.LVL19:
 257              	.L32:
  40:controller/engine_cycle/ignition.c ****     {
 258              		.loc 1 40 5 view .LVU66
 259              	.LBE9:
  16:controller/engine_cycle/ignition.c ****         return;
 260              		.loc 1 16 9 is_stmt 1 view .LVU67
 261 002a 2148     		ldr	r0, .L33+16
 262              	.LVL20:
  16:controller/engine_cycle/ignition.c ****         return;
 263              		.loc 1 16 9 is_stmt 0 view .LVU68
 264 002c FFF7FEFF 		bl	log_error
 265              	.LVL21:
  17:controller/engine_cycle/ignition.c ****     }
 266              		.loc 1 17 9 is_stmt 1 view .LVU69
 267 0030 02E0     		b	.L21
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 10


 268              	.LVL22:
 269              	.L24:
  32:controller/engine_cycle/ignition.c ****             return;
 270              		.loc 1 32 13 view .LVU70
 271 0032 2048     		ldr	r0, .L33+20
 272              	.LVL23:
  32:controller/engine_cycle/ignition.c ****             return;
 273              		.loc 1 32 13 is_stmt 0 view .LVU71
 274 0034 FFF7FEFF 		bl	log_error
 275              	.LVL24:
  33:controller/engine_cycle/ignition.c ****         break;
 276              		.loc 1 33 13 is_stmt 1 view .LVU72
 277              	.L21:
  60:controller/engine_cycle/ignition.c **** 
 278              		.loc 1 60 1 is_stmt 0 view .LVU73
 279 0038 10BD     		pop	{r4, pc}
 280              	.LVL25:
 281              	.L26:
 282              	.LBB10:
  42:controller/engine_cycle/ignition.c ****         ignition_outputs[i].pin = output_conf->output[i].pin;
 283              		.loc 1 42 9 is_stmt 1 view .LVU74
  42:controller/engine_cycle/ignition.c ****         ignition_outputs[i].pin = output_conf->output[i].pin;
 284              		.loc 1 42 58 is_stmt 0 view .LVU75
 285 003a 51F83300 		ldr	r0, [r1, r3, lsl #3]
  42:controller/engine_cycle/ignition.c ****         ignition_outputs[i].pin = output_conf->output[i].pin;
 286              		.loc 1 42 34 view .LVU76
 287 003e 1E4A     		ldr	r2, .L33+24
 288 0040 42F83300 		str	r0, [r2, r3, lsl #3]
  43:controller/engine_cycle/ignition.c ****     }
 289              		.loc 1 43 9 is_stmt 1 view .LVU77
  43:controller/engine_cycle/ignition.c ****     }
 290              		.loc 1 43 57 is_stmt 0 view .LVU78
 291 0044 01EBC300 		add	r0, r1, r3, lsl #3
 292 0048 4068     		ldr	r0, [r0, #4]
  43:controller/engine_cycle/ignition.c ****     }
 293              		.loc 1 43 33 view .LVU79
 294 004a 02EBC302 		add	r2, r2, r3, lsl #3
 295 004e 5060     		str	r0, [r2, #4]
  40:controller/engine_cycle/ignition.c ****     {
 296              		.loc 1 40 51 is_stmt 1 discriminator 3 view .LVU80
 297 0050 0133     		adds	r3, r3, #1
 298              	.LVL26:
 299              	.L25:
  40:controller/engine_cycle/ignition.c ****     {
 300              		.loc 1 40 26 discriminator 1 view .LVU81
 301 0052 032B     		cmp	r3, #3
 302 0054 F1D9     		bls	.L26
 303              	.LBE10:
 304              	.LBB11:
  46:controller/engine_cycle/ignition.c ****     {
 305              		.loc 1 46 17 is_stmt 0 view .LVU82
 306 0056 0024     		movs	r4, #0
 307 0058 08E0     		b	.L27
 308              	.LVL27:
 309              	.L28:
  48:controller/engine_cycle/ignition.c ****     }
 310              		.loc 1 48 9 is_stmt 1 view .LVU83
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 11


  48:controller/engine_cycle/ignition.c ****     }
 311              		.loc 1 48 93 is_stmt 0 view .LVU84
 312 005a 174B     		ldr	r3, .L33+24
  48:controller/engine_cycle/ignition.c ****     }
 313              		.loc 1 48 34 view .LVU85
 314 005c 9988     		ldrh	r1, [r3, #4]
 315 005e 53F83400 		ldr	r0, [r3, r4, lsl #3]
 316 0062 FFF7FEFF 		bl	HAL_GPIO_ReadPin
 317              	.LVL28:
  48:controller/engine_cycle/ignition.c ****     }
 318              		.loc 1 48 32 discriminator 1 view .LVU86
 319 0066 154B     		ldr	r3, .L33+28
 320 0068 1855     		strb	r0, [r3, r4]
  46:controller/engine_cycle/ignition.c ****     {
 321              		.loc 1 46 51 is_stmt 1 discriminator 3 view .LVU87
 322 006a 0134     		adds	r4, r4, #1
 323              	.LVL29:
 324              	.L27:
  46:controller/engine_cycle/ignition.c ****     {
 325              		.loc 1 46 26 discriminator 1 view .LVU88
 326 006c 032C     		cmp	r4, #3
 327 006e F4D9     		bls	.L28
 328              	.LBE11:
 329              	.LBB12:
  51:controller/engine_cycle/ignition.c ****     {
 330              		.loc 1 51 17 is_stmt 0 view .LVU89
 331 0070 0024     		movs	r4, #0
 332              	.LVL30:
  51:controller/engine_cycle/ignition.c ****     {
 333              		.loc 1 51 17 view .LVU90
 334 0072 07E0     		b	.L29
 335              	.LVL31:
 336              	.L30:
  53:controller/engine_cycle/ignition.c ****     }
 337              		.loc 1 53 9 is_stmt 1 view .LVU91
  53:controller/engine_cycle/ignition.c ****     }
 338              		.loc 1 53 69 is_stmt 0 view .LVU92
 339 0074 104B     		ldr	r3, .L33+24
  53:controller/engine_cycle/ignition.c ****     }
 340              		.loc 1 53 9 view .LVU93
 341 0076 0022     		movs	r2, #0
 342 0078 9988     		ldrh	r1, [r3, #4]
 343 007a 53F83400 		ldr	r0, [r3, r4, lsl #3]
 344 007e FFF7FEFF 		bl	HAL_GPIO_WritePin
 345              	.LVL32:
  51:controller/engine_cycle/ignition.c ****     {
 346              		.loc 1 51 51 is_stmt 1 discriminator 3 view .LVU94
 347 0082 0134     		adds	r4, r4, #1
 348              	.LVL33:
 349              	.L29:
  51:controller/engine_cycle/ignition.c ****     {
 350              		.loc 1 51 26 discriminator 1 view .LVU95
 351 0084 032C     		cmp	r4, #3
 352 0086 F5D9     		bls	.L30
 353              	.LBE12:
  56:controller/engine_cycle/ignition.c ****     {
 354              		.loc 1 56 5 view .LVU96
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 12


  56:controller/engine_cycle/ignition.c ****     {
 355              		.loc 1 56 22 is_stmt 0 view .LVU97
 356 0088 054B     		ldr	r3, .L33
 357 008a 1B7F     		ldrb	r3, [r3, #28]	@ zero_extendqisi2
  56:controller/engine_cycle/ignition.c ****     {
 358              		.loc 1 56 8 view .LVU98
 359 008c 002B     		cmp	r3, #0
 360 008e D3D0     		beq	.L21
  56:controller/engine_cycle/ignition.c ****     {
 361              		.loc 1 56 51 discriminator 1 view .LVU99
 362 0090 034B     		ldr	r3, .L33
 363 0092 5B7F     		ldrb	r3, [r3, #29]	@ zero_extendqisi2
  56:controller/engine_cycle/ignition.c ****     {
 364              		.loc 1 56 47 discriminator 1 view .LVU100
 365 0094 082B     		cmp	r3, #8
 366 0096 CFD9     		bls	.L21
  58:controller/engine_cycle/ignition.c ****     }
 367              		.loc 1 58 9 is_stmt 1 view .LVU101
 368 0098 0948     		ldr	r0, .L33+32
 369 009a FFF7FEFF 		bl	log_warning
 370              	.LVL34:
 371 009e CBE7     		b	.L21
 372              	.L34:
 373              		.align	2
 374              	.L33:
 375 00a0 00000000 		.word	configuration
 376 00a4 00000000 		.word	engine
 377 00a8 00000000 		.word	ignition_order
 378 00ac 00003443 		.word	1127481344
 379 00b0 00000000 		.word	.LC1
 380 00b4 28000000 		.word	.LC2
 381 00b8 00000000 		.word	ignition_outputs
 382 00bc 00000000 		.word	ignition_coil_state
 383 00c0 54000000 		.word	.LC3
 384              		.cfi_endproc
 385              	.LFE228:
 387              		.section	.rodata.ignition_trigger_event_handle.str1.4,"aMS",%progbits,1
 388              		.align	2
 389              	.LC4:
 390 0000 69676E69 		.ascii	"ignition dwell out of bounds.\000"
 390      74696F6E 
 390      20647765 
 390      6C6C206F 
 390      7574206F 
 391              		.section	.text.ignition_trigger_event_handle,"ax",%progbits
 392              		.align	1
 393              		.global	ignition_trigger_event_handle
 394              		.syntax unified
 395              		.thumb
 396              		.thumb_func
 398              	ignition_trigger_event_handle:
 399              	.LVL35:
 400              	.LFB229:
  70:controller/engine_cycle/ignition.c ****     /**
 401              		.loc 1 70 1 view -0
 402              		.cfi_startproc
 403              		@ args = 0, pretend = 0, frame = 16
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 13


 404              		@ frame_needed = 0, uses_anonymous_args = 0
  75:controller/engine_cycle/ignition.c ****     {
 405              		.loc 1 75 5 view .LVU103
  75:controller/engine_cycle/ignition.c ****     {
 406              		.loc 1 75 22 is_stmt 0 view .LVU104
 407 0000 554B     		ldr	r3, .L53
 408 0002 5B7D     		ldrb	r3, [r3, #21]	@ zero_extendqisi2
  75:controller/engine_cycle/ignition.c ****     {
 409              		.loc 1 75 8 view .LVU105
 410 0004 002B     		cmp	r3, #0
 411 0006 00F0A580 		beq	.L50
  70:controller/engine_cycle/ignition.c ****     /**
 412              		.loc 1 70 1 view .LVU106
 413 000a 30B5     		push	{r4, r5, lr}
 414              		.cfi_def_cfa_offset 12
 415              		.cfi_offset 4, -12
 416              		.cfi_offset 5, -8
 417              		.cfi_offset 14, -4
 418 000c 85B0     		sub	sp, sp, #20
 419              		.cfi_def_cfa_offset 32
  81:controller/engine_cycle/ignition.c ****     {
 420              		.loc 1 81 5 is_stmt 1 view .LVU107
  81:controller/engine_cycle/ignition.c ****     {
 421              		.loc 1 81 10 is_stmt 0 view .LVU108
 422 000e 524B     		ldr	r3, .L53
 423 0010 D3ED067A 		vldr.32	s15, [r3, #24]
  81:controller/engine_cycle/ignition.c ****     {
 424              		.loc 1 81 8 view .LVU109
 425 0014 B6EE007A 		vmov.f32	s14, #5.0e-1
 426 0018 F4EEC77A 		vcmpe.f32	s15, s14
 427 001c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 428 0020 C0F28D80 		blt	.L37
  81:controller/engine_cycle/ignition.c ****     {
 429              		.loc 1 81 9 discriminator 1 view .LVU110
 430 0024 B1EE007A 		vmov.f32	s14, #4.0e+0
 431 0028 F4EEC77A 		vcmpe.f32	s15, s14
 432 002c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 433 0030 00F28580 		bhi	.L37
  90:controller/engine_cycle/ignition.c ****     #ifdef TEST_MODE
 434              		.loc 1 90 5 is_stmt 1 view .LVU111
 435              	.LVL36:
  92:controller/engine_cycle/ignition.c ****     #else
 436              		.loc 1 92 5 view .LVU112
  97:controller/engine_cycle/ignition.c ****     
 437              		.loc 1 97 5 view .LVU113
  99:controller/engine_cycle/ignition.c ****     if (configuration.ignition_is_multi_spark && rpm < configuration.ignition_multi_spark_rpm_thres
 438              		.loc 1 99 5 view .LVU114
 100:controller/engine_cycle/ignition.c ****     {
 439              		.loc 1 100 5 view .LVU115
 102:controller/engine_cycle/ignition.c ****     }
 440              		.loc 1 102 9 view .LVU116
 107:controller/engine_cycle/ignition.c ****     
 441              		.loc 1 107 5 view .LVU117
 107:controller/engine_cycle/ignition.c ****     
 442              		.loc 1 107 56 is_stmt 0 view .LVU118
 443 0034 494B     		ldr	r3, .L53+4
 444 0036 93ED057A 		vldr.32	s14, [r3, #20]
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 14


 107:controller/engine_cycle/ignition.c ****     
 445              		.loc 1 107 48 view .LVU119
 446 003a C0EE076A 		vdiv.f32	s13, s0, s14
 107:controller/engine_cycle/ignition.c ****     
 447              		.loc 1 107 13 view .LVU120
 448 003e FCEEE66A 		vcvt.u32.f32	s13, s13
 449 0042 CDED016A 		vstr.32	s13, [sp, #4]	@ int
 450 0046 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 451              	.LVL37:
 109:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)configuration.ignition_dwell * (f
 452              		.loc 1 109 5 is_stmt 1 view .LVU121
 109:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)configuration.ignition_dwell * (f
 453              		.loc 1 109 47 is_stmt 0 view .LVU122
 454 004a 06EE903A 		vmov	s13, r3	@ int
 455 004e F8EEE66A 		vcvt.f32.s32	s13, s13
 456 0052 66EE876A 		vmul.f32	s13, s13, s14
 109:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)configuration.ignition_dwell * (f
 457              		.loc 1 109 72 view .LVU123
 458 0056 B3EE0E6A 		vmov.f32	s12, #3.0e+1
 459 005a 76EEC66A 		vsub.f32	s13, s13, s12
 109:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)configuration.ignition_dwell * (f
 460              		.loc 1 109 88 view .LVU124
 461 005e 37EE267A 		vadd.f32	s14, s14, s13
 109:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)configuration.ignition_dwell * (f
 462              		.loc 1 109 22 view .LVU125
 463 0062 8DED037A 		vstr.32	s14, [sp, #12]
 110:controller/engine_cycle/ignition.c ****     
 464              		.loc 1 110 5 is_stmt 1 view .LVU126
 110:controller/engine_cycle/ignition.c ****     
 465              		.loc 1 110 58 is_stmt 0 view .LVU127
 466 0066 9DED037A 		vldr.32	s14, [sp, #12]
 110:controller/engine_cycle/ignition.c ****     
 467              		.loc 1 110 96 view .LVU128
 468 006a DFED3D6A 		vldr.32	s13, .L53+8
 469 006e 67EEA67A 		vmul.f32	s15, s15, s13
 470              	.LVL38:
 471              	.LBB13:
 472              	.LBI13:
 473              		.file 2 "controller/utils/utils.h"
   1:controller/utils/utils.h **** /**
   2:controller/utils/utils.h ****  * @file utils.h
   3:controller/utils/utils.h ****  * @brief Header file containing utility functions and definitions for the smart generator controll
   4:controller/utils/utils.h ****  * 
   5:controller/utils/utils.h ****  * This file provides declarations for utility functions and macros that are
   6:controller/utils/utils.h ****  * used throughout the firmware to support various functionalities.
   7:controller/utils/utils.h ****  * 
   8:controller/utils/utils.h ****  * @note Ensure that this file is included wherever utility functions are required.
   9:controller/utils/utils.h ****  */
  10:controller/utils/utils.h **** #ifndef UTILS_H
  11:controller/utils/utils.h **** #define UTILS_H
  12:controller/utils/utils.h **** 
  13:controller/utils/utils.h **** #include "types.h"
  14:controller/utils/utils.h **** #include "math.h"
  15:controller/utils/utils.h **** #define IS_IN_RANGE(value, min, max) ((value) >= (min) && (value) <= (max))
  16:controller/utils/utils.h **** #define ABS(value) ((value) < 0 ? -(value) : (value))
  17:controller/utils/utils.h **** #define CLAMP(value, min, max) ((value) < (min) ? (min) : ((value) > (max) ? (max) : (value)))
  18:controller/utils/utils.h **** 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 15


  19:controller/utils/utils.h **** /**
  20:controller/utils/utils.h ****  * @brief Maps a value from one range to another.
  21:controller/utils/utils.h ****  * 
  22:controller/utils/utils.h ****  * @param x The value to map.
  23:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  24:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  25:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  26:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  27:controller/utils/utils.h ****  * @return The mapped value in the output range.
  28:controller/utils/utils.h ****  */
  29:controller/utils/utils.h **** #define MAP(x, in_min, in_max, out_min, out_max) \
  30:controller/utils/utils.h ****     (((x) - (in_min)) * ((out_max) - (out_min)) / ((in_max) - (in_min)) + (out_min))
  31:controller/utils/utils.h **** 
  32:controller/utils/utils.h **** 
  33:controller/utils/utils.h **** /**
  34:controller/utils/utils.h ****  * @brief Maps a uint16_t value from one range to another.
  35:controller/utils/utils.h ****  * 
  36:controller/utils/utils.h ****  * @param x The value to map.
  37:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  38:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  39:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  40:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  41:controller/utils/utils.h ****  * @return The mapped value in the output range.
  42:controller/utils/utils.h ****  */
  43:controller/utils/utils.h **** static inline uint16_t map_uint16(uint16_t x, uint16_t in_min, uint16_t in_max, uint16_t out_min, u
  44:controller/utils/utils.h **** {
  45:controller/utils/utils.h ****     if (in_max == in_min)
  46:controller/utils/utils.h ****     {
  47:controller/utils/utils.h ****         return 0; // Avoid division by zero
  48:controller/utils/utils.h ****     }
  49:controller/utils/utils.h ****     return (uint16_t)((x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min);
  50:controller/utils/utils.h **** }
  51:controller/utils/utils.h **** 
  52:controller/utils/utils.h **** static inline float mapf(float x, float in_min, float in_max, float out_min, float out_max)
  53:controller/utils/utils.h **** {
  54:controller/utils/utils.h ****     if (in_max == in_min)
  55:controller/utils/utils.h ****     {
  56:controller/utils/utils.h ****         return 0.0f; // Avoid division by zero
  57:controller/utils/utils.h ****     }
  58:controller/utils/utils.h ****     return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
  59:controller/utils/utils.h **** }
  60:controller/utils/utils.h **** 
  61:controller/utils/utils.h **** 
  62:controller/utils/utils.h **** 
  63:controller/utils/utils.h **** #define CELSIUS_TO_KELVIN(celsius) ((celsius) + 273.15f)
  64:controller/utils/utils.h **** #define KELVIN_TO_CELSIUS(kelvin) ((kelvin) - 273.15f)
  65:controller/utils/utils.h **** 
  66:controller/utils/utils.h **** /**
  67:controller/utils/utils.h ****  * @brief Function to calculate the microseconds it takes for the engine to turn one degree.
  68:controller/utils/utils.h ****  * @note Returns 0 if rpm is 0.
  69:controller/utils/utils.h ****  */
  70:controller/utils/utils.h **** static inline time_us_t microseconds_per_degree(rpm_t rpm)
  71:controller/utils/utils.h **** {
  72:controller/utils/utils.h ****     if (rpm == 0)
  73:controller/utils/utils.h ****     {
  74:controller/utils/utils.h ****         return 0;
  75:controller/utils/utils.h ****     }
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 16


  76:controller/utils/utils.h ****     return (time_us_t) 60.0f * 1e6f / (rpm * 360.0f);
  77:controller/utils/utils.h **** }
  78:controller/utils/utils.h **** 
  79:controller/utils/utils.h **** /**
  80:controller/utils/utils.h ****  * @brief Function to calculate the degrees the engine turns in one microsecond.
  81:controller/utils/utils.h ****  * @note Returns 0 if rpm is 0.
  82:controller/utils/utils.h ****  */
  83:controller/utils/utils.h **** static inline angle_t degrees_per_microsecond(rpm_t rpm)
 474              		.loc 2 83 23 is_stmt 1 view .LVU129
 475              	.LBB14:
  84:controller/utils/utils.h **** {
  85:controller/utils/utils.h ****     if (rpm == 0)
 476              		.loc 2 85 5 view .LVU130
 477              		.loc 2 85 8 is_stmt 0 view .LVU131
 478 0072 F5EE400A 		vcmp.f32	s1, #0
 479 0076 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 480 007a 65D0     		beq	.L44
  86:controller/utils/utils.h ****     {
  87:controller/utils/utils.h ****         return 0.0f;
  88:controller/utils/utils.h ****     }
  89:controller/utils/utils.h ****     return (angle_t)(rpm * 360.0f) / (60.0f * 1e6f);
 481              		.loc 2 89 5 is_stmt 1 view .LVU132
 482              		.loc 2 89 12 is_stmt 0 view .LVU133
 483 007c DFED396A 		vldr.32	s13, .L53+12
 484 0080 60EEA66A 		vmul.f32	s13, s1, s13
 485              		.loc 2 89 36 view .LVU134
 486 0084 DFED385A 		vldr.32	s11, .L53+16
 487 0088 86EEA56A 		vdiv.f32	s12, s13, s11
 488              	.L40:
 489              	.LVL39:
 490              		.loc 2 89 36 view .LVU135
 491              	.LBE14:
 492              	.LBE13:
 110:controller/engine_cycle/ignition.c ****     
 493              		.loc 1 110 110 discriminator 1 view .LVU136
 494 008c 67EE867A 		vmul.f32	s15, s15, s12
 110:controller/engine_cycle/ignition.c ****     
 495              		.loc 1 110 58 discriminator 1 view .LVU137
 496 0090 77EE677A 		vsub.f32	s15, s14, s15
 110:controller/engine_cycle/ignition.c ****     
 497              		.loc 1 110 22 discriminator 1 view .LVU138
 498 0094 CDED027A 		vstr.32	s15, [sp, #8]
 113:controller/engine_cycle/ignition.c ****     next_firing_cylinder_index = ignition_order[phase] - 1;
 499              		.loc 1 113 5 is_stmt 1 view .LVU139
 114:controller/engine_cycle/ignition.c ****  
 500              		.loc 1 114 5 view .LVU140
 114:controller/engine_cycle/ignition.c ****  
 501              		.loc 1 114 48 is_stmt 0 view .LVU141
 502 0098 344A     		ldr	r2, .L53+20
 503 009a D35C     		ldrb	r3, [r2, r3]	@ zero_extendqisi2
 504              	.LVL40:
 114:controller/engine_cycle/ignition.c ****  
 505              		.loc 1 114 56 view .LVU142
 506 009c 013B     		subs	r3, r3, #1
 114:controller/engine_cycle/ignition.c ****  
 507              		.loc 1 114 32 view .LVU143
 508 009e 344A     		ldr	r2, .L53+24
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 17


 509 00a0 1370     		strb	r3, [r2]
 116:controller/engine_cycle/ignition.c ****     {
 510              		.loc 1 116 5 is_stmt 1 view .LVU144
 116:controller/engine_cycle/ignition.c ****     {
 511              		.loc 1 116 27 is_stmt 0 view .LVU145
 512 00a2 DDED027A 		vldr.32	s15, [sp, #8]
 513 00a6 77EEC07A 		vsub.f32	s15, s15, s0
 116:controller/engine_cycle/ignition.c ****     {
 514              		.loc 1 116 8 view .LVU146
 515 00aa B2EE047A 		vmov.f32	s14, #1.0e+1
 516 00ae F4EEC77A 		vcmpe.f32	s15, s14
 517 00b2 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 518 00b6 45D5     		bpl	.L35
 116:controller/engine_cycle/ignition.c ****     {
 519              		.loc 1 116 55 discriminator 1 view .LVU147
 520 00b8 2E4B     		ldr	r3, .L53+28
 521 00ba 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 116:controller/engine_cycle/ignition.c ****     {
 522              		.loc 1 116 52 discriminator 1 view .LVU148
 523 00bc 002B     		cmp	r3, #0
 524 00be 41D1     		bne	.L35
 116:controller/engine_cycle/ignition.c ****     {
 525              		.loc 1 116 98 discriminator 2 view .LVU149
 526 00c0 DDED027A 		vldr.32	s15, [sp, #8]
 527 00c4 77EEC07A 		vsub.f32	s15, s15, s0
 116:controller/engine_cycle/ignition.c ****     {
 528              		.loc 1 116 77 discriminator 2 view .LVU150
 529 00c8 F5EEC07A 		vcmpe.f32	s15, #0
 530 00cc F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 531 00d0 38DD     		ble	.L35
 532              	.LBB16:
 119:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 533              		.loc 1 119 9 is_stmt 1 view .LVU151
 119:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 534              		.loc 1 119 30 is_stmt 0 view .LVU152
 535 00d2 284B     		ldr	r3, .L53+28
 536 00d4 0122     		movs	r2, #1
 537 00d6 1A70     		strb	r2, [r3]
 120:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 538              		.loc 1 120 9 is_stmt 1 view .LVU153
 120:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 539              		.loc 1 120 89 is_stmt 0 view .LVU154
 540 00d8 9DED027A 		vldr.32	s14, [sp, #8]
 541 00dc 37EE407A 		vsub.f32	s14, s14, s0
 542              	.LVL41:
 543              	.LBB17:
 544              	.LBI17:
  70:controller/utils/utils.h **** {
 545              		.loc 2 70 25 is_stmt 1 view .LVU155
 546              	.LBB18:
  72:controller/utils/utils.h ****     {
 547              		.loc 2 72 5 view .LVU156
  72:controller/utils/utils.h ****     {
 548              		.loc 2 72 8 is_stmt 0 view .LVU157
 549 00e0 F5EE400A 		vcmp.f32	s1, #0
 550 00e4 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 551 00e8 31D0     		beq	.L45
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 18


  76:controller/utils/utils.h **** }
 552              		.loc 2 76 5 is_stmt 1 view .LVU158
  76:controller/utils/utils.h **** }
 553              		.loc 2 76 44 is_stmt 0 view .LVU159
 554 00ea DFED1E7A 		vldr.32	s15, .L53+12
 555 00ee 60EEA70A 		vmul.f32	s1, s1, s15
 556              	.LVL42:
  76:controller/utils/utils.h **** }
 557              		.loc 2 76 37 view .LVU160
 558 00f2 DFED1D6A 		vldr.32	s13, .L53+16
 559 00f6 C6EEA07A 		vdiv.f32	s15, s13, s1
 560 00fa FCEEE77A 		vcvt.u32.f32	s15, s15
 561              	.L43:
 562              	.LVL43:
  76:controller/utils/utils.h **** }
 563              		.loc 2 76 37 view .LVU161
 564              	.LBE18:
 565              	.LBE17:
 120:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 566              		.loc 1 120 109 discriminator 1 view .LVU162
 567 00fe F8EE677A 		vcvt.f32.u32	s15, s15
 568 0102 27EE277A 		vmul.f32	s14, s14, s15
 120:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 569              		.loc 1 120 59 discriminator 1 view .LVU163
 570 0106 BCEEC77A 		vcvt.u32.f32	s14, s14
 571              	.LVL44:
 121:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void*)&
 572              		.loc 1 121 9 is_stmt 1 view .LVU164
 121:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void*)&
 573              		.loc 1 121 89 is_stmt 0 view .LVU165
 574 010a DDED036A 		vldr.32	s13, [sp, #12]
 575 010e 76EEC06A 		vsub.f32	s13, s13, s0
 121:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void*)&
 576              		.loc 1 121 109 discriminator 1 view .LVU166
 577 0112 67EEA67A 		vmul.f32	s15, s15, s13
 121:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void*)&
 578              		.loc 1 121 59 discriminator 1 view .LVU167
 579 0116 FCEEE77A 		vcvt.u32.f32	s15, s15
 121:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void*)&
 580              		.loc 1 121 19 discriminator 1 view .LVU168
 581 011a 17EE904A 		vmov	r4, s15	@ int
 582 011e 0444     		add	r4, r4, r0
 583              	.LVL45:
 122:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (void*)&ne
 584              		.loc 1 122 9 is_stmt 1 view .LVU169
 585 0120 134D     		ldr	r5, .L53+24
 586 0122 2A46     		mov	r2, r5
 587 0124 1449     		ldr	r1, .L53+32
 588 0126 17EE103A 		vmov	r3, s14	@ int
 589 012a 0344     		add	r3, r3, r0
 590              	.LVL46:
 122:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (void*)&ne
 591              		.loc 1 122 9 is_stmt 0 view .LVU170
 592 012c 1846     		mov	r0, r3
 593              	.LVL47:
 122:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (void*)&ne
 594              		.loc 1 122 9 view .LVU171
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 19


 595 012e FFF7FEFF 		bl	scheduler_schedule_event_with_arg
 596              	.LVL48:
 123:controller/engine_cycle/ignition.c **** 
 597              		.loc 1 123 9 is_stmt 1 view .LVU172
 598 0132 2A46     		mov	r2, r5
 599 0134 1149     		ldr	r1, .L53+36
 600 0136 2046     		mov	r0, r4
 601 0138 FFF7FEFF 		bl	scheduler_schedule_event_with_arg
 602              	.LVL49:
 603 013c 02E0     		b	.L35
 604              	.LVL50:
 605              	.L37:
 123:controller/engine_cycle/ignition.c **** 
 606              		.loc 1 123 9 is_stmt 0 view .LVU173
 607              	.LBE16:
  86:controller/engine_cycle/ignition.c ****         return;
 608              		.loc 1 86 9 is_stmt 1 view .LVU174
 609 013e 1048     		ldr	r0, .L53+40
 610              	.LVL51:
  86:controller/engine_cycle/ignition.c ****         return;
 611              		.loc 1 86 9 is_stmt 0 view .LVU175
 612 0140 FFF7FEFF 		bl	log_error
 613              	.LVL52:
  87:controller/engine_cycle/ignition.c ****     }
 614              		.loc 1 87 9 is_stmt 1 view .LVU176
 615              	.L35:
 127:controller/engine_cycle/ignition.c **** 
 616              		.loc 1 127 1 is_stmt 0 view .LVU177
 617 0144 05B0     		add	sp, sp, #20
 618              		.cfi_remember_state
 619              		.cfi_def_cfa_offset 12
 620              		@ sp needed
 621 0146 30BD     		pop	{r4, r5, pc}
 622              	.LVL53:
 623              	.L44:
 624              		.cfi_restore_state
 625              	.LBB21:
 626              	.LBB15:
  87:controller/utils/utils.h ****     }
 627              		.loc 2 87 16 view .LVU178
 628 0148 9FED0E6A 		vldr.32	s12, .L53+44
 629 014c 9EE7     		b	.L40
 630              	.LVL54:
 631              	.L45:
  87:controller/utils/utils.h ****     }
 632              		.loc 2 87 16 view .LVU179
 633              	.LBE15:
 634              	.LBE21:
 635              	.LBB22:
 636              	.LBB20:
 637              	.LBB19:
  74:controller/utils/utils.h ****     }
 638              		.loc 2 74 16 view .LVU180
 639 014e DFED0E7A 		vldr.32	s15, .L53+48	@ int
 640 0152 D4E7     		b	.L43
 641              	.LVL55:
 642              	.L50:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 20


 643              		.cfi_def_cfa_offset 0
 644              		.cfi_restore 4
 645              		.cfi_restore 5
 646              		.cfi_restore 14
  74:controller/utils/utils.h ****     }
 647              		.loc 2 74 16 view .LVU181
 648 0154 7047     		bx	lr
 649              	.L54:
 650 0156 00BF     		.align	2
 651              	.L53:
 652 0158 00000000 		.word	configuration
 653 015c 00000000 		.word	engine
 654 0160 00007A44 		.word	1148846080
 655 0164 0000B443 		.word	1135869952
 656 0168 C0E1644C 		.word	1281679808
 657 016c 00000000 		.word	ignition_order
 658 0170 00000000 		.word	next_firing_cylinder_index.0
 659 0174 00000000 		.word	spark_is_in_progress
 660 0178 00000000 		.word	ignition_coil_begin_charge
 661 017c 00000000 		.word	ignition_coil_fire_spark
 662 0180 00000000 		.word	.LC4
 663 0184 00000000 		.word	0
 664 0188 00000000 		.word	0
 665              	.LBE19:
 666              	.LBE20:
 667              	.LBE22:
 668              		.cfi_endproc
 669              	.LFE229:
 671              		.section	.rodata.ignition_get_number_of_sparks_per_coil.str1.4,"aMS",%progbits,1
 672              		.align	2
 673              	.LC5:
 674 0000 556E6B6F 		.ascii	"Unkown ignition mode\000"
 674      776E2069 
 674      676E6974 
 674      696F6E20 
 674      6D6F6465 
 675              		.section	.text.ignition_get_number_of_sparks_per_coil,"ax",%progbits
 676              		.align	1
 677              		.global	ignition_get_number_of_sparks_per_coil
 678              		.syntax unified
 679              		.thumb
 680              		.thumb_func
 682              	ignition_get_number_of_sparks_per_coil:
 683              	.LVL56:
 684              	.LFB230:
 137:controller/engine_cycle/ignition.c ****     switch (ignition_mode)
 685              		.loc 1 137 1 is_stmt 1 view -0
 686              		.cfi_startproc
 687              		@ args = 0, pretend = 0, frame = 0
 688              		@ frame_needed = 0, uses_anonymous_args = 0
 138:controller/engine_cycle/ignition.c ****     {
 689              		.loc 1 138 5 view .LVU183
 690 0000 0228     		cmp	r0, #2
 691 0002 0CD0     		beq	.L58
 692 0004 0328     		cmp	r0, #3
 693 0006 0CD0     		beq	.L59
 137:controller/engine_cycle/ignition.c ****     switch (ignition_mode)
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 21


 694              		.loc 1 137 1 is_stmt 0 view .LVU184
 695 0008 08B5     		push	{r3, lr}
 696              		.cfi_def_cfa_offset 8
 697              		.cfi_offset 3, -8
 698              		.cfi_offset 14, -4
 138:controller/engine_cycle/ignition.c ****     {
 699              		.loc 1 138 5 view .LVU185
 700 000a 0128     		cmp	r0, #1
 701 000c 02D1     		bne	.L57
 141:controller/engine_cycle/ignition.c ****     case IM_INDIVIDUAL_COILS:
 702              		.loc 1 141 9 is_stmt 1 view .LVU186
 141:controller/engine_cycle/ignition.c ****     case IM_INDIVIDUAL_COILS:
 703              		.loc 1 141 22 is_stmt 0 view .LVU187
 704 000e 064B     		ldr	r3, .L64
 705 0010 187C     		ldrb	r0, [r3, #16]	@ zero_extendqisi2
 706              	.LVL57:
 707              	.L56:
 150:controller/engine_cycle/ignition.c **** 
 708              		.loc 1 150 1 view .LVU188
 709 0012 08BD     		pop	{r3, pc}
 710              	.LVL58:
 711              	.L57:
 147:controller/engine_cycle/ignition.c ****         return 1;
 712              		.loc 1 147 9 is_stmt 1 view .LVU189
 713 0014 0548     		ldr	r0, .L64+4
 714              	.LVL59:
 147:controller/engine_cycle/ignition.c ****         return 1;
 715              		.loc 1 147 9 is_stmt 0 view .LVU190
 716 0016 FFF7FEFF 		bl	log_error
 717              	.LVL60:
 148:controller/engine_cycle/ignition.c ****     }
 718              		.loc 1 148 9 is_stmt 1 view .LVU191
 148:controller/engine_cycle/ignition.c ****     }
 719              		.loc 1 148 16 is_stmt 0 view .LVU192
 720 001a 0120     		movs	r0, #1
 721 001c F9E7     		b	.L56
 722              	.LVL61:
 723              	.L58:
 724              		.cfi_def_cfa_offset 0
 725              		.cfi_restore 3
 726              		.cfi_restore 14
 138:controller/engine_cycle/ignition.c ****     {
 727              		.loc 1 138 5 view .LVU193
 728 001e 0120     		movs	r0, #1
 729              	.LVL62:
 138:controller/engine_cycle/ignition.c ****     {
 730              		.loc 1 138 5 view .LVU194
 731 0020 7047     		bx	lr
 732              	.LVL63:
 733              	.L59:
 145:controller/engine_cycle/ignition.c ****     default:
 734              		.loc 1 145 16 view .LVU195
 735 0022 0220     		movs	r0, #2
 736              	.LVL64:
 150:controller/engine_cycle/ignition.c **** 
 737              		.loc 1 150 1 view .LVU196
 738 0024 7047     		bx	lr
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 22


 739              	.L65:
 740 0026 00BF     		.align	2
 741              	.L64:
 742 0028 00000000 		.word	engine
 743 002c 00000000 		.word	.LC5
 744              		.cfi_endproc
 745              	.LFE230:
 747              		.section	.text.ignition_get_coil_duty_cycle,"ax",%progbits
 748              		.align	1
 749              		.global	ignition_get_coil_duty_cycle
 750              		.syntax unified
 751              		.thumb
 752              		.thumb_func
 754              	ignition_get_coil_duty_cycle:
 755              	.LFB233:
 196:controller/engine_cycle/ignition.c **** 
 197:controller/engine_cycle/ignition.c **** /**
 198:controller/engine_cycle/ignition.c ****  * @brief Gets the duty cycle of the ignition coil as a percentage.
 199:controller/engine_cycle/ignition.c ****  * 
 200:controller/engine_cycle/ignition.c ****  * @return The duty cycle of the ignition coil.
 201:controller/engine_cycle/ignition.c ****  */
 202:controller/engine_cycle/ignition.c **** percent_t ignition_get_coil_duty_cycle()
 203:controller/engine_cycle/ignition.c **** {
 756              		.loc 1 203 1 is_stmt 1 view -0
 757              		.cfi_startproc
 758              		@ args = 0, pretend = 0, frame = 0
 759              		@ frame_needed = 0, uses_anonymous_args = 0
 760              		@ link register save eliminated.
 204:controller/engine_cycle/ignition.c **** 
 205:controller/engine_cycle/ignition.c **** }
 761              		.loc 1 205 1 view .LVU198
 762 0000 7047     		bx	lr
 763              		.cfi_endproc
 764              	.LFE233:
 766              		.section	.text.ignition_get_advance,"ax",%progbits
 767              		.align	1
 768              		.global	ignition_get_advance
 769              		.syntax unified
 770              		.thumb
 771              		.thumb_func
 773              	ignition_get_advance:
 774              	.LFB234:
 206:controller/engine_cycle/ignition.c **** 
 207:controller/engine_cycle/ignition.c **** angle_t ignition_get_advance()
 208:controller/engine_cycle/ignition.c **** {
 775              		.loc 1 208 1 view -0
 776              		.cfi_startproc
 777              		@ args = 0, pretend = 0, frame = 0
 778              		@ frame_needed = 0, uses_anonymous_args = 0
 209:controller/engine_cycle/ignition.c ****     angle_t final_advance = IGNITION_ADVANCE_FAIL_SAFE;
 779              		.loc 1 209 5 view .LVU200
 780              	.LVL65:
 210:controller/engine_cycle/ignition.c ****     if (engine.spinning_state != SS_RUNNING)
 781              		.loc 1 210 5 view .LVU201
 782              		.loc 1 210 15 is_stmt 0 view .LVU202
 783 0000 0F4B     		ldr	r3, .L73
 784 0002 5B7C     		ldrb	r3, [r3, #17]	@ zero_extendqisi2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 23


 785              		.loc 1 210 8 view .LVU203
 786 0004 032B     		cmp	r3, #3
 787 0006 03D0     		beq	.L68
 211:controller/engine_cycle/ignition.c ****     {
 212:controller/engine_cycle/ignition.c ****         return configuration.cranking_advance;
 788              		.loc 1 212 9 is_stmt 1 view .LVU204
 789              		.loc 1 212 29 is_stmt 0 view .LVU205
 790 0008 0E4B     		ldr	r3, .L73+4
 791 000a 93ED030A 		vldr.32	s0, [r3, #12]
 213:controller/engine_cycle/ignition.c ****     }
 214:controller/engine_cycle/ignition.c ****     
 215:controller/engine_cycle/ignition.c ****     temperature_t intake_air_temp = sensor_iat_get();
 216:controller/engine_cycle/ignition.c ****     table_ignition_t *ignition_table = table_ignition_get_table();
 217:controller/engine_cycle/ignition.c ****     rpm_t rpm = crankshaft_get_rpm();
 218:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 219:controller/engine_cycle/ignition.c **** 
 220:controller/engine_cycle/ignition.c ****     angle_t table_advance = table_ignition_get_value(ignition_table, rpm, map);
 221:controller/engine_cycle/ignition.c **** 
 222:controller/engine_cycle/ignition.c ****     /* Here we can apply all kinds of correction to the table */
 223:controller/engine_cycle/ignition.c ****     final_advance = table_advance; // + corrections
 224:controller/engine_cycle/ignition.c **** 
 225:controller/engine_cycle/ignition.c ****     return final_advance;
 226:controller/engine_cycle/ignition.c **** }...
 792              		.loc 1 226 1 view .LVU206
 793 000e 7047     		bx	lr
 794              	.L68:
 208:controller/engine_cycle/ignition.c **** {
 795              		.loc 1 208 1 view .LVU207
 796 0010 10B5     		push	{r4, lr}
 797              		.cfi_def_cfa_offset 8
 798              		.cfi_offset 4, -8
 799              		.cfi_offset 14, -4
 800 0012 2DED028B 		vpush.64	{d8}
 801              		.cfi_def_cfa_offset 16
 802              		.cfi_offset 80, -16
 803              		.cfi_offset 81, -12
 215:controller/engine_cycle/ignition.c ****     temperature_t intake_air_temp = sensor_iat_get();
 804              		.loc 1 215 5 is_stmt 1 view .LVU208
 215:controller/engine_cycle/ignition.c ****     temperature_t intake_air_temp = sensor_iat_get();
 805              		.loc 1 215 37 is_stmt 0 view .LVU209
 806 0016 FFF7FEFF 		bl	sensor_iat_get
 807              	.LVL66:
 216:controller/engine_cycle/ignition.c ****     table_ignition_t *ignition_table = table_ignition_get_table();
 808              		.loc 1 216 5 is_stmt 1 view .LVU210
 216:controller/engine_cycle/ignition.c ****     table_ignition_t *ignition_table = table_ignition_get_table();
 809              		.loc 1 216 40 is_stmt 0 view .LVU211
 810 001a FFF7FEFF 		bl	table_ignition_get_table
 811              	.LVL67:
 812 001e 0446     		mov	r4, r0
 813              	.LVL68:
 217:controller/engine_cycle/ignition.c ****     rpm_t rpm = crankshaft_get_rpm();
 814              		.loc 1 217 5 is_stmt 1 view .LVU212
 217:controller/engine_cycle/ignition.c ****     rpm_t rpm = crankshaft_get_rpm();
 815              		.loc 1 217 17 is_stmt 0 view .LVU213
 816 0020 FFF7FEFF 		bl	crankshaft_get_rpm
 817              	.LVL69:
 217:controller/engine_cycle/ignition.c ****     rpm_t rpm = crankshaft_get_rpm();
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 24


 818              		.loc 1 217 17 view .LVU214
 819 0024 B0EE408A 		vmov.f32	s16, s0
 820              	.LVL70:
 218:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 821              		.loc 1 218 5 is_stmt 1 view .LVU215
 218:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 822              		.loc 1 218 22 is_stmt 0 view .LVU216
 823 0028 FFF7FEFF 		bl	sensor_map_get
 824              	.LVL71:
 218:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 825              		.loc 1 218 22 view .LVU217
 826 002c F0EE400A 		vmov.f32	s1, s0
 827              	.LVL72:
 220:controller/engine_cycle/ignition.c ****     angle_t table_advance = table_ignition_get_value(ignition_table, rpm, map);
 828              		.loc 1 220 5 is_stmt 1 view .LVU218
 220:controller/engine_cycle/ignition.c ****     angle_t table_advance = table_ignition_get_value(ignition_table, rpm, map);
 829              		.loc 1 220 29 is_stmt 0 view .LVU219
 830 0030 B0EE480A 		vmov.f32	s0, s16
 831              	.LVL73:
 220:controller/engine_cycle/ignition.c ****     angle_t table_advance = table_ignition_get_value(ignition_table, rpm, map);
 832              		.loc 1 220 29 view .LVU220
 833 0034 2046     		mov	r0, r4
 834 0036 FFF7FEFF 		bl	table_ignition_get_value
 835              	.LVL74:
 223:controller/engine_cycle/ignition.c ****     final_advance = table_advance; // + corrections
 836              		.loc 1 223 5 is_stmt 1 view .LVU221
 225:controller/engine_cycle/ignition.c ****     return final_advance;
 837              		.loc 1 225 5 view .LVU222
 838              		.loc 1 226 1 is_stmt 0 view .LVU223
 839 003a BDEC028B 		vldm	sp!, {d8}
 840              		.cfi_restore 80
 841              		.cfi_restore 81
 842              		.cfi_def_cfa_offset 8
 843              	.LVL75:
 844              		.loc 1 226 1 view .LVU224
 845 003e 10BD     		pop	{r4, pc}
 846              	.LVL76:
 847              	.L74:
 848              		.loc 1 226 1 view .LVU225
 849              		.align	2
 850              	.L73:
 851 0040 00000000 		.word	engine
 852 0044 00000000 		.word	configuration
 853              		.cfi_endproc
 854              	.LFE234:
 856              		.section	.bss.next_firing_cylinder_index.0,"aw",%nobits
 859              	next_firing_cylinder_index.0:
 860 0000 00       		.space	1
 861              		.section	.bss.spark_is_in_progress,"aw",%nobits
 864              	spark_is_in_progress:
 865 0000 00       		.space	1
 866              		.global	ignition_order
 867              		.section	.bss.ignition_order,"aw",%nobits
 868              		.align	2
 871              	ignition_order:
 872 0000 00000000 		.space	4
 873              		.global	ignition_coil_state
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 25


 874              		.section	.bss.ignition_coil_state,"aw",%nobits
 875              		.align	2
 878              	ignition_coil_state:
 879 0000 00000000 		.space	4
 880              		.global	ignition_outputs
 881              		.section	.bss.ignition_outputs,"aw",%nobits
 882              		.align	2
 885              	ignition_outputs:
 886 0000 00000000 		.space	32
 886      00000000 
 886      00000000 
 886      00000000 
 886      00000000 
 887              		.text
 888              	.Letext0:
 889              		.file 3 "controller/enums.h"
 890              		.file 4 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 891              		.file 5 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 892              		.file 6 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 893              		.file 7 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f401xc.h"
 894              		.file 8 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_gpio.h"
 895              		.file 9 "controller/types.h"
 896              		.file 10 "controller/engine_cycle/trigger.h"
 897              		.file 11 "controller/tables.h"
 898              		.file 12 "controller/IO/analog_inputs.h"
 899              		.file 13 "controller/IO/sensors/tps.h"
 900              		.file 14 "controller/IO/thermistor.h"
 901              		.file 15 "controller/utils/pid.h"
 902              		.file 16 "controller/algorithm/governer.h"
 903              		.file 17 "controller/controller.h"
 904              		.file 18 "controller/engine_cycle/ignition.h"
 905              		.file 19 "controller/IO/sensors/map.h"
 906              		.file 20 "controller/IO/sensors/iat.h"
 907              		.file 21 "controller/utils/timing.h"
 908              		.file 22 "controller/utils/error_handling.h"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s 			page 26


DEFINED SYMBOLS
                            *ABS*:00000000 ignition.c
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:21     .rodata.ignition_coil_begin_charge.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:25     .text.ignition_coil_begin_charge:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:31     .text.ignition_coil_begin_charge:00000000 ignition_coil_begin_charge
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:93     .text.ignition_coil_begin_charge:0000002c $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:878    .bss.ignition_coil_state:00000000 ignition_coil_state
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:885    .bss.ignition_outputs:00000000 ignition_outputs
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:100    .text.ignition_coil_fire_spark:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:106    .text.ignition_coil_fire_spark:00000000 ignition_coil_fire_spark
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:173    .text.ignition_coil_fire_spark:00000034 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:864    .bss.spark_is_in_progress:00000000 spark_is_in_progress
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:181    .rodata.ignition_init.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:191    .text.ignition_init:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:197    .text.ignition_init:00000000 ignition_init
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:375    .text.ignition_init:000000a0 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:871    .bss.ignition_order:00000000 ignition_order
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:388    .rodata.ignition_trigger_event_handle.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:392    .text.ignition_trigger_event_handle:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:398    .text.ignition_trigger_event_handle:00000000 ignition_trigger_event_handle
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:652    .text.ignition_trigger_event_handle:00000158 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:859    .bss.next_firing_cylinder_index.0:00000000 next_firing_cylinder_index.0
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:672    .rodata.ignition_get_number_of_sparks_per_coil.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:676    .text.ignition_get_number_of_sparks_per_coil:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:682    .text.ignition_get_number_of_sparks_per_coil:00000000 ignition_get_number_of_sparks_per_coil
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:742    .text.ignition_get_number_of_sparks_per_coil:00000028 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:748    .text.ignition_get_coil_duty_cycle:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:754    .text.ignition_get_coil_duty_cycle:00000000 ignition_get_coil_duty_cycle
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:767    .text.ignition_get_advance:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:773    .text.ignition_get_advance:00000000 ignition_get_advance
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:851    .text.ignition_get_advance:00000040 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:860    .bss.next_firing_cylinder_index.0:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:865    .bss.spark_is_in_progress:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:868    .bss.ignition_order:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:875    .bss.ignition_coil_state:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccww2aAr.s:882    .bss.ignition_outputs:00000000 $d

UNDEFINED SYMBOLS
HAL_GPIO_WritePin
log_error
HAL_GPIO_ReadPin
log_warning
configuration
engine
scheduler_schedule_event_with_arg
sensor_iat_get
table_ignition_get_table
crankshaft_get_rpm
sensor_map_get
table_ignition_get_value
