ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"ignition.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "controller/engine_cycle/ignition.c"
  20              		.section	.rodata.ignition_coil_begin_charge.str1.4,"aMS",%progbits,1
  21              		.align	2
  22              	.LC0:
  23 0000 556E6B6F 		.ascii	"Unkown ignition output\000"
  23      776E2069 
  23      676E6974 
  23      696F6E20 
  23      6F757470 
  24              		.section	.text.ignition_coil_begin_charge,"ax",%progbits
  25              		.align	1
  26              		.global	ignition_coil_begin_charge
  27              		.syntax unified
  28              		.thumb
  29              		.thumb_func
  31              	ignition_coil_begin_charge:
  32              	.LVL0:
  33              	.LFB234:
   1:controller/engine_cycle/ignition.c **** #include "ignition.h"
   2:controller/engine_cycle/ignition.c **** 
   3:controller/engine_cycle/ignition.c **** controller_output_pin_t *ignition_outputs = NULL;
   4:controller/engine_cycle/ignition.c **** 
   5:controller/engine_cycle/ignition.c **** volatile ignition_coil_state_t ignition_coil_state[FIRMWARE_IGNITION_OUTPUT_COUNT] = {0};
   6:controller/engine_cycle/ignition.c **** 
   7:controller/engine_cycle/ignition.c **** uint8_t ignition_order[FIRMWARE_LIMIT_NUMBER_OF_CYLINDERS_MAX] = {0};
   8:controller/engine_cycle/ignition.c **** 
   9:controller/engine_cycle/ignition.c **** static volatile bool spark_is_in_progress = false;
  10:controller/engine_cycle/ignition.c **** 
  11:controller/engine_cycle/ignition.c **** static uint8_t number_of_cylinders = 0;
  12:controller/engine_cycle/ignition.c **** 
  13:controller/engine_cycle/ignition.c **** void ignition_init(controller_output_pin_t *outputs)
  14:controller/engine_cycle/ignition.c **** {
  15:controller/engine_cycle/ignition.c ****     if (outputs == NULL)
  16:controller/engine_cycle/ignition.c ****     {
  17:controller/engine_cycle/ignition.c ****         log_error("ignition init failed. No output config");
  18:controller/engine_cycle/ignition.c ****         return;
  19:controller/engine_cycle/ignition.c ****     }
  20:controller/engine_cycle/ignition.c ****     ignition_outputs = outputs;
  21:controller/engine_cycle/ignition.c **** 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 2


  22:controller/engine_cycle/ignition.c ****     switch (config.firing_order)
  23:controller/engine_cycle/ignition.c ****     {
  24:controller/engine_cycle/ignition.c ****     case FO_1342: // Common inline-4
  25:controller/engine_cycle/ignition.c ****         number_of_cylinders = 4;
  26:controller/engine_cycle/ignition.c ****         switch (config.ignition_mode)
  27:controller/engine_cycle/ignition.c ****         {
  28:controller/engine_cycle/ignition.c ****         case IM_ONE_COIL:
  29:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
  30:controller/engine_cycle/ignition.c ****             ignition_order[1] = 1;
  31:controller/engine_cycle/ignition.c ****             ignition_order[2] = 1;
  32:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
  33:controller/engine_cycle/ignition.c ****             break;
  34:controller/engine_cycle/ignition.c ****         case IM_WASTED_SPARK:
  35:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
  36:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
  37:controller/engine_cycle/ignition.c ****             ignition_order[2] = 2;
  38:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
  39:controller/engine_cycle/ignition.c ****             break;
  40:controller/engine_cycle/ignition.c ****         case IM_INDIVIDUAL_COILS:
  41:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
  42:controller/engine_cycle/ignition.c ****             ignition_order[1] = 3;
  43:controller/engine_cycle/ignition.c ****             ignition_order[2] = 4;
  44:controller/engine_cycle/ignition.c ****             ignition_order[3] = 2;
  45:controller/engine_cycle/ignition.c ****             break;
  46:controller/engine_cycle/ignition.c **** 
  47:controller/engine_cycle/ignition.c ****         default:
  48:controller/engine_cycle/ignition.c ****             log_error("ignition init failed. unkown mode.");
  49:controller/engine_cycle/ignition.c ****             return;
  50:controller/engine_cycle/ignition.c ****         }
  51:controller/engine_cycle/ignition.c **** 
  52:controller/engine_cycle/ignition.c ****         break;
  53:controller/engine_cycle/ignition.c ****     case FO_153624: // Common inline-6
  54:controller/engine_cycle/ignition.c ****         number_of_cylinders = 6;
  55:controller/engine_cycle/ignition.c ****         switch (config.ignition_mode)
  56:controller/engine_cycle/ignition.c ****         {
  57:controller/engine_cycle/ignition.c ****         case IM_ONE_COIL:
  58:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
  59:controller/engine_cycle/ignition.c ****             ignition_order[1] = 1;
  60:controller/engine_cycle/ignition.c ****             ignition_order[2] = 1;
  61:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
  62:controller/engine_cycle/ignition.c ****             ignition_order[4] = 1;
  63:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
  64:controller/engine_cycle/ignition.c ****             break;
  65:controller/engine_cycle/ignition.c ****         case IM_WASTED_SPARK:
  66:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
  67:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
  68:controller/engine_cycle/ignition.c ****             ignition_order[2] = 3;
  69:controller/engine_cycle/ignition.c ****             ignition_order[3] = 3;
  70:controller/engine_cycle/ignition.c ****             ignition_order[4] = 2;
  71:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
  72:controller/engine_cycle/ignition.c ****             break;
  73:controller/engine_cycle/ignition.c ****         case IM_INDIVIDUAL_COILS:
  74:controller/engine_cycle/ignition.c ****             config.ignition_mode = IM_WASTED_SPARK;
  75:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
  76:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
  77:controller/engine_cycle/ignition.c ****             ignition_order[2] = 3;
  78:controller/engine_cycle/ignition.c ****             ignition_order[3] = 3;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 3


  79:controller/engine_cycle/ignition.c ****             ignition_order[4] = 2;
  80:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
  81:controller/engine_cycle/ignition.c ****             log_warning("Coil on plug igntion not possible with 6 cylinders. Defaulted to wasted sp
  82:controller/engine_cycle/ignition.c ****             break;
  83:controller/engine_cycle/ignition.c **** 
  84:controller/engine_cycle/ignition.c ****         default:
  85:controller/engine_cycle/ignition.c ****             log_error("ignition init failed. unkown mode.");
  86:controller/engine_cycle/ignition.c ****             return;
  87:controller/engine_cycle/ignition.c ****         }
  88:controller/engine_cycle/ignition.c **** 
  89:controller/engine_cycle/ignition.c ****     default:
  90:controller/engine_cycle/ignition.c ****         log_error("ignition init failed. unkown firing order.");
  91:controller/engine_cycle/ignition.c ****         return;
  92:controller/engine_cycle/ignition.c ****     }
  93:controller/engine_cycle/ignition.c **** 
  94:controller/engine_cycle/ignition.c ****     runtime.firing_interval_deg = (angle_t)720 / (angle_t)number_of_cylinders;
  95:controller/engine_cycle/ignition.c **** 
  96:controller/engine_cycle/ignition.c ****     /* Read the pin states from real hardware */
  97:controller/engine_cycle/ignition.c ****     for (size_t i = 0; i < FIRMWARE_IGNITION_OUTPUT_COUNT; i++)
  98:controller/engine_cycle/ignition.c ****     {
  99:controller/engine_cycle/ignition.c ****         ignition_coil_state[i] = HAL_GPIO_ReadPin(ignition_outputs[i].gpio, ignition_outputs[i].pin
 100:controller/engine_cycle/ignition.c ****     }
 101:controller/engine_cycle/ignition.c ****     /* Set all outputs to reset just in case */
 102:controller/engine_cycle/ignition.c ****     for (size_t i = 0; i < FIRMWARE_IGNITION_OUTPUT_COUNT; i++)
 103:controller/engine_cycle/ignition.c ****     {
 104:controller/engine_cycle/ignition.c ****         HAL_GPIO_WritePin(ignition_outputs[i].gpio, ignition_outputs[i].pin, GPIO_PIN_RESET);
 105:controller/engine_cycle/ignition.c ****     }
 106:controller/engine_cycle/ignition.c **** 
 107:controller/engine_cycle/ignition.c ****     if (config.multi_spark_enabled && !IS_IN_RANGE(config.multi_spark_number_of_sparks, 0, IGNITION
 108:controller/engine_cycle/ignition.c ****     {
 109:controller/engine_cycle/ignition.c ****         log_warning("Multi spark is enabled but number of sparks are 0.");
 110:controller/engine_cycle/ignition.c ****     }
 111:controller/engine_cycle/ignition.c **** }
 112:controller/engine_cycle/ignition.c **** 
 113:controller/engine_cycle/ignition.c **** /**
 114:controller/engine_cycle/ignition.c ****  * @brief Handles an ignition trigger event based on the crankshaft angle, RPM, and current time.
 115:controller/engine_cycle/ignition.c ****  *
 116:controller/engine_cycle/ignition.c ****  * @param crankshaft_angle The current angle of the crankshaft.
 117:controller/engine_cycle/ignition.c ****  * @param rpm The current revolutions per minute of the engine.
 118:controller/engine_cycle/ignition.c ****  * @param current_time_us The current time in microseconds.
 119:controller/engine_cycle/ignition.c ****  */
 120:controller/engine_cycle/ignition.c **** void ignition_trigger_event_handle(angle_t crankshaft_angle, rpm_t rpm, time_us_t current_time_us)
 121:controller/engine_cycle/ignition.c **** {
 122:controller/engine_cycle/ignition.c ****     /**
 123:controller/engine_cycle/ignition.c ****      * @todo add the necessary checks and bounds
 124:controller/engine_cycle/ignition.c ****      */
 125:controller/engine_cycle/ignition.c ****     if (config.ignition_mode == IM_NO_IGNITION)
 126:controller/engine_cycle/ignition.c ****     {
 127:controller/engine_cycle/ignition.c ****         // obviously, there is no need to do any furthure processing
 128:controller/engine_cycle/ignition.c ****         return;
 129:controller/engine_cycle/ignition.c ****     }
 130:controller/engine_cycle/ignition.c ****     if (runtime.firing_interval_deg == 0)
 131:controller/engine_cycle/ignition.c ****     {
 132:controller/engine_cycle/ignition.c ****         log_error("ignition not initialized.");
 133:controller/engine_cycle/ignition.c ****         return;
 134:controller/engine_cycle/ignition.c ****     }
 135:controller/engine_cycle/ignition.c **** 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 4


 136:controller/engine_cycle/ignition.c ****     if (!IS_IN_RANGE(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_MAX_DWELL_TIME_MS)
 137:controller/engine_cycle/ignition.c ****     {
 138:controller/engine_cycle/ignition.c ****         config.ignition_dwell = CLAMP(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_M
 139:controller/engine_cycle/ignition.c ****         /**
 140:controller/engine_cycle/ignition.c ****          * @todo throw an error
 141:controller/engine_cycle/ignition.c ****          */
 142:controller/engine_cycle/ignition.c ****         log_error("ignition dwell out of bounds.");
 143:controller/engine_cycle/ignition.c **** 
 144:controller/engine_cycle/ignition.c ****         return;
 145:controller/engine_cycle/ignition.c ****     }
 146:controller/engine_cycle/ignition.c ****     /* Wether or not cam phase is known */
 147:controller/engine_cycle/ignition.c ****     bool is_cam_phase_available = false;
 148:controller/engine_cycle/ignition.c **** 
 149:controller/engine_cycle/ignition.c ****     angle_t spark_advance = 0;
 150:controller/engine_cycle/ignition.c **** 
 151:controller/engine_cycle/ignition.c **** #ifdef TEST_MODE
 152:controller/engine_cycle/ignition.c ****     spark_advance = (angle_t)30;
 153:controller/engine_cycle/ignition.c **** #else
 154:controller/engine_cycle/ignition.c ****     spark_advance = ignition_get_advance();
 155:controller/engine_cycle/ignition.c ****     runtime.ignition_advance_deg = spark_advance;
 156:controller/engine_cycle/ignition.c **** #endif
 157:controller/engine_cycle/ignition.c **** 
 158:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
 159:controller/engine_cycle/ignition.c ****     runtime.dwell_actual = config.ignition_dwell;
 160:controller/engine_cycle/ignition.c **** 
 161:controller/engine_cycle/ignition.c ****     /* First we have to detect the engine phase */
 162:controller/engine_cycle/ignition.c ****     uint8_t phase = (uint8_t)(crankshaft_angle / runtime.firing_interval_deg);
 163:controller/engine_cycle/ignition.c ****     uint8_t phase_count = (uint8_t)(angle_t)360 / (angle_t)runtime.firing_interval_deg;
 164:controller/engine_cycle/ignition.c **** 
 165:controller/engine_cycle/ignition.c ****     volatile angle_t next_spark_angle = phase * runtime.firing_interval_deg - spark_advance + runti
 166:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)config.ignition_dwell * (float)10
 167:controller/engine_cycle/ignition.c **** 
 168:controller/engine_cycle/ignition.c ****     static uint8_t next_firing_cylinders[2] = {0};
 169:controller/engine_cycle/ignition.c **** 
 170:controller/engine_cycle/ignition.c ****     next_firing_cylinders[0] = ignition_order[phase] - 1;
 171:controller/engine_cycle/ignition.c ****     next_firing_cylinders[1] = ignition_order[phase] - 1;
 172:controller/engine_cycle/ignition.c **** 
 173:controller/engine_cycle/ignition.c ****     if (!is_cam_phase_available)
 174:controller/engine_cycle/ignition.c ****     {
 175:controller/engine_cycle/ignition.c ****         next_firing_cylinders[1] = ignition_order[phase + 2] - 1;
 176:controller/engine_cycle/ignition.c ****     }
 177:controller/engine_cycle/ignition.c **** 
 178:controller/engine_cycle/ignition.c ****     bool is_synced = get_bit(runtime.status, STATUS_TRIGGER1_SYNCED);
 179:controller/engine_cycle/ignition.c **** 
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 181:controller/engine_cycle/ignition.c ****     {
 182:controller/engine_cycle/ignition.c ****         /* Now we are close enough to the dwell angle that we can schedule the coil charge start */
 183:controller/engine_cycle/ignition.c **** 
 184:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 185:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 186:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void *)
 187:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (void *)ne
 188:controller/engine_cycle/ignition.c **** 
 189:controller/engine_cycle/ignition.c ****         uint8_t number_of_scheduled_sparks = 1;
 190:controller/engine_cycle/ignition.c ****         if (!config.multi_spark_enabled)
 191:controller/engine_cycle/ignition.c ****         {
 192:controller/engine_cycle/ignition.c ****             runtime.multi_spark_actual_spark_count = number_of_scheduled_sparks;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 5


 193:controller/engine_cycle/ignition.c ****             return;
 194:controller/engine_cycle/ignition.c ****         }
 195:controller/engine_cycle/ignition.c **** 
 196:controller/engine_cycle/ignition.c ****         while (number_of_scheduled_sparks < config.multi_spark_number_of_sparks)
 197:controller/engine_cycle/ignition.c ****         {
 198:controller/engine_cycle/ignition.c ****             if (rpm > config.multi_spark_rpm_threshold)
 199:controller/engine_cycle/ignition.c ****             {
 200:controller/engine_cycle/ignition.c ****                 break;
 201:controller/engine_cycle/ignition.c ****             }
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 203:controller/engine_cycle/ignition.c ****             if (duration_of_spark_and_dwell >= config.multi_spark_max_trailing_angle * microseconds
 204:controller/engine_cycle/ignition.c ****             {
 205:controller/engine_cycle/ignition.c ****                 break;
 206:controller/engine_cycle/ignition.c ****             }
 207:controller/engine_cycle/ignition.c **** 
 208:controller/engine_cycle/ignition.c ****             dwell_start_time_us += duration_of_spark_and_dwell;
 209:controller/engine_cycle/ignition.c ****             spark_start_time_us += duration_of_spark_and_dwell;
 210:controller/engine_cycle/ignition.c **** 
 211:controller/engine_cycle/ignition.c ****             // don't schedule events if there are no empty slots in the scheduler
 212:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (
 213:controller/engine_cycle/ignition.c ****             {
 214:controller/engine_cycle/ignition.c ****                 // fire the spark right away to prevent ign coil damage
 215:controller/engine_cycle/ignition.c ****                 ignition_coil_fire_spark((void *)next_firing_cylinders);
 216:controller/engine_cycle/ignition.c ****                 break;
 217:controller/engine_cycle/ignition.c ****             }
 218:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge,
 219:controller/engine_cycle/ignition.c ****             {
 220:controller/engine_cycle/ignition.c **** 
 221:controller/engine_cycle/ignition.c ****                 break;
 222:controller/engine_cycle/ignition.c ****             }
 223:controller/engine_cycle/ignition.c ****             number_of_scheduled_sparks++;
 224:controller/engine_cycle/ignition.c ****         }
 225:controller/engine_cycle/ignition.c ****         spark_is_in_progress = true;
 226:controller/engine_cycle/ignition.c ****         runtime.multi_spark_actual_spark_count = number_of_scheduled_sparks;
 227:controller/engine_cycle/ignition.c ****     }
 228:controller/engine_cycle/ignition.c **** }
 229:controller/engine_cycle/ignition.c **** 
 230:controller/engine_cycle/ignition.c **** /**
 231:controller/engine_cycle/ignition.c ****  * @brief Charges the ignition coil at the specified index.
 232:controller/engine_cycle/ignition.c ****  *
 233:controller/engine_cycle/ignition.c ****  * @param coil_index The index of the coil to be charged.
 234:controller/engine_cycle/ignition.c ****  */
 235:controller/engine_cycle/ignition.c **** void ignition_coil_begin_charge(void *arg)
 236:controller/engine_cycle/ignition.c **** {
  34              		.loc 1 236 1 view -0
  35              		.cfi_startproc
  36              		@ args = 0, pretend = 0, frame = 0
  37              		@ frame_needed = 0, uses_anonymous_args = 0
 237:controller/engine_cycle/ignition.c ****     if (arg == NULL)
  38              		.loc 1 237 5 view .LVU1
  39              		.loc 1 237 8 is_stmt 0 view .LVU2
  40 0000 30B3     		cbz	r0, .L6
 236:controller/engine_cycle/ignition.c ****     if (arg == NULL)
  41              		.loc 1 236 1 view .LVU3
  42 0002 70B5     		push	{r4, r5, r6, lr}
  43              		.cfi_def_cfa_offset 16
  44              		.cfi_offset 4, -16
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 6


  45              		.cfi_offset 5, -12
  46              		.cfi_offset 6, -8
  47              		.cfi_offset 14, -4
  48 0004 0446     		mov	r4, r0
 238:controller/engine_cycle/ignition.c ****     {
 239:controller/engine_cycle/ignition.c ****         return;
 240:controller/engine_cycle/ignition.c ****     }
 241:controller/engine_cycle/ignition.c ****     uint8_t *coil_index = (uint8_t *)arg;
  49              		.loc 1 241 5 is_stmt 1 view .LVU4
  50              	.LVL1:
 242:controller/engine_cycle/ignition.c **** 
 243:controller/engine_cycle/ignition.c ****     if (coil_index[1] > FIRMWARE_IGNITION_OUTPUT_COUNT - 1 || coil_index[0] > FIRMWARE_IGNITION_OUT
  51              		.loc 1 243 5 view .LVU5
  52              		.loc 1 243 19 is_stmt 0 view .LVU6
  53 0006 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
  54              		.loc 1 243 8 view .LVU7
  55 0008 032B     		cmp	r3, #3
  56 000a 02D8     		bhi	.L3
  57              		.loc 1 243 73 discriminator 1 view .LVU8
  58 000c 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
  59              		.loc 1 243 60 discriminator 1 view .LVU9
  60 000e 032B     		cmp	r3, #3
  61 0010 03D9     		bls	.L4
  62              	.L3:
 244:controller/engine_cycle/ignition.c ****     {
 245:controller/engine_cycle/ignition.c ****         log_error("Unkown ignition output");
  63              		.loc 1 245 9 is_stmt 1 view .LVU10
  64 0012 1048     		ldr	r0, .L9
  65              	.LVL2:
  66              		.loc 1 245 9 is_stmt 0 view .LVU11
  67 0014 FFF7FEFF 		bl	log_error
  68              	.LVL3:
 246:controller/engine_cycle/ignition.c ****         return;
  69              		.loc 1 246 9 is_stmt 1 view .LVU12
  70              	.L1:
 247:controller/engine_cycle/ignition.c ****     }
 248:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[0]] = IGNITION_COIL_STATE_CHARGING;
 249:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[1]] = IGNITION_COIL_STATE_CHARGING;
 250:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
 251:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
 252:controller/engine_cycle/ignition.c **** }
  71              		.loc 1 252 1 is_stmt 0 view .LVU13
  72 0018 70BD     		pop	{r4, r5, r6, pc}
  73              	.LVL4:
  74              	.L4:
 248:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[1]] = IGNITION_COIL_STATE_CHARGING;
  75              		.loc 1 248 5 is_stmt 1 view .LVU14
 248:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[1]] = IGNITION_COIL_STATE_CHARGING;
  76              		.loc 1 248 40 is_stmt 0 view .LVU15
  77 001a 0F4A     		ldr	r2, .L9+4
  78 001c 0125     		movs	r5, #1
  79 001e D554     		strb	r5, [r2, r3]
 249:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
  80              		.loc 1 249 5 is_stmt 1 view .LVU16
 249:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
  81              		.loc 1 249 35 is_stmt 0 view .LVU17
  82 0020 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 7


 249:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
  83              		.loc 1 249 40 view .LVU18
  84 0022 D554     		strb	r5, [r2, r3]
 250:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
  85              		.loc 1 250 5 is_stmt 1 view .LVU19
 250:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
  86              		.loc 1 250 50 is_stmt 0 view .LVU20
  87 0024 0078     		ldrb	r0, [r0]	@ zero_extendqisi2
  88              	.LVL5:
 250:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
  89              		.loc 1 250 39 view .LVU21
  90 0026 0D4E     		ldr	r6, .L9+8
  91 0028 3368     		ldr	r3, [r6]
  92 002a 03EBC001 		add	r1, r3, r0, lsl #3
 250:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
  93              		.loc 1 250 5 view .LVU22
  94 002e 2A46     		mov	r2, r5
  95 0030 8988     		ldrh	r1, [r1, #4]
  96 0032 53F83000 		ldr	r0, [r3, r0, lsl #3]
  97 0036 FFF7FEFF 		bl	HAL_GPIO_WritePin
  98              	.LVL6:
 251:controller/engine_cycle/ignition.c **** }
  99              		.loc 1 251 5 is_stmt 1 view .LVU23
 251:controller/engine_cycle/ignition.c **** }
 100              		.loc 1 251 50 is_stmt 0 view .LVU24
 101 003a 6078     		ldrb	r0, [r4, #1]	@ zero_extendqisi2
 251:controller/engine_cycle/ignition.c **** }
 102              		.loc 1 251 39 view .LVU25
 103 003c 3368     		ldr	r3, [r6]
 104 003e 03EBC001 		add	r1, r3, r0, lsl #3
 251:controller/engine_cycle/ignition.c **** }
 105              		.loc 1 251 5 view .LVU26
 106 0042 2A46     		mov	r2, r5
 107 0044 8988     		ldrh	r1, [r1, #4]
 108 0046 53F83000 		ldr	r0, [r3, r0, lsl #3]
 109 004a FFF7FEFF 		bl	HAL_GPIO_WritePin
 110              	.LVL7:
 111 004e E3E7     		b	.L1
 112              	.LVL8:
 113              	.L6:
 114              		.cfi_def_cfa_offset 0
 115              		.cfi_restore 4
 116              		.cfi_restore 5
 117              		.cfi_restore 6
 118              		.cfi_restore 14
 251:controller/engine_cycle/ignition.c **** }
 119              		.loc 1 251 5 view .LVU27
 120 0050 7047     		bx	lr
 121              	.L10:
 122 0052 00BF     		.align	2
 123              	.L9:
 124 0054 00000000 		.word	.LC0
 125 0058 00000000 		.word	ignition_coil_state
 126 005c 00000000 		.word	ignition_outputs
 127              		.cfi_endproc
 128              	.LFE234:
 130              		.section	.text.ignition_coil_fire_spark,"ax",%progbits
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 8


 131              		.align	1
 132              		.global	ignition_coil_fire_spark
 133              		.syntax unified
 134              		.thumb
 135              		.thumb_func
 137              	ignition_coil_fire_spark:
 138              	.LVL9:
 139              	.LFB235:
 253:controller/engine_cycle/ignition.c **** 
 254:controller/engine_cycle/ignition.c **** /**
 255:controller/engine_cycle/ignition.c ****  * @brief Fires a spark from the ignition coil at the specified index.
 256:controller/engine_cycle/ignition.c ****  *
 257:controller/engine_cycle/ignition.c ****  * @param coil_index The index of the coil to fire the spark from.
 258:controller/engine_cycle/ignition.c ****  */
 259:controller/engine_cycle/ignition.c **** void ignition_coil_fire_spark(void *arg)
 260:controller/engine_cycle/ignition.c **** {
 140              		.loc 1 260 1 is_stmt 1 view -0
 141              		.cfi_startproc
 142              		@ args = 0, pretend = 0, frame = 0
 143              		@ frame_needed = 0, uses_anonymous_args = 0
 261:controller/engine_cycle/ignition.c ****     if (arg == NULL)
 144              		.loc 1 261 5 view .LVU29
 145              		.loc 1 261 8 is_stmt 0 view .LVU30
 146 0000 40B3     		cbz	r0, .L16
 260:controller/engine_cycle/ignition.c ****     if (arg == NULL)
 147              		.loc 1 260 1 view .LVU31
 148 0002 70B5     		push	{r4, r5, r6, lr}
 149              		.cfi_def_cfa_offset 16
 150              		.cfi_offset 4, -16
 151              		.cfi_offset 5, -12
 152              		.cfi_offset 6, -8
 153              		.cfi_offset 14, -4
 154 0004 0446     		mov	r4, r0
 262:controller/engine_cycle/ignition.c ****     {
 263:controller/engine_cycle/ignition.c ****         return;
 264:controller/engine_cycle/ignition.c ****     }
 265:controller/engine_cycle/ignition.c **** 
 266:controller/engine_cycle/ignition.c ****     uint8_t *coil_index = (uint8_t *)arg;
 155              		.loc 1 266 5 is_stmt 1 view .LVU32
 156              	.LVL10:
 267:controller/engine_cycle/ignition.c ****     if (coil_index[1] > FIRMWARE_IGNITION_OUTPUT_COUNT - 1 || coil_index[0] > FIRMWARE_IGNITION_OUT
 157              		.loc 1 267 5 view .LVU33
 158              		.loc 1 267 19 is_stmt 0 view .LVU34
 159 0006 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
 160              		.loc 1 267 8 view .LVU35
 161 0008 032B     		cmp	r3, #3
 162 000a 02D8     		bhi	.L13
 163              		.loc 1 267 73 discriminator 1 view .LVU36
 164 000c 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
 165              		.loc 1 267 60 discriminator 1 view .LVU37
 166 000e 032B     		cmp	r3, #3
 167 0010 03D9     		bls	.L14
 168              	.L13:
 268:controller/engine_cycle/ignition.c ****     {
 269:controller/engine_cycle/ignition.c ****         log_error("Unkown ignition output");
 169              		.loc 1 269 9 is_stmt 1 view .LVU38
 170 0012 1148     		ldr	r0, .L19
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 9


 171              	.LVL11:
 172              		.loc 1 269 9 is_stmt 0 view .LVU39
 173 0014 FFF7FEFF 		bl	log_error
 174              	.LVL12:
 270:controller/engine_cycle/ignition.c ****         return;
 175              		.loc 1 270 9 is_stmt 1 view .LVU40
 176              	.L11:
 271:controller/engine_cycle/ignition.c ****     }
 272:controller/engine_cycle/ignition.c **** 
 273:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[0]] = IGNITION_COIL_STATE_NOT_CHARGING;
 274:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[1]] = IGNITION_COIL_STATE_NOT_CHARGING;
 275:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
 276:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
 277:controller/engine_cycle/ignition.c ****     spark_is_in_progress = false;
 278:controller/engine_cycle/ignition.c **** }
 177              		.loc 1 278 1 is_stmt 0 view .LVU41
 178 0018 70BD     		pop	{r4, r5, r6, pc}
 179              	.LVL13:
 180              	.L14:
 273:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[1]] = IGNITION_COIL_STATE_NOT_CHARGING;
 181              		.loc 1 273 5 is_stmt 1 view .LVU42
 273:controller/engine_cycle/ignition.c ****     ignition_coil_state[coil_index[1]] = IGNITION_COIL_STATE_NOT_CHARGING;
 182              		.loc 1 273 40 is_stmt 0 view .LVU43
 183 001a 104A     		ldr	r2, .L19+4
 184 001c 0025     		movs	r5, #0
 185 001e D554     		strb	r5, [r2, r3]
 274:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
 186              		.loc 1 274 5 is_stmt 1 view .LVU44
 274:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
 187              		.loc 1 274 35 is_stmt 0 view .LVU45
 188 0020 4378     		ldrb	r3, [r0, #1]	@ zero_extendqisi2
 274:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[0]].gpio, ignition_outputs[coil_index[0]].pin, GP
 189              		.loc 1 274 40 view .LVU46
 190 0022 D554     		strb	r5, [r2, r3]
 275:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
 191              		.loc 1 275 5 is_stmt 1 view .LVU47
 275:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
 192              		.loc 1 275 50 is_stmt 0 view .LVU48
 193 0024 0078     		ldrb	r0, [r0]	@ zero_extendqisi2
 194              	.LVL14:
 275:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
 195              		.loc 1 275 39 view .LVU49
 196 0026 0E4E     		ldr	r6, .L19+8
 197 0028 3368     		ldr	r3, [r6]
 198 002a 03EBC001 		add	r1, r3, r0, lsl #3
 275:controller/engine_cycle/ignition.c ****     HAL_GPIO_WritePin(ignition_outputs[coil_index[1]].gpio, ignition_outputs[coil_index[1]].pin, GP
 199              		.loc 1 275 5 view .LVU50
 200 002e 2A46     		mov	r2, r5
 201 0030 8988     		ldrh	r1, [r1, #4]
 202 0032 53F83000 		ldr	r0, [r3, r0, lsl #3]
 203 0036 FFF7FEFF 		bl	HAL_GPIO_WritePin
 204              	.LVL15:
 276:controller/engine_cycle/ignition.c ****     spark_is_in_progress = false;
 205              		.loc 1 276 5 is_stmt 1 view .LVU51
 276:controller/engine_cycle/ignition.c ****     spark_is_in_progress = false;
 206              		.loc 1 276 50 is_stmt 0 view .LVU52
 207 003a 6078     		ldrb	r0, [r4, #1]	@ zero_extendqisi2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 10


 276:controller/engine_cycle/ignition.c ****     spark_is_in_progress = false;
 208              		.loc 1 276 39 view .LVU53
 209 003c 3368     		ldr	r3, [r6]
 210 003e 03EBC001 		add	r1, r3, r0, lsl #3
 276:controller/engine_cycle/ignition.c ****     spark_is_in_progress = false;
 211              		.loc 1 276 5 view .LVU54
 212 0042 2A46     		mov	r2, r5
 213 0044 8988     		ldrh	r1, [r1, #4]
 214 0046 53F83000 		ldr	r0, [r3, r0, lsl #3]
 215 004a FFF7FEFF 		bl	HAL_GPIO_WritePin
 216              	.LVL16:
 277:controller/engine_cycle/ignition.c **** }
 217              		.loc 1 277 5 is_stmt 1 view .LVU55
 277:controller/engine_cycle/ignition.c **** }
 218              		.loc 1 277 26 is_stmt 0 view .LVU56
 219 004e 054B     		ldr	r3, .L19+12
 220 0050 1D70     		strb	r5, [r3]
 221 0052 E1E7     		b	.L11
 222              	.LVL17:
 223              	.L16:
 224              		.cfi_def_cfa_offset 0
 225              		.cfi_restore 4
 226              		.cfi_restore 5
 227              		.cfi_restore 6
 228              		.cfi_restore 14
 277:controller/engine_cycle/ignition.c **** }
 229              		.loc 1 277 26 view .LVU57
 230 0054 7047     		bx	lr
 231              	.L20:
 232 0056 00BF     		.align	2
 233              	.L19:
 234 0058 00000000 		.word	.LC0
 235 005c 00000000 		.word	ignition_coil_state
 236 0060 00000000 		.word	ignition_outputs
 237 0064 00000000 		.word	spark_is_in_progress
 238              		.cfi_endproc
 239              	.LFE235:
 241              		.section	.rodata.ignition_init.str1.4,"aMS",%progbits,1
 242              		.align	2
 243              	.LC1:
 244 0000 69676E69 		.ascii	"ignition init failed. No output config\000"
 244      74696F6E 
 244      20696E69 
 244      74206661 
 244      696C6564 
 245 0027 00       		.align	2
 246              	.LC2:
 247 0028 69676E69 		.ascii	"ignition init failed. unkown mode.\000"
 247      74696F6E 
 247      20696E69 
 247      74206661 
 247      696C6564 
 248 004b 00       		.align	2
 249              	.LC3:
 250 004c 436F696C 		.ascii	"Coil on plug igntion not possible with 6 cylinders."
 250      206F6E20 
 250      706C7567 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 11


 250      2069676E 
 250      74696F6E 
 251 007f 20446566 		.ascii	" Defaulted to wasted spark\000"
 251      61756C74 
 251      65642074 
 251      6F207761 
 251      73746564 
 252 009a 0000     		.align	2
 253              	.LC4:
 254 009c 69676E69 		.ascii	"ignition init failed. unkown firing order.\000"
 254      74696F6E 
 254      20696E69 
 254      74206661 
 254      696C6564 
 255 00c7 00       		.align	2
 256              	.LC5:
 257 00c8 4D756C74 		.ascii	"Multi spark is enabled but number of sparks are 0.\000"
 257      69207370 
 257      61726B20 
 257      69732065 
 257      6E61626C 
 258              		.section	.text.ignition_init,"ax",%progbits
 259              		.align	1
 260              		.global	ignition_init
 261              		.syntax unified
 262              		.thumb
 263              		.thumb_func
 265              	ignition_init:
 266              	.LVL18:
 267              	.LFB232:
  14:controller/engine_cycle/ignition.c ****     if (outputs == NULL)
 268              		.loc 1 14 1 is_stmt 1 view -0
 269              		.cfi_startproc
 270              		@ args = 0, pretend = 0, frame = 0
 271              		@ frame_needed = 0, uses_anonymous_args = 0
  14:controller/engine_cycle/ignition.c ****     if (outputs == NULL)
 272              		.loc 1 14 1 is_stmt 0 view .LVU59
 273 0000 10B5     		push	{r4, lr}
 274              		.cfi_def_cfa_offset 8
 275              		.cfi_offset 4, -8
 276              		.cfi_offset 14, -4
  15:controller/engine_cycle/ignition.c ****     {
 277              		.loc 1 15 5 is_stmt 1 view .LVU60
  15:controller/engine_cycle/ignition.c ****     {
 278              		.loc 1 15 8 is_stmt 0 view .LVU61
 279 0002 58B1     		cbz	r0, .L39
  20:controller/engine_cycle/ignition.c **** 
 280              		.loc 1 20 5 is_stmt 1 view .LVU62
  20:controller/engine_cycle/ignition.c **** 
 281              		.loc 1 20 22 is_stmt 0 view .LVU63
 282 0004 4F4A     		ldr	r2, .L40
 283 0006 1060     		str	r0, [r2]
  22:controller/engine_cycle/ignition.c ****     {
 284              		.loc 1 22 5 is_stmt 1 view .LVU64
  22:controller/engine_cycle/ignition.c ****     {
 285              		.loc 1 22 19 is_stmt 0 view .LVU65
 286 0008 4F4B     		ldr	r3, .L40+4
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 12


 287 000a 93F89832 		ldrb	r3, [r3, #664]	@ zero_extendqisi2
  22:controller/engine_cycle/ignition.c ****     {
 288              		.loc 1 22 5 view .LVU66
 289 000e 4BB1     		cbz	r3, .L24
 290 0010 012B     		cmp	r3, #1
 291 0012 34D0     		beq	.L25
 292              	.LVL19:
 293              	.L26:
  90:controller/engine_cycle/ignition.c ****         return;
 294              		.loc 1 90 9 is_stmt 1 view .LVU67
 295 0014 4D48     		ldr	r0, .L40+8
 296 0016 FFF7FEFF 		bl	log_error
 297              	.LVL20:
  91:controller/engine_cycle/ignition.c ****     }
 298              		.loc 1 91 9 view .LVU68
 299              	.L21:
 111:controller/engine_cycle/ignition.c **** 
 300              		.loc 1 111 1 is_stmt 0 view .LVU69
 301 001a 10BD     		pop	{r4, pc}
 302              	.LVL21:
 303              	.L39:
  17:controller/engine_cycle/ignition.c ****         return;
 304              		.loc 1 17 9 is_stmt 1 view .LVU70
 305 001c 4C48     		ldr	r0, .L40+12
 306              	.LVL22:
  17:controller/engine_cycle/ignition.c ****         return;
 307              		.loc 1 17 9 is_stmt 0 view .LVU71
 308 001e FFF7FEFF 		bl	log_error
 309              	.LVL23:
  18:controller/engine_cycle/ignition.c ****     }
 310              		.loc 1 18 9 is_stmt 1 view .LVU72
 311 0022 FAE7     		b	.L21
 312              	.LVL24:
 313              	.L24:
  25:controller/engine_cycle/ignition.c ****         switch (config.ignition_mode)
 314              		.loc 1 25 9 view .LVU73
  25:controller/engine_cycle/ignition.c ****         switch (config.ignition_mode)
 315              		.loc 1 25 29 is_stmt 0 view .LVU74
 316 0024 4B4B     		ldr	r3, .L40+16
 317 0026 0422     		movs	r2, #4
 318 0028 1A70     		strb	r2, [r3]
  26:controller/engine_cycle/ignition.c ****         {
 319              		.loc 1 26 9 is_stmt 1 view .LVU75
  26:controller/engine_cycle/ignition.c ****         {
 320              		.loc 1 26 23 is_stmt 0 view .LVU76
 321 002a 474B     		ldr	r3, .L40+4
 322 002c 93F8A132 		ldrb	r3, [r3, #673]	@ zero_extendqisi2
  26:controller/engine_cycle/ignition.c ****         {
 323              		.loc 1 26 9 view .LVU77
 324 0030 022B     		cmp	r3, #2
 325 0032 16D0     		beq	.L27
 326 0034 032B     		cmp	r3, #3
 327 0036 0CD0     		beq	.L28
 328 0038 012B     		cmp	r3, #1
 329 003a 1CD1     		bne	.L29
  29:controller/engine_cycle/ignition.c ****             ignition_order[1] = 1;
 330              		.loc 1 29 13 is_stmt 1 view .LVU78
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 13


  29:controller/engine_cycle/ignition.c ****             ignition_order[1] = 1;
 331              		.loc 1 29 31 is_stmt 0 view .LVU79
 332 003c 464B     		ldr	r3, .L40+20
 333 003e 0122     		movs	r2, #1
 334 0040 1A70     		strb	r2, [r3]
  30:controller/engine_cycle/ignition.c ****             ignition_order[2] = 1;
 335              		.loc 1 30 13 is_stmt 1 view .LVU80
  30:controller/engine_cycle/ignition.c ****             ignition_order[2] = 1;
 336              		.loc 1 30 31 is_stmt 0 view .LVU81
 337 0042 5A70     		strb	r2, [r3, #1]
  31:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
 338              		.loc 1 31 13 is_stmt 1 view .LVU82
  31:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
 339              		.loc 1 31 31 is_stmt 0 view .LVU83
 340 0044 9A70     		strb	r2, [r3, #2]
  32:controller/engine_cycle/ignition.c ****             break;
 341              		.loc 1 32 13 is_stmt 1 view .LVU84
  32:controller/engine_cycle/ignition.c ****             break;
 342              		.loc 1 32 31 is_stmt 0 view .LVU85
 343 0046 DA70     		strb	r2, [r3, #3]
  33:controller/engine_cycle/ignition.c ****         case IM_WASTED_SPARK:
 344              		.loc 1 33 13 is_stmt 1 view .LVU86
 345              	.L30:
  52:controller/engine_cycle/ignition.c ****     case FO_153624: // Common inline-6
 346              		.loc 1 52 9 view .LVU87
  94:controller/engine_cycle/ignition.c **** 
 347              		.loc 1 94 5 view .LVU88
  94:controller/engine_cycle/ignition.c **** 
 348              		.loc 1 94 33 is_stmt 0 view .LVU89
 349 0048 444B     		ldr	r3, .L40+24
 350 004a 454A     		ldr	r2, .L40+28
 351 004c 1A62     		str	r2, [r3, #32]	@ float
  97:controller/engine_cycle/ignition.c ****     {
 352              		.loc 1 97 5 is_stmt 1 view .LVU90
 353              	.LBB14:
  97:controller/engine_cycle/ignition.c ****     {
 354              		.loc 1 97 10 view .LVU91
 355              	.LVL25:
  97:controller/engine_cycle/ignition.c ****     {
 356              		.loc 1 97 17 is_stmt 0 view .LVU92
 357 004e 0024     		movs	r4, #0
  97:controller/engine_cycle/ignition.c ****     {
 358              		.loc 1 97 5 view .LVU93
 359 0050 56E0     		b	.L34
 360              	.LVL26:
 361              	.L28:
  97:controller/engine_cycle/ignition.c ****     {
 362              		.loc 1 97 5 view .LVU94
 363              	.LBE14:
  35:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
 364              		.loc 1 35 13 is_stmt 1 view .LVU95
  35:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
 365              		.loc 1 35 31 is_stmt 0 view .LVU96
 366 0052 414B     		ldr	r3, .L40+20
 367 0054 0122     		movs	r2, #1
 368 0056 1A70     		strb	r2, [r3]
  36:controller/engine_cycle/ignition.c ****             ignition_order[2] = 2;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 14


 369              		.loc 1 36 13 is_stmt 1 view .LVU97
  36:controller/engine_cycle/ignition.c ****             ignition_order[2] = 2;
 370              		.loc 1 36 31 is_stmt 0 view .LVU98
 371 0058 0221     		movs	r1, #2
 372 005a 5970     		strb	r1, [r3, #1]
  37:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
 373              		.loc 1 37 13 is_stmt 1 view .LVU99
  37:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
 374              		.loc 1 37 31 is_stmt 0 view .LVU100
 375 005c 9970     		strb	r1, [r3, #2]
  38:controller/engine_cycle/ignition.c ****             break;
 376              		.loc 1 38 13 is_stmt 1 view .LVU101
  38:controller/engine_cycle/ignition.c ****             break;
 377              		.loc 1 38 31 is_stmt 0 view .LVU102
 378 005e DA70     		strb	r2, [r3, #3]
  39:controller/engine_cycle/ignition.c ****         case IM_INDIVIDUAL_COILS:
 379              		.loc 1 39 13 is_stmt 1 view .LVU103
 380 0060 F2E7     		b	.L30
 381              	.L27:
  41:controller/engine_cycle/ignition.c ****             ignition_order[1] = 3;
 382              		.loc 1 41 13 view .LVU104
  41:controller/engine_cycle/ignition.c ****             ignition_order[1] = 3;
 383              		.loc 1 41 31 is_stmt 0 view .LVU105
 384 0062 3D4B     		ldr	r3, .L40+20
 385 0064 0122     		movs	r2, #1
 386 0066 1A70     		strb	r2, [r3]
  42:controller/engine_cycle/ignition.c ****             ignition_order[2] = 4;
 387              		.loc 1 42 13 is_stmt 1 view .LVU106
  42:controller/engine_cycle/ignition.c ****             ignition_order[2] = 4;
 388              		.loc 1 42 31 is_stmt 0 view .LVU107
 389 0068 0322     		movs	r2, #3
 390 006a 5A70     		strb	r2, [r3, #1]
  43:controller/engine_cycle/ignition.c ****             ignition_order[3] = 2;
 391              		.loc 1 43 13 is_stmt 1 view .LVU108
  43:controller/engine_cycle/ignition.c ****             ignition_order[3] = 2;
 392              		.loc 1 43 31 is_stmt 0 view .LVU109
 393 006c 0422     		movs	r2, #4
 394 006e 9A70     		strb	r2, [r3, #2]
  44:controller/engine_cycle/ignition.c ****             break;
 395              		.loc 1 44 13 is_stmt 1 view .LVU110
  44:controller/engine_cycle/ignition.c ****             break;
 396              		.loc 1 44 31 is_stmt 0 view .LVU111
 397 0070 0222     		movs	r2, #2
 398 0072 DA70     		strb	r2, [r3, #3]
  45:controller/engine_cycle/ignition.c **** 
 399              		.loc 1 45 13 is_stmt 1 view .LVU112
 400 0074 E8E7     		b	.L30
 401              	.L29:
  48:controller/engine_cycle/ignition.c ****             return;
 402              		.loc 1 48 13 view .LVU113
 403 0076 3B48     		ldr	r0, .L40+32
 404              	.LVL27:
  48:controller/engine_cycle/ignition.c ****             return;
 405              		.loc 1 48 13 is_stmt 0 view .LVU114
 406 0078 FFF7FEFF 		bl	log_error
 407              	.LVL28:
  49:controller/engine_cycle/ignition.c ****         }
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 15


 408              		.loc 1 49 13 is_stmt 1 view .LVU115
 409 007c CDE7     		b	.L21
 410              	.LVL29:
 411              	.L25:
  54:controller/engine_cycle/ignition.c ****         switch (config.ignition_mode)
 412              		.loc 1 54 9 view .LVU116
  54:controller/engine_cycle/ignition.c ****         switch (config.ignition_mode)
 413              		.loc 1 54 29 is_stmt 0 view .LVU117
 414 007e 354B     		ldr	r3, .L40+16
 415 0080 0622     		movs	r2, #6
 416 0082 1A70     		strb	r2, [r3]
  55:controller/engine_cycle/ignition.c ****         {
 417              		.loc 1 55 9 is_stmt 1 view .LVU118
  55:controller/engine_cycle/ignition.c ****         {
 418              		.loc 1 55 23 is_stmt 0 view .LVU119
 419 0084 304B     		ldr	r3, .L40+4
 420 0086 93F8A132 		ldrb	r3, [r3, #673]	@ zero_extendqisi2
  55:controller/engine_cycle/ignition.c ****         {
 421              		.loc 1 55 9 view .LVU120
 422 008a 022B     		cmp	r3, #2
 423 008c 17D0     		beq	.L31
 424 008e 032B     		cmp	r3, #3
 425 0090 0AD0     		beq	.L32
 426 0092 012B     		cmp	r3, #1
 427 0094 24D1     		bne	.L33
  58:controller/engine_cycle/ignition.c ****             ignition_order[1] = 1;
 428              		.loc 1 58 13 is_stmt 1 view .LVU121
  58:controller/engine_cycle/ignition.c ****             ignition_order[1] = 1;
 429              		.loc 1 58 31 is_stmt 0 view .LVU122
 430 0096 304B     		ldr	r3, .L40+20
 431 0098 0122     		movs	r2, #1
 432 009a 1A70     		strb	r2, [r3]
  59:controller/engine_cycle/ignition.c ****             ignition_order[2] = 1;
 433              		.loc 1 59 13 is_stmt 1 view .LVU123
  59:controller/engine_cycle/ignition.c ****             ignition_order[2] = 1;
 434              		.loc 1 59 31 is_stmt 0 view .LVU124
 435 009c 5A70     		strb	r2, [r3, #1]
  60:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
 436              		.loc 1 60 13 is_stmt 1 view .LVU125
  60:controller/engine_cycle/ignition.c ****             ignition_order[3] = 1;
 437              		.loc 1 60 31 is_stmt 0 view .LVU126
 438 009e 9A70     		strb	r2, [r3, #2]
  61:controller/engine_cycle/ignition.c ****             ignition_order[4] = 1;
 439              		.loc 1 61 13 is_stmt 1 view .LVU127
  61:controller/engine_cycle/ignition.c ****             ignition_order[4] = 1;
 440              		.loc 1 61 31 is_stmt 0 view .LVU128
 441 00a0 DA70     		strb	r2, [r3, #3]
  62:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
 442              		.loc 1 62 13 is_stmt 1 view .LVU129
  62:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
 443              		.loc 1 62 31 is_stmt 0 view .LVU130
 444 00a2 1A71     		strb	r2, [r3, #4]
  63:controller/engine_cycle/ignition.c ****             break;
 445              		.loc 1 63 13 is_stmt 1 view .LVU131
  63:controller/engine_cycle/ignition.c ****             break;
 446              		.loc 1 63 31 is_stmt 0 view .LVU132
 447 00a4 5A71     		strb	r2, [r3, #5]
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 16


  64:controller/engine_cycle/ignition.c ****         case IM_WASTED_SPARK:
 448              		.loc 1 64 13 is_stmt 1 view .LVU133
 449 00a6 B5E7     		b	.L26
 450              	.L32:
  66:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
 451              		.loc 1 66 13 view .LVU134
  66:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
 452              		.loc 1 66 31 is_stmt 0 view .LVU135
 453 00a8 2B4B     		ldr	r3, .L40+20
 454 00aa 0122     		movs	r2, #1
 455 00ac 1A70     		strb	r2, [r3]
  67:controller/engine_cycle/ignition.c ****             ignition_order[2] = 3;
 456              		.loc 1 67 13 is_stmt 1 view .LVU136
  67:controller/engine_cycle/ignition.c ****             ignition_order[2] = 3;
 457              		.loc 1 67 31 is_stmt 0 view .LVU137
 458 00ae 0221     		movs	r1, #2
 459 00b0 5970     		strb	r1, [r3, #1]
  68:controller/engine_cycle/ignition.c ****             ignition_order[3] = 3;
 460              		.loc 1 68 13 is_stmt 1 view .LVU138
  68:controller/engine_cycle/ignition.c ****             ignition_order[3] = 3;
 461              		.loc 1 68 31 is_stmt 0 view .LVU139
 462 00b2 0320     		movs	r0, #3
 463              	.LVL30:
  68:controller/engine_cycle/ignition.c ****             ignition_order[3] = 3;
 464              		.loc 1 68 31 view .LVU140
 465 00b4 9870     		strb	r0, [r3, #2]
  69:controller/engine_cycle/ignition.c ****             ignition_order[4] = 2;
 466              		.loc 1 69 13 is_stmt 1 view .LVU141
  69:controller/engine_cycle/ignition.c ****             ignition_order[4] = 2;
 467              		.loc 1 69 31 is_stmt 0 view .LVU142
 468 00b6 D870     		strb	r0, [r3, #3]
  70:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
 469              		.loc 1 70 13 is_stmt 1 view .LVU143
  70:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
 470              		.loc 1 70 31 is_stmt 0 view .LVU144
 471 00b8 1971     		strb	r1, [r3, #4]
  71:controller/engine_cycle/ignition.c ****             break;
 472              		.loc 1 71 13 is_stmt 1 view .LVU145
  71:controller/engine_cycle/ignition.c ****             break;
 473              		.loc 1 71 31 is_stmt 0 view .LVU146
 474 00ba 5A71     		strb	r2, [r3, #5]
  72:controller/engine_cycle/ignition.c ****         case IM_INDIVIDUAL_COILS:
 475              		.loc 1 72 13 is_stmt 1 view .LVU147
 476 00bc AAE7     		b	.L26
 477              	.LVL31:
 478              	.L31:
  74:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
 479              		.loc 1 74 13 view .LVU148
  74:controller/engine_cycle/ignition.c ****             ignition_order[0] = 1;
 480              		.loc 1 74 34 is_stmt 0 view .LVU149
 481 00be 0322     		movs	r2, #3
 482 00c0 214B     		ldr	r3, .L40+4
 483 00c2 83F8A122 		strb	r2, [r3, #673]
  75:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
 484              		.loc 1 75 13 is_stmt 1 view .LVU150
  75:controller/engine_cycle/ignition.c ****             ignition_order[1] = 2;
 485              		.loc 1 75 31 is_stmt 0 view .LVU151
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 17


 486 00c6 244B     		ldr	r3, .L40+20
 487 00c8 0121     		movs	r1, #1
 488 00ca 1970     		strb	r1, [r3]
  76:controller/engine_cycle/ignition.c ****             ignition_order[2] = 3;
 489              		.loc 1 76 13 is_stmt 1 view .LVU152
  76:controller/engine_cycle/ignition.c ****             ignition_order[2] = 3;
 490              		.loc 1 76 31 is_stmt 0 view .LVU153
 491 00cc 0220     		movs	r0, #2
 492              	.LVL32:
  76:controller/engine_cycle/ignition.c ****             ignition_order[2] = 3;
 493              		.loc 1 76 31 view .LVU154
 494 00ce 5870     		strb	r0, [r3, #1]
  77:controller/engine_cycle/ignition.c ****             ignition_order[3] = 3;
 495              		.loc 1 77 13 is_stmt 1 view .LVU155
  77:controller/engine_cycle/ignition.c ****             ignition_order[3] = 3;
 496              		.loc 1 77 31 is_stmt 0 view .LVU156
 497 00d0 9A70     		strb	r2, [r3, #2]
  78:controller/engine_cycle/ignition.c ****             ignition_order[4] = 2;
 498              		.loc 1 78 13 is_stmt 1 view .LVU157
  78:controller/engine_cycle/ignition.c ****             ignition_order[4] = 2;
 499              		.loc 1 78 31 is_stmt 0 view .LVU158
 500 00d2 DA70     		strb	r2, [r3, #3]
  79:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
 501              		.loc 1 79 13 is_stmt 1 view .LVU159
  79:controller/engine_cycle/ignition.c ****             ignition_order[5] = 1;
 502              		.loc 1 79 31 is_stmt 0 view .LVU160
 503 00d4 1871     		strb	r0, [r3, #4]
  80:controller/engine_cycle/ignition.c ****             log_warning("Coil on plug igntion not possible with 6 cylinders. Defaulted to wasted sp
 504              		.loc 1 80 13 is_stmt 1 view .LVU161
  80:controller/engine_cycle/ignition.c ****             log_warning("Coil on plug igntion not possible with 6 cylinders. Defaulted to wasted sp
 505              		.loc 1 80 31 is_stmt 0 view .LVU162
 506 00d6 5971     		strb	r1, [r3, #5]
  81:controller/engine_cycle/ignition.c ****             break;
 507              		.loc 1 81 13 is_stmt 1 view .LVU163
 508 00d8 2348     		ldr	r0, .L40+36
 509 00da FFF7FEFF 		bl	log_warning
 510              	.LVL33:
  82:controller/engine_cycle/ignition.c **** 
 511              		.loc 1 82 13 view .LVU164
 512 00de 99E7     		b	.L26
 513              	.LVL34:
 514              	.L33:
  85:controller/engine_cycle/ignition.c ****             return;
 515              		.loc 1 85 13 view .LVU165
 516 00e0 2048     		ldr	r0, .L40+32
 517              	.LVL35:
  85:controller/engine_cycle/ignition.c ****             return;
 518              		.loc 1 85 13 is_stmt 0 view .LVU166
 519 00e2 FFF7FEFF 		bl	log_error
 520              	.LVL36:
  86:controller/engine_cycle/ignition.c ****         }
 521              		.loc 1 86 13 is_stmt 1 view .LVU167
 522 00e6 98E7     		b	.L21
 523              	.LVL37:
 524              	.L35:
 525              	.LBB15:
  99:controller/engine_cycle/ignition.c ****     }
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 18


 526              		.loc 1 99 9 view .LVU168
  99:controller/engine_cycle/ignition.c ****     }
 527              		.loc 1 99 67 is_stmt 0 view .LVU169
 528 00e8 164B     		ldr	r3, .L40
 529 00ea 1B68     		ldr	r3, [r3]
 530 00ec 03EBC402 		add	r2, r3, r4, lsl #3
  99:controller/engine_cycle/ignition.c ****     }
 531              		.loc 1 99 34 view .LVU170
 532 00f0 9188     		ldrh	r1, [r2, #4]
 533 00f2 53F83400 		ldr	r0, [r3, r4, lsl #3]
 534 00f6 FFF7FEFF 		bl	HAL_GPIO_ReadPin
 535              	.LVL38:
  99:controller/engine_cycle/ignition.c ****     }
 536              		.loc 1 99 32 discriminator 1 view .LVU171
 537 00fa 1C4B     		ldr	r3, .L40+40
 538 00fc 1855     		strb	r0, [r3, r4]
  97:controller/engine_cycle/ignition.c ****     {
 539              		.loc 1 97 61 is_stmt 1 discriminator 3 view .LVU172
 540 00fe 0134     		adds	r4, r4, #1
 541              	.LVL39:
 542              	.L34:
  97:controller/engine_cycle/ignition.c ****     {
 543              		.loc 1 97 26 discriminator 1 view .LVU173
 544 0100 032C     		cmp	r4, #3
 545 0102 F1D9     		bls	.L35
 546              	.LBE15:
 547              	.LBB16:
 102:controller/engine_cycle/ignition.c ****     {
 548              		.loc 1 102 17 is_stmt 0 view .LVU174
 549 0104 0024     		movs	r4, #0
 550              	.LVL40:
 102:controller/engine_cycle/ignition.c ****     {
 551              		.loc 1 102 17 view .LVU175
 552 0106 0AE0     		b	.L36
 553              	.LVL41:
 554              	.L37:
 104:controller/engine_cycle/ignition.c ****     }
 555              		.loc 1 104 9 is_stmt 1 view .LVU176
 104:controller/engine_cycle/ignition.c ****     }
 556              		.loc 1 104 43 is_stmt 0 view .LVU177
 557 0108 0E4B     		ldr	r3, .L40
 558 010a 1B68     		ldr	r3, [r3]
 559 010c 03EBC401 		add	r1, r3, r4, lsl #3
 104:controller/engine_cycle/ignition.c ****     }
 560              		.loc 1 104 9 view .LVU178
 561 0110 0022     		movs	r2, #0
 562 0112 8988     		ldrh	r1, [r1, #4]
 563 0114 53F83400 		ldr	r0, [r3, r4, lsl #3]
 564 0118 FFF7FEFF 		bl	HAL_GPIO_WritePin
 565              	.LVL42:
 102:controller/engine_cycle/ignition.c ****     {
 566              		.loc 1 102 61 is_stmt 1 discriminator 3 view .LVU179
 567 011c 0134     		adds	r4, r4, #1
 568              	.LVL43:
 569              	.L36:
 102:controller/engine_cycle/ignition.c ****     {
 570              		.loc 1 102 26 discriminator 1 view .LVU180
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 19


 571 011e 032C     		cmp	r4, #3
 572 0120 F2D9     		bls	.L37
 573              	.LBE16:
 107:controller/engine_cycle/ignition.c ****     {
 574              		.loc 1 107 5 view .LVU181
 107:controller/engine_cycle/ignition.c ****     {
 575              		.loc 1 107 15 is_stmt 0 view .LVU182
 576 0122 094B     		ldr	r3, .L40+4
 577 0124 93F8A232 		ldrb	r3, [r3, #674]	@ zero_extendqisi2
 107:controller/engine_cycle/ignition.c ****     {
 578              		.loc 1 107 8 view .LVU183
 579 0128 002B     		cmp	r3, #0
 580 012a 3FF476AF 		beq	.L21
 107:controller/engine_cycle/ignition.c ****     {
 581              		.loc 1 107 40 discriminator 1 view .LVU184
 582 012e 064B     		ldr	r3, .L40+4
 583 0130 93F8A332 		ldrb	r3, [r3, #675]	@ zero_extendqisi2
 107:controller/engine_cycle/ignition.c ****     {
 584              		.loc 1 107 36 discriminator 1 view .LVU185
 585 0134 082B     		cmp	r3, #8
 586 0136 7FF670AF 		bls	.L21
 109:controller/engine_cycle/ignition.c ****     }
 587              		.loc 1 109 9 is_stmt 1 view .LVU186
 588 013a 0D48     		ldr	r0, .L40+44
 589 013c FFF7FEFF 		bl	log_warning
 590              	.LVL44:
 591 0140 6BE7     		b	.L21
 592              	.L41:
 593 0142 00BF     		.align	2
 594              	.L40:
 595 0144 00000000 		.word	ignition_outputs
 596 0148 00100000 		.word	config+4096
 597 014c 9C000000 		.word	.LC4
 598 0150 00000000 		.word	.LC1
 599 0154 00000000 		.word	number_of_cylinders
 600 0158 00000000 		.word	ignition_order
 601 015c 00000000 		.word	runtime
 602 0160 00003443 		.word	1127481344
 603 0164 28000000 		.word	.LC2
 604 0168 4C000000 		.word	.LC3
 605 016c 00000000 		.word	ignition_coil_state
 606 0170 C8000000 		.word	.LC5
 607              		.cfi_endproc
 608              	.LFE232:
 610              		.section	.text.ignition_get_coil_duty_cycle,"ax",%progbits
 611              		.align	1
 612              		.global	ignition_get_coil_duty_cycle
 613              		.syntax unified
 614              		.thumb
 615              		.thumb_func
 617              	ignition_get_coil_duty_cycle:
 618              	.LFB236:
 279:controller/engine_cycle/ignition.c **** 
 280:controller/engine_cycle/ignition.c **** /**
 281:controller/engine_cycle/ignition.c ****  * @brief Gets the duty cycle of the ignition coil as a percentage.
 282:controller/engine_cycle/ignition.c ****  *
 283:controller/engine_cycle/ignition.c ****  * @return The duty cycle of the ignition coil.
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 20


 284:controller/engine_cycle/ignition.c ****  */
 285:controller/engine_cycle/ignition.c **** percent_t ignition_get_coil_duty_cycle()
 286:controller/engine_cycle/ignition.c **** {
 619              		.loc 1 286 1 view -0
 620              		.cfi_startproc
 621              		@ args = 0, pretend = 0, frame = 0
 622              		@ frame_needed = 0, uses_anonymous_args = 0
 623              		@ link register save eliminated.
 287:controller/engine_cycle/ignition.c **** }
 624              		.loc 1 287 1 view .LVU188
 625 0000 7047     		bx	lr
 626              		.cfi_endproc
 627              	.LFE236:
 629              		.section	.text.ignition_get_advance,"ax",%progbits
 630              		.align	1
 631              		.global	ignition_get_advance
 632              		.syntax unified
 633              		.thumb
 634              		.thumb_func
 636              	ignition_get_advance:
 637              	.LFB237:
 288:controller/engine_cycle/ignition.c **** 
 289:controller/engine_cycle/ignition.c **** angle_t ignition_get_advance()
 290:controller/engine_cycle/ignition.c **** {
 638              		.loc 1 290 1 view -0
 639              		.cfi_startproc
 640              		@ args = 0, pretend = 0, frame = 0
 641              		@ frame_needed = 0, uses_anonymous_args = 0
 642 0000 08B5     		push	{r3, lr}
 643              		.cfi_def_cfa_offset 8
 644              		.cfi_offset 3, -8
 645              		.cfi_offset 14, -4
 646 0002 2DED028B 		vpush.64	{d8}
 647              		.cfi_def_cfa_offset 16
 648              		.cfi_offset 80, -16
 649              		.cfi_offset 81, -12
 291:controller/engine_cycle/ignition.c ****     angle_t final_advance = IGNITION_ADVANCE_FAIL_SAFE;
 650              		.loc 1 291 5 view .LVU190
 651              	.LVL45:
 292:controller/engine_cycle/ignition.c ****     if (runtime.spinning_state != SS_RUNNING)
 652              		.loc 1 292 5 view .LVU191
 653              		.loc 1 292 16 is_stmt 0 view .LVU192
 654 0006 0E4B     		ldr	r3, .L47
 655 0008 93F85030 		ldrb	r3, [r3, #80]	@ zero_extendqisi2
 656              		.loc 1 292 8 view .LVU193
 657 000c 032B     		cmp	r3, #3
 658 000e 05D0     		beq	.L44
 293:controller/engine_cycle/ignition.c ****     {
 294:controller/engine_cycle/ignition.c ****         return config.cranking_advance;
 659              		.loc 1 294 9 is_stmt 1 view .LVU194
 660              		.loc 1 294 22 is_stmt 0 view .LVU195
 661 0010 0C4B     		ldr	r3, .L47+4
 662 0012 93ED810A 		vldr.32	s0, [r3, #516]
 663              	.LVL46:
 664              	.L43:
 295:controller/engine_cycle/ignition.c ****     }
 296:controller/engine_cycle/ignition.c **** 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 21


 297:controller/engine_cycle/ignition.c ****     rpm_t rpm = crankshaft_get_rpm();
 298:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 299:controller/engine_cycle/ignition.c **** 
 300:controller/engine_cycle/ignition.c ****     final_advance += table_2d_get_value(&config.ign_table_1, rpm, map); // expand and allow the use
 301:controller/engine_cycle/ignition.c **** 
 302:controller/engine_cycle/ignition.c ****     /* Here we can apply all kinds of correction to the table */
 303:controller/engine_cycle/ignition.c **** 
 304:controller/engine_cycle/ignition.c ****     return final_advance;
 305:controller/engine_cycle/ignition.c **** }...
 665              		.loc 1 305 1 view .LVU196
 666 0016 BDEC028B 		vldm	sp!, {d8}
 667              		.cfi_remember_state
 668              		.cfi_restore 80
 669              		.cfi_restore 81
 670              		.cfi_def_cfa_offset 8
 671 001a 08BD     		pop	{r3, pc}
 672              	.LVL47:
 673              	.L44:
 674              		.cfi_restore_state
 297:controller/engine_cycle/ignition.c ****     rpm_t rpm = crankshaft_get_rpm();
 675              		.loc 1 297 5 is_stmt 1 view .LVU197
 297:controller/engine_cycle/ignition.c ****     rpm_t rpm = crankshaft_get_rpm();
 676              		.loc 1 297 17 is_stmt 0 view .LVU198
 677 001c FFF7FEFF 		bl	crankshaft_get_rpm
 678              	.LVL48:
 679 0020 B0EE408A 		vmov.f32	s16, s0
 680              	.LVL49:
 298:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 681              		.loc 1 298 5 is_stmt 1 view .LVU199
 298:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 682              		.loc 1 298 22 is_stmt 0 view .LVU200
 683 0024 FFF7FEFF 		bl	sensor_map_get
 684              	.LVL50:
 298:controller/engine_cycle/ignition.c ****     pressure_t map = sensor_map_get();
 685              		.loc 1 298 22 view .LVU201
 686 0028 F0EE400A 		vmov.f32	s1, s0
 687              	.LVL51:
 300:controller/engine_cycle/ignition.c ****     final_advance += table_2d_get_value(&config.ign_table_1, rpm, map); // expand and allow the use
 688              		.loc 1 300 5 is_stmt 1 view .LVU202
 300:controller/engine_cycle/ignition.c ****     final_advance += table_2d_get_value(&config.ign_table_1, rpm, map); // expand and allow the use
 689              		.loc 1 300 22 is_stmt 0 view .LVU203
 690 002c B0EE480A 		vmov.f32	s0, s16
 691              	.LVL52:
 300:controller/engine_cycle/ignition.c ****     final_advance += table_2d_get_value(&config.ign_table_1, rpm, map); // expand and allow the use
 692              		.loc 1 300 22 view .LVU204
 693 0030 0548     		ldr	r0, .L47+8
 694 0032 FFF7FEFF 		bl	table_2d_get_value
 695              	.LVL53:
 300:controller/engine_cycle/ignition.c ****     final_advance += table_2d_get_value(&config.ign_table_1, rpm, map); // expand and allow the use
 696              		.loc 1 300 19 discriminator 1 view .LVU205
 697 0036 F2EE047A 		vmov.f32	s15, #1.0e+1
 698 003a 30EE270A 		vadd.f32	s0, s0, s15
 699              	.LVL54:
 304:controller/engine_cycle/ignition.c ****     return final_advance;
 700              		.loc 1 304 5 is_stmt 1 view .LVU206
 304:controller/engine_cycle/ignition.c ****     return final_advance;
 701              		.loc 1 304 12 is_stmt 0 view .LVU207
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 22


 702 003e EAE7     		b	.L43
 703              	.L48:
 704              		.align	2
 705              	.L47:
 706 0040 00000000 		.word	runtime
 707 0044 00100000 		.word	config+4096
 708 0048 00090000 		.word	config+2304
 709              		.cfi_endproc
 710              	.LFE237:
 712              		.section	.rodata.ignition_trigger_event_handle.str1.4,"aMS",%progbits,1
 713              		.align	2
 714              	.LC6:
 715 0000 69676E69 		.ascii	"ignition not initialized.\000"
 715      74696F6E 
 715      206E6F74 
 715      20696E69 
 715      7469616C 
 716 001a 0000     		.align	2
 717              	.LC7:
 718 001c 69676E69 		.ascii	"ignition dwell out of bounds.\000"
 718      74696F6E 
 718      20647765 
 718      6C6C206F 
 718      7574206F 
 719              		.section	.text.ignition_trigger_event_handle,"ax",%progbits
 720              		.align	1
 721              		.global	ignition_trigger_event_handle
 722              		.syntax unified
 723              		.thumb
 724              		.thumb_func
 726              	ignition_trigger_event_handle:
 727              	.LVL55:
 728              	.LFB233:
 121:controller/engine_cycle/ignition.c **** {
 729              		.loc 1 121 1 is_stmt 1 view -0
 730              		.cfi_startproc
 731              		@ args = 0, pretend = 0, frame = 16
 732              		@ frame_needed = 0, uses_anonymous_args = 0
 125:controller/engine_cycle/ignition.c ****     if (config.ignition_mode == IM_NO_IGNITION)
 733              		.loc 1 125 5 view .LVU209
 125:controller/engine_cycle/ignition.c ****     if (config.ignition_mode == IM_NO_IGNITION)
 734              		.loc 1 125 15 is_stmt 0 view .LVU210
 735 0000 A34B     		ldr	r3, .L84
 736 0002 93F8A132 		ldrb	r3, [r3, #673]	@ zero_extendqisi2
 125:controller/engine_cycle/ignition.c ****     if (config.ignition_mode == IM_NO_IGNITION)
 737              		.loc 1 125 8 view .LVU211
 738 0006 002B     		cmp	r3, #0
 739 0008 00F04181 		beq	.L78
 121:controller/engine_cycle/ignition.c **** {
 740              		.loc 1 121 1 view .LVU212
 741 000c 70B5     		push	{r4, r5, r6, lr}
 742              		.cfi_def_cfa_offset 16
 743              		.cfi_offset 4, -16
 744              		.cfi_offset 5, -12
 745              		.cfi_offset 6, -8
 746              		.cfi_offset 14, -4
 747 000e 2DED048B 		vpush.64	{d8, d9}
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 23


 748              		.cfi_def_cfa_offset 32
 749              		.cfi_offset 80, -32
 750              		.cfi_offset 81, -28
 751              		.cfi_offset 82, -24
 752              		.cfi_offset 83, -20
 753 0012 84B0     		sub	sp, sp, #16
 754              		.cfi_def_cfa_offset 48
 755 0014 F0EE408A 		vmov.f32	s17, s0
 756 0018 B0EE608A 		vmov.f32	s16, s1
 757 001c 0446     		mov	r4, r0
 130:controller/engine_cycle/ignition.c ****     if (runtime.firing_interval_deg == 0)
 758              		.loc 1 130 5 is_stmt 1 view .LVU213
 130:controller/engine_cycle/ignition.c ****     if (runtime.firing_interval_deg == 0)
 759              		.loc 1 130 16 is_stmt 0 view .LVU214
 760 001e 9D4B     		ldr	r3, .L84+4
 761 0020 D3ED087A 		vldr.32	s15, [r3, #32]
 130:controller/engine_cycle/ignition.c ****     if (runtime.firing_interval_deg == 0)
 762              		.loc 1 130 8 view .LVU215
 763 0024 F5EE407A 		vcmp.f32	s15, #0
 764 0028 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 765 002c 21D0     		beq	.L81
 136:controller/engine_cycle/ignition.c ****     if (!IS_IN_RANGE(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_MAX_DWELL_TIME_MS)
 766              		.loc 1 136 5 is_stmt 1 view .LVU216
 136:controller/engine_cycle/ignition.c ****     if (!IS_IN_RANGE(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_MAX_DWELL_TIME_MS)
 767              		.loc 1 136 10 is_stmt 0 view .LVU217
 768 002e 984B     		ldr	r3, .L84
 769 0030 D3ED837A 		vldr.32	s15, [r3, #524]
 136:controller/engine_cycle/ignition.c ****     if (!IS_IN_RANGE(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_MAX_DWELL_TIME_MS)
 770              		.loc 1 136 8 view .LVU218
 771 0034 B6EE007A 		vmov.f32	s14, #5.0e-1
 772 0038 F4EEC77A 		vcmpe.f32	s15, s14
 773 003c F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 774 0040 06DB     		blt	.L52
 136:controller/engine_cycle/ignition.c ****     if (!IS_IN_RANGE(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_MAX_DWELL_TIME_MS)
 775              		.loc 1 136 9 discriminator 1 view .LVU219
 776 0042 B1EE007A 		vmov.f32	s14, #4.0e+0
 777 0046 F4EEC77A 		vcmpe.f32	s15, s14
 778 004a F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 779 004e 20D9     		bls	.L54
 780              	.L52:
 138:controller/engine_cycle/ignition.c ****         config.ignition_dwell = CLAMP(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_M
 781              		.loc 1 138 9 is_stmt 1 view .LVU220
 138:controller/engine_cycle/ignition.c ****         config.ignition_dwell = CLAMP(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_M
 782              		.loc 1 138 33 is_stmt 0 view .LVU221
 783 0050 B6EE007A 		vmov.f32	s14, #5.0e-1
 784 0054 F4EEC77A 		vcmpe.f32	s15, s14
 785 0058 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 786 005c 0DD4     		bmi	.L67
 138:controller/engine_cycle/ignition.c ****         config.ignition_dwell = CLAMP(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_M
 787              		.loc 1 138 33 discriminator 2 view .LVU222
 788 005e B1EE007A 		vmov.f32	s14, #4.0e+0
 789 0062 F4EEC77A 		vcmpe.f32	s15, s14
 790 0066 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 791 006a 08DD     		ble	.L55
 138:controller/engine_cycle/ignition.c ****         config.ignition_dwell = CLAMP(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_M
 792              		.loc 1 138 33 discriminator 4 view .LVU223
 793 006c F0EE477A 		vmov.f32	s15, s14
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 24


 794 0070 05E0     		b	.L55
 795              	.L81:
 132:controller/engine_cycle/ignition.c ****         log_error("ignition not initialized.");
 796              		.loc 1 132 9 is_stmt 1 view .LVU224
 797 0072 8948     		ldr	r0, .L84+8
 798              	.LVL56:
 132:controller/engine_cycle/ignition.c ****         log_error("ignition not initialized.");
 799              		.loc 1 132 9 is_stmt 0 view .LVU225
 800 0074 FFF7FEFF 		bl	log_error
 801              	.LVL57:
 133:controller/engine_cycle/ignition.c ****         return;
 802              		.loc 1 133 9 is_stmt 1 view .LVU226
 803 0078 07E0     		b	.L49
 804              	.LVL58:
 805              	.L67:
 138:controller/engine_cycle/ignition.c ****         config.ignition_dwell = CLAMP(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_M
 806              		.loc 1 138 33 is_stmt 0 discriminator 1 view .LVU227
 807 007a F6EE007A 		vmov.f32	s15, #5.0e-1
 808              	.L55:
 138:controller/engine_cycle/ignition.c ****         config.ignition_dwell = CLAMP(config.ignition_dwell, IGNITION_MIN_DWELL_TIME_MS, IGNITION_M
 809              		.loc 1 138 31 discriminator 8 view .LVU228
 810 007e 844B     		ldr	r3, .L84
 811 0080 C3ED837A 		vstr.32	s15, [r3, #524]
 142:controller/engine_cycle/ignition.c ****         log_error("ignition dwell out of bounds.");
 812              		.loc 1 142 9 is_stmt 1 view .LVU229
 813 0084 8548     		ldr	r0, .L84+12
 814              	.LVL59:
 142:controller/engine_cycle/ignition.c ****         log_error("ignition dwell out of bounds.");
 815              		.loc 1 142 9 is_stmt 0 view .LVU230
 816 0086 FFF7FEFF 		bl	log_error
 817              	.LVL60:
 144:controller/engine_cycle/ignition.c ****         return;
 818              		.loc 1 144 9 is_stmt 1 view .LVU231
 819              	.L49:
 228:controller/engine_cycle/ignition.c **** }
 820              		.loc 1 228 1 is_stmt 0 view .LVU232
 821 008a 04B0     		add	sp, sp, #16
 822              		.cfi_remember_state
 823              		.cfi_def_cfa_offset 32
 824              		@ sp needed
 825 008c BDEC048B 		vldm	sp!, {d8-d9}
 826              		.cfi_restore 82
 827              		.cfi_restore 83
 828              		.cfi_restore 80
 829              		.cfi_restore 81
 830              		.cfi_def_cfa_offset 16
 831              	.LVL61:
 228:controller/engine_cycle/ignition.c **** }
 832              		.loc 1 228 1 view .LVU233
 833 0090 70BD     		pop	{r4, r5, r6, pc}
 834              	.LVL62:
 835              	.L54:
 836              		.cfi_restore_state
 147:controller/engine_cycle/ignition.c ****     bool is_cam_phase_available = false;
 837              		.loc 1 147 5 is_stmt 1 view .LVU234
 149:controller/engine_cycle/ignition.c ****     angle_t spark_advance = 0;
 838              		.loc 1 149 5 view .LVU235
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 25


 154:controller/engine_cycle/ignition.c ****     spark_advance = ignition_get_advance();
 839              		.loc 1 154 5 view .LVU236
 154:controller/engine_cycle/ignition.c ****     spark_advance = ignition_get_advance();
 840              		.loc 1 154 21 is_stmt 0 view .LVU237
 841 0092 FFF7FEFF 		bl	ignition_get_advance
 842              	.LVL63:
 155:controller/engine_cycle/ignition.c ****     runtime.ignition_advance_deg = spark_advance;
 843              		.loc 1 155 5 is_stmt 1 view .LVU238
 155:controller/engine_cycle/ignition.c ****     runtime.ignition_advance_deg = spark_advance;
 844              		.loc 1 155 34 is_stmt 0 view .LVU239
 845 0096 7F4B     		ldr	r3, .L84+4
 846 0098 83ED090A 		vstr.32	s0, [r3, #36]
 158:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
 847              		.loc 1 158 5 is_stmt 1 view .LVU240
 158:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
 848              		.loc 1 158 21 is_stmt 0 view .LVU241
 849 009c B5EEC00A 		vcmpe.f32	s0, #0
 850 00a0 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 851 00a4 09D4     		bmi	.L68
 158:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
 852              		.loc 1 158 21 discriminator 2 view .LVU242
 853 00a6 DFED7E7A 		vldr.32	s15, .L84+16
 854 00aa B4EEE70A 		vcmpe.f32	s0, s15
 855 00ae F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 856 00b2 04DD     		ble	.L57
 158:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
 857              		.loc 1 158 21 discriminator 4 view .LVU243
 858 00b4 B0EE670A 		vmov.f32	s0, s15
 859              	.LVL64:
 158:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
 860              		.loc 1 158 21 discriminator 4 view .LVU244
 861 00b8 01E0     		b	.L57
 862              	.LVL65:
 863              	.L68:
 158:controller/engine_cycle/ignition.c ****     spark_advance = CLAMP(spark_advance, IGNITION_MIN_ADVANCE, IGNITION_MAX_ADVANCE);
 864              		.loc 1 158 21 discriminator 1 view .LVU245
 865 00ba 9FED7A0A 		vldr.32	s0, .L84+20
 866              	.LVL66:
 867              	.L57:
 159:controller/engine_cycle/ignition.c ****     runtime.dwell_actual = config.ignition_dwell;
 868              		.loc 1 159 5 is_stmt 1 view .LVU246
 159:controller/engine_cycle/ignition.c ****     runtime.dwell_actual = config.ignition_dwell;
 869              		.loc 1 159 34 is_stmt 0 view .LVU247
 870 00be 744B     		ldr	r3, .L84
 871 00c0 D3ED837A 		vldr.32	s15, [r3, #524]
 159:controller/engine_cycle/ignition.c ****     runtime.dwell_actual = config.ignition_dwell;
 872              		.loc 1 159 26 view .LVU248
 873 00c4 734B     		ldr	r3, .L84+4
 874 00c6 C3ED137A 		vstr.32	s15, [r3, #76]
 162:controller/engine_cycle/ignition.c ****     uint8_t phase = (uint8_t)(crankshaft_angle / runtime.firing_interval_deg);
 875              		.loc 1 162 5 is_stmt 1 view .LVU249
 162:controller/engine_cycle/ignition.c ****     uint8_t phase = (uint8_t)(crankshaft_angle / runtime.firing_interval_deg);
 876              		.loc 1 162 57 is_stmt 0 view .LVU250
 877 00ca 93ED087A 		vldr.32	s14, [r3, #32]
 162:controller/engine_cycle/ignition.c ****     uint8_t phase = (uint8_t)(crankshaft_angle / runtime.firing_interval_deg);
 878              		.loc 1 162 48 view .LVU251
 879 00ce C8EE876A 		vdiv.f32	s13, s17, s14
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 26


 162:controller/engine_cycle/ignition.c ****     uint8_t phase = (uint8_t)(crankshaft_angle / runtime.firing_interval_deg);
 880              		.loc 1 162 13 view .LVU252
 881 00d2 FCEEE66A 		vcvt.u32.f32	s13, s13
 882 00d6 CDED016A 		vstr.32	s13, [sp, #4]	@ int
 883 00da 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 884              	.LVL67:
 163:controller/engine_cycle/ignition.c ****     uint8_t phase_count = (uint8_t)(angle_t)360 / (angle_t)runtime.firing_interval_deg;
 885              		.loc 1 163 5 is_stmt 1 view .LVU253
 165:controller/engine_cycle/ignition.c ****     volatile angle_t next_spark_angle = phase * runtime.firing_interval_deg - spark_advance + runti
 886              		.loc 1 165 5 view .LVU254
 165:controller/engine_cycle/ignition.c ****     volatile angle_t next_spark_angle = phase * runtime.firing_interval_deg - spark_advance + runti
 887              		.loc 1 165 47 is_stmt 0 view .LVU255
 888 00de 06EE903A 		vmov	s13, r3	@ int
 889 00e2 F8EEE66A 		vcvt.f32.s32	s13, s13
 890 00e6 66EE876A 		vmul.f32	s13, s13, s14
 165:controller/engine_cycle/ignition.c ****     volatile angle_t next_spark_angle = phase * runtime.firing_interval_deg - spark_advance + runti
 891              		.loc 1 165 77 view .LVU256
 892 00ea 76EEC06A 		vsub.f32	s13, s13, s0
 165:controller/engine_cycle/ignition.c ****     volatile angle_t next_spark_angle = phase * runtime.firing_interval_deg - spark_advance + runti
 893              		.loc 1 165 93 view .LVU257
 894 00ee 37EE267A 		vadd.f32	s14, s14, s13
 895              	.LVL68:
 165:controller/engine_cycle/ignition.c ****     volatile angle_t next_spark_angle = phase * runtime.firing_interval_deg - spark_advance + runti
 896              		.loc 1 165 22 view .LVU258
 897 00f2 8DED037A 		vstr.32	s14, [sp, #12]
 166:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)config.ignition_dwell * (float)10
 898              		.loc 1 166 5 is_stmt 1 view .LVU259
 166:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)config.ignition_dwell * (float)10
 899              		.loc 1 166 58 is_stmt 0 view .LVU260
 900 00f6 9DED037A 		vldr.32	s14, [sp, #12]
 166:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)config.ignition_dwell * (float)10
 901              		.loc 1 166 89 view .LVU261
 902 00fa DFED6B6A 		vldr.32	s13, .L84+24
 903 00fe 67EEA67A 		vmul.f32	s15, s15, s13
 904              	.LVL69:
 905              	.LBB17:
 906              	.LBI17:
 907              		.file 2 "controller/utils/utils.h"
   1:controller/utils/utils.h **** /**
   2:controller/utils/utils.h ****  * @file utils.h
   3:controller/utils/utils.h ****  * @brief Header file containing utility functions and definitions for the smart generator controll
   4:controller/utils/utils.h ****  *
   5:controller/utils/utils.h ****  * This file provides declarations for utility functions and macros that are
   6:controller/utils/utils.h ****  * used throughout the firmware to support various functionalities.
   7:controller/utils/utils.h ****  *
   8:controller/utils/utils.h ****  * @note Ensure that this file is included wherever utility functions are required.
   9:controller/utils/utils.h ****  */
  10:controller/utils/utils.h **** #ifndef UTILS_H
  11:controller/utils/utils.h **** #define UTILS_H
  12:controller/utils/utils.h **** 
  13:controller/utils/utils.h **** #include "types.h"
  14:controller/utils/utils.h **** #include "math.h"
  15:controller/utils/utils.h **** #define IS_IN_RANGE(value, min, max) ((value) >= (min) && (value) <= (max))
  16:controller/utils/utils.h **** #define ABS(value) ((value) < 0 ? -(value) : (value))
  17:controller/utils/utils.h **** #define CLAMP(value, min, max) ((value) < (min) ? (min) : ((value) > (max) ? (max) : (value)))
  18:controller/utils/utils.h **** 
  19:controller/utils/utils.h **** static inline void change_bit(uint32_t *var, uint8_t bit, bool state)
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 27


  20:controller/utils/utils.h **** {
  21:controller/utils/utils.h ****     if (bit > 31)
  22:controller/utils/utils.h ****     {
  23:controller/utils/utils.h ****         return;
  24:controller/utils/utils.h ****     }
  25:controller/utils/utils.h ****     if (state)
  26:controller/utils/utils.h ****     {
  27:controller/utils/utils.h ****         *var |= (1u << bit);
  28:controller/utils/utils.h ****     }
  29:controller/utils/utils.h ****     else
  30:controller/utils/utils.h ****     {
  31:controller/utils/utils.h ****         *var &= ~(1u << bit);
  32:controller/utils/utils.h ****     }
  33:controller/utils/utils.h **** }
  34:controller/utils/utils.h **** 
  35:controller/utils/utils.h **** static inline bool get_bit(uint32_t flags, uint8_t bit)
  36:controller/utils/utils.h **** {
  37:controller/utils/utils.h ****     if (bit < 32)
  38:controller/utils/utils.h ****     {
  39:controller/utils/utils.h ****         return (flags >> bit) & 1u;
  40:controller/utils/utils.h ****     }
  41:controller/utils/utils.h ****     return false;
  42:controller/utils/utils.h **** }
  43:controller/utils/utils.h **** 
  44:controller/utils/utils.h **** /**
  45:controller/utils/utils.h ****  * @brief Maps a value from one range to another.
  46:controller/utils/utils.h ****  *
  47:controller/utils/utils.h ****  * @param x The value to map.
  48:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  49:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  50:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  51:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  52:controller/utils/utils.h ****  * @return The mapped value in the output range.
  53:controller/utils/utils.h ****  */
  54:controller/utils/utils.h **** #define MAP(x, in_min, in_max, out_min, out_max) \
  55:controller/utils/utils.h ****     (((x) - (in_min)) * ((out_max) - (out_min)) / ((in_max) - (in_min)) + (out_min))
  56:controller/utils/utils.h **** 
  57:controller/utils/utils.h **** /**
  58:controller/utils/utils.h ****  * @brief Maps a uint16_t value from one range to another.
  59:controller/utils/utils.h ****  *
  60:controller/utils/utils.h ****  * @param x The value to map.
  61:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  62:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  63:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  64:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  65:controller/utils/utils.h ****  * @return The mapped value in the output range.
  66:controller/utils/utils.h ****  */
  67:controller/utils/utils.h **** static inline uint16_t map_uint16(uint16_t x, uint16_t in_min, uint16_t in_max, uint16_t out_min, u
  68:controller/utils/utils.h **** {
  69:controller/utils/utils.h ****     if (in_max == in_min)
  70:controller/utils/utils.h ****     {
  71:controller/utils/utils.h ****         return 0; // Avoid division by zero
  72:controller/utils/utils.h ****     }
  73:controller/utils/utils.h ****     return (uint16_t)((x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min);
  74:controller/utils/utils.h **** }
  75:controller/utils/utils.h **** 
  76:controller/utils/utils.h **** static inline float mapf(float x, float in_min, float in_max, float out_min, float out_max)
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 28


  77:controller/utils/utils.h **** {
  78:controller/utils/utils.h ****     if (in_max == in_min)
  79:controller/utils/utils.h ****     {
  80:controller/utils/utils.h ****         return 0.0f; // Avoid division by zero
  81:controller/utils/utils.h ****     }
  82:controller/utils/utils.h ****     return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
  83:controller/utils/utils.h **** }
  84:controller/utils/utils.h **** 
  85:controller/utils/utils.h **** // http://en.wikipedia.org/wiki/Endianness
  86:controller/utils/utils.h **** inline uint16_t swap_endian_uint16(uint16_t x)
  87:controller/utils/utils.h **** {
  88:controller/utils/utils.h ****     return ((x << 8) | (x >> 8));
  89:controller/utils/utils.h **** }
  90:controller/utils/utils.h **** inline uint32_t swap_endian_uint32(uint32_t x)
  91:controller/utils/utils.h **** {
  92:controller/utils/utils.h ****     return (((x >> 24) & 0x000000ff) | ((x << 8) & 0x00ff0000) |
  93:controller/utils/utils.h ****             ((x >> 8) & 0x0000ff00) | ((x << 24) & 0xff000000));
  94:controller/utils/utils.h **** }
  95:controller/utils/utils.h **** 
  96:controller/utils/utils.h **** void swap_endian_copy_uint8(uint8_t *dst, const uint8_t *src, size_t size);
  97:controller/utils/utils.h **** 
  98:controller/utils/utils.h **** #define CELSIUS_TO_KELVIN(celsius) ((celsius) + 273.15f)
  99:controller/utils/utils.h **** #define KELVIN_TO_CELSIUS(kelvin) ((kelvin) - 273.15f)
 100:controller/utils/utils.h **** 
 101:controller/utils/utils.h **** /**
 102:controller/utils/utils.h ****  * @brief Function to calculate the microseconds it takes for the engine to turn one degree.
 103:controller/utils/utils.h ****  * @note Returns 0 if rpm is 0.
 104:controller/utils/utils.h ****  */
 105:controller/utils/utils.h **** static inline time_us_t microseconds_per_degree(rpm_t rpm)
 106:controller/utils/utils.h **** {
 107:controller/utils/utils.h ****     if (rpm == 0)
 108:controller/utils/utils.h ****     {
 109:controller/utils/utils.h ****         return 0;
 110:controller/utils/utils.h ****     }
 111:controller/utils/utils.h ****     return (time_us_t)60.0f * 1e6f / (rpm * 360.0f);
 112:controller/utils/utils.h **** }
 113:controller/utils/utils.h **** 
 114:controller/utils/utils.h **** /**
 115:controller/utils/utils.h ****  * @brief Function to calculate the degrees the engine turns in one microsecond.
 116:controller/utils/utils.h ****  * @note Returns 0 if rpm is 0.
 117:controller/utils/utils.h ****  */
 118:controller/utils/utils.h **** static inline angle_t degrees_per_microsecond(rpm_t rpm)
 908              		.loc 2 118 23 is_stmt 1 view .LVU262
 909              	.LBB18:
 119:controller/utils/utils.h **** {
 120:controller/utils/utils.h ****     if (rpm == 0)
 910              		.loc 2 120 5 view .LVU263
 911              		.loc 2 120 8 is_stmt 0 view .LVU264
 912 0102 B5EE408A 		vcmp.f32	s16, #0
 913 0106 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 914 010a 00F0AB80 		beq	.L69
 121:controller/utils/utils.h ****     {
 122:controller/utils/utils.h ****         return 0.0f;
 123:controller/utils/utils.h ****     }
 124:controller/utils/utils.h ****     return (angle_t)(rpm * 360.0f) / (60.0f * 1e6f);
 915              		.loc 2 124 5 is_stmt 1 view .LVU265
 916              		.loc 2 124 12 is_stmt 0 view .LVU266
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 29


 917 010e DFED676A 		vldr.32	s13, .L84+28
 918 0112 68EE266A 		vmul.f32	s13, s16, s13
 919              		.loc 2 124 36 view .LVU267
 920 0116 DFED665A 		vldr.32	s11, .L84+32
 921 011a 86EEA56A 		vdiv.f32	s12, s13, s11
 922              	.L59:
 923              	.LVL70:
 924              		.loc 2 124 36 view .LVU268
 925              	.LBE18:
 926              	.LBE17:
 166:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)config.ignition_dwell * (float)10
 927              		.loc 1 166 103 discriminator 1 view .LVU269
 928 011e 67EE867A 		vmul.f32	s15, s15, s12
 166:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)config.ignition_dwell * (float)10
 929              		.loc 1 166 58 discriminator 1 view .LVU270
 930 0122 77EE677A 		vsub.f32	s15, s14, s15
 166:controller/engine_cycle/ignition.c ****     volatile angle_t next_dwell_angle = next_spark_angle - (float)config.ignition_dwell * (float)10
 931              		.loc 1 166 22 discriminator 1 view .LVU271
 932 0126 CDED027A 		vstr.32	s15, [sp, #8]
 168:controller/engine_cycle/ignition.c ****     static uint8_t next_firing_cylinders[2] = {0};
 933              		.loc 1 168 5 is_stmt 1 view .LVU272
 170:controller/engine_cycle/ignition.c ****     next_firing_cylinders[0] = ignition_order[phase] - 1;
 934              		.loc 1 170 5 view .LVU273
 170:controller/engine_cycle/ignition.c ****     next_firing_cylinders[0] = ignition_order[phase] - 1;
 935              		.loc 1 170 46 is_stmt 0 view .LVU274
 936 012a 6248     		ldr	r0, .L84+36
 937 012c C25C     		ldrb	r2, [r0, r3]	@ zero_extendqisi2
 170:controller/engine_cycle/ignition.c ****     next_firing_cylinders[0] = ignition_order[phase] - 1;
 938              		.loc 1 170 54 view .LVU275
 939 012e 013A     		subs	r2, r2, #1
 940 0130 D2B2     		uxtb	r2, r2
 170:controller/engine_cycle/ignition.c ****     next_firing_cylinders[0] = ignition_order[phase] - 1;
 941              		.loc 1 170 30 view .LVU276
 942 0132 6149     		ldr	r1, .L84+40
 943 0134 0A70     		strb	r2, [r1]
 171:controller/engine_cycle/ignition.c ****     next_firing_cylinders[1] = ignition_order[phase] - 1;
 944              		.loc 1 171 5 is_stmt 1 view .LVU277
 171:controller/engine_cycle/ignition.c ****     next_firing_cylinders[1] = ignition_order[phase] - 1;
 945              		.loc 1 171 30 is_stmt 0 view .LVU278
 946 0136 4A70     		strb	r2, [r1, #1]
 173:controller/engine_cycle/ignition.c ****     if (!is_cam_phase_available)
 947              		.loc 1 173 5 is_stmt 1 view .LVU279
 175:controller/engine_cycle/ignition.c ****         next_firing_cylinders[1] = ignition_order[phase + 2] - 1;
 948              		.loc 1 175 9 view .LVU280
 175:controller/engine_cycle/ignition.c ****         next_firing_cylinders[1] = ignition_order[phase + 2] - 1;
 949              		.loc 1 175 57 is_stmt 0 view .LVU281
 950 0138 0233     		adds	r3, r3, #2
 951              	.LVL71:
 175:controller/engine_cycle/ignition.c ****         next_firing_cylinders[1] = ignition_order[phase + 2] - 1;
 952              		.loc 1 175 50 view .LVU282
 953 013a C35C     		ldrb	r3, [r0, r3]	@ zero_extendqisi2
 954              	.LVL72:
 175:controller/engine_cycle/ignition.c ****         next_firing_cylinders[1] = ignition_order[phase + 2] - 1;
 955              		.loc 1 175 62 view .LVU283
 956 013c 013B     		subs	r3, r3, #1
 175:controller/engine_cycle/ignition.c ****         next_firing_cylinders[1] = ignition_order[phase + 2] - 1;
 957              		.loc 1 175 34 view .LVU284
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 30


 958 013e 4B70     		strb	r3, [r1, #1]
 178:controller/engine_cycle/ignition.c ****     bool is_synced = get_bit(runtime.status, STATUS_TRIGGER1_SYNCED);
 959              		.loc 1 178 5 is_stmt 1 view .LVU285
 178:controller/engine_cycle/ignition.c ****     bool is_synced = get_bit(runtime.status, STATUS_TRIGGER1_SYNCED);
 960              		.loc 1 178 22 is_stmt 0 view .LVU286
 961 0140 544B     		ldr	r3, .L84+4
 962              	.LVL73:
 178:controller/engine_cycle/ignition.c ****     bool is_synced = get_bit(runtime.status, STATUS_TRIGGER1_SYNCED);
 963              		.loc 1 178 22 view .LVU287
 964 0142 1B68     		ldr	r3, [r3]
 965              	.LVL74:
 966              	.LBB20:
 967              	.LBI20:
  35:controller/utils/utils.h **** {
 968              		.loc 2 35 20 is_stmt 1 view .LVU288
 969              	.LBB21:
  37:controller/utils/utils.h ****     {
 970              		.loc 2 37 5 view .LVU289
  39:controller/utils/utils.h ****     }
 971              		.loc 2 39 9 view .LVU290
  39:controller/utils/utils.h ****     }
 972              		.loc 2 39 9 is_stmt 0 view .LVU291
 973              	.LBE21:
 974              	.LBE20:
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 975              		.loc 1 180 5 is_stmt 1 view .LVU292
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 976              		.loc 1 180 8 is_stmt 0 view .LVU293
 977 0144 13F0080F 		tst	r3, #8
 978 0148 9FD0     		beq	.L49
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 979              		.loc 1 180 40 discriminator 1 view .LVU294
 980 014a DDED027A 		vldr.32	s15, [sp, #8]
 981 014e 77EEE87A 		vsub.f32	s15, s15, s17
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 982              		.loc 1 180 19 discriminator 1 view .LVU295
 983 0152 B2EE047A 		vmov.f32	s14, #1.0e+1
 984 0156 F4EEC77A 		vcmpe.f32	s15, s14
 985 015a F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 986 015e 94D5     		bpl	.L49
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 987              		.loc 1 180 68 discriminator 2 view .LVU296
 988 0160 564B     		ldr	r3, .L84+44
 989              	.LVL75:
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 990              		.loc 1 180 68 discriminator 2 view .LVU297
 991 0162 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 992              		.loc 1 180 65 discriminator 2 view .LVU298
 993 0164 002B     		cmp	r3, #0
 994 0166 90D1     		bne	.L49
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 995              		.loc 1 180 111 discriminator 3 view .LVU299
 996 0168 DDED027A 		vldr.32	s15, [sp, #8]
 997 016c 77EEE87A 		vsub.f32	s15, s15, s17
 180:controller/engine_cycle/ignition.c ****     if (is_synced && (next_dwell_angle - crankshaft_angle) < 10 && !spark_is_in_progress && (next_d
 998              		.loc 1 180 90 discriminator 3 view .LVU300
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 31


 999 0170 F5EEC07A 		vcmpe.f32	s15, #0
 1000 0174 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1001 0178 87DD     		ble	.L49
 1002              	.LBB22:
 184:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 1003              		.loc 1 184 9 is_stmt 1 view .LVU301
 184:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 1004              		.loc 1 184 89 is_stmt 0 view .LVU302
 1005 017a DDED027A 		vldr.32	s15, [sp, #8]
 1006 017e 77EEE87A 		vsub.f32	s15, s15, s17
 1007              	.LVL76:
 1008              	.LBB23:
 1009              	.LBI23:
 105:controller/utils/utils.h **** {
 1010              		.loc 2 105 25 is_stmt 1 view .LVU303
 1011              	.LBB24:
 107:controller/utils/utils.h ****     {
 1012              		.loc 2 107 5 view .LVU304
 107:controller/utils/utils.h ****     {
 1013              		.loc 2 107 8 is_stmt 0 view .LVU305
 1014 0182 B5EE408A 		vcmp.f32	s16, #0
 1015 0186 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1016 018a 6ED0     		beq	.L70
 111:controller/utils/utils.h **** }
 1017              		.loc 2 111 5 is_stmt 1 view .LVU306
 111:controller/utils/utils.h **** }
 1018              		.loc 2 111 43 is_stmt 0 view .LVU307
 1019 018c 9FED477A 		vldr.32	s14, .L84+28
 1020 0190 28EE077A 		vmul.f32	s14, s16, s14
 111:controller/utils/utils.h **** }
 1021              		.loc 2 111 36 view .LVU308
 1022 0194 DFED466A 		vldr.32	s13, .L84+32
 1023 0198 86EE879A 		vdiv.f32	s18, s13, s14
 1024 019c BCEEC99A 		vcvt.u32.f32	s18, s18
 1025              	.L62:
 1026              	.LVL77:
 111:controller/utils/utils.h **** }
 1027              		.loc 2 111 36 view .LVU309
 1028              	.LBE24:
 1029              	.LBE23:
 184:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 1030              		.loc 1 184 109 discriminator 1 view .LVU310
 1031 01a0 B8EE499A 		vcvt.f32.u32	s18, s18
 1032 01a4 67EE897A 		vmul.f32	s15, s15, s18
 184:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 1033              		.loc 1 184 59 discriminator 1 view .LVU311
 1034 01a8 FCEEE77A 		vcvt.u32.f32	s15, s15
 1035 01ac 17EE906A 		vmov	r6, s15	@ int
 184:controller/engine_cycle/ignition.c ****         time_us_t dwell_start_time_us = current_time_us + (time_us_t)((next_dwell_angle - crankshaf
 1036              		.loc 1 184 19 discriminator 1 view .LVU312
 1037 01b0 2644     		add	r6, r6, r4
 1038              	.LVL78:
 185:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 1039              		.loc 1 185 9 is_stmt 1 view .LVU313
 185:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 1040              		.loc 1 185 89 is_stmt 0 view .LVU314
 1041 01b2 DDED037A 		vldr.32	s15, [sp, #12]
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 32


 1042 01b6 77EEE87A 		vsub.f32	s15, s15, s17
 185:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 1043              		.loc 1 185 109 discriminator 1 view .LVU315
 1044 01ba 69EE277A 		vmul.f32	s15, s18, s15
 185:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 1045              		.loc 1 185 59 discriminator 1 view .LVU316
 1046 01be FCEEE77A 		vcvt.u32.f32	s15, s15
 1047 01c2 17EE905A 		vmov	r5, s15	@ int
 185:controller/engine_cycle/ignition.c ****         time_us_t spark_start_time_us = current_time_us + (time_us_t)((next_spark_angle - crankshaf
 1048              		.loc 1 185 19 discriminator 1 view .LVU317
 1049 01c6 2544     		add	r5, r5, r4
 1050              	.LVL79:
 186:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void *)
 1051              		.loc 1 186 9 is_stmt 1 view .LVU318
 1052 01c8 3B4C     		ldr	r4, .L84+40
 1053              	.LVL80:
 186:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge, (void *)
 1054              		.loc 1 186 9 is_stmt 0 view .LVU319
 1055 01ca 2246     		mov	r2, r4
 1056 01cc 3C49     		ldr	r1, .L84+48
 1057 01ce 3046     		mov	r0, r6
 1058 01d0 FFF7FEFF 		bl	scheduler_schedule_event_with_arg
 1059              	.LVL81:
 187:controller/engine_cycle/ignition.c ****         scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (void *)ne
 1060              		.loc 1 187 9 is_stmt 1 view .LVU320
 1061 01d4 2246     		mov	r2, r4
 1062 01d6 3B49     		ldr	r1, .L84+52
 1063 01d8 2846     		mov	r0, r5
 1064 01da FFF7FEFF 		bl	scheduler_schedule_event_with_arg
 1065              	.LVL82:
 189:controller/engine_cycle/ignition.c ****         uint8_t number_of_scheduled_sparks = 1;
 1066              		.loc 1 189 9 view .LVU321
 190:controller/engine_cycle/ignition.c ****         if (!config.multi_spark_enabled)
 1067              		.loc 1 190 9 view .LVU322
 190:controller/engine_cycle/ignition.c ****         if (!config.multi_spark_enabled)
 1068              		.loc 1 190 20 is_stmt 0 view .LVU323
 1069 01de 2C4B     		ldr	r3, .L84
 1070 01e0 93F8A232 		ldrb	r3, [r3, #674]	@ zero_extendqisi2
 190:controller/engine_cycle/ignition.c ****         if (!config.multi_spark_enabled)
 1071              		.loc 1 190 12 view .LVU324
 1072 01e4 002B     		cmp	r3, #0
 1073 01e6 43D0     		beq	.L82
 189:controller/engine_cycle/ignition.c ****         uint8_t number_of_scheduled_sparks = 1;
 1074              		.loc 1 189 17 view .LVU325
 1075 01e8 0124     		movs	r4, #1
 1076              	.LVL83:
 1077              	.L63:
 196:controller/engine_cycle/ignition.c ****         while (number_of_scheduled_sparks < config.multi_spark_number_of_sparks)
 1078              		.loc 1 196 43 is_stmt 1 view .LVU326
 196:controller/engine_cycle/ignition.c ****         while (number_of_scheduled_sparks < config.multi_spark_number_of_sparks)
 1079              		.loc 1 196 51 is_stmt 0 view .LVU327
 1080 01ea 294B     		ldr	r3, .L84
 1081 01ec 93F8A332 		ldrb	r3, [r3, #675]	@ zero_extendqisi2
 196:controller/engine_cycle/ignition.c ****         while (number_of_scheduled_sparks < config.multi_spark_number_of_sparks)
 1082              		.loc 1 196 43 view .LVU328
 1083 01f0 A342     		cmp	r3, r4
 1084 01f2 45D9     		bls	.L64
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 33


 1085              	.LBB26:
 198:controller/engine_cycle/ignition.c ****             if (rpm > config.multi_spark_rpm_threshold)
 1086              		.loc 1 198 13 is_stmt 1 view .LVU329
 198:controller/engine_cycle/ignition.c ****             if (rpm > config.multi_spark_rpm_threshold)
 1087              		.loc 1 198 29 is_stmt 0 view .LVU330
 1088 01f4 264B     		ldr	r3, .L84
 1089 01f6 D3ED847A 		vldr.32	s15, [r3, #528]
 198:controller/engine_cycle/ignition.c ****             if (rpm > config.multi_spark_rpm_threshold)
 1090              		.loc 1 198 16 view .LVU331
 1091 01fa F4EEC87A 		vcmpe.f32	s15, s16
 1092 01fe F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1093 0202 3DD4     		bmi	.L64
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1094              		.loc 1 202 13 is_stmt 1 view .LVU332
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1095              		.loc 1 202 64 is_stmt 0 view .LVU333
 1096 0204 07EE904A 		vmov	s15, r4	@ int
 1097 0208 F8EE677A 		vcvt.f32.u32	s15, s15
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1098              		.loc 1 202 107 view .LVU334
 1099 020c 93ED857A 		vldr.32	s14, [r3, #532]
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1100              		.loc 1 202 141 view .LVU335
 1101 0210 D3ED836A 		vldr.32	s13, [r3, #524]
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1102              		.loc 1 202 133 view .LVU336
 1103 0214 37EE267A 		vadd.f32	s14, s14, s13
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1104              		.loc 1 202 98 view .LVU337
 1105 0218 67EE877A 		vmul.f32	s15, s15, s14
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1106              		.loc 1 202 158 view .LVU338
 1107 021c 9FED227A 		vldr.32	s14, .L84+24
 1108 0220 67EE877A 		vmul.f32	s15, s15, s14
 202:controller/engine_cycle/ignition.c ****             time_us_t duration_of_spark_and_dwell = (uint32_t)((float)number_of_scheduled_sparks * 
 1109              		.loc 1 202 23 view .LVU339
 1110 0224 FCEEE77A 		vcvt.u32.f32	s15, s15
 1111              	.LVL84:
 203:controller/engine_cycle/ignition.c ****             if (duration_of_spark_and_dwell >= config.multi_spark_max_trailing_angle * microseconds
 1112              		.loc 1 203 13 is_stmt 1 view .LVU340
 203:controller/engine_cycle/ignition.c ****             if (duration_of_spark_and_dwell >= config.multi_spark_max_trailing_angle * microseconds
 1113              		.loc 1 203 45 is_stmt 0 view .LVU341
 1114 0228 F8EE676A 		vcvt.f32.u32	s13, s15
 203:controller/engine_cycle/ignition.c ****             if (duration_of_spark_and_dwell >= config.multi_spark_max_trailing_angle * microseconds
 1115              		.loc 1 203 54 view .LVU342
 1116 022c 93ED867A 		vldr.32	s14, [r3, #536]
 203:controller/engine_cycle/ignition.c ****             if (duration_of_spark_and_dwell >= config.multi_spark_max_trailing_angle * microseconds
 1117              		.loc 1 203 86 discriminator 1 view .LVU343
 1118 0230 29EE077A 		vmul.f32	s14, s18, s14
 203:controller/engine_cycle/ignition.c ****             if (duration_of_spark_and_dwell >= config.multi_spark_max_trailing_angle * microseconds
 1119              		.loc 1 203 16 discriminator 1 view .LVU344
 1120 0234 F4EEC76A 		vcmpe.f32	s13, s14
 1121 0238 F1EE10FA 		vmrs	APSR_nzcv, FPSCR
 1122 023c 20DA     		bge	.L64
 208:controller/engine_cycle/ignition.c ****             dwell_start_time_us += duration_of_spark_and_dwell;
 1123              		.loc 1 208 13 is_stmt 1 view .LVU345
 208:controller/engine_cycle/ignition.c ****             dwell_start_time_us += duration_of_spark_and_dwell;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 34


 1124              		.loc 1 208 33 is_stmt 0 view .LVU346
 1125 023e 17EE903A 		vmov	r3, s15	@ int
 1126 0242 1E44     		add	r6, r6, r3
 1127              	.LVL85:
 209:controller/engine_cycle/ignition.c ****             spark_start_time_us += duration_of_spark_and_dwell;
 1128              		.loc 1 209 13 is_stmt 1 view .LVU347
 209:controller/engine_cycle/ignition.c ****             spark_start_time_us += duration_of_spark_and_dwell;
 1129              		.loc 1 209 33 is_stmt 0 view .LVU348
 1130 0244 1D44     		add	r5, r5, r3
 1131              	.LVL86:
 212:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (
 1132              		.loc 1 212 13 is_stmt 1 view .LVU349
 212:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (
 1133              		.loc 1 212 18 is_stmt 0 view .LVU350
 1134 0246 1C4A     		ldr	r2, .L84+40
 1135 0248 1E49     		ldr	r1, .L84+52
 1136 024a 2846     		mov	r0, r5
 1137 024c FFF7FEFF 		bl	scheduler_schedule_event_with_arg
 1138              	.LVL87:
 212:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(spark_start_time_us, ignition_coil_fire_spark, (
 1139              		.loc 1 212 16 discriminator 1 view .LVU351
 1140 0250 98B1     		cbz	r0, .L83
 218:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge,
 1141              		.loc 1 218 13 is_stmt 1 view .LVU352
 218:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge,
 1142              		.loc 1 218 18 is_stmt 0 view .LVU353
 1143 0252 194A     		ldr	r2, .L84+40
 1144 0254 1A49     		ldr	r1, .L84+48
 1145 0256 3046     		mov	r0, r6
 1146 0258 FFF7FEFF 		bl	scheduler_schedule_event_with_arg
 1147              	.LVL88:
 218:controller/engine_cycle/ignition.c ****             if (!scheduler_schedule_event_with_arg(dwell_start_time_us, ignition_coil_begin_charge,
 1148              		.loc 1 218 16 discriminator 1 view .LVU354
 1149 025c 80B1     		cbz	r0, .L64
 223:controller/engine_cycle/ignition.c ****             number_of_scheduled_sparks++;
 1150              		.loc 1 223 13 is_stmt 1 view .LVU355
 223:controller/engine_cycle/ignition.c ****             number_of_scheduled_sparks++;
 1151              		.loc 1 223 39 is_stmt 0 view .LVU356
 1152 025e 0134     		adds	r4, r4, #1
 1153              	.LVL89:
 223:controller/engine_cycle/ignition.c ****             number_of_scheduled_sparks++;
 1154              		.loc 1 223 39 view .LVU357
 1155 0260 E4B2     		uxtb	r4, r4
 1156              	.LVL90:
 223:controller/engine_cycle/ignition.c ****             number_of_scheduled_sparks++;
 1157              		.loc 1 223 39 view .LVU358
 1158 0262 C2E7     		b	.L63
 1159              	.LVL91:
 1160              	.L69:
 223:controller/engine_cycle/ignition.c ****             number_of_scheduled_sparks++;
 1161              		.loc 1 223 39 view .LVU359
 1162              	.LBE26:
 1163              	.LBE22:
 1164              	.LBB29:
 1165              	.LBB19:
 122:controller/utils/utils.h ****     }
 1166              		.loc 2 122 16 view .LVU360
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 35


 1167 0264 9FED0F6A 		vldr.32	s12, .L84+20
 1168 0268 59E7     		b	.L59
 1169              	.LVL92:
 1170              	.L70:
 122:controller/utils/utils.h ****     }
 1171              		.loc 2 122 16 view .LVU361
 1172              	.LBE19:
 1173              	.LBE29:
 1174              	.LBB30:
 1175              	.LBB27:
 1176              	.LBB25:
 109:controller/utils/utils.h ****     }
 1177              		.loc 2 109 16 view .LVU362
 1178 026a 9FED179A 		vldr.32	s18, .L84+56	@ int
 1179 026e 97E7     		b	.L62
 1180              	.LVL93:
 1181              	.L82:
 109:controller/utils/utils.h ****     }
 1182              		.loc 2 109 16 view .LVU363
 1183              	.LBE25:
 1184              	.LBE27:
 192:controller/engine_cycle/ignition.c ****             runtime.multi_spark_actual_spark_count = number_of_scheduled_sparks;
 1185              		.loc 1 192 13 is_stmt 1 view .LVU364
 192:controller/engine_cycle/ignition.c ****             runtime.multi_spark_actual_spark_count = number_of_scheduled_sparks;
 1186              		.loc 1 192 52 is_stmt 0 view .LVU365
 1187 0270 084B     		ldr	r3, .L84+4
 1188 0272 0122     		movs	r2, #1
 1189 0274 83F85220 		strb	r2, [r3, #82]
 193:controller/engine_cycle/ignition.c ****             return;
 1190              		.loc 1 193 13 is_stmt 1 view .LVU366
 1191 0278 07E7     		b	.L49
 1192              	.LVL94:
 1193              	.L83:
 1194              	.LBB28:
 215:controller/engine_cycle/ignition.c ****                 ignition_coil_fire_spark((void *)next_firing_cylinders);
 1195              		.loc 1 215 17 view .LVU367
 1196 027a 0F48     		ldr	r0, .L84+40
 1197 027c FFF7FEFF 		bl	ignition_coil_fire_spark
 1198              	.LVL95:
 216:controller/engine_cycle/ignition.c ****                 break;
 1199              		.loc 1 216 17 view .LVU368
 1200              	.L64:
 216:controller/engine_cycle/ignition.c ****                 break;
 1201              		.loc 1 216 17 is_stmt 0 view .LVU369
 1202              	.LBE28:
 225:controller/engine_cycle/ignition.c ****         spark_is_in_progress = true;
 1203              		.loc 1 225 9 is_stmt 1 view .LVU370
 225:controller/engine_cycle/ignition.c ****         spark_is_in_progress = true;
 1204              		.loc 1 225 30 is_stmt 0 view .LVU371
 1205 0280 0E4B     		ldr	r3, .L84+44
 1206 0282 0122     		movs	r2, #1
 1207 0284 1A70     		strb	r2, [r3]
 226:controller/engine_cycle/ignition.c ****         runtime.multi_spark_actual_spark_count = number_of_scheduled_sparks;
 1208              		.loc 1 226 9 is_stmt 1 view .LVU372
 226:controller/engine_cycle/ignition.c ****         runtime.multi_spark_actual_spark_count = number_of_scheduled_sparks;
 1209              		.loc 1 226 48 is_stmt 0 view .LVU373
 1210 0286 034B     		ldr	r3, .L84+4
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 36


 1211 0288 83F85240 		strb	r4, [r3, #82]
 1212 028c FDE6     		b	.L49
 1213              	.LVL96:
 1214              	.L78:
 1215              		.cfi_def_cfa_offset 0
 1216              		.cfi_restore 4
 1217              		.cfi_restore 5
 1218              		.cfi_restore 6
 1219              		.cfi_restore 14
 1220              		.cfi_restore 80
 1221              		.cfi_restore 81
 1222              		.cfi_restore 82
 1223              		.cfi_restore 83
 226:controller/engine_cycle/ignition.c ****         runtime.multi_spark_actual_spark_count = number_of_scheduled_sparks;
 1224              		.loc 1 226 48 view .LVU374
 1225 028e 7047     		bx	lr
 1226              	.L85:
 1227              		.align	2
 1228              	.L84:
 1229 0290 00100000 		.word	config+4096
 1230 0294 00000000 		.word	runtime
 1231 0298 00000000 		.word	.LC6
 1232 029c 1C000000 		.word	.LC7
 1233 02a0 00002042 		.word	1109393408
 1234 02a4 00000000 		.word	0
 1235 02a8 00007A44 		.word	1148846080
 1236 02ac 0000B443 		.word	1135869952
 1237 02b0 C0E1644C 		.word	1281679808
 1238 02b4 00000000 		.word	ignition_order
 1239 02b8 00000000 		.word	next_firing_cylinders.0
 1240 02bc 00000000 		.word	spark_is_in_progress
 1241 02c0 00000000 		.word	ignition_coil_begin_charge
 1242 02c4 00000000 		.word	ignition_coil_fire_spark
 1243 02c8 00000000 		.word	0
 1244              	.LBE30:
 1245              		.cfi_endproc
 1246              	.LFE233:
 1248              		.section	.bss.next_firing_cylinders.0,"aw",%nobits
 1249              		.align	2
 1252              	next_firing_cylinders.0:
 1253 0000 0000     		.space	2
 1254              		.section	.bss.number_of_cylinders,"aw",%nobits
 1257              	number_of_cylinders:
 1258 0000 00       		.space	1
 1259              		.section	.bss.spark_is_in_progress,"aw",%nobits
 1262              	spark_is_in_progress:
 1263 0000 00       		.space	1
 1264              		.global	ignition_order
 1265              		.section	.bss.ignition_order,"aw",%nobits
 1266              		.align	2
 1269              	ignition_order:
 1270 0000 00000000 		.space	8
 1270      00000000 
 1271              		.global	ignition_coil_state
 1272              		.section	.bss.ignition_coil_state,"aw",%nobits
 1273              		.align	2
 1276              	ignition_coil_state:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 37


 1277 0000 00000000 		.space	4
 1278              		.global	ignition_outputs
 1279              		.section	.bss.ignition_outputs,"aw",%nobits
 1280              		.align	2
 1283              	ignition_outputs:
 1284 0000 00000000 		.space	4
 1285              		.text
 1286              	.Letext0:
 1287              		.file 3 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 1288              		.file 4 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 1289              		.file 5 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 1290              		.file 6 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f401xc.h"
 1291              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_gpio.h"
 1292              		.file 8 "controller/types.h"
 1293              		.file 9 "controller/tables.h"
 1294              		.file 10 "controller/config_and_runtime.h"
 1295              		.file 11 "controller/engine_cycle/trigger.h"
 1296              		.file 12 "controller/engine_cycle/ignition.h"
 1297              		.file 13 "controller/IO/sensors.h"
 1298              		.file 14 "controller/utils/timing.h"
 1299              		.file 15 "controller/utils/error_handling.h"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s 			page 38


DEFINED SYMBOLS
                            *ABS*:00000000 ignition.c
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:21     .rodata.ignition_coil_begin_charge.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:25     .text.ignition_coil_begin_charge:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:31     .text.ignition_coil_begin_charge:00000000 ignition_coil_begin_charge
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:124    .text.ignition_coil_begin_charge:00000054 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1276   .bss.ignition_coil_state:00000000 ignition_coil_state
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1283   .bss.ignition_outputs:00000000 ignition_outputs
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:131    .text.ignition_coil_fire_spark:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:137    .text.ignition_coil_fire_spark:00000000 ignition_coil_fire_spark
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:234    .text.ignition_coil_fire_spark:00000058 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1262   .bss.spark_is_in_progress:00000000 spark_is_in_progress
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:242    .rodata.ignition_init.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:259    .text.ignition_init:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:265    .text.ignition_init:00000000 ignition_init
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:595    .text.ignition_init:00000144 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1257   .bss.number_of_cylinders:00000000 number_of_cylinders
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1269   .bss.ignition_order:00000000 ignition_order
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:611    .text.ignition_get_coil_duty_cycle:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:617    .text.ignition_get_coil_duty_cycle:00000000 ignition_get_coil_duty_cycle
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:630    .text.ignition_get_advance:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:636    .text.ignition_get_advance:00000000 ignition_get_advance
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:706    .text.ignition_get_advance:00000040 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:713    .rodata.ignition_trigger_event_handle.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:720    .text.ignition_trigger_event_handle:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:726    .text.ignition_trigger_event_handle:00000000 ignition_trigger_event_handle
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1229   .text.ignition_trigger_event_handle:00000290 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1252   .bss.next_firing_cylinders.0:00000000 next_firing_cylinders.0
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1249   .bss.next_firing_cylinders.0:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1258   .bss.number_of_cylinders:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1263   .bss.spark_is_in_progress:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1266   .bss.ignition_order:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1273   .bss.ignition_coil_state:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccCH7i89.s:1280   .bss.ignition_outputs:00000000 $d

UNDEFINED SYMBOLS
log_error
HAL_GPIO_WritePin
log_warning
HAL_GPIO_ReadPin
config
runtime
crankshaft_get_rpm
sensor_map_get
table_2d_get_value
scheduler_schedule_event_with_arg
