ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"comms.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "controller/utils/comms.c"
  20              		.section	.rodata.comm_task_entry.str1.4,"aMS",%progbits,1
  21              		.align	2
  22              	.LC0:
  23 0000 30303200 		.ascii	"002\000"
  24              		.section	.text.comm_task_entry,"ax",%progbits
  25              		.align	1
  26              		.global	comm_task_entry
  27              		.syntax unified
  28              		.thumb
  29              		.thumb_func
  31              	comm_task_entry:
  32              	.LFB229:
   1:controller/utils/comms.c **** #include "comms.h"
   2:controller/utils/comms.c **** #include "usbd_cdc_if.h" // For CDC_Transmit_FS
   3:controller/utils/comms.c **** #include "controller.h" // For signature and version strings
   4:controller/utils/comms.c **** #include <string.h> // For strlen(), memcmp()
   5:controller/utils/comms.c **** 
   6:controller/utils/comms.c **** // Global handle for the message queue (defined here as it's created in main)
   7:controller/utils/comms.c **** osMessageQueueId_t usb_rx_queue_handle;
   8:controller/utils/comms.c **** 
   9:controller/utils/comms.c **** osThreadId_t comm_task_handle;
  10:controller/utils/comms.c **** 
  11:controller/utils/comms.c **** 
  12:controller/utils/comms.c **** 
  13:controller/utils/comms.c **** typedef enum {
  14:controller/utils/comms.c **** 	TS_PLAIN = 0,
  15:controller/utils/comms.c **** 	TS_CRC = 1
  16:controller/utils/comms.c **** } ts_response_format_e;
  17:controller/utils/comms.c **** 
  18:controller/utils/comms.c **** void comms_send_response(ts_response_format_e mode, const uint8_t *buffer, size_t size);
  19:controller/utils/comms.c **** void comms_write_crc_packet(uint8_t response_code, const uint8_t *buffer, size_t size);
  20:controller/utils/comms.c **** void serial_write(const uint8_t* buffer, size_t size);
  21:controller/utils/comms.c **** 
  22:controller/utils/comms.c **** void comms_init()
  23:controller/utils/comms.c **** {
  24:controller/utils/comms.c ****     // usb_rx_queue_handle is declared extern in comms.h
  25:controller/utils/comms.c ****     usb_rx_queue_handle = osMessageQueueNew(
  26:controller/utils/comms.c ****       8, // Queue size: Can hold 8 usb_rx_packet_t messages
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 2


  27:controller/utils/comms.c ****       sizeof(usb_rx_packet_t),
  28:controller/utils/comms.c ****       NULL // Default attributes
  29:controller/utils/comms.c ****     );
  30:controller/utils/comms.c ****     // Define and create the communication task
  31:controller/utils/comms.c ****     const osThreadAttr_t comm_task_attributes = {
  32:controller/utils/comms.c ****     .name = "CommTask", // Name for debugging
  33:controller/utils/comms.c ****     .stack_size = 512 * 4, // Stack size in bytes (adjust as needed, 512 words typical)
  34:controller/utils/comms.c ****     .priority = (osPriority_t) osPriorityNormal, // Task priority
  35:controller/utils/comms.c ****     };
  36:controller/utils/comms.c ****     comm_task_handle = osThreadNew(comm_task_entry, NULL, &comm_task_attributes);
  37:controller/utils/comms.c **** }
  38:controller/utils/comms.c **** 
  39:controller/utils/comms.c **** // --- Task Entry Function ---
  40:controller/utils/comms.c **** void comm_task_entry(void *argument) {
  33              		.loc 1 40 38 view -0
  34              		.cfi_startproc
  35              		@ args = 0, pretend = 0, frame = 72
  36              		@ frame_needed = 0, uses_anonymous_args = 0
  37              	.LVL0:
  38              		.loc 1 40 38 is_stmt 0 view .LVU1
  39 0000 00B5     		push	{lr}
  40              		.cfi_def_cfa_offset 4
  41              		.cfi_offset 14, -4
  42 0002 93B0     		sub	sp, sp, #76
  43              		.cfi_def_cfa_offset 80
  44 0004 03E0     		b	.L2
  45              	.LVL1:
  46              	.L4:
  47              	.LBB2:
  41:controller/utils/comms.c ****     for (;;) {
  42:controller/utils/comms.c ****         usb_rx_packet_t received_packet;
  43:controller/utils/comms.c ****         osStatus_t status = osMessageQueueGet(usb_rx_queue_handle, &received_packet, NULL, osWaitFo
  44:controller/utils/comms.c ****         if (status != osOK) { continue; }
  45:controller/utils/comms.c ****         HAL_GPIO_TogglePin(LED_GPIO_Port, LED_Pin);
  46:controller/utils/comms.c ****         volatile uint8_t command;
  47:controller/utils/comms.c ****         command = received_packet.data[0];
  48:controller/utils/comms.c ****         if (command == 0)
  49:controller/utils/comms.c ****         {
  50:controller/utils/comms.c ****             continue;// ignore null commands
  51:controller/utils/comms.c ****         }
  52:controller/utils/comms.c ****         else if (command == TS_QUERY_COMMAND || command == TS_HELLO_COMMAND)
  53:controller/utils/comms.c ****         {
  54:controller/utils/comms.c ****             
  55:controller/utils/comms.c ****             CDC_Transmit_FS(TS_SIGNATURE, sizeof(TS_SIGNATURE));
  48              		.loc 1 55 13 is_stmt 1 view .LVU2
  49 0006 0421     		movs	r1, #4
  50 0008 1648     		ldr	r0, .L9
  51 000a FFF7FEFF 		bl	CDC_Transmit_FS
  52              	.LVL2:
  53              	.L2:
  54              		.loc 1 55 13 is_stmt 0 view .LVU3
  55              	.LBE2:
  41:controller/utils/comms.c ****     for (;;) {
  56              		.loc 1 41 5 is_stmt 1 view .LVU4
  57              	.LBB3:
  42:controller/utils/comms.c ****         osStatus_t status = osMessageQueueGet(usb_rx_queue_handle, &received_packet, NULL, osWaitFo
  58              		.loc 1 42 9 view .LVU5
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 3


  43:controller/utils/comms.c ****         if (status != osOK) { continue; }
  59              		.loc 1 43 9 view .LVU6
  43:controller/utils/comms.c ****         if (status != osOK) { continue; }
  60              		.loc 1 43 29 is_stmt 0 view .LVU7
  61 000e 4FF0FF33 		mov	r3, #-1
  62 0012 0022     		movs	r2, #0
  63 0014 01A9     		add	r1, sp, #4
  64 0016 1448     		ldr	r0, .L9+4
  65 0018 0068     		ldr	r0, [r0]
  66 001a FFF7FEFF 		bl	osMessageQueueGet
  67              	.LVL3:
  44:controller/utils/comms.c ****         HAL_GPIO_TogglePin(LED_GPIO_Port, LED_Pin);
  68              		.loc 1 44 9 is_stmt 1 view .LVU8
  44:controller/utils/comms.c ****         HAL_GPIO_TogglePin(LED_GPIO_Port, LED_Pin);
  69              		.loc 1 44 12 is_stmt 0 view .LVU9
  70 001e 0028     		cmp	r0, #0
  71 0020 F5D1     		bne	.L2
  45:controller/utils/comms.c ****         volatile uint8_t command;
  72              		.loc 1 45 9 is_stmt 1 view .LVU10
  73 0022 4FF40051 		mov	r1, #8192
  74 0026 00F18040 		add	r0, r0, #1073741824
  75              	.LVL4:
  45:controller/utils/comms.c ****         volatile uint8_t command;
  76              		.loc 1 45 9 is_stmt 0 view .LVU11
  77 002a 00F50230 		add	r0, r0, #133120
  78              	.LVL5:
  45:controller/utils/comms.c ****         volatile uint8_t command;
  79              		.loc 1 45 9 view .LVU12
  80 002e FFF7FEFF 		bl	HAL_GPIO_TogglePin
  81              	.LVL6:
  46:controller/utils/comms.c ****         command = received_packet.data[0];
  82              		.loc 1 46 9 is_stmt 1 view .LVU13
  47:controller/utils/comms.c ****         if (command == 0)
  83              		.loc 1 47 9 view .LVU14
  47:controller/utils/comms.c ****         if (command == 0)
  84              		.loc 1 47 39 is_stmt 0 view .LVU15
  85 0032 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
  47:controller/utils/comms.c ****         if (command == 0)
  86              		.loc 1 47 17 view .LVU16
  87 0036 8DF80330 		strb	r3, [sp, #3]
  48:controller/utils/comms.c ****         {
  88              		.loc 1 48 9 is_stmt 1 view .LVU17
  48:controller/utils/comms.c ****         {
  89              		.loc 1 48 21 is_stmt 0 view .LVU18
  90 003a 9DF80330 		ldrb	r3, [sp, #3]	@ zero_extendqisi2
  48:controller/utils/comms.c ****         {
  91              		.loc 1 48 12 view .LVU19
  92 003e 002B     		cmp	r3, #0
  93 0040 E5D0     		beq	.L2
  52:controller/utils/comms.c ****         {
  94              		.loc 1 52 14 is_stmt 1 view .LVU20
  52:controller/utils/comms.c ****         {
  95              		.loc 1 52 26 is_stmt 0 view .LVU21
  96 0042 9DF80330 		ldrb	r3, [sp, #3]	@ zero_extendqisi2
  52:controller/utils/comms.c ****         {
  97              		.loc 1 52 17 view .LVU22
  98 0046 512B     		cmp	r3, #81
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 4


  99 0048 DDD0     		beq	.L4
  52:controller/utils/comms.c ****         {
 100              		.loc 1 52 57 discriminator 1 view .LVU23
 101 004a 9DF80330 		ldrb	r3, [sp, #3]	@ zero_extendqisi2
  52:controller/utils/comms.c ****         {
 102              		.loc 1 52 46 discriminator 1 view .LVU24
 103 004e 532B     		cmp	r3, #83
 104 0050 D9D0     		beq	.L4
  56:controller/utils/comms.c ****         }
  57:controller/utils/comms.c ****         else if (command == TS_COMMAND_F)
 105              		.loc 1 57 14 is_stmt 1 view .LVU25
 106              		.loc 1 57 26 is_stmt 0 view .LVU26
 107 0052 9DF80330 		ldrb	r3, [sp, #3]	@ zero_extendqisi2
 108              		.loc 1 57 17 view .LVU27
 109 0056 462B     		cmp	r3, #70
 110 0058 D9D1     		bne	.L2
  58:controller/utils/comms.c ****         {
  59:controller/utils/comms.c ****             CDC_Transmit_FS(TS_PROTOCOL, sizeof(TS_PROTOCOL));
 111              		.loc 1 59 13 is_stmt 1 view .LVU28
 112 005a 0421     		movs	r1, #4
 113 005c 0348     		ldr	r0, .L9+8
 114 005e FFF7FEFF 		bl	CDC_Transmit_FS
 115              	.LVL7:
 116 0062 D4E7     		b	.L2
 117              	.L10:
 118              		.align	2
 119              	.L9:
 120 0064 00000000 		.word	TS_SIGNATURE
 121 0068 00000000 		.word	usb_rx_queue_handle
 122 006c 00000000 		.word	.LC0
 123              	.LBE3:
 124              		.cfi_endproc
 125              	.LFE229:
 127              		.section	.rodata.comms_init.str1.4,"aMS",%progbits,1
 128              		.align	2
 129              	.LC1:
 130 0000 436F6D6D 		.ascii	"CommTask\000"
 130      5461736B 
 130      00
 131              		.section	.text.comms_init,"ax",%progbits
 132              		.align	1
 133              		.global	comms_init
 134              		.syntax unified
 135              		.thumb
 136              		.thumb_func
 138              	comms_init:
 139              	.LFB228:
  23:controller/utils/comms.c ****     // usb_rx_queue_handle is declared extern in comms.h
 140              		.loc 1 23 1 view -0
 141              		.cfi_startproc
 142              		@ args = 0, pretend = 0, frame = 40
 143              		@ frame_needed = 0, uses_anonymous_args = 0
 144 0000 10B5     		push	{r4, lr}
 145              		.cfi_def_cfa_offset 8
 146              		.cfi_offset 4, -8
 147              		.cfi_offset 14, -4
 148 0002 8AB0     		sub	sp, sp, #40
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 5


 149              		.cfi_def_cfa_offset 48
  25:controller/utils/comms.c ****       8, // Queue size: Can hold 8 usb_rx_packet_t messages
 150              		.loc 1 25 5 view .LVU30
  25:controller/utils/comms.c ****       8, // Queue size: Can hold 8 usb_rx_packet_t messages
 151              		.loc 1 25 27 is_stmt 0 view .LVU31
 152 0004 0022     		movs	r2, #0
 153 0006 4421     		movs	r1, #68
 154 0008 0820     		movs	r0, #8
 155 000a FFF7FEFF 		bl	osMessageQueueNew
 156              	.LVL8:
  25:controller/utils/comms.c ****       8, // Queue size: Can hold 8 usb_rx_packet_t messages
 157              		.loc 1 25 25 discriminator 1 view .LVU32
 158 000e 0C4B     		ldr	r3, .L13
 159 0010 1860     		str	r0, [r3]
  31:controller/utils/comms.c ****     .name = "CommTask", // Name for debugging
 160              		.loc 1 31 5 is_stmt 1 view .LVU33
  31:controller/utils/comms.c ****     .name = "CommTask", // Name for debugging
 161              		.loc 1 31 26 is_stmt 0 view .LVU34
 162 0012 01AC     		add	r4, sp, #4
 163 0014 2422     		movs	r2, #36
 164 0016 0021     		movs	r1, #0
 165 0018 2046     		mov	r0, r4
 166 001a FFF7FEFF 		bl	memset
 167              	.LVL9:
 168 001e 094B     		ldr	r3, .L13+4
 169 0020 0193     		str	r3, [sp, #4]
 170 0022 4FF40063 		mov	r3, #2048
 171 0026 0693     		str	r3, [sp, #24]
 172 0028 1823     		movs	r3, #24
 173 002a 0793     		str	r3, [sp, #28]
  36:controller/utils/comms.c **** }
 174              		.loc 1 36 5 is_stmt 1 view .LVU35
  36:controller/utils/comms.c **** }
 175              		.loc 1 36 24 is_stmt 0 view .LVU36
 176 002c 2246     		mov	r2, r4
 177 002e 0021     		movs	r1, #0
 178 0030 0548     		ldr	r0, .L13+8
 179 0032 FFF7FEFF 		bl	osThreadNew
 180              	.LVL10:
  36:controller/utils/comms.c **** }
 181              		.loc 1 36 22 discriminator 1 view .LVU37
 182 0036 054B     		ldr	r3, .L13+12
 183 0038 1860     		str	r0, [r3]
  37:controller/utils/comms.c **** 
 184              		.loc 1 37 1 view .LVU38
 185 003a 0AB0     		add	sp, sp, #40
 186              		.cfi_def_cfa_offset 8
 187              		@ sp needed
 188 003c 10BD     		pop	{r4, pc}
 189              	.L14:
 190 003e 00BF     		.align	2
 191              	.L13:
 192 0040 00000000 		.word	usb_rx_queue_handle
 193 0044 00000000 		.word	.LC1
 194 0048 00000000 		.word	comm_task_entry
 195 004c 00000000 		.word	comm_task_handle
 196              		.cfi_endproc
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 6


 197              	.LFE228:
 199              		.section	.text.comms_send_response,"ax",%progbits
 200              		.align	1
 201              		.global	comms_send_response
 202              		.syntax unified
 203              		.thumb
 204              		.thumb_func
 206              	comms_send_response:
 207              	.LVL11:
 208              	.LFB230:
  60:controller/utils/comms.c ****         }
  61:controller/utils/comms.c ****         
  62:controller/utils/comms.c ****     }
  63:controller/utils/comms.c ****     
  64:controller/utils/comms.c **** }
  65:controller/utils/comms.c **** 
  66:controller/utils/comms.c **** void comms_send_response(ts_response_format_e mode, const uint8_t *buffer, size_t size)
  67:controller/utils/comms.c **** {
 209              		.loc 1 67 1 is_stmt 1 view -0
 210              		.cfi_startproc
 211              		@ args = 0, pretend = 0, frame = 0
 212              		@ frame_needed = 0, uses_anonymous_args = 0
 213              		@ link register save eliminated.
  68:controller/utils/comms.c ****     if (size == 0)
 214              		.loc 1 68 5 view .LVU40
  69:controller/utils/comms.c ****         return;
 215              		.loc 1 69 9 view .LVU41
  70:controller/utils/comms.c ****     if (mode == TS_CRC)
  71:controller/utils/comms.c ****     {
  72:controller/utils/comms.c ****         // writeCrcPacket(TS_RESPONSE_OK, buffer, size);
  73:controller/utils/comms.c ****     }
  74:controller/utils/comms.c ****     else
  75:controller/utils/comms.c ****     {
  76:controller/utils/comms.c ****         serial_write(buffer, size);
  77:controller/utils/comms.c ****     }
  78:controller/utils/comms.c **** }
 216              		.loc 1 78 1 is_stmt 0 view .LVU42
 217 0000 7047     		bx	lr
 218              		.cfi_endproc
 219              	.LFE230:
 221              		.section	.text.serial_write,"ax",%progbits
 222              		.align	1
 223              		.global	serial_write
 224              		.syntax unified
 225              		.thumb
 226              		.thumb_func
 228              	serial_write:
 229              	.LVL12:
 230              	.LFB231:
  79:controller/utils/comms.c **** 
  80:controller/utils/comms.c **** void serial_write(const uint8_t* buffer, size_t size)
  81:controller/utils/comms.c **** {
 231              		.loc 1 81 1 is_stmt 1 view -0
 232              		.cfi_startproc
 233              		@ args = 0, pretend = 0, frame = 0
 234              		@ frame_needed = 0, uses_anonymous_args = 0
 235              		@ link register save eliminated.
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 7


  82:controller/utils/comms.c **** 	
  83:controller/utils/comms.c ****     if (size == 0)
 236              		.loc 1 83 5 view .LVU44
  84:controller/utils/comms.c ****     {
  85:controller/utils/comms.c ****         return;
 237              		.loc 1 85 9 view .LVU45
  86:controller/utils/comms.c ****     }
  87:controller/utils/comms.c ****     
  88:controller/utils/comms.c **** }...
 238              		.loc 1 88 1 is_stmt 0 view .LVU46
 239 0000 7047     		bx	lr
 240              		.cfi_endproc
 241              	.LFE231:
 243              		.global	comm_task_handle
 244              		.section	.bss.comm_task_handle,"aw",%nobits
 245              		.align	2
 248              	comm_task_handle:
 249 0000 00000000 		.space	4
 250              		.global	usb_rx_queue_handle
 251              		.section	.bss.usb_rx_queue_handle,"aw",%nobits
 252              		.align	2
 255              	usb_rx_queue_handle:
 256 0000 00000000 		.space	4
 257              		.section	.rodata.TS_SIGNATURE,"a"
 258              		.align	2
 261              	TS_SIGNATURE:
 262 0000 00534743 		.ascii	"\000SGC"
 263              		.text
 264              	.Letext0:
 265              		.file 2 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 266              		.file 3 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 267              		.file 4 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 268              		.file 5 "Middlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS_V2/cmsis_os2.h"
 269              		.file 6 "controller/utils/comms.h"
 270              		.file 7 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f401xc.h"
 271              		.file 8 "USB_DEVICE/App/usbd_cdc_if.h"
 272              		.file 9 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_gpio.h"
 273              		.file 10 "<built-in>"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s 			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 comms.c
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:21     .rodata.comm_task_entry.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:25     .text.comm_task_entry:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:31     .text.comm_task_entry:00000000 comm_task_entry
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:120    .text.comm_task_entry:00000064 $d
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:261    .rodata.TS_SIGNATURE:00000000 TS_SIGNATURE
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:255    .bss.usb_rx_queue_handle:00000000 usb_rx_queue_handle
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:128    .rodata.comms_init.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:132    .text.comms_init:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:138    .text.comms_init:00000000 comms_init
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:192    .text.comms_init:00000040 $d
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:248    .bss.comm_task_handle:00000000 comm_task_handle
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:200    .text.comms_send_response:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:206    .text.comms_send_response:00000000 comms_send_response
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:222    .text.serial_write:00000000 $t
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:228    .text.serial_write:00000000 serial_write
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:245    .bss.comm_task_handle:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:252    .bss.usb_rx_queue_handle:00000000 $d
C:\Users\alireza\AppData\Local\Temp\ccrOfV2g.s:258    .rodata.TS_SIGNATURE:00000000 $d

UNDEFINED SYMBOLS
CDC_Transmit_FS
osMessageQueueGet
HAL_GPIO_TogglePin
osMessageQueueNew
memset
osThreadNew
