ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"comms.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "controller/utils/comms.c"
  20              		.section	.text.runtime_update_task,"ax",%progbits
  21              		.align	1
  22              		.global	runtime_update_task
  23              		.syntax unified
  24              		.thumb
  25              		.thumb_func
  27              	runtime_update_task:
  28              	.LFB239:
   1:controller/utils/comms.c **** #include "comms.h"
   2:controller/utils/comms.c **** #include "usbd_cdc_if.h"
   3:controller/utils/comms.c **** #include <string.h>
   4:controller/utils/comms.c **** #include "utils.h"
   5:controller/utils/comms.c **** #include "crc.h"
   6:controller/utils/comms.c **** #include "timing.h"
   7:controller/utils/comms.c **** #include "controller.h"
   8:controller/utils/comms.c **** /*******************************************************************************
   9:controller/utils/comms.c ****  *                          TUNERSTUDIO PROTOCOL PACKET FORMAT
  10:controller/utils/comms.c ****  * 
  11:controller/utils/comms.c ****  * ┌───────────────────────────────
  12:controller/utils/comms.c ****  * │                            HOST → ECU REQUEST                            │
  13:controller/utils/comms.c ****  * ├──────────┬────────────────────
  14:controller/utils/comms.c ****  * │   SIZE   │              PAYLOAD (CMD + DATA)              │    CRC32     │
  15:controller/utils/comms.c ****  * └──────────┴────────────────────
  16:controller/utils/comms.c ****  * 
  17:controller/utils/comms.c ****  *    2 bytes                      N bytes                         4 bytes
  18:controller/utils/comms.c ****  * 
  19:controller/utils/comms.c ****  * 
  20:controller/utils/comms.c ****  * ┌───────────────────────────────
  21:controller/utils/comms.c ****  * │                            ECU → HOST RESPONSE                            │
  22:controller/utils/comms.c ****  * ├──────────┬──────────┬─────────
  23:controller/utils/comms.c ****  * │   SIZE   │   FLAG   │           PAYLOAD (DATA)             │    CRC32     │
  24:controller/utils/comms.c ****  * └──────────┴──────────┴─────────
  25:controller/utils/comms.c ****  * 
  26:controller/utils/comms.c ****  *    2 bytes    1 byte                 N bytes                    4 bytes
  27:controller/utils/comms.c ****  * 
  28:controller/utils/comms.c ****  * NOTES:
  29:controller/utils/comms.c ****  * - SIZE: Big-endian uint16 (payload length EXCLUDING CRC)
  30:controller/utils/comms.c ****  * - FLAG: 0x00=OK, 0x7F=ERROR, 0x5A=DATA_PENDING
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 2


  31:controller/utils/comms.c ****  * - CRC32: Calculated over Size+Payload (EXCLUDING the CRC itself)
  32:controller/utils/comms.c ****  * - All multi-byte fields use BIG-ENDIAN byte order
  33:controller/utils/comms.c ****  * - Minimum packet size: 7 bytes (2+1+0+4 for empty response)
  34:controller/utils/comms.c ****  * For every packet sent to the Megasquirt, there will be a response packet, so the sender can vali
  35:controller/utils/comms.c **** reception. The sender MUST act on the response code and MUST check the CRC32.
  36:controller/utils/comms.c ****  ******************************************************************************/
  37:controller/utils/comms.c **** // ==================== Global Variables ====================
  38:controller/utils/comms.c **** osMessageQueueId_t usb_rx_queue;
  39:controller/utils/comms.c **** output_channels_t output_channels;
  40:controller/utils/comms.c **** calibration_page calibration_values;
  41:controller/utils/comms.c **** 
  42:controller/utils/comms.c **** usb_rx_packet_t rx_packet;
  43:controller/utils/comms.c **** /**
  44:controller/utils/comms.c ****  * See 'blockingFactor' in .ini
  45:controller/utils/comms.c ****  */
  46:controller/utils/comms.c **** uint8_t tx_buffer[TS_BLOCKING_FACTOR + 30];
  47:controller/utils/comms.c **** uint8_t rx_buffer[TS_BLOCKING_FACTOR + 30];
  48:controller/utils/comms.c **** 
  49:controller/utils/comms.c **** /* Function delcearations  */
  50:controller/utils/comms.c **** /**
  51:controller/utils/comms.c ****  * @note size can be zero to transmit an empty packet
  52:controller/utils/comms.c ****  */
  53:controller/utils/comms.c **** void send_response(uint8_t flag, uint8_t *data, size_t size, comms_response_format_t mode);
  54:controller/utils/comms.c **** void transmit_crc_packet(uint8_t flag, const uint8_t *buf, size_t size);
  55:controller/utils/comms.c **** bool process_plain_command(uint8_t *request, uint16_t size);
  56:controller/utils/comms.c **** void process_command(uint8_t *request, uint16_t size);
  57:controller/utils/comms.c **** void handle_page_read_command(uint16_t page, uint16_t offset, uint16_t count);
  58:controller/utils/comms.c **** void handle_page_write_command(uint16_t page, uint16_t offset, uint16_t count);
  59:controller/utils/comms.c **** 
  60:controller/utils/comms.c **** /* Function definations */
  61:controller/utils/comms.c **** 
  62:controller/utils/comms.c **** void send_response(uint8_t flag, uint8_t *data, size_t size, comms_response_format_t mode)
  63:controller/utils/comms.c **** {
  64:controller/utils/comms.c **** 
  65:controller/utils/comms.c ****     if (mode == TS_CRC)
  66:controller/utils/comms.c ****     {
  67:controller/utils/comms.c ****         transmit_crc_packet(flag, data, size);
  68:controller/utils/comms.c ****     }
  69:controller/utils/comms.c ****     else
  70:controller/utils/comms.c ****     {
  71:controller/utils/comms.c ****         if (size > 0)
  72:controller/utils/comms.c ****         {
  73:controller/utils/comms.c **** 			memcpy(tx_buffer, data, size);
  74:controller/utils/comms.c ****             CDC_Transmit_FS(tx_buffer, size);
  75:controller/utils/comms.c ****         }
  76:controller/utils/comms.c ****     }
  77:controller/utils/comms.c **** 	HAL_GPIO_WritePin(LED_GPIO_Port, LED_Pin, GPIO_PIN_SET);
  78:controller/utils/comms.c **** }
  79:controller/utils/comms.c **** 
  80:controller/utils/comms.c **** void transmit_crc_packet(uint8_t flag, const uint8_t *buf, size_t size)
  81:controller/utils/comms.c **** {
  82:controller/utils/comms.c **** 
  83:controller/utils/comms.c **** 	/* We first calculate the prefix */
  84:controller/utils/comms.c ****     uint16_t packet_size = 0;
  85:controller/utils/comms.c **** 	packet_size += 2; // prefix
  86:controller/utils/comms.c **** 	packet_size += 1; // flag
  87:controller/utils/comms.c **** 	packet_size += 4; // CRC
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 3


  88:controller/utils/comms.c **** 	packet_size += size; // payload
  89:controller/utils/comms.c **** 
  90:controller/utils/comms.c **** 	/* Converte the size to big endian */
  91:controller/utils/comms.c **** 	uint16_t prefix = 0;
  92:controller/utils/comms.c **** 	prefix = swap_endian_uint16(sizeof(flag) + size);
  93:controller/utils/comms.c **** 
  94:controller/utils/comms.c **** 	/* Now we calculate the CRC, over the flag and payload */
  95:controller/utils/comms.c **** 	uint32_t crc = 0;
  96:controller/utils/comms.c **** 	crc = crc32_inc(0, (void*)&flag, 1); // flag
  97:controller/utils/comms.c **** 	crc = crc32_inc(crc, buf, size); // payload
  98:controller/utils/comms.c **** 
  99:controller/utils/comms.c **** 	/* Converte the crc to big endian */
 100:controller/utils/comms.c **** 	uint32_t suffix = 0;
 101:controller/utils/comms.c **** 	suffix = swap_endian_uint32(crc);
 102:controller/utils/comms.c **** 
 103:controller/utils/comms.c **** 	/* Form the packet in the transmit buffer */
 104:controller/utils/comms.c **** 	size_t tx_buffer_index = 0;
 105:controller/utils/comms.c **** 	memcpy(tx_buffer, &prefix, sizeof(prefix)); // prefix to buffer
 106:controller/utils/comms.c **** 	tx_buffer_index += sizeof(prefix);
 107:controller/utils/comms.c **** 	memcpy(tx_buffer + tx_buffer_index, &flag, sizeof(flag)); // flag to buffer
 108:controller/utils/comms.c **** 	tx_buffer_index += sizeof(flag);
 109:controller/utils/comms.c **** 	memcpy(tx_buffer + tx_buffer_index, buf, size); // payload to buffer
 110:controller/utils/comms.c **** 	tx_buffer_index += size;
 111:controller/utils/comms.c **** 	memcpy(tx_buffer + tx_buffer_index, &suffix, sizeof(suffix)); // suffix to buffer
 112:controller/utils/comms.c **** 	tx_buffer_index += sizeof(suffix);
 113:controller/utils/comms.c **** 
 114:controller/utils/comms.c **** 	/* Finally transmit over USB */
 115:controller/utils/comms.c **** 
 116:controller/utils/comms.c **** 	CDC_Transmit_FS(tx_buffer, packet_size);
 117:controller/utils/comms.c **** }
 118:controller/utils/comms.c **** 
 119:controller/utils/comms.c **** 
 120:controller/utils/comms.c **** 
 121:controller/utils/comms.c **** // ==================== Initialization ====================
 122:controller/utils/comms.c **** void comms_init(void)
 123:controller/utils/comms.c **** {
 124:controller/utils/comms.c **** 	usb_rx_queue = osMessageQueueNew(10, sizeof(usb_packet_ptr_t), NULL);
 125:controller/utils/comms.c **** 
 126:controller/utils/comms.c **** 
 127:controller/utils/comms.c **** 
 128:controller/utils/comms.c ****     const osThreadAttr_t comms_task_attrs = {
 129:controller/utils/comms.c ****         .name = "comms_task",
 130:controller/utils/comms.c ****         .stack_size = 1024 * 4,
 131:controller/utils/comms.c ****         .priority = osPriorityNormal,
 132:controller/utils/comms.c ****     };
 133:controller/utils/comms.c ****     osThreadNew(comms_task, NULL, &comms_task_attrs);
 134:controller/utils/comms.c **** 
 135:controller/utils/comms.c **** 	const osThreadAttr_t runtime_update_task_attrs = {
 136:controller/utils/comms.c **** 		.name = "update_task",
 137:controller/utils/comms.c **** 		.stack_size = 1024,
 138:controller/utils/comms.c **** 		.priority = osPriorityNormal,
 139:controller/utils/comms.c **** 	};
 140:controller/utils/comms.c **** 	osThreadNew(runtime_update_task, NULL, &runtime_update_task_attrs);
 141:controller/utils/comms.c **** }
 142:controller/utils/comms.c **** 
 143:controller/utils/comms.c **** // ==================== Communication Task ====================
 144:controller/utils/comms.c **** void comms_task(void *argument)
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 4


 145:controller/utils/comms.c **** {
 146:controller/utils/comms.c ****     usb_packet_ptr_t packet;
 147:controller/utils/comms.c ****     for (;;)
 148:controller/utils/comms.c ****     {
 149:controller/utils/comms.c ****         if (osMessageQueueGet(usb_rx_queue, &packet, NULL, osWaitForever) == osOK)
 150:controller/utils/comms.c ****         {
 151:controller/utils/comms.c ****             process_command(packet.data, packet.len);
 152:controller/utils/comms.c ****         }
 153:controller/utils/comms.c ****     }
 154:controller/utils/comms.c **** }
 155:controller/utils/comms.c **** 
 156:controller/utils/comms.c **** // ==================== Command Processing ====================
 157:controller/utils/comms.c **** bool process_plain_command(uint8_t *request, uint16_t size)
 158:controller/utils/comms.c **** {
 159:controller/utils/comms.c ****     uint8_t first_byte = request[0];
 160:controller/utils/comms.c ****     switch (first_byte)
 161:controller/utils/comms.c ****     {
 162:controller/utils/comms.c ****     case TS_COMMAND_F:
 163:controller/utils/comms.c ****     #ifndef TS_USE_OLD_PROTOCOL
 164:controller/utils/comms.c ****         send_response(0, (uint8_t*)TS_PROTOCOL, sizeof(TS_PROTOCOL) - 1, TS_PLAIN);
 165:controller/utils/comms.c ****         return true;
 166:controller/utils/comms.c ****     #endif
 167:controller/utils/comms.c ****         break;
 168:controller/utils/comms.c ****     case TS_HELLO_COMMAND:
 169:controller/utils/comms.c ****         send_response(0, (uint8_t*)TS_SIGNATURE, sizeof(TS_SIGNATURE) - 1, TS_PLAIN);
 170:controller/utils/comms.c ****         return true;
 171:controller/utils/comms.c ****         break;
 172:controller/utils/comms.c ****     case TS_QUERY_COMMAND:
 173:controller/utils/comms.c ****         send_response(0, (uint8_t*)TS_SIGNATURE, sizeof(TS_SIGNATURE) - 1, TS_PLAIN);
 174:controller/utils/comms.c ****         return true;
 175:controller/utils/comms.c ****         break;
 176:controller/utils/comms.c ****     case TS_TEST_COMMS_COMMAND:
 177:controller/utils/comms.c ****         send_response(0, (uint8_t *)0xFF, 1, TS_PLAIN);
 178:controller/utils/comms.c ****         return true;
 179:controller/utils/comms.c ****         break;
 180:controller/utils/comms.c ****     case TS_CAN_ID_COMMAND:
 181:controller/utils/comms.c ****         send_response(0, (uint8_t*)TS_CAN_ID, sizeof(TS_CAN_ID) - 1, TS_PLAIN);
 182:controller/utils/comms.c ****         return true;
 183:controller/utils/comms.c ****         break;
 184:controller/utils/comms.c **** 
 185:controller/utils/comms.c ****     default:
 186:controller/utils/comms.c ****         break;
 187:controller/utils/comms.c ****     }
 188:controller/utils/comms.c ****         // This wasn't a valid command
 189:controller/utils/comms.c ****         return false;
 190:controller/utils/comms.c ****     
 191:controller/utils/comms.c **** }
 192:controller/utils/comms.c **** 
 193:controller/utils/comms.c **** void process_command(uint8_t *request, uint16_t size)
 194:controller/utils/comms.c **** {
 195:controller/utils/comms.c ****     if (process_plain_command(request, size))
 196:controller/utils/comms.c ****     {
 197:controller/utils/comms.c ****         return;
 198:controller/utils/comms.c ****     }
 199:controller/utils/comms.c ****     uint16_t packet_size = 0;
 200:controller/utils/comms.c ****     uint32_t packet_crc = 0;
 201:controller/utils/comms.c ****     uint32_t calculated_packet_crc = 0;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 5


 202:controller/utils/comms.c ****     bool is_packet_valid = false;
 203:controller/utils/comms.c ****     if (size > 5)
 204:controller/utils/comms.c ****     {
 205:controller/utils/comms.c ****         packet_size = swap_endian_uint16(*(uint16_t *)request);
 206:controller/utils/comms.c ****         packet_crc = swap_endian_uint32(*(uint32_t *)request[size - 1 - TS_PACKET_CRC_SIZE]);
 207:controller/utils/comms.c ****         calculated_packet_crc = crc32_inc(0, (void *)(request + TS_PACKET_PREFIX_SIZE), size - TS_P
 208:controller/utils/comms.c ****     }
 209:controller/utils/comms.c ****     if (calculated_packet_crc == packet_crc)
 210:controller/utils/comms.c ****     {
 211:controller/utils/comms.c ****         is_packet_valid = true;
 212:controller/utils/comms.c ****     }
 213:controller/utils/comms.c **** 
 214:controller/utils/comms.c ****     uint8_t command = request[2];
 215:controller/utils/comms.c **** 
 216:controller/utils/comms.c ****     switch (command)
 217:controller/utils/comms.c ****     {
 218:controller/utils/comms.c ****     case TS_TEST_COMMS_COMMAND:
 219:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)0xFF, 1, TS_CRC);
 220:controller/utils/comms.c ****         return;
 221:controller/utils/comms.c ****         break;
 222:controller/utils/comms.c **** 
 223:controller/utils/comms.c ****     case TS_COMMAND_F:
 224:controller/utils/comms.c **** #ifndef TS_USE_OLD_PROTOCOL
 225:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)TS_PROTOCOL, sizeof(TS_PROTOCOL) - 1, TS_CRC);
 226:controller/utils/comms.c **** #endif
 227:controller/utils/comms.c ****         return;
 228:controller/utils/comms.c ****         break;
 229:controller/utils/comms.c **** 
 230:controller/utils/comms.c ****     case TS_CAN_ID_COMMAND:
 231:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)TS_CAN_ID, sizeof(TS_CAN_ID), TS_CRC);
 232:controller/utils/comms.c ****         return;
 233:controller/utils/comms.c ****         break;
 234:controller/utils/comms.c **** 
 235:controller/utils/comms.c ****     case TS_QUERY_COMMAND:
 236:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)TS_SIGNATURE, sizeof(TS_SIGNATURE) - 1, TS_CRC);
 237:controller/utils/comms.c ****         return;
 238:controller/utils/comms.c ****         break;
 239:controller/utils/comms.c **** 
 240:controller/utils/comms.c ****     case TS_HELLO_COMMAND:
 241:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)TS_SIGNATURE, sizeof(TS_SIGNATURE), TS_CRC);
 242:controller/utils/comms.c ****         return;
 243:controller/utils/comms.c ****         break;
 244:controller/utils/comms.c ****     case TS_SERIAL_INFO_COMMAND:
 245:controller/utils/comms.c ****         uint8_t response[5];
 246:controller/utils/comms.c ****         response[0] = 2; // serial version
 247:controller/utils/comms.c ****         *(uint16_t *)&response[1] = swap_endian_uint16(TS_TABLE_BLOCKING_FACTOR);
 248:controller/utils/comms.c ****         *(uint16_t *)&response[3] = swap_endian_uint16(TS_BLOCKING_FACTOR);
 249:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)response, sizeof(response), TS_CRC);
 250:controller/utils/comms.c ****         return;
 251:controller/utils/comms.c ****         break;
 252:controller/utils/comms.c **** 
 253:controller/utils/comms.c ****     case TS_OUTPUT_COMMAND:
 254:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)&output_channels, sizeof(output_channels), TS_CRC)
 255:controller/utils/comms.c ****         return;
 256:controller/utils/comms.c ****         break;
 257:controller/utils/comms.c ****     case TS_READ_COMMAND:
 258:controller/utils/comms.c ****         uint16_t page = 0;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 6


 259:controller/utils/comms.c ****         uint16_t offset = *(uint16_t *)&request[3];
 260:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 261:controller/utils/comms.c ****         handle_page_read_command(page, offset, size);
 262:controller/utils/comms.c ****         return;
 263:controller/utils/comms.c ****         break;
 264:controller/utils/comms.c ****     case TS_CRC_CHECK_COMMAND:
 265:controller/utils/comms.c ****         uint32_t page_crc = crc32_inc(0, calibration_values.data, sizeof(calibration_values.data));
 266:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)&page_crc, sizeof(page_crc), TS_CRC);
 267:controller/utils/comms.c ****         return;
 268:controller/utils/comms.c ****         break;
 269:controller/utils/comms.c **** 
 270:controller/utils/comms.c ****     case TS_CHUNK_WRITE_COMMAND:
 271:controller/utils/comms.c ****     {
 272:controller/utils/comms.c ****         uint16_t page = 0;
 273:controller/utils/comms.c ****         uint16_t offset = *(uint16_t *)&request[3];
 274:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 275:controller/utils/comms.c ****         memcpy(calibration_values.data + offset, &request[7], size);
 276:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, NULL, 0, TS_CRC);
 277:controller/utils/comms.c ****         return;
 278:controller/utils/comms.c ****         break;
 279:controller/utils/comms.c ****     }
 280:controller/utils/comms.c ****     case TS_SINGLE_WRITE_COMMAND:
 281:controller/utils/comms.c ****     {
 282:controller/utils/comms.c ****         uint16_t page = 0;
 283:controller/utils/comms.c ****         uint16_t offset = *(uint16_t *)&request[3];
 284:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 285:controller/utils/comms.c ****         memcpy(calibration_values.data + offset, &request[7], size);
 286:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, NULL, 0, TS_CRC);
 287:controller/utils/comms.c ****         return;
 288:controller/utils/comms.c ****         break;
 289:controller/utils/comms.c ****     }
 290:controller/utils/comms.c **** 
 291:controller/utils/comms.c ****     case TS_BURN_COMMAND:
 292:controller/utils/comms.c ****         // handle burn command and if it was ok, then send ok status
 293:controller/utils/comms.c ****         send_response(TS_RESPONSE_BURN_OK, NULL, 0, TS_CRC);
 294:controller/utils/comms.c ****         return;
 295:controller/utils/comms.c ****         break;
 296:controller/utils/comms.c ****     default:
 297:controller/utils/comms.c ****         break;
 298:controller/utils/comms.c ****     }
 299:controller/utils/comms.c ****     HAL_GPIO_TogglePin(LED_GPIO_Port, LED_Pin);
 300:controller/utils/comms.c **** }
 301:controller/utils/comms.c **** 
 302:controller/utils/comms.c **** void handle_page_read_command(uint16_t page, uint16_t offset, uint16_t count)
 303:controller/utils/comms.c **** {
 304:controller/utils/comms.c **** 	if (page > 1)
 305:controller/utils/comms.c **** 	{
 306:controller/utils/comms.c **** 		return;
 307:controller/utils/comms.c **** 	}
 308:controller/utils/comms.c **** 	if ((offset + count) > TS_PAGE_SIZE)
 309:controller/utils/comms.c **** 	{
 310:controller/utils/comms.c **** 		return;
 311:controller/utils/comms.c **** 	}
 312:controller/utils/comms.c **** 	
 313:controller/utils/comms.c **** 	send_response(TS_RESPONSE_OK, (uint8_t*)&calibration_values.data + offset, count, TS_CRC);
 314:controller/utils/comms.c **** }
 315:controller/utils/comms.c **** 
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 7


 316:controller/utils/comms.c **** void handle_page_write_command(uint16_t page, uint16_t offset, uint16_t count)
 317:controller/utils/comms.c **** {
 318:controller/utils/comms.c **** 	if (page > 1)
 319:controller/utils/comms.c **** 	{
 320:controller/utils/comms.c **** 		return;
 321:controller/utils/comms.c **** 	}
 322:controller/utils/comms.c **** 	if ((offset + count) > TS_PAGE_SIZE)
 323:controller/utils/comms.c **** 	{
 324:controller/utils/comms.c **** 		return;
 325:controller/utils/comms.c **** 	}
 326:controller/utils/comms.c **** 	
 327:controller/utils/comms.c **** }
 328:controller/utils/comms.c **** 
 329:controller/utils/comms.c **** 
 330:controller/utils/comms.c **** void comms_write_status_flag(status_flags_t flag, bool state)
 331:controller/utils/comms.c **** {
 332:controller/utils/comms.c **** 	uint8_t index = flag;
 333:controller/utils/comms.c **** 	change_bit_uint32(&output_channels.status, index, state);
 334:controller/utils/comms.c **** }
 335:controller/utils/comms.c **** 
 336:controller/utils/comms.c **** // ==================== Runtime Update Task ====================
 337:controller/utils/comms.c **** void runtime_update_task(void *argument)
 338:controller/utils/comms.c **** {
  29              		.loc 1 338 1 view -0
  30              		.cfi_startproc
  31              		@ Volatile: function does not return.
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              	.LVL0:
  35              		.loc 1 338 1 is_stmt 0 view .LVU1
  36 0000 08B5     		push	{r3, lr}
  37              		.cfi_def_cfa_offset 8
  38              		.cfi_offset 3, -8
  39              		.cfi_offset 14, -4
  40              	.LVL1:
  41              	.L2:
 339:controller/utils/comms.c **** 	for (;;)
  42              		.loc 1 339 2 is_stmt 1 view .LVU2
 340:controller/utils/comms.c **** 	{
 341:controller/utils/comms.c **** 		output_channels.sync_loss_count = engine.trigger.sync_loss_counter;
  43              		.loc 1 341 3 view .LVU3
  44              		.loc 1 341 51 is_stmt 0 view .LVU4
  45 0002 1F4D     		ldr	r5, .L4
  46 0004 EB8B     		ldrh	r3, [r5, #30]
  47              		.loc 1 341 35 view .LVU5
  48 0006 1F4C     		ldr	r4, .L4+4
  49 0008 A384     		strh	r3, [r4, #36]	@ movhi
 342:controller/utils/comms.c **** 		change_bit_uint32(&output_channels.status, STATUS_TRIGGER_SYNCED, engine.trigger.sync_status == T
  50              		.loc 1 342 3 is_stmt 1 view .LVU6
  51              		.loc 1 342 83 is_stmt 0 view .LVU7
  52 000a 6A7F     		ldrb	r2, [r5, #29]	@ zero_extendqisi2
  53              		.loc 1 342 3 view .LVU8
  54 000c 012A     		cmp	r2, #1
  55 000e 14BF     		ite	ne
  56 0010 0022     		movne	r2, #0
  57 0012 0122     		moveq	r2, #1
  58 0014 1A21     		movs	r1, #26
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 8


  59 0016 2046     		mov	r0, r4
  60 0018 FFF7FEFF 		bl	change_bit_uint32
  61              	.LVL2:
 343:controller/utils/comms.c **** 		change_bit_uint32(&output_channels.status, STATUS_TRIGGER_ERROR, engine.trigger.sync_loss_counter
  62              		.loc 1 343 3 is_stmt 1 view .LVU9
  63              		.loc 1 343 82 is_stmt 0 view .LVU10
  64 001c EA8B     		ldrh	r2, [r5, #30]
  65              		.loc 1 343 3 view .LVU11
  66 001e B2F57A7F 		cmp	r2, #1000
  67 0022 94BF     		ite	ls
  68 0024 0022     		movls	r2, #0
  69 0026 0122     		movhi	r2, #1
  70 0028 0D21     		movs	r1, #13
  71 002a 2046     		mov	r0, r4
  72 002c FFF7FEFF 		bl	change_bit_uint32
  73              	.LVL3:
 344:controller/utils/comms.c **** 		change_bit_uint32(&output_channels.status, STATUS_CRANKING, engine.spinning_state == SS_CRANKING)
  74              		.loc 1 344 3 is_stmt 1 view .LVU12
  75              		.loc 1 344 69 is_stmt 0 view .LVU13
  76 0030 6A7C     		ldrb	r2, [r5, #17]	@ zero_extendqisi2
  77              		.loc 1 344 3 view .LVU14
  78 0032 022A     		cmp	r2, #2
  79 0034 14BF     		ite	ne
  80 0036 0022     		movne	r2, #0
  81 0038 0122     		moveq	r2, #1
  82 003a 1821     		movs	r1, #24
  83 003c 2046     		mov	r0, r4
  84 003e FFF7FEFF 		bl	change_bit_uint32
  85              	.LVL4:
 345:controller/utils/comms.c **** 		change_bit_uint32(&output_channels.status, STATUS_RUNNING, engine.spinning_state == SS_RUNNING);
  86              		.loc 1 345 3 is_stmt 1 view .LVU15
  87              		.loc 1 345 68 is_stmt 0 view .LVU16
  88 0042 6A7C     		ldrb	r2, [r5, #17]	@ zero_extendqisi2
  89              		.loc 1 345 3 view .LVU17
  90 0044 032A     		cmp	r2, #3
  91 0046 14BF     		ite	ne
  92 0048 0022     		movne	r2, #0
  93 004a 0122     		moveq	r2, #1
  94 004c 1921     		movs	r1, #25
  95 004e 2046     		mov	r0, r4
  96 0050 FFF7FEFF 		bl	change_bit_uint32
  97              	.LVL5:
 346:controller/utils/comms.c **** 		// Replace with actual sensor readings
 347:controller/utils/comms.c **** 		output_channels.rpm = engine.rpm;
  98              		.loc 1 347 3 is_stmt 1 view .LVU18
  99              		.loc 1 347 31 is_stmt 0 view .LVU19
 100 0054 EB68     		ldr	r3, [r5, #12]	@ float
 101              		.loc 1 347 23 view .LVU20
 102 0056 6360     		str	r3, [r4, #4]	@ float
 348:controller/utils/comms.c **** 		output_channels.map = engine.map;
 103              		.loc 1 348 3 is_stmt 1 view .LVU21
 104              		.loc 1 348 31 is_stmt 0 view .LVU22
 105 0058 2B6D     		ldr	r3, [r5, #80]	@ float
 106              		.loc 1 348 23 view .LVU23
 107 005a A360     		str	r3, [r4, #8]	@ float
 349:controller/utils/comms.c **** 		output_channels.tps = engine.tps1;
 108              		.loc 1 349 3 is_stmt 1 view .LVU24
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 9


 109              		.loc 1 349 31 is_stmt 0 view .LVU25
 110 005c EB6C     		ldr	r3, [r5, #76]	@ float
 111              		.loc 1 349 23 view .LVU26
 112 005e E360     		str	r3, [r4, #12]	@ float
 350:controller/utils/comms.c **** 		output_channels.lambda = 1;
 113              		.loc 1 350 3 is_stmt 1 view .LVU27
 114              		.loc 1 350 26 is_stmt 0 view .LVU28
 115 0060 4FF07E53 		mov	r3, #1065353216
 116 0064 2361     		str	r3, [r4, #16]	@ float
 351:controller/utils/comms.c **** 		output_channels.advance = engine.ignition_advance;
 117              		.loc 1 351 3 is_stmt 1 view .LVU29
 118              		.loc 1 351 35 is_stmt 0 view .LVU30
 119 0066 AB69     		ldr	r3, [r5, #24]	@ float
 120              		.loc 1 351 27 view .LVU31
 121 0068 6361     		str	r3, [r4, #20]	@ float
 352:controller/utils/comms.c **** 		output_channels.dwell = configuration.ignition_dwell;
 122              		.loc 1 352 3 is_stmt 1 view .LVU32
 123              		.loc 1 352 40 is_stmt 0 view .LVU33
 124 006a 074B     		ldr	r3, .L4+8
 125 006c DB69     		ldr	r3, [r3, #28]	@ float
 126              		.loc 1 352 25 view .LVU34
 127 006e A361     		str	r3, [r4, #24]	@ float
 353:controller/utils/comms.c **** 		output_channels.vbatt = 10;
 128              		.loc 1 353 3 is_stmt 1 view .LVU35
 129              		.loc 1 353 25 is_stmt 0 view .LVU36
 130 0070 064B     		ldr	r3, .L4+12
 131 0072 E361     		str	r3, [r4, #28]	@ float
 354:controller/utils/comms.c **** 		output_channels.clt = engine.clt;
 132              		.loc 1 354 3 is_stmt 1 view .LVU37
 133              		.loc 1 354 31 is_stmt 0 view .LVU38
 134 0074 6B6D     		ldr	r3, [r5, #84]	@ float
 135              		.loc 1 354 23 view .LVU39
 136 0076 2362     		str	r3, [r4, #32]	@ float
 355:controller/utils/comms.c **** 		osDelay(10);
 137              		.loc 1 355 3 is_stmt 1 discriminator 1 view .LVU40
 138 0078 0A20     		movs	r0, #10
 139 007a FFF7FEFF 		bl	osDelay
 140              	.LVL6:
 339:controller/utils/comms.c **** 	{
 141              		.loc 1 339 2 view .LVU41
 142 007e C0E7     		b	.L2
 143              	.L5:
 144              		.align	2
 145              	.L4:
 146 0080 00000000 		.word	engine
 147 0084 00000000 		.word	output_channels
 148 0088 00000000 		.word	configuration
 149 008c 00002041 		.word	1092616192
 150              		.cfi_endproc
 151              	.LFE239:
 153              		.section	.text.transmit_crc_packet,"ax",%progbits
 154              		.align	1
 155              		.global	transmit_crc_packet
 156              		.syntax unified
 157              		.thumb
 158              		.thumb_func
 160              	transmit_crc_packet:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 10


 161              	.LVL7:
 162              	.LFB231:
  81:controller/utils/comms.c **** 
 163              		.loc 1 81 1 view -0
 164              		.cfi_startproc
 165              		@ args = 0, pretend = 0, frame = 8
 166              		@ frame_needed = 0, uses_anonymous_args = 0
  81:controller/utils/comms.c **** 
 167              		.loc 1 81 1 is_stmt 0 view .LVU43
 168 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 169              		.cfi_def_cfa_offset 28
 170              		.cfi_offset 4, -28
 171              		.cfi_offset 5, -24
 172              		.cfi_offset 6, -20
 173              		.cfi_offset 7, -16
 174              		.cfi_offset 8, -12
 175              		.cfi_offset 9, -8
 176              		.cfi_offset 14, -4
 177 0004 83B0     		sub	sp, sp, #12
 178              		.cfi_def_cfa_offset 40
 179 0006 0F46     		mov	r7, r1
 180 0008 1546     		mov	r5, r2
 181 000a 8DF80700 		strb	r0, [sp, #7]
  84:controller/utils/comms.c **** 	packet_size += 2; // prefix
 182              		.loc 1 84 5 is_stmt 1 view .LVU44
 183              	.LVL8:
  85:controller/utils/comms.c **** 	packet_size += 1; // flag
 184              		.loc 1 85 2 view .LVU45
  86:controller/utils/comms.c **** 	packet_size += 4; // CRC
 185              		.loc 1 86 2 view .LVU46
  87:controller/utils/comms.c **** 	packet_size += size; // payload
 186              		.loc 1 87 2 view .LVU47
  88:controller/utils/comms.c **** 
 187              		.loc 1 88 2 view .LVU48
  88:controller/utils/comms.c **** 
 188              		.loc 1 88 14 is_stmt 0 view .LVU49
 189 000e 96B2     		uxth	r6, r2
 190 0010 06F10708 		add	r8, r6, #7
 191 0014 1FFA88F8 		uxth	r8, r8
 192              	.LVL9:
  91:controller/utils/comms.c **** 	prefix = swap_endian_uint16(sizeof(flag) + size);
 193              		.loc 1 91 2 is_stmt 1 view .LVU50
  92:controller/utils/comms.c **** 
 194              		.loc 1 92 2 view .LVU51
  92:controller/utils/comms.c **** 
 195              		.loc 1 92 11 is_stmt 0 view .LVU52
 196 0018 0136     		adds	r6, r6, #1
 197              	.LVL10:
 198              	.LBB17:
 199              	.LBI17:
 200              		.file 2 "controller/utils/utils.h"
   1:controller/utils/utils.h **** /**
   2:controller/utils/utils.h ****  * @file utils.h
   3:controller/utils/utils.h ****  * @brief Header file containing utility functions and definitions for the smart generator controll
   4:controller/utils/utils.h ****  * 
   5:controller/utils/utils.h ****  * This file provides declarations for utility functions and macros that are
   6:controller/utils/utils.h ****  * used throughout the firmware to support various functionalities.
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 11


   7:controller/utils/utils.h ****  * 
   8:controller/utils/utils.h ****  * @note Ensure that this file is included wherever utility functions are required.
   9:controller/utils/utils.h ****  */
  10:controller/utils/utils.h **** #ifndef UTILS_H
  11:controller/utils/utils.h **** #define UTILS_H
  12:controller/utils/utils.h **** 
  13:controller/utils/utils.h **** #include "types.h"
  14:controller/utils/utils.h **** #include "math.h"
  15:controller/utils/utils.h **** #define IS_IN_RANGE(value, min, max) ((value) >= (min) && (value) <= (max))
  16:controller/utils/utils.h **** #define ABS(value) ((value) < 0 ? -(value) : (value))
  17:controller/utils/utils.h **** #define CLAMP(value, min, max) ((value) < (min) ? (min) : ((value) > (max) ? (max) : (value)))
  18:controller/utils/utils.h **** 
  19:controller/utils/utils.h **** void change_bit_uint32(uint32_t *var, uint8_t bit_index, bool state);
  20:controller/utils/utils.h **** 
  21:controller/utils/utils.h **** /**
  22:controller/utils/utils.h ****  * @brief Maps a value from one range to another.
  23:controller/utils/utils.h ****  * 
  24:controller/utils/utils.h ****  * @param x The value to map.
  25:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  26:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  27:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  28:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  29:controller/utils/utils.h ****  * @return The mapped value in the output range.
  30:controller/utils/utils.h ****  */
  31:controller/utils/utils.h **** #define MAP(x, in_min, in_max, out_min, out_max) \
  32:controller/utils/utils.h ****     (((x) - (in_min)) * ((out_max) - (out_min)) / ((in_max) - (in_min)) + (out_min))
  33:controller/utils/utils.h **** 
  34:controller/utils/utils.h **** 
  35:controller/utils/utils.h **** /**
  36:controller/utils/utils.h ****  * @brief Maps a uint16_t value from one range to another.
  37:controller/utils/utils.h ****  * 
  38:controller/utils/utils.h ****  * @param x The value to map.
  39:controller/utils/utils.h ****  * @param in_min The lower bound of the input range.
  40:controller/utils/utils.h ****  * @param in_max The upper bound of the input range.
  41:controller/utils/utils.h ****  * @param out_min The lower bound of the output range.
  42:controller/utils/utils.h ****  * @param out_max The upper bound of the output range.
  43:controller/utils/utils.h ****  * @return The mapped value in the output range.
  44:controller/utils/utils.h ****  */
  45:controller/utils/utils.h **** static inline uint16_t map_uint16(uint16_t x, uint16_t in_min, uint16_t in_max, uint16_t out_min, u
  46:controller/utils/utils.h **** {
  47:controller/utils/utils.h ****     if (in_max == in_min)
  48:controller/utils/utils.h ****     {
  49:controller/utils/utils.h ****         return 0; // Avoid division by zero
  50:controller/utils/utils.h ****     }
  51:controller/utils/utils.h ****     return (uint16_t)((x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min);
  52:controller/utils/utils.h **** }
  53:controller/utils/utils.h **** 
  54:controller/utils/utils.h **** static inline float mapf(float x, float in_min, float in_max, float out_min, float out_max)
  55:controller/utils/utils.h **** {
  56:controller/utils/utils.h ****     if (in_max == in_min)
  57:controller/utils/utils.h ****     {
  58:controller/utils/utils.h ****         return 0.0f; // Avoid division by zero
  59:controller/utils/utils.h ****     }
  60:controller/utils/utils.h ****     return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
  61:controller/utils/utils.h **** }
  62:controller/utils/utils.h **** 
  63:controller/utils/utils.h **** // http://en.wikipedia.org/wiki/Endianness
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 12


  64:controller/utils/utils.h **** inline uint16_t swap_endian_uint16(uint16_t x)
 201              		.loc 2 64 17 is_stmt 1 view .LVU53
 202              	.LBB18:
  65:controller/utils/utils.h **** {
  66:controller/utils/utils.h **** 	return ((x << 8) | (x >> 8));
 203              		.loc 2 66 2 view .LVU54
 204              		.loc 2 66 19 is_stmt 0 view .LVU55
 205 001a 76BA     		rev16	r6, r6
 206              	.LVL11:
 207              		.loc 2 66 19 view .LVU56
 208              	.LBE18:
 209              	.LBE17:
  95:controller/utils/comms.c **** 	crc = crc32_inc(0, (void*)&flag, 1); // flag
 210              		.loc 1 95 2 is_stmt 1 view .LVU57
  96:controller/utils/comms.c **** 	crc = crc32_inc(crc, buf, size); // payload
 211              		.loc 1 96 2 view .LVU58
  96:controller/utils/comms.c **** 	crc = crc32_inc(crc, buf, size); // payload
 212              		.loc 1 96 8 is_stmt 0 view .LVU59
 213 001c 0122     		movs	r2, #1
 214              	.LVL12:
  96:controller/utils/comms.c **** 	crc = crc32_inc(crc, buf, size); // payload
 215              		.loc 1 96 8 view .LVU60
 216 001e 0DF10701 		add	r1, sp, #7
 217              	.LVL13:
  96:controller/utils/comms.c **** 	crc = crc32_inc(crc, buf, size); // payload
 218              		.loc 1 96 8 view .LVU61
 219 0022 0020     		movs	r0, #0
 220              	.LVL14:
  96:controller/utils/comms.c **** 	crc = crc32_inc(crc, buf, size); // payload
 221              		.loc 1 96 8 view .LVU62
 222 0024 FFF7FEFF 		bl	crc32_inc
 223              	.LVL15:
  97:controller/utils/comms.c **** 
 224              		.loc 1 97 2 is_stmt 1 view .LVU63
  97:controller/utils/comms.c **** 
 225              		.loc 1 97 8 is_stmt 0 view .LVU64
 226 0028 2A46     		mov	r2, r5
 227 002a 3946     		mov	r1, r7
 228 002c FFF7FEFF 		bl	crc32_inc
 229              	.LVL16:
 100:controller/utils/comms.c **** 	suffix = swap_endian_uint32(crc);
 230              		.loc 1 100 2 is_stmt 1 view .LVU65
 101:controller/utils/comms.c **** 
 231              		.loc 1 101 2 view .LVU66
 232              	.LBB19:
 233              	.LBI19:
  67:controller/utils/utils.h **** }
  68:controller/utils/utils.h **** inline uint32_t swap_endian_uint32(uint32_t x)
 234              		.loc 2 68 17 view .LVU67
 235              	.LBB20:
  69:controller/utils/utils.h **** {
  70:controller/utils/utils.h **** 	return (((x >> 24) & 0x000000ff) | ((x <<  8) & 0x00ff0000) |
 236              		.loc 2 70 2 view .LVU68
 237              		.loc 2 70 41 is_stmt 0 view .LVU69
 238 0030 0402     		lsls	r4, r0, #8
 239              		.loc 2 70 48 view .LVU70
 240 0032 04F47F04 		and	r4, r4, #16711680
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 13


 241              		.loc 2 70 35 view .LVU71
 242 0036 44EA1064 		orr	r4, r4, r0, lsr #24
  71:controller/utils/utils.h **** 			((x >>  8) & 0x0000ff00) | ((x << 24) & 0xff000000));
 243              		.loc 2 71 8 view .LVU72
 244 003a 030A     		lsrs	r3, r0, #8
 245              		.loc 2 71 15 view .LVU73
 246 003c 03F47F43 		and	r3, r3, #65280
  70:controller/utils/utils.h **** 			((x >>  8) & 0x0000ff00) | ((x << 24) & 0xff000000));
 247              		.loc 2 70 62 view .LVU74
 248 0040 1C43     		orrs	r4, r4, r3
 249              		.loc 2 71 29 view .LVU75
 250 0042 44EA0064 		orr	r4, r4, r0, lsl #24
 251              	.LVL17:
 252              		.loc 2 71 29 view .LVU76
 253              	.LBE20:
 254              	.LBE19:
 104:controller/utils/comms.c **** 	memcpy(tx_buffer, &prefix, sizeof(prefix)); // prefix to buffer
 255              		.loc 1 104 2 is_stmt 1 view .LVU77
 105:controller/utils/comms.c **** 	tx_buffer_index += sizeof(prefix);
 256              		.loc 1 105 2 view .LVU78
 257 0046 DFF83090 		ldr	r9, .L8
 258 004a A9F80060 		strh	r6, [r9]	@ movhi
 106:controller/utils/comms.c **** 	memcpy(tx_buffer + tx_buffer_index, &flag, sizeof(flag)); // flag to buffer
 259              		.loc 1 106 2 view .LVU79
 260              	.LVL18:
 107:controller/utils/comms.c **** 	tx_buffer_index += sizeof(flag);
 261              		.loc 1 107 2 view .LVU80
 262 004e 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 263 0052 89F80230 		strb	r3, [r9, #2]
 108:controller/utils/comms.c **** 	memcpy(tx_buffer + tx_buffer_index, buf, size); // payload to buffer
 264              		.loc 1 108 2 view .LVU81
 265              	.LVL19:
 109:controller/utils/comms.c **** 	tx_buffer_index += size;
 266              		.loc 1 109 2 view .LVU82
 267 0056 2A46     		mov	r2, r5
 268 0058 3946     		mov	r1, r7
 269 005a 09F10300 		add	r0, r9, #3
 270              	.LVL20:
 109:controller/utils/comms.c **** 	tx_buffer_index += size;
 271              		.loc 1 109 2 is_stmt 0 view .LVU83
 272 005e FFF7FEFF 		bl	memcpy
 273              	.LVL21:
 110:controller/utils/comms.c **** 	memcpy(tx_buffer + tx_buffer_index, &suffix, sizeof(suffix)); // suffix to buffer
 274              		.loc 1 110 2 is_stmt 1 view .LVU84
 110:controller/utils/comms.c **** 	memcpy(tx_buffer + tx_buffer_index, &suffix, sizeof(suffix)); // suffix to buffer
 275              		.loc 1 110 18 is_stmt 0 view .LVU85
 276 0062 0335     		adds	r5, r5, #3
 277              	.LVL22:
 111:controller/utils/comms.c **** 	tx_buffer_index += sizeof(suffix);
 278              		.loc 1 111 2 is_stmt 1 view .LVU86
 279 0064 49F80540 		str	r4, [r9, r5]	@ unaligned
 112:controller/utils/comms.c **** 
 280              		.loc 1 112 2 view .LVU87
 281              	.LVL23:
 116:controller/utils/comms.c **** }
 282              		.loc 1 116 2 view .LVU88
 283 0068 4146     		mov	r1, r8
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 14


 284 006a 4846     		mov	r0, r9
 285 006c FFF7FEFF 		bl	CDC_Transmit_FS
 286              	.LVL24:
 117:controller/utils/comms.c **** 
 287              		.loc 1 117 1 is_stmt 0 view .LVU89
 288 0070 03B0     		add	sp, sp, #12
 289              		.cfi_def_cfa_offset 28
 290              		@ sp needed
 291 0072 BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 292              	.LVL25:
 293              	.L9:
 117:controller/utils/comms.c **** 
 294              		.loc 1 117 1 view .LVU90
 295 0076 00BF     		.align	2
 296              	.L8:
 297 0078 00000000 		.word	tx_buffer
 298              		.cfi_endproc
 299              	.LFE231:
 301              		.section	.text.send_response,"ax",%progbits
 302              		.align	1
 303              		.global	send_response
 304              		.syntax unified
 305              		.thumb
 306              		.thumb_func
 308              	send_response:
 309              	.LVL26:
 310              	.LFB230:
  63:controller/utils/comms.c **** 
 311              		.loc 1 63 1 is_stmt 1 view -0
 312              		.cfi_startproc
 313              		@ args = 0, pretend = 0, frame = 0
 314              		@ frame_needed = 0, uses_anonymous_args = 0
  63:controller/utils/comms.c **** 
 315              		.loc 1 63 1 is_stmt 0 view .LVU92
 316 0000 38B5     		push	{r3, r4, r5, lr}
 317              		.cfi_def_cfa_offset 16
 318              		.cfi_offset 3, -16
 319              		.cfi_offset 4, -12
 320              		.cfi_offset 5, -8
 321              		.cfi_offset 14, -4
 322 0002 1446     		mov	r4, r2
  65:controller/utils/comms.c ****     {
 323              		.loc 1 65 5 is_stmt 1 view .LVU93
  65:controller/utils/comms.c ****     {
 324              		.loc 1 65 8 is_stmt 0 view .LVU94
 325 0004 012B     		cmp	r3, #1
 326 0006 07D0     		beq	.L14
  71:controller/utils/comms.c ****         {
 327              		.loc 1 71 9 is_stmt 1 view .LVU95
  71:controller/utils/comms.c ****         {
 328              		.loc 1 71 12 is_stmt 0 view .LVU96
 329 0008 4AB9     		cbnz	r2, .L15
 330              	.LVL27:
 331              	.L12:
  77:controller/utils/comms.c **** }
 332              		.loc 1 77 2 is_stmt 1 view .LVU97
 333 000a 0122     		movs	r2, #1
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 15


 334 000c 4FF40051 		mov	r1, #8192
 335 0010 0748     		ldr	r0, .L16
 336 0012 FFF7FEFF 		bl	HAL_GPIO_WritePin
 337              	.LVL28:
  78:controller/utils/comms.c **** 
 338              		.loc 1 78 1 is_stmt 0 view .LVU98
 339 0016 38BD     		pop	{r3, r4, r5, pc}
 340              	.LVL29:
 341              	.L14:
  67:controller/utils/comms.c ****     }
 342              		.loc 1 67 9 is_stmt 1 view .LVU99
 343 0018 FFF7FEFF 		bl	transmit_crc_packet
 344              	.LVL30:
  67:controller/utils/comms.c ****     }
 345              		.loc 1 67 9 is_stmt 0 view .LVU100
 346 001c F5E7     		b	.L12
 347              	.LVL31:
 348              	.L15:
  73:controller/utils/comms.c ****             CDC_Transmit_FS(tx_buffer, size);
 349              		.loc 1 73 4 is_stmt 1 view .LVU101
 350 001e 054D     		ldr	r5, .L16+4
 351 0020 2846     		mov	r0, r5
 352              	.LVL32:
  73:controller/utils/comms.c ****             CDC_Transmit_FS(tx_buffer, size);
 353              		.loc 1 73 4 is_stmt 0 view .LVU102
 354 0022 FFF7FEFF 		bl	memcpy
 355              	.LVL33:
  74:controller/utils/comms.c ****         }
 356              		.loc 1 74 13 is_stmt 1 view .LVU103
 357 0026 A1B2     		uxth	r1, r4
 358 0028 2846     		mov	r0, r5
 359 002a FFF7FEFF 		bl	CDC_Transmit_FS
 360              	.LVL34:
 361 002e ECE7     		b	.L12
 362              	.L17:
 363              		.align	2
 364              	.L16:
 365 0030 00080240 		.word	1073874944
 366 0034 00000000 		.word	tx_buffer
 367              		.cfi_endproc
 368              	.LFE230:
 370              		.section	.rodata.comms_init.str1.4,"aMS",%progbits,1
 371              		.align	2
 372              	.LC0:
 373 0000 636F6D6D 		.ascii	"comms_task\000"
 373      735F7461 
 373      736B00
 374 000b 00       		.align	2
 375              	.LC1:
 376 000c 75706461 		.ascii	"update_task\000"
 376      74655F74 
 376      61736B00 
 377              		.section	.text.comms_init,"ax",%progbits
 378              		.align	1
 379              		.global	comms_init
 380              		.syntax unified
 381              		.thumb
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 16


 382              		.thumb_func
 384              	comms_init:
 385              	.LFB232:
 123:controller/utils/comms.c **** 	usb_rx_queue = osMessageQueueNew(10, sizeof(usb_packet_ptr_t), NULL);
 386              		.loc 1 123 1 view -0
 387              		.cfi_startproc
 388              		@ args = 0, pretend = 0, frame = 72
 389              		@ frame_needed = 0, uses_anonymous_args = 0
 390 0000 70B5     		push	{r4, r5, r6, lr}
 391              		.cfi_def_cfa_offset 16
 392              		.cfi_offset 4, -16
 393              		.cfi_offset 5, -12
 394              		.cfi_offset 6, -8
 395              		.cfi_offset 14, -4
 396 0002 92B0     		sub	sp, sp, #72
 397              		.cfi_def_cfa_offset 88
 124:controller/utils/comms.c **** 
 398              		.loc 1 124 2 view .LVU105
 124:controller/utils/comms.c **** 
 399              		.loc 1 124 17 is_stmt 0 view .LVU106
 400 0004 0022     		movs	r2, #0
 401 0006 0821     		movs	r1, #8
 402 0008 0A20     		movs	r0, #10
 403 000a FFF7FEFF 		bl	osMessageQueueNew
 404              	.LVL35:
 124:controller/utils/comms.c **** 
 405              		.loc 1 124 15 discriminator 1 view .LVU107
 406 000e 134B     		ldr	r3, .L20
 407 0010 1860     		str	r0, [r3]
 128:controller/utils/comms.c ****         .name = "comms_task",
 408              		.loc 1 128 5 is_stmt 1 view .LVU108
 128:controller/utils/comms.c ****         .name = "comms_task",
 409              		.loc 1 128 26 is_stmt 0 view .LVU109
 410 0012 09AC     		add	r4, sp, #36
 411 0014 2426     		movs	r6, #36
 412 0016 3246     		mov	r2, r6
 413 0018 0021     		movs	r1, #0
 414 001a 2046     		mov	r0, r4
 415 001c FFF7FEFF 		bl	memset
 416              	.LVL36:
 417 0020 0F4B     		ldr	r3, .L20+4
 418 0022 0993     		str	r3, [sp, #36]
 419 0024 4FF48053 		mov	r3, #4096
 420 0028 0E93     		str	r3, [sp, #56]
 421 002a 1825     		movs	r5, #24
 422 002c 0F95     		str	r5, [sp, #60]
 133:controller/utils/comms.c **** 
 423              		.loc 1 133 5 is_stmt 1 view .LVU110
 424 002e 2246     		mov	r2, r4
 425 0030 0021     		movs	r1, #0
 426 0032 0C48     		ldr	r0, .L20+8
 427 0034 FFF7FEFF 		bl	osThreadNew
 428              	.LVL37:
 135:controller/utils/comms.c **** 		.name = "update_task",
 429              		.loc 1 135 2 view .LVU111
 135:controller/utils/comms.c **** 		.name = "update_task",
 430              		.loc 1 135 23 is_stmt 0 view .LVU112
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 17


 431 0038 3246     		mov	r2, r6
 432 003a 0021     		movs	r1, #0
 433 003c 6846     		mov	r0, sp
 434 003e FFF7FEFF 		bl	memset
 435              	.LVL38:
 436 0042 094B     		ldr	r3, .L20+12
 437 0044 0093     		str	r3, [sp]
 438 0046 4FF48063 		mov	r3, #1024
 439 004a 0593     		str	r3, [sp, #20]
 440 004c 0695     		str	r5, [sp, #24]
 140:controller/utils/comms.c **** }
 441              		.loc 1 140 2 is_stmt 1 view .LVU113
 442 004e 6A46     		mov	r2, sp
 443 0050 0021     		movs	r1, #0
 444 0052 0648     		ldr	r0, .L20+16
 445 0054 FFF7FEFF 		bl	osThreadNew
 446              	.LVL39:
 141:controller/utils/comms.c **** 
 447              		.loc 1 141 1 is_stmt 0 view .LVU114
 448 0058 12B0     		add	sp, sp, #72
 449              		.cfi_def_cfa_offset 16
 450              		@ sp needed
 451 005a 70BD     		pop	{r4, r5, r6, pc}
 452              	.L21:
 453              		.align	2
 454              	.L20:
 455 005c 00000000 		.word	usb_rx_queue
 456 0060 00000000 		.word	.LC0
 457 0064 00000000 		.word	comms_task
 458 0068 0C000000 		.word	.LC1
 459 006c 00000000 		.word	runtime_update_task
 460              		.cfi_endproc
 461              	.LFE232:
 463              		.section	.rodata.process_plain_command.str1.4,"aMS",%progbits,1
 464              		.align	2
 465              	.LC2:
 466 0000 30303200 		.ascii	"002\000"
 467              		.align	2
 468              	.LC3:
 469 0004 4A696D53 		.ascii	"JimStim dev.2025.07\000"
 469      74696D20 
 469      6465762E 
 469      32303235 
 469      2E303700 
 470              		.section	.text.process_plain_command,"ax",%progbits
 471              		.align	1
 472              		.global	process_plain_command
 473              		.syntax unified
 474              		.thumb
 475              		.thumb_func
 477              	process_plain_command:
 478              	.LVL40:
 479              	.LFB234:
 158:controller/utils/comms.c ****     uint8_t first_byte = request[0];
 480              		.loc 1 158 1 is_stmt 1 view -0
 481              		.cfi_startproc
 482              		@ args = 0, pretend = 0, frame = 0
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 18


 483              		@ frame_needed = 0, uses_anonymous_args = 0
 158:controller/utils/comms.c ****     uint8_t first_byte = request[0];
 484              		.loc 1 158 1 is_stmt 0 view .LVU116
 485 0000 08B5     		push	{r3, lr}
 486              		.cfi_def_cfa_offset 8
 487              		.cfi_offset 3, -8
 488              		.cfi_offset 14, -4
 159:controller/utils/comms.c ****     switch (first_byte)
 489              		.loc 1 159 5 is_stmt 1 view .LVU117
 159:controller/utils/comms.c ****     switch (first_byte)
 490              		.loc 1 159 13 is_stmt 0 view .LVU118
 491 0002 0378     		ldrb	r3, [r0]	@ zero_extendqisi2
 492              	.LVL41:
 160:controller/utils/comms.c ****     {
 493              		.loc 1 160 5 is_stmt 1 view .LVU119
 494 0004 433B     		subs	r3, r3, #67
 495 0006 102B     		cmp	r3, #16
 496 0008 32D8     		bhi	.L30
 497 000a DFE803F0 		tbb	[pc, r3]
 498              	.L25:
 499 000e 21       		.byte	(.L29-.L25)/2
 500 000f 31       		.byte	(.L30-.L25)/2
 501 0010 31       		.byte	(.L30-.L25)/2
 502 0011 09       		.byte	(.L28-.L25)/2
 503 0012 31       		.byte	(.L30-.L25)/2
 504 0013 31       		.byte	(.L30-.L25)/2
 505 0014 29       		.byte	(.L27-.L25)/2
 506 0015 31       		.byte	(.L30-.L25)/2
 507 0016 31       		.byte	(.L30-.L25)/2
 508 0017 31       		.byte	(.L30-.L25)/2
 509 0018 31       		.byte	(.L30-.L25)/2
 510 0019 31       		.byte	(.L30-.L25)/2
 511 001a 31       		.byte	(.L30-.L25)/2
 512 001b 31       		.byte	(.L30-.L25)/2
 513 001c 19       		.byte	(.L26-.L25)/2
 514 001d 31       		.byte	(.L30-.L25)/2
 515 001e 11       		.byte	(.L24-.L25)/2
 516 001f 00       		.p2align 1
 517              	.L28:
 164:controller/utils/comms.c ****         return true;
 518              		.loc 1 164 9 view .LVU120
 519 0020 0023     		movs	r3, #0
 520 0022 0322     		movs	r2, #3
 521 0024 1349     		ldr	r1, .L32
 522              	.LVL42:
 164:controller/utils/comms.c ****         return true;
 523              		.loc 1 164 9 is_stmt 0 view .LVU121
 524 0026 1846     		mov	r0, r3
 525              	.LVL43:
 164:controller/utils/comms.c ****         return true;
 526              		.loc 1 164 9 view .LVU122
 527 0028 FFF7FEFF 		bl	send_response
 528              	.LVL44:
 165:controller/utils/comms.c ****     #endif
 529              		.loc 1 165 9 is_stmt 1 view .LVU123
 165:controller/utils/comms.c ****     #endif
 530              		.loc 1 165 16 is_stmt 0 view .LVU124
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 19


 531 002c 0120     		movs	r0, #1
 532 002e 20E0     		b	.L23
 533              	.LVL45:
 534              	.L24:
 167:controller/utils/comms.c ****     case TS_HELLO_COMMAND:
 535              		.loc 1 167 9 is_stmt 1 view .LVU125
 169:controller/utils/comms.c ****         return true;
 536              		.loc 1 169 9 view .LVU126
 537 0030 0023     		movs	r3, #0
 538 0032 1322     		movs	r2, #19
 539 0034 1049     		ldr	r1, .L32+4
 540              	.LVL46:
 169:controller/utils/comms.c ****         return true;
 541              		.loc 1 169 9 is_stmt 0 view .LVU127
 542 0036 1846     		mov	r0, r3
 543              	.LVL47:
 169:controller/utils/comms.c ****         return true;
 544              		.loc 1 169 9 view .LVU128
 545 0038 FFF7FEFF 		bl	send_response
 546              	.LVL48:
 170:controller/utils/comms.c ****         break;
 547              		.loc 1 170 9 is_stmt 1 view .LVU129
 170:controller/utils/comms.c ****         break;
 548              		.loc 1 170 16 is_stmt 0 view .LVU130
 549 003c 0120     		movs	r0, #1
 550 003e 18E0     		b	.L23
 551              	.LVL49:
 552              	.L26:
 171:controller/utils/comms.c ****     case TS_QUERY_COMMAND:
 553              		.loc 1 171 9 is_stmt 1 view .LVU131
 173:controller/utils/comms.c ****         return true;
 554              		.loc 1 173 9 view .LVU132
 555 0040 0023     		movs	r3, #0
 556 0042 1322     		movs	r2, #19
 557 0044 0C49     		ldr	r1, .L32+4
 558              	.LVL50:
 173:controller/utils/comms.c ****         return true;
 559              		.loc 1 173 9 is_stmt 0 view .LVU133
 560 0046 1846     		mov	r0, r3
 561              	.LVL51:
 173:controller/utils/comms.c ****         return true;
 562              		.loc 1 173 9 view .LVU134
 563 0048 FFF7FEFF 		bl	send_response
 564              	.LVL52:
 174:controller/utils/comms.c ****         break;
 565              		.loc 1 174 9 is_stmt 1 view .LVU135
 174:controller/utils/comms.c ****         break;
 566              		.loc 1 174 16 is_stmt 0 view .LVU136
 567 004c 0120     		movs	r0, #1
 568 004e 10E0     		b	.L23
 569              	.LVL53:
 570              	.L29:
 175:controller/utils/comms.c ****     case TS_TEST_COMMS_COMMAND:
 571              		.loc 1 175 9 is_stmt 1 view .LVU137
 177:controller/utils/comms.c ****         return true;
 572              		.loc 1 177 9 view .LVU138
 573 0050 0023     		movs	r3, #0
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 20


 574 0052 0122     		movs	r2, #1
 575 0054 FF21     		movs	r1, #255
 576              	.LVL54:
 177:controller/utils/comms.c ****         return true;
 577              		.loc 1 177 9 is_stmt 0 view .LVU139
 578 0056 1846     		mov	r0, r3
 579              	.LVL55:
 177:controller/utils/comms.c ****         return true;
 580              		.loc 1 177 9 view .LVU140
 581 0058 FFF7FEFF 		bl	send_response
 582              	.LVL56:
 178:controller/utils/comms.c ****         break;
 583              		.loc 1 178 9 is_stmt 1 view .LVU141
 178:controller/utils/comms.c ****         break;
 584              		.loc 1 178 16 is_stmt 0 view .LVU142
 585 005c 0120     		movs	r0, #1
 586 005e 08E0     		b	.L23
 587              	.LVL57:
 588              	.L27:
 179:controller/utils/comms.c ****     case TS_CAN_ID_COMMAND:
 589              		.loc 1 179 9 is_stmt 1 view .LVU143
 181:controller/utils/comms.c ****         return true;
 590              		.loc 1 181 9 view .LVU144
 591 0060 0023     		movs	r3, #0
 592 0062 1A46     		mov	r2, r3
 593 0064 1946     		mov	r1, r3
 594              	.LVL58:
 181:controller/utils/comms.c ****         return true;
 595              		.loc 1 181 9 is_stmt 0 view .LVU145
 596 0066 1846     		mov	r0, r3
 597              	.LVL59:
 181:controller/utils/comms.c ****         return true;
 598              		.loc 1 181 9 view .LVU146
 599 0068 FFF7FEFF 		bl	send_response
 600              	.LVL60:
 182:controller/utils/comms.c ****         break;
 601              		.loc 1 182 9 is_stmt 1 view .LVU147
 182:controller/utils/comms.c ****         break;
 602              		.loc 1 182 16 is_stmt 0 view .LVU148
 603 006c 0120     		movs	r0, #1
 604 006e 00E0     		b	.L23
 605              	.LVL61:
 606              	.L30:
 160:controller/utils/comms.c ****     {
 607              		.loc 1 160 5 view .LVU149
 608 0070 0020     		movs	r0, #0
 609              	.LVL62:
 610              	.L23:
 191:controller/utils/comms.c **** 
 611              		.loc 1 191 1 view .LVU150
 612 0072 08BD     		pop	{r3, pc}
 613              	.L33:
 614              		.align	2
 615              	.L32:
 616 0074 00000000 		.word	.LC2
 617 0078 04000000 		.word	.LC3
 618              		.cfi_endproc
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 21


 619              	.LFE234:
 621              		.section	.text.handle_page_read_command,"ax",%progbits
 622              		.align	1
 623              		.global	handle_page_read_command
 624              		.syntax unified
 625              		.thumb
 626              		.thumb_func
 628              	handle_page_read_command:
 629              	.LVL63:
 630              	.LFB236:
 303:controller/utils/comms.c **** 	if (page > 1)
 631              		.loc 1 303 1 is_stmt 1 view -0
 632              		.cfi_startproc
 633              		@ args = 0, pretend = 0, frame = 0
 634              		@ frame_needed = 0, uses_anonymous_args = 0
 304:controller/utils/comms.c **** 	{
 635              		.loc 1 304 2 view .LVU152
 304:controller/utils/comms.c **** 	{
 636              		.loc 1 304 5 is_stmt 0 view .LVU153
 637 0000 0128     		cmp	r0, #1
 638 0002 0DD8     		bhi	.L37
 303:controller/utils/comms.c **** 	if (page > 1)
 639              		.loc 1 303 1 view .LVU154
 640 0004 08B5     		push	{r3, lr}
 641              		.cfi_def_cfa_offset 8
 642              		.cfi_offset 3, -8
 643              		.cfi_offset 14, -4
 308:controller/utils/comms.c **** 	{
 644              		.loc 1 308 2 is_stmt 1 view .LVU155
 308:controller/utils/comms.c **** 	{
 645              		.loc 1 308 14 is_stmt 0 view .LVU156
 646 0006 8818     		adds	r0, r1, r2
 647              	.LVL64:
 308:controller/utils/comms.c **** 	{
 648              		.loc 1 308 5 view .LVU157
 649 0008 40F63813 		movw	r3, #2360
 650 000c 9842     		cmp	r0, r3
 651 000e 00DD     		ble	.L40
 652              	.LVL65:
 653              	.L34:
 314:controller/utils/comms.c **** 
 654              		.loc 1 314 1 view .LVU158
 655 0010 08BD     		pop	{r3, pc}
 656              	.LVL66:
 657              	.L40:
 313:controller/utils/comms.c **** }
 658              		.loc 1 313 2 is_stmt 1 view .LVU159
 659 0012 0123     		movs	r3, #1
 660 0014 0348     		ldr	r0, .L41
 661 0016 0144     		add	r1, r1, r0
 662              	.LVL67:
 313:controller/utils/comms.c **** }
 663              		.loc 1 313 2 is_stmt 0 view .LVU160
 664 0018 0020     		movs	r0, #0
 665 001a FFF7FEFF 		bl	send_response
 666              	.LVL68:
 313:controller/utils/comms.c **** }
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 22


 667              		.loc 1 313 2 view .LVU161
 668 001e F7E7     		b	.L34
 669              	.LVL69:
 670              	.L37:
 671              		.cfi_def_cfa_offset 0
 672              		.cfi_restore 3
 673              		.cfi_restore 14
 313:controller/utils/comms.c **** }
 674              		.loc 1 313 2 view .LVU162
 675 0020 7047     		bx	lr
 676              	.L42:
 677 0022 00BF     		.align	2
 678              	.L41:
 679 0024 00000000 		.word	calibration_values
 680              		.cfi_endproc
 681              	.LFE236:
 683              		.section	.text.process_command,"ax",%progbits
 684              		.align	1
 685              		.global	process_command
 686              		.syntax unified
 687              		.thumb
 688              		.thumb_func
 690              	process_command:
 691              	.LVL70:
 692              	.LFB235:
 194:controller/utils/comms.c ****     if (process_plain_command(request, size))
 693              		.loc 1 194 1 is_stmt 1 view -0
 694              		.cfi_startproc
 695              		@ args = 0, pretend = 0, frame = 8
 696              		@ frame_needed = 0, uses_anonymous_args = 0
 194:controller/utils/comms.c ****     if (process_plain_command(request, size))
 697              		.loc 1 194 1 is_stmt 0 view .LVU164
 698 0000 30B5     		push	{r4, r5, lr}
 699              		.cfi_def_cfa_offset 12
 700              		.cfi_offset 4, -12
 701              		.cfi_offset 5, -8
 702              		.cfi_offset 14, -4
 703 0002 83B0     		sub	sp, sp, #12
 704              		.cfi_def_cfa_offset 24
 705 0004 0546     		mov	r5, r0
 706 0006 0C46     		mov	r4, r1
 195:controller/utils/comms.c ****     {
 707              		.loc 1 195 5 is_stmt 1 view .LVU165
 195:controller/utils/comms.c ****     {
 708              		.loc 1 195 9 is_stmt 0 view .LVU166
 709 0008 FFF7FEFF 		bl	process_plain_command
 710              	.LVL71:
 195:controller/utils/comms.c ****     {
 711              		.loc 1 195 8 discriminator 1 view .LVU167
 712 000c 0028     		cmp	r0, #0
 713 000e 40F0A480 		bne	.L43
 199:controller/utils/comms.c ****     uint32_t packet_crc = 0;
 714              		.loc 1 199 5 is_stmt 1 view .LVU168
 715              	.LVL72:
 200:controller/utils/comms.c ****     uint32_t calculated_packet_crc = 0;
 716              		.loc 1 200 5 view .LVU169
 201:controller/utils/comms.c ****     bool is_packet_valid = false;
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 23


 717              		.loc 1 201 5 view .LVU170
 202:controller/utils/comms.c ****     if (size > 5)
 718              		.loc 1 202 5 view .LVU171
 203:controller/utils/comms.c ****     {
 719              		.loc 1 203 5 view .LVU172
 203:controller/utils/comms.c ****     {
 720              		.loc 1 203 8 is_stmt 0 view .LVU173
 721 0012 052C     		cmp	r4, #5
 722 0014 21D8     		bhi	.L62
 723              	.LVL73:
 724              	.L45:
 209:controller/utils/comms.c ****     {
 725              		.loc 1 209 5 is_stmt 1 view .LVU174
 211:controller/utils/comms.c ****     }
 726              		.loc 1 211 9 view .LVU175
 214:controller/utils/comms.c **** 
 727              		.loc 1 214 5 view .LVU176
 214:controller/utils/comms.c **** 
 728              		.loc 1 214 13 is_stmt 0 view .LVU177
 729 0016 AB78     		ldrb	r3, [r5, #2]	@ zero_extendqisi2
 730              	.LVL74:
 216:controller/utils/comms.c ****     {
 731              		.loc 1 216 5 is_stmt 1 view .LVU178
 732 0018 423B     		subs	r3, r3, #66
 733 001a 352B     		cmp	r3, #53
 734 001c 00F29880 		bhi	.L46
 735 0020 DFE803F0 		tbb	[pc, r3]
 736              	.L48:
 737 0024 8F       		.byte	(.L59-.L48)/2
 738 0025 20       		.byte	(.L58-.L48)/2
 739 0026 96       		.byte	(.L46-.L48)/2
 740 0027 96       		.byte	(.L46-.L48)/2
 741 0028 27       		.byte	(.L57-.L48)/2
 742 0029 96       		.byte	(.L46-.L48)/2
 743 002a 96       		.byte	(.L46-.L48)/2
 744 002b 2E       		.byte	(.L56-.L48)/2
 745 002c 96       		.byte	(.L46-.L48)/2
 746 002d 96       		.byte	(.L46-.L48)/2
 747 002e 96       		.byte	(.L46-.L48)/2
 748 002f 96       		.byte	(.L46-.L48)/2
 749 0030 96       		.byte	(.L46-.L48)/2
 750 0031 52       		.byte	(.L55-.L48)/2
 751 0032 96       		.byte	(.L46-.L48)/2
 752 0033 35       		.byte	(.L54-.L48)/2
 753 0034 96       		.byte	(.L46-.L48)/2
 754 0035 3C       		.byte	(.L53-.L48)/2
 755 0036 96       		.byte	(.L46-.L48)/2
 756 0037 96       		.byte	(.L46-.L48)/2
 757 0038 96       		.byte	(.L46-.L48)/2
 758 0039 6F       		.byte	(.L52-.L48)/2
 759 003a 96       		.byte	(.L46-.L48)/2
 760 003b 96       		.byte	(.L46-.L48)/2
 761 003c 96       		.byte	(.L46-.L48)/2
 762 003d 96       		.byte	(.L46-.L48)/2
 763 003e 96       		.byte	(.L46-.L48)/2
 764 003f 96       		.byte	(.L46-.L48)/2
 765 0040 96       		.byte	(.L46-.L48)/2
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 24


 766 0041 96       		.byte	(.L46-.L48)/2
 767 0042 96       		.byte	(.L46-.L48)/2
 768 0043 96       		.byte	(.L46-.L48)/2
 769 0044 96       		.byte	(.L46-.L48)/2
 770 0045 96       		.byte	(.L46-.L48)/2
 771 0046 96       		.byte	(.L46-.L48)/2
 772 0047 96       		.byte	(.L46-.L48)/2
 773 0048 43       		.byte	(.L51-.L48)/2
 774 0049 96       		.byte	(.L46-.L48)/2
 775 004a 96       		.byte	(.L46-.L48)/2
 776 004b 96       		.byte	(.L46-.L48)/2
 777 004c 96       		.byte	(.L46-.L48)/2
 778 004d 61       		.byte	(.L50-.L48)/2
 779 004e 96       		.byte	(.L46-.L48)/2
 780 004f 96       		.byte	(.L46-.L48)/2
 781 0050 96       		.byte	(.L46-.L48)/2
 782 0051 96       		.byte	(.L46-.L48)/2
 783 0052 96       		.byte	(.L46-.L48)/2
 784 0053 96       		.byte	(.L46-.L48)/2
 785 0054 59       		.byte	(.L49-.L48)/2
 786 0055 96       		.byte	(.L46-.L48)/2
 787 0056 96       		.byte	(.L46-.L48)/2
 788 0057 96       		.byte	(.L46-.L48)/2
 789 0058 96       		.byte	(.L46-.L48)/2
 790 0059 7F       		.byte	(.L47-.L48)/2
 791              	.LVL75:
 792              		.p2align 1
 793              	.L62:
 205:controller/utils/comms.c ****         packet_crc = swap_endian_uint32(*(uint32_t *)request[size - 1 - TS_PACKET_CRC_SIZE]);
 794              		.loc 1 205 9 view .LVU179
 206:controller/utils/comms.c ****         calculated_packet_crc = crc32_inc(0, (void *)(request + TS_PACKET_PREFIX_SIZE), size - TS_P
 795              		.loc 1 206 9 view .LVU180
 207:controller/utils/comms.c ****     }
 796              		.loc 1 207 9 view .LVU181
 207:controller/utils/comms.c ****     }
 797              		.loc 1 207 33 is_stmt 0 view .LVU182
 798 005a A21F     		subs	r2, r4, #6
 799 005c A91C     		adds	r1, r5, #2
 800 005e FFF7FEFF 		bl	crc32_inc
 801              	.LVL76:
 207:controller/utils/comms.c ****     }
 802              		.loc 1 207 33 view .LVU183
 803 0062 D8E7     		b	.L45
 804              	.LVL77:
 805              	.L58:
 806              	.LBB21:
 219:controller/utils/comms.c ****         return;
 807              		.loc 1 219 9 is_stmt 1 view .LVU184
 808 0064 0123     		movs	r3, #1
 809 0066 1A46     		mov	r2, r3
 810 0068 FF21     		movs	r1, #255
 811 006a 0020     		movs	r0, #0
 812 006c FFF7FEFF 		bl	send_response
 813              	.LVL78:
 220:controller/utils/comms.c ****         break;
 814              		.loc 1 220 9 view .LVU185
 815 0070 73E0     		b	.L43
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 25


 816              	.LVL79:
 817              	.L57:
 221:controller/utils/comms.c **** 
 818              		.loc 1 221 9 view .LVU186
 225:controller/utils/comms.c **** #endif
 819              		.loc 1 225 9 view .LVU187
 820 0072 0123     		movs	r3, #1
 821 0074 0322     		movs	r2, #3
 822 0076 3A49     		ldr	r1, .L63
 823 0078 0020     		movs	r0, #0
 824 007a FFF7FEFF 		bl	send_response
 825              	.LVL80:
 227:controller/utils/comms.c ****         break;
 826              		.loc 1 227 9 view .LVU188
 827 007e 6CE0     		b	.L43
 828              	.LVL81:
 829              	.L56:
 228:controller/utils/comms.c **** 
 830              		.loc 1 228 9 view .LVU189
 231:controller/utils/comms.c ****         return;
 831              		.loc 1 231 9 view .LVU190
 832 0080 0123     		movs	r3, #1
 833 0082 1A46     		mov	r2, r3
 834 0084 0021     		movs	r1, #0
 835 0086 0846     		mov	r0, r1
 836 0088 FFF7FEFF 		bl	send_response
 837              	.LVL82:
 232:controller/utils/comms.c ****         break;
 838              		.loc 1 232 9 view .LVU191
 839 008c 65E0     		b	.L43
 840              	.LVL83:
 841              	.L54:
 233:controller/utils/comms.c **** 
 842              		.loc 1 233 9 view .LVU192
 236:controller/utils/comms.c ****         return;
 843              		.loc 1 236 9 view .LVU193
 844 008e 0123     		movs	r3, #1
 845 0090 1322     		movs	r2, #19
 846 0092 3449     		ldr	r1, .L63+4
 847 0094 0020     		movs	r0, #0
 848 0096 FFF7FEFF 		bl	send_response
 849              	.LVL84:
 237:controller/utils/comms.c ****         break;
 850              		.loc 1 237 9 view .LVU194
 851 009a 5EE0     		b	.L43
 852              	.LVL85:
 853              	.L53:
 238:controller/utils/comms.c **** 
 854              		.loc 1 238 9 view .LVU195
 241:controller/utils/comms.c ****         return;
 855              		.loc 1 241 9 view .LVU196
 856 009c 0123     		movs	r3, #1
 857 009e 1422     		movs	r2, #20
 858 00a0 3049     		ldr	r1, .L63+4
 859 00a2 0020     		movs	r0, #0
 860 00a4 FFF7FEFF 		bl	send_response
 861              	.LVL86:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 26


 242:controller/utils/comms.c ****         break;
 862              		.loc 1 242 9 view .LVU197
 863 00a8 57E0     		b	.L43
 864              	.LVL87:
 865              	.L51:
 243:controller/utils/comms.c ****     case TS_SERIAL_INFO_COMMAND:
 866              		.loc 1 243 9 view .LVU198
 245:controller/utils/comms.c ****         response[0] = 2; // serial version
 867              		.loc 1 245 9 view .LVU199
 246:controller/utils/comms.c ****         *(uint16_t *)&response[1] = swap_endian_uint16(TS_TABLE_BLOCKING_FACTOR);
 868              		.loc 1 246 9 view .LVU200
 246:controller/utils/comms.c ****         *(uint16_t *)&response[1] = swap_endian_uint16(TS_TABLE_BLOCKING_FACTOR);
 869              		.loc 1 246 21 is_stmt 0 view .LVU201
 870 00aa 0223     		movs	r3, #2
 871 00ac 8DF80030 		strb	r3, [sp]
 872              	.LVL88:
 247:controller/utils/comms.c ****         *(uint16_t *)&response[3] = swap_endian_uint16(TS_BLOCKING_FACTOR);
 873              		.loc 1 247 9 is_stmt 1 view .LVU202
 247:controller/utils/comms.c ****         *(uint16_t *)&response[3] = swap_endian_uint16(TS_BLOCKING_FACTOR);
 874              		.loc 1 247 35 is_stmt 0 discriminator 1 view .LVU203
 875 00b0 0423     		movs	r3, #4
 876 00b2 ADF80130 		strh	r3, [sp, #1]	@ unaligned
 248:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)response, sizeof(response), TS_CRC);
 877              		.loc 1 248 9 is_stmt 1 view .LVU204
 248:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)response, sizeof(response), TS_CRC);
 878              		.loc 1 248 35 is_stmt 0 discriminator 1 view .LVU205
 879 00b6 ADF80330 		strh	r3, [sp, #3]	@ unaligned
 249:controller/utils/comms.c ****         return;
 880              		.loc 1 249 9 is_stmt 1 view .LVU206
 881 00ba 0123     		movs	r3, #1
 882 00bc 0522     		movs	r2, #5
 883 00be 6946     		mov	r1, sp
 884 00c0 0020     		movs	r0, #0
 885 00c2 FFF7FEFF 		bl	send_response
 886              	.LVL89:
 250:controller/utils/comms.c ****         break;
 887              		.loc 1 250 9 view .LVU207
 888 00c6 48E0     		b	.L43
 889              	.LVL90:
 890              	.L55:
 251:controller/utils/comms.c **** 
 891              		.loc 1 251 9 view .LVU208
 254:controller/utils/comms.c ****         return;
 892              		.loc 1 254 9 view .LVU209
 893 00c8 0123     		movs	r3, #1
 894 00ca 6522     		movs	r2, #101
 895 00cc 2649     		ldr	r1, .L63+8
 896 00ce 0020     		movs	r0, #0
 897 00d0 FFF7FEFF 		bl	send_response
 898              	.LVL91:
 255:controller/utils/comms.c ****         break;
 899              		.loc 1 255 9 view .LVU210
 900 00d4 41E0     		b	.L43
 901              	.LVL92:
 902              	.L49:
 256:controller/utils/comms.c ****     case TS_READ_COMMAND:
 903              		.loc 1 256 9 view .LVU211
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 27


 258:controller/utils/comms.c ****         uint16_t offset = *(uint16_t *)&request[3];
 904              		.loc 1 258 9 view .LVU212
 259:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 905              		.loc 1 259 9 view .LVU213
 260:controller/utils/comms.c ****         handle_page_read_command(page, offset, size);
 906              		.loc 1 260 9 view .LVU214
 261:controller/utils/comms.c ****         return;
 907              		.loc 1 261 9 view .LVU215
 908 00d6 B5F80520 		ldrh	r2, [r5, #5]
 909 00da B5F80310 		ldrh	r1, [r5, #3]
 910 00de 0020     		movs	r0, #0
 911 00e0 FFF7FEFF 		bl	handle_page_read_command
 912              	.LVL93:
 262:controller/utils/comms.c ****         break;
 913              		.loc 1 262 9 view .LVU216
 914 00e4 39E0     		b	.L43
 915              	.LVL94:
 916              	.L50:
 263:controller/utils/comms.c ****     case TS_CRC_CHECK_COMMAND:
 917              		.loc 1 263 9 view .LVU217
 265:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)&page_crc, sizeof(page_crc), TS_CRC);
 918              		.loc 1 265 9 view .LVU218
 265:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)&page_crc, sizeof(page_crc), TS_CRC);
 919              		.loc 1 265 29 is_stmt 0 view .LVU219
 920 00e6 40F63812 		movw	r2, #2360
 921 00ea 2049     		ldr	r1, .L63+12
 922 00ec 0020     		movs	r0, #0
 923 00ee FFF7FEFF 		bl	crc32_inc
 924              	.LVL95:
 265:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, (uint8_t *)&page_crc, sizeof(page_crc), TS_CRC);
 925              		.loc 1 265 18 discriminator 1 view .LVU220
 926 00f2 0090     		str	r0, [sp]
 266:controller/utils/comms.c ****         return;
 927              		.loc 1 266 9 is_stmt 1 view .LVU221
 928 00f4 0123     		movs	r3, #1
 929 00f6 0422     		movs	r2, #4
 930 00f8 6946     		mov	r1, sp
 931 00fa 0020     		movs	r0, #0
 932 00fc FFF7FEFF 		bl	send_response
 933              	.LVL96:
 267:controller/utils/comms.c ****         break;
 934              		.loc 1 267 9 view .LVU222
 935 0100 2BE0     		b	.L43
 936              	.LVL97:
 937              	.L52:
 268:controller/utils/comms.c **** 
 938              		.loc 1 268 9 view .LVU223
 939              	.LBB22:
 272:controller/utils/comms.c ****         uint16_t offset = *(uint16_t *)&request[3];
 940              		.loc 1 272 9 view .LVU224
 273:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 941              		.loc 1 273 9 view .LVU225
 273:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 942              		.loc 1 273 18 is_stmt 0 view .LVU226
 943 0102 B5F80330 		ldrh	r3, [r5, #3]
 944              	.LVL98:
 274:controller/utils/comms.c ****         memcpy(calibration_values.data + offset, &request[7], size);
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 28


 945              		.loc 1 274 9 is_stmt 1 view .LVU227
 275:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, NULL, 0, TS_CRC);
 946              		.loc 1 275 9 view .LVU228
 947 0106 B5F80520 		ldrh	r2, [r5, #5]
 948 010a E91D     		adds	r1, r5, #7
 949 010c 1748     		ldr	r0, .L63+12
 950 010e 1844     		add	r0, r0, r3
 951 0110 FFF7FEFF 		bl	memcpy
 952              	.LVL99:
 276:controller/utils/comms.c ****         return;
 953              		.loc 1 276 9 view .LVU229
 954 0114 0123     		movs	r3, #1
 955 0116 0022     		movs	r2, #0
 956 0118 1146     		mov	r1, r2
 957 011a 1046     		mov	r0, r2
 958 011c FFF7FEFF 		bl	send_response
 959              	.LVL100:
 277:controller/utils/comms.c ****         break;
 960              		.loc 1 277 9 view .LVU230
 961 0120 1BE0     		b	.L43
 962              	.LVL101:
 963              	.L47:
 278:controller/utils/comms.c ****     }
 964              		.loc 1 278 9 view .LVU231
 965              	.LBE22:
 966              	.LBB23:
 282:controller/utils/comms.c ****         uint16_t offset = *(uint16_t *)&request[3];
 967              		.loc 1 282 9 view .LVU232
 283:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 968              		.loc 1 283 9 view .LVU233
 283:controller/utils/comms.c ****         uint16_t size = *(uint16_t *)&request[5];
 969              		.loc 1 283 18 is_stmt 0 view .LVU234
 970 0122 B5F80330 		ldrh	r3, [r5, #3]
 971              	.LVL102:
 284:controller/utils/comms.c ****         memcpy(calibration_values.data + offset, &request[7], size);
 972              		.loc 1 284 9 is_stmt 1 view .LVU235
 285:controller/utils/comms.c ****         send_response(TS_RESPONSE_OK, NULL, 0, TS_CRC);
 973              		.loc 1 285 9 view .LVU236
 974 0126 B5F80520 		ldrh	r2, [r5, #5]
 975 012a E91D     		adds	r1, r5, #7
 976 012c 0F48     		ldr	r0, .L63+12
 977 012e 1844     		add	r0, r0, r3
 978 0130 FFF7FEFF 		bl	memcpy
 979              	.LVL103:
 286:controller/utils/comms.c ****         return;
 980              		.loc 1 286 9 view .LVU237
 981 0134 0123     		movs	r3, #1
 982 0136 0022     		movs	r2, #0
 983 0138 1146     		mov	r1, r2
 984 013a 1046     		mov	r0, r2
 985 013c FFF7FEFF 		bl	send_response
 986              	.LVL104:
 287:controller/utils/comms.c ****         break;
 987              		.loc 1 287 9 view .LVU238
 988 0140 0BE0     		b	.L43
 989              	.LVL105:
 990              	.L59:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 29


 288:controller/utils/comms.c ****     }
 991              		.loc 1 288 9 view .LVU239
 992              	.LBE23:
 293:controller/utils/comms.c ****         return;
 993              		.loc 1 293 9 view .LVU240
 994 0142 0123     		movs	r3, #1
 995 0144 0022     		movs	r2, #0
 996 0146 1146     		mov	r1, r2
 997 0148 0420     		movs	r0, #4
 998 014a FFF7FEFF 		bl	send_response
 999              	.LVL106:
 294:controller/utils/comms.c ****         break;
 1000              		.loc 1 294 9 view .LVU241
 1001 014e 04E0     		b	.L43
 1002              	.LVL107:
 1003              	.L46:
 295:controller/utils/comms.c ****     default:
 1004              		.loc 1 295 9 view .LVU242
 297:controller/utils/comms.c ****     }
 1005              		.loc 1 297 9 view .LVU243
 1006              	.LBE21:
 299:controller/utils/comms.c **** }
 1007              		.loc 1 299 5 view .LVU244
 1008 0150 4FF40051 		mov	r1, #8192
 1009 0154 0648     		ldr	r0, .L63+16
 1010 0156 FFF7FEFF 		bl	HAL_GPIO_TogglePin
 1011              	.LVL108:
 1012              	.L43:
 300:controller/utils/comms.c **** 
 1013              		.loc 1 300 1 is_stmt 0 view .LVU245
 1014 015a 03B0     		add	sp, sp, #12
 1015              		.cfi_def_cfa_offset 12
 1016              		@ sp needed
 1017 015c 30BD     		pop	{r4, r5, pc}
 1018              	.LVL109:
 1019              	.L64:
 300:controller/utils/comms.c **** 
 1020              		.loc 1 300 1 view .LVU246
 1021 015e 00BF     		.align	2
 1022              	.L63:
 1023 0160 00000000 		.word	.LC2
 1024 0164 04000000 		.word	.LC3
 1025 0168 00000000 		.word	output_channels
 1026 016c 00000000 		.word	calibration_values
 1027 0170 00080240 		.word	1073874944
 1028              		.cfi_endproc
 1029              	.LFE235:
 1031              		.section	.text.comms_task,"ax",%progbits
 1032              		.align	1
 1033              		.global	comms_task
 1034              		.syntax unified
 1035              		.thumb
 1036              		.thumb_func
 1038              	comms_task:
 1039              	.LFB233:
 145:controller/utils/comms.c ****     usb_packet_ptr_t packet;
 1040              		.loc 1 145 1 is_stmt 1 view -0
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 30


 1041              		.cfi_startproc
 1042              		@ Volatile: function does not return.
 1043              		@ args = 0, pretend = 0, frame = 8
 1044              		@ frame_needed = 0, uses_anonymous_args = 0
 1045              	.LVL110:
 145:controller/utils/comms.c ****     usb_packet_ptr_t packet;
 1046              		.loc 1 145 1 is_stmt 0 view .LVU248
 1047 0000 00B5     		push	{lr}
 1048              		.cfi_def_cfa_offset 4
 1049              		.cfi_offset 14, -4
 1050 0002 83B0     		sub	sp, sp, #12
 1051              		.cfi_def_cfa_offset 16
 1052              	.LVL111:
 1053              	.L66:
 146:controller/utils/comms.c ****     for (;;)
 1054              		.loc 1 146 5 is_stmt 1 view .LVU249
 147:controller/utils/comms.c ****     {
 1055              		.loc 1 147 5 view .LVU250
 149:controller/utils/comms.c ****         {
 1056              		.loc 1 149 9 view .LVU251
 149:controller/utils/comms.c ****         {
 1057              		.loc 1 149 13 is_stmt 0 view .LVU252
 1058 0004 4FF0FF33 		mov	r3, #-1
 1059 0008 0022     		movs	r2, #0
 1060 000a 6946     		mov	r1, sp
 1061 000c 0548     		ldr	r0, .L69
 1062 000e 0068     		ldr	r0, [r0]
 1063 0010 FFF7FEFF 		bl	osMessageQueueGet
 1064              	.LVL112:
 149:controller/utils/comms.c ****         {
 1065              		.loc 1 149 12 discriminator 1 view .LVU253
 1066 0014 0028     		cmp	r0, #0
 1067 0016 F5D1     		bne	.L66
 151:controller/utils/comms.c ****         }
 1068              		.loc 1 151 13 is_stmt 1 view .LVU254
 1069 0018 BDF80410 		ldrh	r1, [sp, #4]
 1070 001c 0098     		ldr	r0, [sp]
 1071 001e FFF7FEFF 		bl	process_command
 1072              	.LVL113:
 1073 0022 EFE7     		b	.L66
 1074              	.L70:
 1075              		.align	2
 1076              	.L69:
 1077 0024 00000000 		.word	usb_rx_queue
 1078              		.cfi_endproc
 1079              	.LFE233:
 1081              		.section	.text.handle_page_write_command,"ax",%progbits
 1082              		.align	1
 1083              		.global	handle_page_write_command
 1084              		.syntax unified
 1085              		.thumb
 1086              		.thumb_func
 1088              	handle_page_write_command:
 1089              	.LVL114:
 1090              	.LFB237:
 317:controller/utils/comms.c **** 	if (page > 1)
 1091              		.loc 1 317 1 view -0
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 31


 1092              		.cfi_startproc
 1093              		@ args = 0, pretend = 0, frame = 0
 1094              		@ frame_needed = 0, uses_anonymous_args = 0
 1095              		@ link register save eliminated.
 318:controller/utils/comms.c **** 	{
 1096              		.loc 1 318 2 view .LVU256
 322:controller/utils/comms.c **** 	{
 1097              		.loc 1 322 2 view .LVU257
 324:controller/utils/comms.c **** 	}
 1098              		.loc 1 324 3 view .LVU258
 327:controller/utils/comms.c **** 
 1099              		.loc 1 327 1 is_stmt 0 view .LVU259
 1100 0000 7047     		bx	lr
 1101              		.cfi_endproc
 1102              	.LFE237:
 1104              		.section	.text.comms_write_status_flag,"ax",%progbits
 1105              		.align	1
 1106              		.global	comms_write_status_flag
 1107              		.syntax unified
 1108              		.thumb
 1109              		.thumb_func
 1111              	comms_write_status_flag:
 1112              	.LVL115:
 1113              	.LFB238:
 331:controller/utils/comms.c **** 	uint8_t index = flag;
 1114              		.loc 1 331 1 is_stmt 1 view -0
 1115              		.cfi_startproc
 1116              		@ args = 0, pretend = 0, frame = 0
 1117              		@ frame_needed = 0, uses_anonymous_args = 0
 331:controller/utils/comms.c **** 	uint8_t index = flag;
 1118              		.loc 1 331 1 is_stmt 0 view .LVU261
 1119 0000 08B5     		push	{r3, lr}
 1120              		.cfi_def_cfa_offset 8
 1121              		.cfi_offset 3, -8
 1122              		.cfi_offset 14, -4
 1123 0002 0A46     		mov	r2, r1
 332:controller/utils/comms.c **** 	change_bit_uint32(&output_channels.status, index, state);
 1124              		.loc 1 332 2 is_stmt 1 view .LVU262
 1125              	.LVL116:
 333:controller/utils/comms.c **** }
 1126              		.loc 1 333 2 view .LVU263
 1127 0004 0146     		mov	r1, r0
 1128              	.LVL117:
 333:controller/utils/comms.c **** }
 1129              		.loc 1 333 2 is_stmt 0 view .LVU264
 1130 0006 0248     		ldr	r0, .L74
 1131              	.LVL118:
 333:controller/utils/comms.c **** }
 1132              		.loc 1 333 2 view .LVU265
 1133 0008 FFF7FEFF 		bl	change_bit_uint32
 1134              	.LVL119:
 334:controller/utils/comms.c **** 
 1135              		.loc 1 334 1 view .LVU266
 1136 000c 08BD     		pop	{r3, pc}
 1137              	.L75:
 1138 000e 00BF     		.align	2
 1139              	.L74:
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 32


 1140 0010 00000000 		.word	output_channels
 1141              		.cfi_endproc
 1142              	.LFE238:
 1144              		.global	rx_buffer
 1145              		.section	.bss.rx_buffer,"aw",%nobits
 1146              		.align	2
 1149              	rx_buffer:
 1150 0000 00000000 		.space	1054
 1150      00000000 
 1150      00000000 
 1150      00000000 
 1150      00000000 
 1151              		.global	tx_buffer
 1152              		.section	.bss.tx_buffer,"aw",%nobits
 1153              		.align	2
 1156              	tx_buffer:
 1157 0000 00000000 		.space	1054
 1157      00000000 
 1157      00000000 
 1157      00000000 
 1157      00000000 
 1158              		.global	rx_packet
 1159              		.section	.bss.rx_packet,"aw",%nobits
 1160              		.align	2
 1163              	rx_packet:
 1164 0000 00000000 		.space	66
 1164      00000000 
 1164      00000000 
 1164      00000000 
 1164      00000000 
 1165              		.global	calibration_values
 1166              		.section	.bss.calibration_values,"aw",%nobits
 1167              		.align	2
 1170              	calibration_values:
 1171 0000 00000000 		.space	2360
 1171      00000000 
 1171      00000000 
 1171      00000000 
 1171      00000000 
 1172              		.global	output_channels
 1173              		.section	.bss.output_channels,"aw",%nobits
 1174              		.align	2
 1177              	output_channels:
 1178 0000 00000000 		.space	101
 1178      00000000 
 1178      00000000 
 1178      00000000 
 1178      00000000 
 1179              		.global	usb_rx_queue
 1180              		.section	.bss.usb_rx_queue,"aw",%nobits
 1181              		.align	2
 1184              	usb_rx_queue:
 1185 0000 00000000 		.space	4
 1186              		.text
 1187              	.Letext0:
 1188              		.file 3 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 1189              		.file 4 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 33


 1190              		.file 5 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f401xc.h"
 1191              		.file 6 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev-
 1192              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_gpio.h"
 1193              		.file 8 "Middlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS_V2/cmsis_os2.h"
 1194              		.file 9 "controller/utils/comms.h"
 1195              		.file 10 "controller/types.h"
 1196              		.file 11 "controller/engine_cycle/trigger.h"
 1197              		.file 12 "controller/tables.h"
 1198              		.file 13 "controller/IO/analog_inputs.h"
 1199              		.file 14 "controller/IO/sensors.h"
 1200              		.file 15 "controller/utils/pid.h"
 1201              		.file 16 "controller/algorithm/governer.h"
 1202              		.file 17 "controller/controller.h"
 1203              		.file 18 "USB_DEVICE/App/usbd_cdc_if.h"
 1204              		.file 19 "C:/Users/alireza/AppData/Roaming/Code/User/globalStorage/bmd.stm32-for-vscode/@xpack-dev
 1205              		.file 20 "<built-in>"
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 34


DEFINED SYMBOLS
                            *ABS*:00000000 comms.c
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:21     .text.runtime_update_task:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:27     .text.runtime_update_task:00000000 runtime_update_task
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:146    .text.runtime_update_task:00000080 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1177   .bss.output_channels:00000000 output_channels
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:154    .text.transmit_crc_packet:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:160    .text.transmit_crc_packet:00000000 transmit_crc_packet
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:297    .text.transmit_crc_packet:00000078 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1156   .bss.tx_buffer:00000000 tx_buffer
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:302    .text.send_response:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:308    .text.send_response:00000000 send_response
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:365    .text.send_response:00000030 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:371    .rodata.comms_init.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:378    .text.comms_init:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:384    .text.comms_init:00000000 comms_init
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:455    .text.comms_init:0000005c $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1184   .bss.usb_rx_queue:00000000 usb_rx_queue
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1038   .text.comms_task:00000000 comms_task
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:464    .rodata.process_plain_command.str1.4:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:471    .text.process_plain_command:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:477    .text.process_plain_command:00000000 process_plain_command
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:499    .text.process_plain_command:0000000e $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:616    .text.process_plain_command:00000074 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:622    .text.handle_page_read_command:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:628    .text.handle_page_read_command:00000000 handle_page_read_command
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:679    .text.handle_page_read_command:00000024 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1170   .bss.calibration_values:00000000 calibration_values
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:684    .text.process_command:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:690    .text.process_command:00000000 process_command
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:737    .text.process_command:00000024 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:792    .text.process_command:0000005a $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1023   .text.process_command:00000160 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1032   .text.comms_task:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1077   .text.comms_task:00000024 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1082   .text.handle_page_write_command:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1088   .text.handle_page_write_command:00000000 handle_page_write_command
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1105   .text.comms_write_status_flag:00000000 $t
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1111   .text.comms_write_status_flag:00000000 comms_write_status_flag
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1140   .text.comms_write_status_flag:00000010 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1149   .bss.rx_buffer:00000000 rx_buffer
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1146   .bss.rx_buffer:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1153   .bss.tx_buffer:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1163   .bss.rx_packet:00000000 rx_packet
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1160   .bss.rx_packet:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1167   .bss.calibration_values:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1174   .bss.output_channels:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:1181   .bss.usb_rx_queue:00000000 $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:516    .text.process_plain_command:0000001f $d
C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s:516    .text.process_plain_command:00000020 $t

UNDEFINED SYMBOLS
change_bit_uint32
osDelay
engine
configuration
crc32_inc
ARM GAS  C:\Users\alireza\AppData\Local\Temp\cc8d8vxa.s 			page 35


memcpy
CDC_Transmit_FS
HAL_GPIO_WritePin
osMessageQueueNew
memset
osThreadNew
HAL_GPIO_TogglePin
osMessageQueueGet
